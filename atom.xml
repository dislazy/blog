<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>星空</title>
  
  <subtitle>Storms make trees take deeper roots.</subtitle>
  <link href="https://blog.bosong.online/atom.xml" rel="self"/>
  
  <link href="https://blog.bosong.online/"/>
  <updated>2022-06-02T01:05:59.617Z</updated>
  <id>https://blog.bosong.online/</id>
  
  <author>
    <name>Jack</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用Authelia来实现多站的OIDC登录</title>
    <link href="https://blog.bosong.online/%E4%BD%BF%E7%94%A8Authelia%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%AB%99%E7%9A%84OIDC%E7%99%BB%E5%BD%95.html"/>
    <id>https://blog.bosong.online/%E4%BD%BF%E7%94%A8Authelia%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%AB%99%E7%9A%84OIDC%E7%99%BB%E5%BD%95.html</id>
    <published>2022-06-02T00:58:35.000Z</published>
    <updated>2022-06-02T01:05:59.617Z</updated>
    
    <content type="html"><![CDATA[<p> <img src="https://imagecdn.bosong.online/uPic/61_1654131271466.jpeg" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/61_1654131271466.jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="61_1654131271466"></p><div class="story post-story"><h2 id="简单说说什么是OIDC"><a href="#简单说说什么是OIDC" class="headerlink" title="简单说说什么是OIDC"></a>简单说说什么是OIDC</h2><p>简单来说，OIDC是一个OAuth2上层的简单身份层协议。它允许客户端验证用户的身份并获取基本的用户配置信息。OIDC使用JSON Web Token（JWT）作为信息返回，通过符合OAuth2的流程来获取对应的TOKEN信息。</p><p>它的作用是为多个不同的站点提供登录功能（和SSO类似）。每次需要使用OIDC登录网站时，都会被重定向到登录的OpenID网站，然后再回到该网站。例如，如果选择使用Github帐户登录Grafana，这就使用了OIDC。成功通过Github身份验证并授权Grafana访问您的信息后，Github会将有关用户和执行的身份验证的信息发送回Grafana。此信息在JWT中返回，包含ID Token或者Access Token。</p><p>这样就实现了简单的登录流程，OIDC主要有以下几个作用：</p><p>1、OIDC的协议简化了登录的流程开发工作，在支持OIDC的应用简单配置即可使用</p><p>2、OIDC的协议有组别概念，可以限制用户可访问的资源内容</p><p>3、一个账号根据不同的资源权限访问不同的站点内容</p></div><div class="story post-story"><h2 id="如何配置Authelia来支持grafana通过OIDC登录"><a href="#如何配置Authelia来支持grafana通过OIDC登录" class="headerlink" title="如何配置Authelia来支持grafana通过OIDC登录"></a>如何配置Authelia来支持grafana通过OIDC登录</h2><p>先看<a href="https://www.authelia.com/docs/configuration/identity-providers/oidc.html">官方文档</a> ，官方文档写的还是比较详细的，创建一个OIDC应用，只需要在<code>configuration.yml</code>的后面加上对应的配置即可,在本文中我以grafana配置为例，简单说明grafana使用Authelia来进行登录</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">identity_providers:</span></span><br><span class="line">  <span class="attr">oidc:</span></span><br><span class="line">    <span class="attr">hmac_secret:</span> <span class="string">rc9uqHMWXf69M9TXrEfa2XoAtbXsbSGMvqWC</span></span><br><span class="line">    <span class="comment"># issuer_private_key 这个字段的内容我直接用docker-compose里面的env来替代，减少yaml中的配置长度和保护机密</span></span><br><span class="line">    <span class="comment">#AUTHELIA_IDENTITY_PROVIDERS_OIDC_ISSUER_PRIVATE_KEY_FILE=/config/key.pem</span></span><br><span class="line">    <span class="comment">#issuer_private_key:</span></span><br><span class="line">    <span class="attr">access_token_lifespan:</span> <span class="string">1h</span></span><br><span class="line">    <span class="attr">authorize_code_lifespan:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">id_token_lifespan:</span> <span class="string">1h</span></span><br><span class="line">    <span class="attr">refresh_token_lifespan:</span> <span class="string">90m</span></span><br><span class="line">    <span class="attr">enable_client_debug_messages:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">enforce_pkce:</span> <span class="string">public_clients_only</span></span><br><span class="line">    <span class="attr">cors:</span></span><br><span class="line">      <span class="attr">endpoints:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">authorization</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">token</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">revocation</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">introspection</span></span><br><span class="line">      <span class="comment">#这里允许配置为`*`,代表全部网站</span></span><br><span class="line">      <span class="attr">allowed_origins:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="comment">#  - https://example.com</span></span><br><span class="line">      <span class="attr">allowed_origins_from_client_redirect_uris:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">clients:</span></span><br><span class="line">      <span class="comment">#如果多个应用，复制下面同样的一大串进行具体配置即可</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">grafana</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">grafana</span></span><br><span class="line">        <span class="attr">secret:</span> <span class="string">GzPji9HrYbLQEX</span></span><br><span class="line">        <span class="attr">sector_identifier:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="attr">public:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment">#校验的级别，可以是one_factor等</span></span><br><span class="line">        <span class="attr">authorization_policy:</span> <span class="string">two_factor</span></span><br><span class="line">        <span class="attr">pre_configured_consent_duration:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="attr">audience:</span> []</span><br><span class="line">        <span class="comment">#可以访问到的用户信息，具体有哪些，可以直接看官方文档的说明</span></span><br><span class="line">        <span class="attr">scopes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">openid</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">groups</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">email</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">profile</span></span><br><span class="line">        <span class="comment">#在auth登录成功后需要重定向的接口地址，不同的应用需要根据实际情况配置</span></span><br><span class="line">        <span class="attr">redirect_uris:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">https://grafana.abc.com/login/generic_oauth</span></span><br><span class="line">        <span class="attr">grant_types:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">refresh_token</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">authorization_code</span></span><br><span class="line">        <span class="attr">response_types:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">code</span></span><br><span class="line">        <span class="attr">response_modes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">form_post</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">query</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">fragment</span></span><br><span class="line">        <span class="attr">userinfo_signing_algorithm:</span> <span class="string">none</span></span><br></pre></td></tr></table></figure><p>这样一个很简单的配置，就让Authelia实现了自身作为OIDC的身份提供商供 grafana 这个应用登录访问。</p><p>我们可以直接访问到你的authelia的地址来查看登录需要配置的端点信息：<code>https://auth.example.com/.well-known/openid-configuration</code> 将对应的<code>auth.example.com</code> 换成你自己的域名。</p></div><div class="story post-story"><h2 id="如何配置Grafana来使用Authelia提供的OIDC进行登录"><a href="#如何配置Grafana来使用Authelia提供的OIDC进行登录" class="headerlink" title="如何配置Grafana来使用Authelia提供的OIDC进行登录"></a>如何配置Grafana来使用Authelia提供的OIDC进行登录</h2><p>grafana 配置OIDC的登录官方也有完善的文档，但是我也遇到了一些小的坑点，所以我会在贴配置的同时，说明我遇到的坑点（其实是我菜）。</p><p>使用开源项目的对应功能，肯定第一步是看<a href="https://grafana.com/docs/grafana/latest/auth/generic-oauth/">官方文档</a> ，官方文档还是写的比较详细，但是它是一个通用文档，我们需要根据实际情况做一下小的变更。</p><h3 id="grafana使用docker-compose启动"><a href="#grafana使用docker-compose启动" class="headerlink" title="grafana使用docker-compose启动"></a>grafana使用docker-compose启动</h3><p>我的grafana是使用docker-compose启动的，它的配置很简单：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana-oss:$&#123;grafana_version&#125;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gateway</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;grafana-server --config /etc/grafana/grafana.ini&#x27;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">env_file:</span> <span class="string">.env</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana.ini:/etc/grafana/grafana.ini</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/grafana:/var/lib/grafana</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">disable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">4000</span><span class="string">:3000</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>这时候需要复制grafana的<a href="https://github.com/grafana/grafana/blob/main/conf/sample.ini">默认配置文件</a> 来写到<code>grafana.ini</code> 文件中了，数据库信息什么的配置。</p><p>注意我在这里碰到了一个坑点：当你需要启用对应的配置时候，需要将 <code>;</code>去掉，这样配置才能生效。（惯性思维是<code>#</code>，突然来个<code>;</code>号有点懵）。</p><h3 id="grafana支持Authelia登录访问"><a href="#grafana支持Authelia登录访问" class="headerlink" title="grafana支持Authelia登录访问"></a>grafana支持Authelia登录访问</h3><p>grafana 的配置写的比较简单命令，其他配置忽略的情况下，以下几个配置就能支持到authelia的登录访问了。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># The full public facing url you use in browser, used for redirects and emails</span></span><br><span class="line"><span class="comment"># 这个配置为你的grafana地址，需要进行配置</span></span><br><span class="line"><span class="string">root_url</span> <span class="string">=</span> <span class="string">https://grafana.abc.com</span></span><br><span class="line"><span class="comment"># 如果仅限OAuth仅限登录的话设置为true（建议先设置为false，待修改OIDC的权限配置为admin之后再关闭）</span></span><br><span class="line"><span class="string">disable_login_form</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#################################### Generic OAuth ##########################</span></span><br><span class="line">[<span class="string">auth.generic_oauth</span>]</span><br><span class="line"><span class="string">enabled</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line"><span class="string">name</span> <span class="string">=</span> <span class="string">authelia</span></span><br><span class="line"><span class="string">allow_sign_up</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line"><span class="string">client_id</span> <span class="string">=</span> <span class="string">grafana</span></span><br><span class="line"><span class="string">client_secret</span> <span class="string">=</span> <span class="string">GzPji9HrYbLQEX</span></span><br><span class="line"><span class="string">scopes</span> <span class="string">=</span> <span class="string">openid</span> <span class="string">profile</span> <span class="string">groups</span> <span class="string">email</span></span><br><span class="line"><span class="string">empty_scopes</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"><span class="string">auth_url</span> <span class="string">=</span> <span class="string">https://auth.example.com/api/oidc/authorization</span></span><br><span class="line"><span class="string">token_url</span> <span class="string">=</span> <span class="string">https://auth.example.com/api/oidc/token</span></span><br><span class="line"><span class="string">api_url</span> <span class="string">=</span> <span class="string">https://auth.example.com/oidc/userinfo</span></span><br><span class="line"><span class="string">use_pkce</span> <span class="string">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>配置完成后重启grafana之后，再次访问grafana就可以看到你配置的authelia登录框了，成果如下：</p><p> <img src="https://imagecdn.bosong.online/uPic/grafana_login_1654130801482.jpg" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/grafana_login_1654130801482.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="grafana_login_1654130801482"></p></div><div class="story post-story"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>实际上我总共配置了三个client: <a href="https://github.com/outline/outline">outline</a>、<a href="https://github.com/portainer/portainer">portainer</a>  这个参考<a href="https://www.authelia.com/docs/community/oidc-integrations/portainer.html">官方文档</a>即可配置成功、grafana，除了grafana花费了些许时间之外（主要是我菜，配置没有去掉<code>;</code>），其他两个配置都很简单。</p><p>现在authelia这个服务已经为我的数个网站提供登录保护支持，如果你有兴趣，可以与我一起交流探索更多的有趣的玩法，如果有遇到的一些问题欢迎一起探讨。</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt; &lt;img src=&quot;https://imagecdn.bosong.online/uPic/61_1654131271466.jpeg&quot; class=&quot;lazyload&quot; data-srcset=&quot;https://imagecdn.bosong.online/uPic/61_1654131271466.jpeg&quot; srcset=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==&quot; alt=&quot;61_1654131271466&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;简单说说什么是OIDC&quot;&gt;&lt;a href=&quot;#简单说说什么是OIDC&quot; class=&quot;headerlink&quot; title=&quot;简单说说什么是OIDC&quot;&gt;&lt;/a&gt;简单说说什么是OIDC&lt;/h2&gt;&lt;p&gt;简单来说，OIDC是一个OAuth2上层的简单身份层协议。它允许客户端验证用户的身份并获取基本的用户配置信息。OIDC使用JSON Web Token（JWT）作为信息返回，通过符合OAuth2的流程来获取对应的TOKEN信息。&lt;/p&gt;
&lt;p&gt;它的作用是为多个不同的站点提供登录功能（和SSO类似）。每次需要使用OIDC登录网站时，都会被重定向到登录的OpenID网站，然后再回到该网站。例如，如果选择使用Github帐户登录Grafana，这就使用了OIDC。成功通过Github身份验证并授权Grafana访问您的信息后，Github会将有关用户和执行的身份验证的信息发送回Grafana。此信息在JWT中返回，包含ID Token或者Access Token。&lt;/p&gt;
&lt;p&gt;这样就实现了简单的登录流程，OIDC主要有以下几个作用：&lt;/p&gt;
&lt;p&gt;1、OIDC的协议简化了登录的流程开发工作，在支持OIDC的应用简单配置即可使用&lt;/p&gt;
&lt;p&gt;2、OIDC的协议有组别概念，可以限制用户可访问的资源内容&lt;/p&gt;
&lt;p&gt;3、一个账号根据不同的资源权限访问不同的站点内容&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="技术手册" scheme="https://blog.bosong.online/categories/%E6%8A%80%E6%9C%AF%E6%89%8B%E5%86%8C/"/>
    
    
    <category term="oidc" scheme="https://blog.bosong.online/tags/oidc/"/>
    
    <category term="authelia" scheme="https://blog.bosong.online/tags/authelia/"/>
    
    <category term="grafana" scheme="https://blog.bosong.online/tags/grafana/"/>
    
  </entry>
  
  <entry>
    <title>Notebook软件的自我进化历程</title>
    <link href="https://blog.bosong.online/Notebook%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%87%AA%E6%88%91%E8%BF%9B%E5%8C%96%E5%8E%86%E7%A8%8B.html"/>
    <id>https://blog.bosong.online/Notebook%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%87%AA%E6%88%91%E8%BF%9B%E5%8C%96%E5%8E%86%E7%A8%8B.html</id>
    <published>2022-05-29T13:03:59.000Z</published>
    <updated>2022-06-02T01:05:59.614Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="说说过去"><a href="#说说过去" class="headerlink" title="说说过去"></a>说说过去</h2><p>对于程序员来说，有时候会有很多灵感爆发出来，然后这个时候就需要一个很灵活的笔记本能够记录自己的所思所想，快速的把想法沉淀到纸面上，而我也一直在寻找这样的一个好用的notebook。</p><p>我曾经用过好多款的notebook，但是或多或少的不是特别符合我的需求：</p><ul><li><strong><a href="https://www.notion.so/zh-cn">notion</a></strong> 笔记应用中的神器了，因为是商业化的有一些限制的，或者有一些个人隐私的内容不方便记录，试用了一段时间后放弃</li><li><strong><a href="https://github.com/zadam/trilium">trilium</a></strong> 也算是一个非常好用的笔记本了，优点就是无线层级，并且能快速记录每日的一个笔记，缺点可能就是颜值过低，然后数据存储是Sqlite,使用了很长一段时间后放弃</li><li><strong><a href="https://www.yuque.com/">语雀</a></strong> 国产的笔记软件，它的定位是类似于wiki这样的模式，创建一个文档还是比较繁琐，至少需要连续点3击三次以上，我要的是点击一次就能创建一个文档，给提了需求无果以后放弃。</li><li><strong><a href="https://github.com/leanote">蚂蚁笔记</a></strong> 蚂蚁笔记实际上是国内各种社区上推文比较多的一款了，文档也很详实，但是因为开源不再更新，所以不考虑使用</li><li><strong><a href="https://github.com/standardnotes">standardnotes </a></strong> 这个是用截止到目前用的时间最长的笔记软件，够简洁，但是毕竟作为一个开源的商业化软件，自建的文档写的不是特别详细，很多功能都能设置，但是不生效，备份措施很多，但是只局限于付费会员（也不提供开源的方法配置），所以我一直在寻找替代品</li><li><strong><a href="https://github.com/m0ngr31/DailyNotes">dailynotes</a></strong> dailynotes是一款小众的开源笔记本，它的作用主要是以日期为标题记录一些工作内容，当天的todo啥的，非常好用，一开始只支持了Sqlite，但是我看完源码之后，发现非常简单，进行了一些自定义的改造和自动化部署，一直把它当做每日todo在使用，现在还用着，非常好用</li><li><strong><a href="https://github.com/requarks/wiki">wikijs</a></strong> wikijs是一款我用来替代standardnotes的笔记本，部署简单，操作简单，但是它的作用还是wiki类，创建一个文档，至少要点三次，所以找到替代品以后无奈放弃</li><li><strong><a href="https://github.com/outline/outline">outline</a></strong> 这个我发现的最晚，但是发现是最好用的笔记本，部署比较简单，但是需要的组件比较繁琐，需要PostgreSQL、自建的oidc登录、aws s3或者兼容的tencent cos等,主要是有层级结构，颜值还行，操作简单，我创建文档点一下就可以，备份也很简单，会帮我直接存储到tencent cos上，不用担心数据丢失。</li></ul><p>我对Notebook的要求也比较简单:</p><ul><li>支持web页面访问，我有几个电脑，用软件的话一个一个下载怕是要疯</li><li>创建文档或者笔记简单，最好是点一下就可以，并且支持markdown编辑器</li><li>备份简单，最好能直接备份我的原始markdown文档，不给markdown重命名或者添加一个特别的标签</li><li>数据安全 数据安全最合适的方法就是开源笔记，数据都在自己手上，不用担心泄密</li></ul></div><div class="story post-story"><h2 id="说说当前"><a href="#说说当前" class="headerlink" title="说说当前"></a>说说当前</h2><p>自从发现了<a href="https://github.com/outline/outline">outline</a>以后，我还尝试着去注册，试用一下，然而在官网给了我致命打击，只支持组织类的账户注册，还都是google&#x2F;slack等软件，然后发现开源，我就试着看对应的搭建文档，总体还是比较简单，它面向的客户主要是企业类客户，所以很多方面设计是偏向于企业化设计的，包括组件，刚好我有一些替代品：</p><ul><li>PostgreSQL 刚好我有自建的,没有成本直接使用</li><li>Redis 刚好我有自建的，没有成本直接使用</li><li>Mail 刚好我有自己的邮箱服务器，也是可以直接使用</li><li>OIDC 刚好我自己一直在使用的web层sso软件: authelia 支持OIDC,简单配置一番即可使用</li><li>AWS S3 我是长期使用tencent cos 它是兼容s3协议的，虽然稍微有些不完美，但是还是可以使用，这个备份的文件直接存储到cos上</li></ul><p>一切就是那么的巧合，我迫不及待的创建好数据库和对应的账户，创建好cos的存储桶和单独的ak,配置基于authelia的OIDC，那么一切就开始了，就很简单，创建好<code>.env </code>然后放入在github仓库中复制的模板，创建好docker-compose文件，一键启动。</p></div><div class="story post-story"><h2 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h2><p>数据迁移一直是一件比较难受的事情，我之前从<a href="https://github.com/standardnotes">standardnotes</a>迁移到<a href="https://github.com/requarks/wiki">wikijs</a> 在周末的深夜花了两三个小时，迁移我的接近100多篇的各种文档，然后第二天睡醒就感觉wikijs可能用不长久了，因为创建一个文档要点三次以上。</p><p>然而outline的迁移远比我想象的要简单，直接把wikijs的github上的备份仓库下载下来，然后直接把markdown里面的标题等信息全部手动移除，直接导入到outline就可以了，它支持直接导入文档，我只花了十几分钟来去掉markdown里面的多余信息，就完成了备份迁移过程。</p></div><div class="story post-story"><h2 id="我目前使用的开源软件"><a href="#我目前使用的开源软件" class="headerlink" title="我目前使用的开源软件"></a>我目前使用的开源软件</h2><p>使用开源软件最多的目的是为了减少数据泄密，还有方便自己的生活，列举一下我目前在使用的开源软件</p><ul><li><strong><a href="https://github.com/dani-garcia/vaultwarden">bitwarden</a></strong> 开源的密码管理软件，我用的是社区爱好者自己根据官方的接口进行重新实现的版本，它搭配chrome的bitwarden插件我压根没手动输入过密码，而且我的绝大多数密码都是复杂密码，不用担心账号被盗取</li><li><strong><a href="https://github.com/authelia/authelia">authelia </a></strong> 开源的SSO，它可以直接在Nginx层配置没有账号密码管理的软件，给他们套上一层登录，减少了大量的账号系统的开发工作，它目前在防护我的web版ssh页面、大学毕业班级相册、包括OIDC的outline等服务</li><li><strong><a href="https://squoosh.songbo.fun/">squoosh </a></strong> 是google开源的图片压缩软件，我主要担心图片被泄露，所以打包开源代码自建了一个，放在cdn上也能加快访问速度，它是完全本地化的图片裁剪，不会把图片存储到服务器上</li><li><strong><a href="https://github.com/nirui/sshwifty">sshwifty </a></strong> 颜值比较高的还比较简单的web版ssh管理工具，用过很多，要么特别重，要么颜值很低，这款比较轻量，我在前面套上authelia提供的SSO，也不用担心被随意访问我的私人服务器</li><li><strong><a href="https://github.com/m0ngr31/DailyNotes">dailynotes </a></strong> 目前使用的每日记录工具，它和notebook的区别是以当天日期记录的一个笔记，适合用来做日常工作todo，时间久了往前倒倒看最近每天或者过去一个阶段做了点啥，还是比较合适，比较轻量，导出备份也是特别简单</li><li><strong><a href="https://github.com/grafana/grafana">grafana </a></strong> 这个主要是用来看云服务器监控指标，属于运维类的，平常使用率不是特别高</li><li><strong><a href="https://github.com/cppla/ServerStatus">serverStatus </a></strong> 主要是用来看云服务器的基础指标，部署和使用都比较简单</li><li><strong><a href="https://github.com/outline/outline">outline </a></strong> 日常使用的笔记本，目前使用起来非常顺畅，导出数据也是很简单</li><li><strong><a href="https://github.com/portainer/portainer">portainer </a></strong> docker容器的管理软件，基本上用它来在线看各个机器上的docker指标等信息</li><li><strong><a href="https://github.com/dbeaver/cloudbeaver">cloudbeaver </a></strong> 在线的mysql等的链接工具，直接在网页上使用，平常如果换到陌生机器的话不用安装软件就可以直接快速查找数据库</li><li>…其实还有一些，但是因为使用频次不是特别高，所以没有特别的列举出来</li></ul></div><div class="story post-story"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这篇文章主要就是讲述一下我的网络版notebook的软件使用历史，一个好用的工具能让你节省很多的时间和精力，并且能让你的思绪能够快速的被记录下来。工欲善其事必先利其器，我算是一个喜欢折腾的人，平常会收集很多自己常用的软件，大部分是开源软件，对于我来说数据安全得到了保障，并且能增加我的阅历和生活，给无聊的生活带来一些乐趣，像OIDC这种东西，如果不是运维啊什么的，基本上很难去接触到，这也算是对自己技术能力的一个提升。</p><p>我对现代化软件最大的期望就是都能够在浏览器里直接运行，并且最好能在国内访问，这样速度和安全性都能得到保障，安装软件还算是一件比较痛苦的事情。</p><p>作为喜欢使用开源软件的程序员，也是深深的感谢开源文化，我日常也在积极参与开源，不局限于给常用的软件提PR，提升用户体验和自己的一些体验，自己也有一些开源的项目，比较简单，就主要是为了增加自己各种项目的自动化进程，减少人工干预。</p></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;说说过去&quot;&gt;&lt;a href=&quot;#说说过去&quot; class=&quot;headerlink&quot; title=&quot;说说过去&quot;&gt;&lt;/a&gt;说说过去&lt;/h2&gt;&lt;p&gt;对于程序员来说，有时候会有很多灵感爆发出来，然后这个时候就需要一个很灵活的笔记本能够记录自己的所思所想，快速的把想法沉淀到纸面上，而我也一直在寻找这样的一个好用的notebook。&lt;/p&gt;
&lt;p&gt;我曾经用过好多款的notebook，但是或多或少的不是特别符合我的需求：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.notion.so/zh-cn&quot;&gt;notion&lt;/a&gt;&lt;/strong&gt; 笔记应用中的神器了，因为是商业化的有一些限制的，或者有一些个人隐私的内容不方便记录，试用了一段时间后放弃&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/zadam/trilium&quot;&gt;trilium&lt;/a&gt;&lt;/strong&gt; 也算是一个非常好用的笔记本了，优点就是无线层级，并且能快速记录每日的一个笔记，缺点可能就是颜值过低，然后数据存储是Sqlite,使用了很长一段时间后放弃&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.yuque.com/&quot;&gt;语雀&lt;/a&gt;&lt;/strong&gt; 国产的笔记软件，它的定位是类似于wiki这样的模式，创建一个文档还是比较繁琐，至少需要连续点3击三次以上，我要的是点击一次就能创建一个文档，给提了需求无果以后放弃。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/leanote&quot;&gt;蚂蚁笔记&lt;/a&gt;&lt;/strong&gt; 蚂蚁笔记实际上是国内各种社区上推文比较多的一款了，文档也很详实，但是因为开源不再更新，所以不考虑使用&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/standardnotes&quot;&gt;standardnotes &lt;/a&gt;&lt;/strong&gt; 这个是用截止到目前用的时间最长的笔记软件，够简洁，但是毕竟作为一个开源的商业化软件，自建的文档写的不是特别详细，很多功能都能设置，但是不生效，备份措施很多，但是只局限于付费会员（也不提供开源的方法配置），所以我一直在寻找替代品&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/m0ngr31/DailyNotes&quot;&gt;dailynotes&lt;/a&gt;&lt;/strong&gt; dailynotes是一款小众的开源笔记本，它的作用主要是以日期为标题记录一些工作内容，当天的todo啥的，非常好用，一开始只支持了Sqlite，但是我看完源码之后，发现非常简单，进行了一些自定义的改造和自动化部署，一直把它当做每日todo在使用，现在还用着，非常好用&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/requarks/wiki&quot;&gt;wikijs&lt;/a&gt;&lt;/strong&gt; wikijs是一款我用来替代standardnotes的笔记本，部署简单，操作简单，但是它的作用还是wiki类，创建一个文档，至少要点三次，所以找到替代品以后无奈放弃&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/outline/outline&quot;&gt;outline&lt;/a&gt;&lt;/strong&gt; 这个我发现的最晚，但是发现是最好用的笔记本，部署比较简单，但是需要的组件比较繁琐，需要PostgreSQL、自建的oidc登录、aws s3或者兼容的tencent cos等,主要是有层级结构，颜值还行，操作简单，我创建文档点一下就可以，备份也很简单，会帮我直接存储到tencent cos上，不用担心数据丢失。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我对Notebook的要求也比较简单:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;支持web页面访问，我有几个电脑，用软件的话一个一个下载怕是要疯&lt;/li&gt;
&lt;li&gt;创建文档或者笔记简单，最好是点一下就可以，并且支持markdown编辑器&lt;/li&gt;
&lt;li&gt;备份简单，最好能直接备份我的原始markdown文档，不给markdown重命名或者添加一个特别的标签&lt;/li&gt;
&lt;li&gt;数据安全 数据安全最合适的方法就是开源笔记，数据都在自己手上，不用担心泄密&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;说说当前&quot;&gt;&lt;a href=&quot;#说说当前&quot; class=&quot;headerlink&quot; title=&quot;说说当前&quot;&gt;&lt;/a&gt;说说当前&lt;/h2&gt;&lt;p&gt;自从发现了&lt;a href=&quot;https://github.com/outline/outline&quot;&gt;outline&lt;/a&gt;以后，我还尝试着去注册，试用一下，然而在官网给了我致命打击，只支持组织类的账户注册，还都是google&amp;#x2F;slack等软件，然后发现开源，我就试着看对应的搭建文档，总体还是比较简单，它面向的客户主要是企业类客户，所以很多方面设计是偏向于企业化设计的，包括组件，刚好我有一些替代品：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PostgreSQL 刚好我有自建的,没有成本直接使用&lt;/li&gt;
&lt;li&gt;Redis 刚好我有自建的，没有成本直接使用&lt;/li&gt;
&lt;li&gt;Mail 刚好我有自己的邮箱服务器，也是可以直接使用&lt;/li&gt;
&lt;li&gt;OIDC 刚好我自己一直在使用的web层sso软件: authelia 支持OIDC,简单配置一番即可使用&lt;/li&gt;
&lt;li&gt;AWS S3 我是长期使用tencent cos 它是兼容s3协议的，虽然稍微有些不完美，但是还是可以使用，这个备份的文件直接存储到cos上&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一切就是那么的巧合，我迫不及待的创建好数据库和对应的账户，创建好cos的存储桶和单独的ak,配置基于authelia的OIDC，那么一切就开始了，就很简单，创建好&lt;code&gt;.env &lt;/code&gt;然后放入在github仓库中复制的模板，创建好docker-compose文件，一键启动。&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="常用软件" scheme="https://blog.bosong.online/categories/%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="开源" scheme="https://blog.bosong.online/tags/%E5%BC%80%E6%BA%90/"/>
    
    <category term="notebook" scheme="https://blog.bosong.online/tags/notebook/"/>
    
  </entry>
  
  <entry>
    <title>使用简单脚本实现github与其他所有git仓库的双向同步</title>
    <link href="https://blog.bosong.online/%E4%BD%BF%E7%94%A8%E7%AE%80%E5%8D%95%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0github%E4%B8%8E%E5%85%B6%E4%BB%96%E6%89%80%E6%9C%89git%E4%BB%93%E5%BA%93%E7%9A%84%E5%8F%8C%E5%90%91%E5%90%8C%E6%AD%A5.html"/>
    <id>https://blog.bosong.online/%E4%BD%BF%E7%94%A8%E7%AE%80%E5%8D%95%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0github%E4%B8%8E%E5%85%B6%E4%BB%96%E6%89%80%E6%9C%89git%E4%BB%93%E5%BA%93%E7%9A%84%E5%8F%8C%E5%90%91%E5%90%8C%E6%AD%A5.html</id>
    <published>2022-05-20T00:35:48.000Z</published>
    <updated>2022-06-02T01:05:59.617Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>写这篇文章的初衷是昨天晚上记录一下我从gitee迁移到codeup的一系列过程，其中最后一步涉及到了github与codeup代码的双向同步，所以记录趁热记录一下我的github action如何使用。</p></div><div class="story post-story"><h2 id="More-Hub-Mirror-Action"><a href="#More-Hub-Mirror-Action" class="headerlink" title="More Hub Mirror Action"></a>More Hub Mirror Action</h2><p>我给这个github action起名叫做<a href="https://github.com/marketplace/actions/more-hub-mirror-action">More Hub Mirror Action</a>,代表它能在多个hub托管平台之上相互同步代码，主要用来做代码备份以及开源镜像同步。</p><p>我的介绍大概是这样写的：</p><p>一个用于在hub间（例如Github，Gitee、Coding，不局限，可以是所有）账户代码仓库同步的action，这个项目脱胎于Yikun&#x2F;hub-mirror-action@master。</p><ol><li><p>由于我是想要一个纯粹的不同的hub之间 同步的脚本，所以将该脚本进行了删减，不是作者做的不好，只是我仅仅需要简单的功能罢了</p></li><li><p>目前只支持，也只会支持两个仓库必须在两个hub之间存在的情况，不再创建新的仓库（由于创建仓库需要api支持，但是为了更通用，所以决定不支持对应的功能）</p></li><li><p>根据能量守恒定律，失去些什么，必然能得到些什么，这样就可以在不同的hub之间同步数据，不管是 从 github-&gt;gitee 还是 gitee-github 都可以支持到</p></li><li><p>src、dst 都需要写全路径了，例如：github.com&#x2F;kunpengcompute</p></li><li><p>static_list 是必传参数，因为不会再动态获取对应的repos了</p></li><li><p>dst_key 也是必传参数，因为为了安全考虑，我决定全部使用ssh的方式进行同步，如果后期有需要，可以兼容https</p></li></ol></div><div class="story post-story"><h2 id="怎么用"><a href="#怎么用" class="headerlink" title="怎么用"></a>怎么用</h2><p>同步过程主要分为两步：</p><ol><li>使用定时任务同步或者使用github的webhook触发同步</li><li>配置好对应的项目，然后让github action跑起来即可。</li></ol><h3 id="创建一个单独仓库，专门用来跑github-action"><a href="#创建一个单独仓库，专门用来跑github-action" class="headerlink" title="创建一个单独仓库，专门用来跑github action"></a>创建一个单独仓库，专门用来跑github action</h3><p>创建好对应的github action，有两个，可以使用同一个action进行操作，我创建的仓库名是：<code>github-sync</code>,下面我都以该仓库名作为github action的webhook进行请求。</p><p>先要做几个准备：</p><ol><li>创建一个ssh密钥，在github和你创建的仓库都进行配置，不会创建ssh密钥的话参考<a href="https://gitee.com/help/articles/4181">文档</a>即可。</li><li>创建一个github的token它的作用主要是给你的webhook做安全验证的，<a href="https://github.com/settings/tokens/new">点击</a>创建token。</li></ol><p>该仓库下的github action配置如下：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a basic workflow to help you get started with Actions</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name:</span> <span class="string">signle_repo_codeup2github</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls when the workflow will run</span></span><br><span class="line"><span class="attr">on:</span> </span><br><span class="line"> <span class="comment">#定时任务自动触发（最好和webhook的拆分为两个）</span></span><br><span class="line"> <span class="comment">#schedule:</span></span><br><span class="line">  <span class="comment">#  - cron: 0 */12 * * *</span></span><br><span class="line"> <span class="comment">#使用github的webhook触发</span></span><br><span class="line"> <span class="attr">repository_dispatch:</span></span><br><span class="line">   <span class="attr">types:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">codeup_push</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#手动触发</span></span><br><span class="line"> <span class="attr">workflow_dispatch:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">repo-sync:</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">dst_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GIT_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sync</span> <span class="string">codeup</span> <span class="string">repo</span> <span class="string">to</span> <span class="string">github</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">dislazy/hub-mirror-action@v2.0.0</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">env.dst_key</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="comment"># 必选，需要同步的 git 用户（源）</span></span><br><span class="line">          <span class="attr">src:</span> <span class="string">&#x27;codeup.aliyun.com/dislazy&#x27;</span></span><br><span class="line">          <span class="comment"># 必选，需要同步到的 git 用户（目的）</span></span><br><span class="line">          <span class="attr">dst:</span> <span class="string">&#x27;github.com/dislazy&#x27;</span></span><br><span class="line">          <span class="comment"># 必选，公钥对应的私钥，https://gitee.com/profile/sshkeys</span></span><br><span class="line">          <span class="attr">dst_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GIT_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment">#必选，同步的仓库列表，多个用,分开即可</span></span><br><span class="line">          <span class="attr">static_list:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.client_payload.repo</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment">#启用git push -f强制同步，注意：开启后，会强制覆盖目的端仓库。</span></span><br><span class="line">          <span class="attr">force_update:</span> <span class="literal">true</span></span><br><span class="line">          <span class="comment">#配置cache</span></span><br><span class="line">          <span class="attr">cache_path:</span> <span class="string">/codeup/workspace</span></span><br></pre></td></tr></table></figure><p>简单说明：</p><ul><li><p><strong>codeup_push</strong>，这个是webhook和github约定好的event，填已有的即可</p></li><li><p><strong>secrets.GIT_PRIVATE_KEY</strong> 这个是上面提到的ssh密钥，及时放在github的secrets中</p></li><li><p><strong>src</strong>、<strong>dst</strong>使用除了https之外的个人路径全路径，src和dst可以随便填你想要同步的两个hub，甚至可以不是github(身在曹营心在汉的即视感)</p></li><li><p><strong>github.event.client_payload.repo</strong> 这个是你在webhook中提到的你要同步的仓库</p></li></ul><h3 id="在任意处创建对应的webhook请求github-api同步仓库"><a href="#在任意处创建对应的webhook请求github-api同步仓库" class="headerlink" title="在任意处创建对应的webhook请求github api同步仓库"></a>在任意处创建对应的webhook请求github api同步仓库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H &#x27;Accept: application/vnd.github.v3+json&#x27; -H &#x27;Authorization: token $&#123;github-token&#125;&#x27; https://api.github.com/repos/dislazy/github-sync/dispatches -d &#x27;&#123;&quot;event_type&quot;:&quot;codeup_push&quot;,&quot;client_payload&quot;:&#123;&quot;repo&quot;:&quot;$&#123;repos_name&#125;&quot;,&quot;message&quot;:&quot;github action sync&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure><p>简单说明：</p><ul><li><strong>github-token</strong> 替换为你准备工作中创建的github token</li><li><strong>repos_name</strong> 你需要同步的仓库列表，多个用<code>,</code>分隔开即可</li><li><strong>event_type</strong> 就是上面约定的event密钥，保持一致即可</li></ul></div><div class="story post-story"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我目前使用以上的脚本基本上分为两个大块：</p><ol><li>使用定时任务执行github api，用来同步一些固定需要同步的仓库，如果仓库新增了直接改webhook的请求参数即可</li><li>当codeup提交代码的时候使用对应的flow工作流触发github api请求，异步完成github 同步请求</li></ol><p>开源的工具有很多，大多数都是为不同的需求不同的人群定制的，如果找不到合适的，如果有能力改一改也是极好的。</p></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;写这篇文章的初衷是昨天晚上记录一下我从gitee迁移到codeup的一系列过程，其中最后一步涉及到了github与codeup代码的双向同步，所以记录趁热记录一下我的github action如何使用。&lt;/p&gt;
&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;More-Hub-Mirror-Action&quot;&gt;&lt;a href=&quot;#More-Hub-Mirror-Action&quot; class=&quot;headerlink&quot; title=&quot;More Hub Mirror Action&quot;&gt;&lt;/a&gt;More Hub Mirror Action&lt;/h2&gt;&lt;p&gt;我给这个github action起名叫做&lt;a href=&quot;https://github.com/marketplace/actions/more-hub-mirror-action&quot;&gt;More Hub Mirror Action&lt;/a&gt;,代表它能在多个hub托管平台之上相互同步代码，主要用来做代码备份以及开源镜像同步。&lt;/p&gt;
&lt;p&gt;我的介绍大概是这样写的：&lt;/p&gt;
&lt;p&gt;一个用于在hub间（例如Github，Gitee、Coding，不局限，可以是所有）账户代码仓库同步的action，这个项目脱胎于Yikun&amp;#x2F;hub-mirror-action@master。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;由于我是想要一个纯粹的不同的hub之间 同步的脚本，所以将该脚本进行了删减，不是作者做的不好，只是我仅仅需要简单的功能罢了&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;目前只支持，也只会支持两个仓库必须在两个hub之间存在的情况，不再创建新的仓库（由于创建仓库需要api支持，但是为了更通用，所以决定不支持对应的功能）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;根据能量守恒定律，失去些什么，必然能得到些什么，这样就可以在不同的hub之间同步数据，不管是 从 github-&amp;gt;gitee 还是 gitee-github 都可以支持到&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;src、dst 都需要写全路径了，例如：github.com&amp;#x2F;kunpengcompute&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;static_list 是必传参数，因为不会再动态获取对应的repos了&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;dst_key 也是必传参数，因为为了安全考虑，我决定全部使用ssh的方式进行同步，如果后期有需要，可以兼容https&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="git" scheme="https://blog.bosong.online/categories/git/"/>
    
    
    <category term="github" scheme="https://blog.bosong.online/tags/github/"/>
    
    <category term="github action" scheme="https://blog.bosong.online/tags/github-action/"/>
    
  </entry>
  
  <entry>
    <title>从gitee到codeup,我经历了什么？</title>
    <link href="https://blog.bosong.online/%E4%BB%8Egitee%E5%88%B0codeup-%E6%88%91%E7%BB%8F%E5%8E%86%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F.html"/>
    <id>https://blog.bosong.online/%E4%BB%8Egitee%E5%88%B0codeup-%E6%88%91%E7%BB%8F%E5%8E%86%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F.html</id>
    <published>2022-05-19T16:16:56.000Z</published>
    <updated>2022-06-02T01:05:59.616Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a href="https://gitee.com/">gitee</a>是目前国内做的比较好的公共git托管仓库和开源交流平台，<a href="https://codeup.aliyun.com/">codeup</a>是阿里云的企业git托管，包括一整套devops的解决方案。</p><p>这篇文章主要分享一下我最近将代码从gitee迁移到codeup并且将几乎所有的devops都迁移到flow的过程。</p></div><div class="story post-story"><h2 id="为什么？"><a href="#为什么？" class="headerlink" title="为什么？"></a>为什么？</h2><p>主要还是想要一个简洁的git仓库管理平台和完善的devops生态系统，codeup早期时候使用过，但是没有这次的感觉这么惊艳，当一个产品让你产生了惊艳的感觉的时候，你可能已经想迫不及待的尝试它了，我也是这样，codeup恰好就是我想要的样子。</p></div><div class="story post-story"><h2 id="迁移过程"><a href="#迁移过程" class="headerlink" title="迁移过程"></a>迁移过程</h2><p>迁移过程总的来说分为三大步；</p><ol><li>同步所有的gitee仓库到codeup</li><li>所有的自动部署、自动打包等的流水线迁移</li><li>适配和github的sync</li></ol><h3 id="Step1：同步现在所有的git仓库"><a href="#Step1：同步现在所有的git仓库" class="headerlink" title="Step1：同步现在所有的git仓库"></a>Step1：同步现在所有的git仓库</h3><p>幸运的是，codeup支持一键同步很多平台的仓库，gitee恰好就被快速而便捷的同步到了codeup中，唯一出现的波澜就是：codeup是默认以代码组来创建仓库的，有点类似gitlab中project的概念，然而作为一个个人开发者,我不需要组别进行管理，这个时候在同步仓库的时候就把仓库的地址修改为不分组就可以了。</p><p>同步的过程很顺利，改好组别，一键全选，然后等待同步完成就可以。</p><h3 id="Step2：流水线迁移到flow"><a href="#Step2：流水线迁移到flow" class="headerlink" title="Step2：流水线迁移到flow"></a>Step2：流水线迁移到flow</h3><p>flow是阿里云云效的一个组成部分，主要就是负责干devops这件事的。如果你不想迁移仓库，只是想单独使用flow作为你的devops工具也是完全可以的，它最多每个月送你5400分钟的构建打包时间，节点还可以使用国内和香港的节点，再也不用为node项目的编译而改一堆的仓库地址还没啥用而发愁了。</p><p>flow的配置过程也是相当简单，主要是阿里云提供了一大堆齐全的模板供你使用和查找，原生的文档也还是写的不错，说实话我在用xxx go的时候配置一步一个坑，构建速度还慢的感人。</p><p>拿一个最简单的docker镜像来说，我的打包到部署过程就只分为两个步骤：打包，部署。刚好我使用的也是阿里云的镜像仓库，然后直接选择个人仓库，填写一下你dockerfile的位置，其他的flow都给你搞定了，不需要你再写任何代码，效率之高谁用谁知道。</p><p>部署就更简单了,flow有全局的环境变量（真正的全局，配置好了，在对应的流水线引用一下，就so easy，在github等都是付费功能）,在服务器安装agent,然后直接<code>cd /aaa/ &amp;&amp; docker-compose up -d</code> 就部署完成了。不需要去配置服务器的密码什么的，地址都不需要填。</p><p>我有98个git仓库，21个流水线任务（多数是一样的，换个参数即可），在不到4小时的时间里，完全迁移完成，主要我的流水线都足够简单，打包，部署仅此而已。</p><p>再简单说一下，一个简单的node项目，原来在xxx go打包需要18+分钟，迁移完成后打包+部署耗时2分钟20s,主要是它的免费时长是5400分钟，效率可见一斑。</p><h3 id="Step3：codeup-与github-代码双向同步"><a href="#Step3：codeup-与github-代码双向同步" class="headerlink" title="Step3：codeup 与github 代码双向同步"></a>Step3：codeup 与github 代码双向同步</h3><p>说双向同步其实有点牵强，真实情况是：大部分仓库从codeup同步到github（主要是私人项目），小部分仓库从github同步到github（主要是开源项目）。</p><p>这个过程还是稍微有点坎坷，但是没有让人失望，我之前就用过<a href="https://github.com/Yikun/hub-mirror-action">Yikun&#x2F;hub-mirror-action</a>来同步我的镜像仓库，但是看完源码发现，它好像不支持我从codeup同步到github，然后我就自己动手丰衣足食，根据他的源码修改了一个适合我自己使用场景的项目<a href="https://github.com/dislazy/hub-mirror-action">dislazy&#x2F;hub-mirror-action</a>，在此也非常感谢原作者，开源的力量很强大，值得我们有能力的人都尽一下自己的力量，我的action非常简单，可以以ssh的方式同步任何你想互相同步的代码，你可以从github同步到codeup，也可以从codeup同步到github。</p><p>我的同步action都放在github的同一个仓库中，新建了几个action，分别是：将github的全量仓库每天定时备份到gitee，同步codeup的单个仓库到github（近实时，通过api触发），同步github的单个仓库到codeup（近实时，通过api触发）。</p><p>说到同步，其实更多的是为了备份，发现codeup有一个很人性化的功能，能帮你备份你所有的仓库到阿里云的oss中，存储费用低廉（5年40G才45块钱，还是比较良心的），这样备份就有很多份，能防止任何一个仓库突然出现问题。</p></div><div class="story post-story"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>从决定迁移，到迁移完成，改一大堆东西，4个小时完成这个项目，有一方面是自己的能力问题，另外一方面我觉得和工具的易用性脱不开关系，就例如我配置xxx go的打包部署一样，一个项目我花了1小时配置，相当痛苦。</p><p>写这篇文章的目的纯粹是觉得工具好用，而我刚好用到，能节省我的时间和精力，所以想记录一下其中的过程，这篇文章没有任何代码，原因是因为flow的代码不直接存在仓库中，它是独立的，只是你需要关联仓库而已，如此简单。</p><p>其他的就从<a href="https://help.aliyun.com/document_detail/153402.html">文档</a>中找把，用之前看一遍文档，比尝试很多次都有用。</p></div><div class="story post-story"><h2 id="其他想说的"><a href="#其他想说的" class="headerlink" title="其他想说的"></a>其他想说的</h2><p>最近持续的居家办公生活，让我略感焦虑，说孤独也是很有感触，独立工作还是挺考验自己的自律性，以及工作和生活糅杂在一块的些许不便，然后该适应总是要适应，最近有很多的经历想变成文章记录下来，也因为情绪和工作的原因没有及时的记录下来，以后要多多记录，纯粹记录自己想记录的，给未来的自己看看。</p><p>加油吧，皮卡丘。</p></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://gitee.com/&quot;&gt;gitee&lt;/a&gt;是目前国内做的比较好的公共git托管仓库和开源交流平台，&lt;a href=&quot;https://codeup.aliyun.com/&quot;&gt;codeup&lt;/a&gt;是阿里云的企业git托管，包括一整套devops的解决方案。&lt;/p&gt;
&lt;p&gt;这篇文章主要分享一下我最近将代码从gitee迁移到codeup并且将几乎所有的devops都迁移到flow的过程。&lt;/p&gt;
&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;为什么？&quot;&gt;&lt;a href=&quot;#为什么？&quot; class=&quot;headerlink&quot; title=&quot;为什么？&quot;&gt;&lt;/a&gt;为什么？&lt;/h2&gt;&lt;p&gt;主要还是想要一个简洁的git仓库管理平台和完善的devops生态系统，codeup早期时候使用过，但是没有这次的感觉这么惊艳，当一个产品让你产生了惊艳的感觉的时候，你可能已经想迫不及待的尝试它了，我也是这样，codeup恰好就是我想要的样子。&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="git" scheme="https://blog.bosong.online/categories/git/"/>
    
    
    <category term="github" scheme="https://blog.bosong.online/tags/github/"/>
    
    <category term="gitee" scheme="https://blog.bosong.online/tags/gitee/"/>
    
    <category term="codeup" scheme="https://blog.bosong.online/tags/codeup/"/>
    
    <category term="flow" scheme="https://blog.bosong.online/tags/flow/"/>
    
    <category term="devops" scheme="https://blog.bosong.online/tags/devops/"/>
    
  </entry>
  
  <entry>
    <title>github自动同步到gitee最佳实践</title>
    <link href="https://blog.bosong.online/github%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5%E5%88%B0gitee%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://blog.bosong.online/github%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5%E5%88%B0gitee%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html</id>
    <published>2022-04-05T02:28:16.000Z</published>
    <updated>2022-06-02T01:05:59.615Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>前段时间对github同步到gitee并且实现自动化devops写了一篇简单版的文章，后期也遇到了很多问题，这篇文章主要解决遇到的痛点。</p></blockquote><div class="story post-story"><h2 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h2><ol><li>仓库数量多的情况下每个都需要配置，十分繁琐。</li><li>如果统一配置在一个github action中时单个仓库提交无法被感知。</li><li>github的私有仓库如果gitee没有则会被原来的github action创建为公有仓库，隐私信息容易被泄露。</li></ol></div><div class="story post-story"><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>遇到问题是正常的，我们需要思考如何去解决问题，也需要针对具体的问题去解决问题，如果可以一劳永逸当然是最好的，然而大多数情况下不能，只能一步一步的探索。</p><h3 id="Q3解决方案"><a href="#Q3解决方案" class="headerlink" title="Q3解决方案"></a>Q3解决方案</h3><p>先从问题3开始解决，只需要去查看对应的api文档，看看有没有对应参数，查看了文档之后发现有，然后去分析对应的github action的代码然后fork到自己的账户下面，去改动对应的代码即可，我这边已经改动完了，提交到PR但是因为理念原因目前没有被merge，可以直接上github查看我的fix。</p><ul><li><a href="https://gitee.com/api/v5/swagger#/postV5UserRepos">giteeApi文档</a></li><li><a href="https://docs.github.com/en/rest/reference/repos#get-a-repository">githubApi文档</a></li><li><a href="https://github.com/dislazy/hub-mirror-action">自行修改的创建私有仓库的pr</a></li></ul><h3 id="Q1和Q2解决方案"><a href="#Q1和Q2解决方案" class="headerlink" title="Q1和Q2解决方案"></a>Q1和Q2解决方案</h3><p>多个仓库配置和单个仓库配置其实是冲突但是又不冲突的，可以分开来实现，创建一个新的github仓库，然后专门来做这件事，这样就不用一个一个去进行繁琐的配置了。</p><ol><li><p>针对多个仓库的同步，这种同步实际上不需要实时，定时同步即可，这样可以用一个github action task去实现即可，以下是对应的解决方案代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># 定时同步多个仓库</span><br><span class="line"></span><br><span class="line">name: github2gitee</span><br><span class="line"></span><br><span class="line"># Controls when the workflow will run</span><br><span class="line">on:</span><br><span class="line">  # Triggers the workflow on push or pull request events but only for the main branch</span><br><span class="line">  push:</span><br><span class="line">  #  branches: [ main ]  注释代表全部分支、</span><br><span class="line">  schedule:</span><br><span class="line">    - cron: 0 */12 * * *</span><br><span class="line"></span><br><span class="line">  # Allows you to run this workflow manually from the Actions tab</span><br><span class="line">  workflow_dispatch:</span><br><span class="line"></span><br><span class="line"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span><br><span class="line">jobs:</span><br><span class="line">  repo-sync:</span><br><span class="line">    env:</span><br><span class="line">      dst_key: $&#123;&#123; secrets.GITEE_PRIVATE_KEY &#125;&#125;</span><br><span class="line">      dst_token: $&#123;&#123; secrets.GITEE_TOKEN &#125;&#125;</span><br><span class="line">      gitee_user: $&#123;&#123; secrets.GITEE_USER &#125;&#125;</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    steps:</span><br><span class="line">      - uses: actions/checkout@v2</span><br><span class="line">        with:</span><br><span class="line">          persist-credentials: false</span><br><span class="line"></span><br><span class="line">      - name: Get Time</span><br><span class="line">        id: get-time</span><br><span class="line">        run: |</span><br><span class="line">          echo &quot;::set-output name=date::$(/bin/date -u &quot;+%Y%m%d%H%M%S&quot;)&quot;</span><br><span class="line">        shell: bash</span><br><span class="line"></span><br><span class="line">      - name: Cache src repos</span><br><span class="line">        uses: actions/cache@v1</span><br><span class="line">        id: cache</span><br><span class="line">        with:</span><br><span class="line">          path: $&#123;&#123; github.workspace &#125;&#125;/github-cache</span><br><span class="line">          key: $&#123;&#123; runner.os &#125;&#125;-hub-repos-cache-$&#123;&#123; steps.get-time.outputs.date &#125;&#125;</span><br><span class="line">          restore-keys: $&#123;&#123; runner.os &#125;&#125;-hub-repos-cache</span><br><span class="line"></span><br><span class="line">      - name: sync github -&gt; gitee</span><br><span class="line">        uses: dislazy/hub-mirror-action@master</span><br><span class="line">        if: env.dst_key &amp;&amp; env.dst_token &amp;&amp; env.gitee_user</span><br><span class="line">        with:</span><br><span class="line">          # 必选，需要同步的 Github 用户（源）</span><br><span class="line">          src: &#x27;github/$&#123;&#123; github.repository_owner &#125;&#125;&#x27;</span><br><span class="line">          # 必选，需要同步到的 Gitee 用户（目的）</span><br><span class="line">          dst: &#x27;gitee/$&#123;&#123; secrets.GITEE_USER &#125;&#125;&#x27;</span><br><span class="line">          # 必选，Gitee公钥对应的私钥，https://gitee.com/profile/sshkeys</span><br><span class="line">          dst_key: $&#123;&#123; secrets.GITEE_PRIVATE_KEY &#125;&#125;</span><br><span class="line">          # 必选，Gitee对应的用于创建仓库的token，https://gitee.com/profile/personal_access_tokens</span><br><span class="line">          dst_token:  $&#123;&#123; secrets.GITEE_TOKEN &#125;&#125;</span><br><span class="line">          # 如果是组织，指定组织即可，默认为用户 user</span><br><span class="line">          account_type: user</span><br><span class="line">          # 需要同步的仓库列表</span><br><span class="line">          static_list: &quot;repo-a,repo-b,repo-c&quot;</span><br><span class="line">          #启用git push -f强制同步，注意：开启后，会强制覆盖目的端仓库。</span><br><span class="line">          clone_style: ssh</span><br><span class="line">          #默认为https，可以设置为ssh或者https。当设置为ssh时，你需要将dst_key所对应的公钥同时配置到源端和目的端</span><br><span class="line">          force_update: true</span><br><span class="line">          #配置cache</span><br><span class="line">          cache_path: $&#123;&#123; github.workspace &#125;&#125;/github-cache</span><br><span class="line">          #默认创建仓库为私有仓库</span><br><span class="line">          dst_private: true</span><br><span class="line">      - name: Print cache path</span><br><span class="line">        run: |</span><br><span class="line">          ls -la $&#123;&#123; github.workspace &#125;&#125;/github-cache</span><br></pre></td></tr></table></figure></li><li><p>针对单个仓库，因为需要进行及时进行后续的devops流程，所以针对它需要在push完之后进行同步。</p></li></ol><p>我们去调研一下github的github action文档之后发现可以直接进行webhook触发，这个就可以直接帮助我们实现对应的实时同步过程。</p><p>可以先行查看对应的 <a href="https://docs.github.com/cn/actions/using-workflows/events-that-trigger-workflows">文档</a>。</p><p>此时分为两步走，在此之前先创建一个github的token,<a href="https://github.com/settings/tokens/new">点击</a> 申请一个 token，配置<code>repos</code>的所有权限即可，后面会用到。</p><ul><li>在上面的仓库里再创建一个单仓库的action，只不过这个触发方式是webhook事件(github_push这个自定义事件)触发此时同步的是<code>github.event.client_payload.repo</code> 这个参数的对应的仓库，它由wenhook传递过来，见代码：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># This is a basic workflow to help you get started with Actions</span><br><span class="line"></span><br><span class="line">name: signle_repo_github2gitee</span><br><span class="line"></span><br><span class="line"># Controls when the workflow will run</span><br><span class="line">on: </span><br><span class="line"> repository_dispatch:</span><br><span class="line">   types:</span><br><span class="line">     - github_push</span><br><span class="line"></span><br><span class="line">  # Allows you to run this workflow manually from the Actions tab</span><br><span class="line"> workflow_dispatch:</span><br><span class="line"></span><br><span class="line"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span><br><span class="line">jobs:</span><br><span class="line">  repo-sync:</span><br><span class="line">    env:</span><br><span class="line">      dst_key: $&#123;&#123; secrets.GITEE_PRIVATE_KEY &#125;&#125;</span><br><span class="line">      dst_token: $&#123;&#123; secrets.GITEE_TOKEN &#125;&#125;</span><br><span class="line">      gitee_user: $&#123;&#123; secrets.GITEE_USER &#125;&#125;</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    steps:</span><br><span class="line">      - uses: actions/checkout@v2</span><br><span class="line">        with:</span><br><span class="line">          persist-credentials: false</span><br><span class="line"></span><br><span class="line">      - name: sync github -&gt; gitee</span><br><span class="line">        uses: Yikun/hub-mirror-action@master</span><br><span class="line">        if: env.dst_key &amp;&amp; env.dst_token &amp;&amp; env.gitee_user</span><br><span class="line">        with:</span><br><span class="line">          # 必选，需要同步的 Github 用户（源）</span><br><span class="line">          src: &#x27;github/$&#123;&#123; github.repository_owner &#125;&#125;&#x27;</span><br><span class="line">          # 必选，需要同步到的 Gitee 用户（目的）</span><br><span class="line">          dst: &#x27;gitee/$&#123;&#123; secrets.GITEE_USER &#125;&#125;&#x27;</span><br><span class="line">          # 必选，Gitee公钥对应的私钥，https://gitee.com/profile/sshkeys</span><br><span class="line">          dst_key: $&#123;&#123; secrets.GITEE_PRIVATE_KEY &#125;&#125;</span><br><span class="line">          # 必选，Gitee对应的用于创建仓库的token，https://gitee.com/profile/personal_access_tokens</span><br><span class="line">          dst_token:  $&#123;&#123; secrets.GITEE_TOKEN &#125;&#125;</span><br><span class="line">          # 如果是组织，指定组织即可，默认为用户 user</span><br><span class="line">          account_type: user</span><br><span class="line">          # 直接取当前项目的仓库名</span><br><span class="line">          static_list: $&#123;&#123; github.event.client_payload.repo &#125;&#125;</span><br><span class="line">          #启用git push -f强制同步，注意：开启后，会强制覆盖目的端仓库。</span><br><span class="line">          clone_style: ssh</span><br><span class="line">          #默认为https，可以设置为ssh或者https。当设置为ssh时，你需要将dst_key所对应的公钥同时配置到源端和目的端</span><br><span class="line">          force_update: true</span><br><span class="line">          #配置cache</span><br><span class="line">          cache_path: /github/workspace/$&#123;&#123; github.event.client_payload.repo &#125;&#125;</span><br></pre></td></tr></table></figure><ul><li>在<strong>你需要同步的仓库内</strong>创建一个webhook对应的action，如下：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># This is a basic workflow to help you get started with Actions</span><br><span class="line"></span><br><span class="line">name: webhook</span><br><span class="line"></span><br><span class="line"># Controls when the workflow will run</span><br><span class="line">on:</span><br><span class="line">  # 注释代表所有分支</span><br><span class="line">  push:</span><br><span class="line">#     branches: [ main ]</span><br><span class="line"></span><br><span class="line">  # Allows you to run this workflow manually from the Actions tab</span><br><span class="line">  workflow_dispatch:</span><br><span class="line">  </span><br><span class="line">jobs:</span><br><span class="line">  build:</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    steps:</span><br><span class="line">      - uses: actions/checkout@v3</span><br><span class="line"></span><br><span class="line">      # Runs a set of commands using the runners shell</span><br><span class="line">      - name: Run a multi-line script</span><br><span class="line">        run: |</span><br><span class="line">           curl \</span><br><span class="line">            -X POST \</span><br><span class="line">            -H &quot;Accept: application/vnd.github.v3+json&quot; \</span><br><span class="line">            -H &quot;Authorization: token &#123;&#123;githubToken&#125;&#125;&quot; \</span><br><span class="line">            https://api.github.com/repos/:owner/:repo/dispatches \</span><br><span class="line">            -d &#x27;&#123;&quot;event_type&quot;:&quot;github_push&quot;,&quot;client_payload&quot;:&#123;&quot;repo&quot;:&quot;$&#123;&#123; github.event.repository.name &#125;&#125;&quot;,&quot;message&quot;:&quot;github action sync&quot;&#125;&#125;&#x27;</span><br><span class="line">           echo &#x27;success&#x27;</span><br></pre></td></tr></table></figure><p>其中，owner 是你的用户名，替换即可，repo 是你上面创建仓库的仓库名， githubToken 是上面申请的 Token 凭证，前面的<code>token</code>单词要保留githubToken存到仓库的secrets中，然后将，event_type 是自定义的事件名字，client_payload是一个对象，它可以传递你需要传递的参数，我上面就传递了repo这个参数。</p><p>然后提交代码到对应仓库，查看webhook是否发送成功，再校验webhook触发的task是否执行成功即可。</p></div><div class="story post-story"><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>通过以上方案解决了多个仓库配置不便和单个仓库繁琐配置的问题，还有隐私安全的问题，大大节省了配置的时间和你花费的精力，如果针对上面的方案有疑问，欢迎与我多多交流。</p></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;前段时间对github同步到gitee并且实现自动化devops写了一篇简单版的文章，后期也遇到了很多问题，这篇文章主要解决遇到的痛点。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;痛点&quot;&gt;&lt;a href=&quot;#痛点&quot; class=&quot;headerlink&quot; title=&quot;痛点&quot;&gt;&lt;/a&gt;痛点&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;仓库数量多的情况下每个都需要配置，十分繁琐。&lt;/li&gt;
&lt;li&gt;如果统一配置在一个github action中时单个仓库提交无法被感知。&lt;/li&gt;
&lt;li&gt;github的私有仓库如果gitee没有则会被原来的github action创建为公有仓库，隐私信息容易被泄露。&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="Github" scheme="https://blog.bosong.online/categories/Github/"/>
    
    
    <category term="git" scheme="https://blog.bosong.online/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>从github迁移到gitee和以coding为基础的的全链路devops</title>
    <link href="https://blog.bosong.online/%E4%BB%8Egithub%E8%BF%81%E7%A7%BB%E5%88%B0gitee%E5%92%8C%E4%BB%A5coding%E4%B8%BA%E5%9F%BA%E7%A1%80%E7%9A%84%E7%9A%84%E5%85%A8%E9%93%BE%E8%B7%AFdevops.html"/>
    <id>https://blog.bosong.online/%E4%BB%8Egithub%E8%BF%81%E7%A7%BB%E5%88%B0gitee%E5%92%8C%E4%BB%A5coding%E4%B8%BA%E5%9F%BA%E7%A1%80%E7%9A%84%E7%9A%84%E5%85%A8%E9%93%BE%E8%B7%AFdevops.html</id>
    <published>2022-03-13T05:39:19.000Z</published>
    <updated>2022-06-02T01:05:59.616Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>文章的标题起的比较长，实际上这篇文章将以我的hugo-blog项目为例，讲述一下我将代码提交到github，然后自动同步到gitee，再根据gitee的webhook通过coding的持续集成部署的整个过程。</p><p>感谢github、gitee的给我们个人开发者提供足够的资源来完成这一系列的数据存储过程，也感谢coding提供的在我认为目前足够使用的持续集成功能，关键是这整个过程都是不需要付费的，需要的是灵快的小脑筋以及网上前人的经验罢了（文章中会用一些英文单词，避免敏感词汇，敬请原谅）。</p></div><div class="story post-story"><h2 id="为什么迁移"><a href="#为什么迁移" class="headerlink" title="为什么迁移"></a>为什么迁移</h2><p>事情的起因由俄乌战争引起，我认为没有战争是正义或者邪恶的，因为史诗是由胜利者书写的。</p><p>一直以来秉承一个原则：技术是自由的，它不能也不应该掺和到politics中去。</p><p>然而真实的情况是：技术必须与politics共存，它是在保证politics下才有的产物。</p><p>从这次俄乌战争中就可以看出来，以USA为首的西方国家彻底粉碎了技术是自由的谎言，甚至开源也不是自由的，由人主导的所谓的开源并非自由，从React到Github等一系列国外的开源软件的官网就能看出来很多现实：当我们的国家发生战争时，甚至是收复TW时，我们<br>将受到从金融、政治、外交、贸易、技术等一系列的和不能预知的威胁。</p><p>由此，为保障个人的权益，我决定将自己的代码库逐渐迁移到gitee中来，以预防未来可能发生的某些事情。</p></div><div class="story post-story"><h2 id="迁移的步骤"><a href="#迁移的步骤" class="headerlink" title="迁移的步骤"></a>迁移的步骤</h2><p>得益于github和gitee的用户群体都同样的大，绝大部分的坑都已经被前人趟过，我们只要稍加整理就好了。</p><p>从github迁移到gitee主要分为两步走：</p><ul><li>将github的所有个人仓库全量迁移到gitee</li><li>将github的相关代码提交使用自动化的方式提交到gitee，保持仓库同步</li></ul><p>以上的方案是不是很熟悉：完全就是数据库的数据热迁移步骤。下面我将详细说明以上两个步骤的具体情况：</p><h3 id="数据仓库的全量迁移"><a href="#数据仓库的全量迁移" class="headerlink" title="数据仓库的全量迁移"></a>数据仓库的全量迁移</h3><p>感谢gitee提供的数据全量迁移功能，让我如此没有障碍的快速进行数据迁移，不得不说软件国产化做的越来越好，越来越贴近中国人的使用习惯。</p><ol><li>先登录到gitee进入主页，点击+号，然后可以看到<strong>从 GitHub &#x2F; GitLab 导入仓库</strong> 按钮，如果没有授权及时授权,如图: <img src="https://imagecdn.bosong.online/uPic/gitee-home_1647152067844.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/gitee-home_1647152067844.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="gitee-home_1647152067844"></li><li>进入菜单以后，可以看到你的github仓库列表（及时授权），然后选择你要导入的仓库导入就可以了，这样就完成了数据的全量迁移过程，非常简单。如图：<img src="https://imagecdn.bosong.online/uPic/gitee-repo_1647152429308.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/gitee-repo_1647152429308.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="gitee-repo_1647152429308"></li></ol><h3 id="数据仓库的增量同步"><a href="#数据仓库的增量同步" class="headerlink" title="数据仓库的增量同步"></a>数据仓库的增量同步</h3><p>全量迁移进行的非常顺利，接下来是对你需要经常写入的仓库进行数据的增量同步了，可以慢慢来，先将关键步骤记录下来，然后逐步逐个迁移，这样能将大量的工作分散开来。</p><p>迁移的技术方案：使用github的actions将当前仓库的提交记录同步到gitee中，个人免费版每个月有2000分钟的actions使用时间，相对来说还是比较富余的，大概1-2分钟可以同步一次commit，能同步一千来个commit，基本上够用。</p><p>迁移的步骤：</p><ol><li>准备github和gitee需要的秘钥，例如github和gitee对应的专用ssh秘钥、gitee的个人token、gitee的用户名</li><li>编写github action的action.yml文件，按照实际情况进行跳转，我使用的是: <a href="https://github.com/Yikun/hub-mirror-action">Yikun&#x2F;hub-mirror-action</a>，一点开进去就是对应的说明介绍，我就不作多说</li><li>提交commit 查看对应的gitee仓库是否更新到了最新的commit</li></ol><p>需要注意的点：</p><ul><li>我在action中拉取代码和提交代码都使用的是ssh方式，所以需要自己创建一对ssh秘钥，可以点击<a href="https://gitee.com/help/articles/4181#article-header0">此处</a>查看教程，此时github、gitee都需要配置这个ssh公钥。</li><li>在此过程中，如果是新创建的仓库需要同步，可以不在gitee那创建对应的仓库，action会自动创建，此时需要gitee的token，可以点击<a href="https://gitee.com/profile/personal_access_tokens/new">此处</a>生成token（实测发现gitee的企业版有坑，注意）。</li><li>注意源仓库（github）对应的用户属性，设置<code>src_account_type</code>为<code>user or org</code> ，目标仓库（gitee）的参数是<code>dst_account_type</code> ，设置也同样如此。</li><li>将<code>GITEE_PRIVATE_KEY</code>、<code>GITEE_TOKEN</code> 、<code>GITEE_USER</code> 都配置到github的<strong>Actions secrets</strong>中去,然后再编写如下所示的action。</li></ul><p>配置<strong>Actions secrets</strong></p><p><img src="https://imagecdn.bosong.online/uPic/gihub-secrets_1647153632395.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/gihub-secrets_1647153632395.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="gihub-secrets_1647153632395"></p><p>创建github action 入口<br><img src="https://imagecdn.bosong.online/uPic/github-action_1647153612114.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/github-action_1647153612114.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="github-action_1647153612114"></p><p>对应的yml文件：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a basic workflow to help you get started with Actions</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls when the workflow will run</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="comment"># Triggers the workflow on push or pull request events but only for the main branch</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Allows you to run this workflow manually from the Actions tab</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">repo-sync:</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">dst_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITEE_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">dst_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITEE_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">gitee_user:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITEE_USER</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sync</span> <span class="string">github</span> <span class="number">2</span> <span class="string">gitee</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">Yikun/hub-mirror-action@master</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">env.dst_key</span> <span class="string">&amp;&amp;</span> <span class="string">env.dst_token</span> <span class="string">&amp;&amp;</span> <span class="string">env.gitee_user</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="comment"># 必选，需要同步的 Github 用户（源）</span></span><br><span class="line">          <span class="attr">src:</span> <span class="string">&#x27;github/$<span class="template-variable">&#123;&#123; github.repository_owner &#125;&#125;</span>&#x27;</span></span><br><span class="line">          <span class="comment"># 必选，需要同步到的 Gitee 用户（目的）</span></span><br><span class="line">          <span class="attr">dst:</span> <span class="string">&#x27;gitee/$<span class="template-variable">&#123;&#123; secrets.GITEE_USER &#125;&#125;</span>&#x27;</span></span><br><span class="line">          <span class="comment"># 必选，Gitee公钥对应的私钥，https://gitee.com/profile/sshkeys</span></span><br><span class="line">          <span class="attr">dst_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITEE_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment"># 必选，Gitee对应的用于创建仓库的token，https://gitee.com/profile/personal_access_tokens</span></span><br><span class="line">          <span class="attr">dst_token:</span>  <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITEE_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment"># 如果是组织，指定组织即可，默认为用户 user</span></span><br><span class="line">          <span class="comment"># account_type: org</span></span><br><span class="line">          <span class="comment"># 直接取当前项目的仓库名</span></span><br><span class="line">          <span class="attr">static_list:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.repository.name</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment">#启用git push -f强制同步，注意：开启后，会强制覆盖目的端仓库。</span></span><br><span class="line">          <span class="attr">clone_style:</span> <span class="string">ssh</span></span><br><span class="line">          <span class="comment">#默认为https，可以设置为ssh或者https。当设置为ssh时，你需要将dst_key所对应的公钥同时配置到源端和目的端</span></span><br><span class="line">          <span class="attr">force_update:</span> <span class="literal">true</span></span><br><span class="line">          <span class="comment">#配置cache</span></span><br><span class="line">          <span class="attr">cache_path:</span> <span class="string">/github/workspace/hub-mirror-cache</span></span><br><span class="line"><span class="comment">#源账户的类型：user or org</span></span><br><span class="line">          <span class="attr">src_account_type:</span> <span class="string">user</span></span><br><span class="line"><span class="comment">#目标账户的类型：user or org</span></span><br><span class="line">          <span class="attr">dst_account_type:</span> <span class="string">org</span></span><br></pre></td></tr></table></figure><p>直接按照以上配置进行修改即可，开箱即用，配置好了之后，可以提交一条commit 试试效果，job执行结果如下：</p><p><img src="https://imagecdn.bosong.online/uPic/github-action-result_1647153859714.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/github-action-result_1647153859714.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="github-action-result_1647153859714"></p><h3 id="查看源仓库和目标仓库的记录是否对应"><a href="#查看源仓库和目标仓库的记录是否对应" class="headerlink" title="查看源仓库和目标仓库的记录是否对应"></a>查看源仓库和目标仓库的记录是否对应</h3><p>检查一下源仓库（github）和目标仓库（gitee）对应的提交记录是否对应，如果对应上了就没啥问题，不然就再看看actions的执行情况。</p><p>到这就完成了从github到gitee的迁移过程了，标准的数据库数据迁移做法：全量迁移+增量同步，如果有啥情况，随时可以无损迁移到gitee。</p></div><div class="story post-story"><h2 id="codng的devops"><a href="#codng的devops" class="headerlink" title="codng的devops"></a>codng的devops</h2><p>其实从github迁移到gitee不仅仅是代码数据库的迁移，还有后面的一系列的devops对应的地址改变，我这边主要就是在coding的持续集成,由于我的Jenkinsfile全部都是写在代码仓库里的，这时候切换就非常方便了，直接将对应的代码源从github切换成gitee的同名仓库即可，基本没有代价。</p><p>可能会有人问gitee也有对应的持续集成 <strong>gitee go</strong> 为啥不直接在gitee中生态圈使用，主要还是因为不能和coding一样我直接在自己的主机上执行任务，这样就不计算它的免费时间了，而且coding每个月会给1000分钟的免费时间，基本上也是用不完的。（主要是省钱和合理资源利用）。</p><p>直接将github的源代码仓库修改为gitee：</p><p><img src="https://imagecdn.bosong.online/uPic/coding-deploy_1647154646788.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/coding-deploy_1647154646788.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="coding-deploy_1647154646788"></p><p>如果有自有云主机，可以配置在coding的资源池中使用，这样还不占用coding的免费时间，达到资源合理利用的目的</p><p><img src="https://imagecdn.bosong.online/uPic/coding-host_1647154660760.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/uPic/coding-host_1647154660760.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="coding-host_1647154660760"></p><p>其实从github迁移到gitee 还有一层大的好处：不需要考虑你的国内云服务器拉不下来github代码的问题了，我的云主机十次有九次拉不下来github的代码，所以我一直使用coding自带的资源池。</p><p>另外一部分还有就是如何使用coding的持续集成功能部署<strong>hugo</strong> 项目，我会出一篇文章详细说明。</p></div><div class="story post-story"><h2 id="结果和想法"><a href="#结果和想法" class="headerlink" title="结果和想法"></a>结果和想法</h2><p>有些事想想觉得还挺费劲，但是一旦深入了解后做起来，发现还是挺简单，有时候就需要突破思维定势，你理解的难是建立在你固有的思维体系中的，如果要说难，先详细的去了解过整个过程后再去说难。</p><p>迁移和部署都出乎我想象的顺利，整个过程几个小时就完成了，支持重要的软件国产化，自有化，这样才能不被卡脖子。只要你足够强大，那么别人的制裁就只是个笑话了。</p></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;文章的标题起的比较长，实际上这篇文章将以我的hugo-blog项目为例，讲述一下我将代码提交到github，然后自动同步到gitee，再根据gitee的webhook通过coding的持续集成部署的整个过程。&lt;/p&gt;
&lt;p&gt;感谢github、gitee的给我们个人开发者提供足够的资源来完成这一系列的数据存储过程，也感谢coding提供的在我认为目前足够使用的持续集成功能，关键是这整个过程都是不需要付费的，需要的是灵快的小脑筋以及网上前人的经验罢了（文章中会用一些英文单词，避免敏感词汇，敬请原谅）。&lt;/p&gt;
&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;为什么迁移&quot;&gt;&lt;a href=&quot;#为什么迁移&quot; class=&quot;headerlink&quot; title=&quot;为什么迁移&quot;&gt;&lt;/a&gt;为什么迁移&lt;/h2&gt;&lt;p&gt;事情的起因由俄乌战争引起，我认为没有战争是正义或者邪恶的，因为史诗是由胜利者书写的。&lt;/p&gt;
&lt;p&gt;一直以来秉承一个原则：技术是自由的，它不能也不应该掺和到politics中去。&lt;/p&gt;
&lt;p&gt;然而真实的情况是：技术必须与politics共存，它是在保证politics下才有的产物。&lt;/p&gt;
&lt;p&gt;从这次俄乌战争中就可以看出来，以USA为首的西方国家彻底粉碎了技术是自由的谎言，甚至开源也不是自由的，由人主导的所谓的开源并非自由，从React到Github等一系列国外的开源软件的官网就能看出来很多现实：当我们的国家发生战争时，甚至是收复TW时，我们&lt;br&gt;将受到从金融、政治、外交、贸易、技术等一系列的和不能预知的威胁。&lt;/p&gt;
&lt;p&gt;由此，为保障个人的权益，我决定将自己的代码库逐渐迁移到gitee中来，以预防未来可能发生的某些事情。&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="技术手册" scheme="https://blog.bosong.online/categories/%E6%8A%80%E6%9C%AF%E6%89%8B%E5%86%8C/"/>
    
    
    <category term="github" scheme="https://blog.bosong.online/tags/github/"/>
    
    <category term="gitee" scheme="https://blog.bosong.online/tags/gitee/"/>
    
    <category term="devops" scheme="https://blog.bosong.online/tags/devops/"/>
    
    <category term="coding" scheme="https://blog.bosong.online/tags/coding/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7升级Git版本</title>
    <link href="https://blog.bosong.online/CentOS7%E5%8D%87%E7%BA%A7Git%E7%89%88%E6%9C%AC.html"/>
    <id>https://blog.bosong.online/CentOS7%E5%8D%87%E7%BA%A7Git%E7%89%88%E6%9C%AC.html</id>
    <published>2022-03-13T03:11:34.000Z</published>
    <updated>2022-06-02T01:05:59.611Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在将自有云服务器导入到coding中作为持续集成的云主机时，提示git版本太老，所以无法继续进行安装，所以参考一篇文章对Centos 7上的Git进行了重新安装升级。</p><p>查看当前服务器的git版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ce-88 ~]# git --version</span><br><span class="line">git version 1.8.3.1</span><br></pre></td></tr></table></figure><p>查看当前的系统版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ce-88 ~]# cat /etc/redhat-release</span><br><span class="line">CentOS Linux release 7.9.2009 (Core)</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>本次我们安装git使用编译源代码的方式安装，此前需要安装一些必要的依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ce-88 ~]# yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc</span><br><span class="line">[root@ce-88 ~]# yum install  gcc perl-ExtUtils-MakeMaker</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h2><p>直接使用yum将git的旧版本remove掉</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ce-88 ~]#  yum remove git</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="编译安装Git"><a href="#编译安装Git" class="headerlink" title="编译安装Git"></a>编译安装Git</h2><p>Git软件包可<a href="https://mirrors.edge.kernel.org/pub/software/scm/git">在此获取</a>：<a href="https://mirrors.edge.kernel.org/pub/software/scm/git/%E3%80%82">https://mirrors.edge.kernel.org/pub/software/scm/git/。</a> </p><p>我发现源代码不区分你的CPU架构，直接找最新的版的下载即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git-2.9.5.tar.gz </span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ce-88 ~]#  cd /usr/local/src/</span><br><span class="line">[root@ce-88 ~]#  wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.9.5.tar.gz --no-check-certificate</span><br><span class="line">[root@ce-88 ~]#  tar -zxvf git-2.9.5.tar.gz</span><br><span class="line">[root@ce-88 ~]#  cd git-2.9.5/</span><br><span class="line">[root@ce-88 ~]#  make prefix=/usr/local/git all</span><br><span class="line">[root@ce-88 ~]#  make prefix=/usr/local/git install</span><br><span class="line">[root@ce-88 ~]#  echo &quot;export PATH=$PATH:/usr/local/git/bin&quot; &gt;&gt; /etc/profile</span><br><span class="line">[root@ce-88 ~]#  source /etc/profile</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="验证版本"><a href="#验证版本" class="headerlink" title="验证版本"></a>验证版本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@227 ~]# git version</span><br><span class="line">git version 2.9.5</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="非root用户使用"><a href="#非root用户使用" class="headerlink" title="非root用户使用"></a>非root用户使用</h2><p>如果是非root用户使用git，则需要配置下该用户下的环境变量。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;export PATH=$PATH:/usr/local/git/bin&quot; &gt;&gt; ~/.bashrc</span><br><span class="line">$ source ~/.bashrc</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li>本文参考<a href="https://www.cnblogs.com/Hi-blog/p/How-To-Update-Git-On-CentOS7.html">CentOS7升级Git版本</a></li></ul></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在将自有云服务器导入到coding中作为持续集成的云主机时，提示git版本太老，所以无法继续进行安装，所以参考一篇文章对Centos 7上的Git进行了重新安装升级。&lt;/p&gt;
&lt;p&gt;查看当前服务器的git版本&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@ce-88 ~]# git --version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git version 1.8.3.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看当前的系统版本&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@ce-88 ~]# cat /etc/redhat-release&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CentOS Linux release 7.9.2009 (Core)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;安装依赖&quot;&gt;&lt;a href=&quot;#安装依赖&quot; class=&quot;headerlink&quot; title=&quot;安装依赖&quot;&gt;&lt;/a&gt;安装依赖&lt;/h2&gt;&lt;p&gt;本次我们安装git使用编译源代码的方式安装，此前需要安装一些必要的依赖&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@ce-88 ~]# yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ce-88 ~]# yum install  gcc perl-ExtUtils-MakeMaker&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/div&gt;</summary>
    
    
    
    <category term="Linux" scheme="https://blog.bosong.online/categories/Linux/"/>
    
    
    <category term="git" scheme="https://blog.bosong.online/tags/git/"/>
    
    <category term="linux" scheme="https://blog.bosong.online/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Docker升级到最新版本</title>
    <link href="https://blog.bosong.online/Docker%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC.html"/>
    <id>https://blog.bosong.online/Docker%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC.html</id>
    <published>2022-03-11T09:31:03.000Z</published>
    <updated>2022-06-02T01:05:59.611Z</updated>
    
    <content type="html"><![CDATA[<p>1、查看系统要求</p><p>Docker 要求 CentOS 系统的内核版本高于 3.10 ,查看CentOS的内核版本。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure><p>2、删除旧版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker  docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure><p>3、安装需要的软件包</p><p>yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><p>4、设置Docker yum源</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p>5、查看所有仓库中所有docker版本</p><p>可以查看所有仓库中所有docker版本,并选择特定的版本安装。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure><p>6、安装docker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure><p>由于repo中默认只开启stable仓库，故这里安装的是最新稳定版。</p><p>如果要安装特定版本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce-18.06.1.ce  </span><br></pre></td></tr></table></figure><p>7、启动</p><p>设置为开机启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>查看启动状态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure><p>查看版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><p>** 版权声明 **</p><ul><li>本文来源于：<a href="https://segmentfault.com/a/1190000020073249">Docker升级到最新版本</a>;</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;1、查看系统要求&lt;/p&gt;
&lt;p&gt;Docker 要求 CentOS 系统的内核版本高于 3.10 ,查看CentOS的内核版本。&lt;/p&gt;</summary>
    
    
    
    <category term="Linux" scheme="https://blog.bosong.online/categories/Linux/"/>
    
    
    <category term="linux" scheme="https://blog.bosong.online/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>vue项目实现CDN动静分离及自动化部署</title>
    <link href="https://blog.bosong.online/vue%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0CDN%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%8F%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2.html"/>
    <id>https://blog.bosong.online/vue%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0CDN%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%8F%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2.html</id>
    <published>2022-03-02T09:32:33.000Z</published>
    <updated>2022-06-02T01:05:59.616Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="前世今生"><a href="#前世今生" class="headerlink" title="前世今生"></a>前世今生</h2><p>1410是刚毕业那会做一个毕业照展示网站项目。</p><p>早期使用的是Vue.js作为前端项目，Java作为后端项目。</p><p>中间将Python写的服务端替换了Java后端。</p><p>最后将Golang写的服务端替换了Python后端。</p><p>近期又做了一些前端方面的改造：</p><ul><li>使用authelia作为Nginx层的SSO网关，设置为登录可访问（不能实现全站CDN的原因是需要NGINX层）</li><li>照片使用腾讯云CDN访问，并且为加快访问速度还使用了腾讯云的万象图片处理</li><li>抛弃后端接口，直接使用json存储照片列表</li><li>实现前端项目动静分离，引入CDN加快访问速度</li><li>使用coding的持续集成实现自动化部署</li></ul><p>以后再也不用操心改完代码还要做一堆的操作让代码上线了，网站访问速度和安全性都得到了提升。</p></div><div class="story post-story"><h2 id="升级打怪过程"><a href="#升级打怪过程" class="headerlink" title="升级打怪过程"></a>升级打怪过程</h2><p>这篇文章就主要介绍一下将vue项目build后实现动静分离和自动化部署过程，以及遇到的一些坑点。<br>以下是1410前端项目的项目结构：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">|-- public //存放不可变静态资源</span><br><span class="line">|-- index.html</span><br><span class="line">|-- favicon.ico</span><br><span class="line">|-- data.json</span><br><span class="line">|-- src</span><br><span class="line">|-- plugins  //存放要引入的插件例如iview</span><br><span class="line">|-- App.vue  //项目入口</span><br><span class="line">|-- main.js  //项目配置</span><br><span class="line">|-- config //存放打包成容器后的nginx的配置</span><br><span class="line">    |-- nginx.conf</span><br><span class="line">|-- .env.deploy 打包时指定的文件</span><br><span class="line">|-- index.js 上传打包后dist文件夹到COS</span><br><span class="line">|-- Dockerfile 打包成docker镜像的配置</span><br><span class="line">|-- Jenkinsfile 持续集成的配置文件</span><br><span class="line">|-- vue.config.js vue的配置文件</span><br><span class="line">|-- package.json //存放打包命令以及依赖</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="改造vue项目实现动静分离"><a href="#改造vue项目实现动静分离" class="headerlink" title="改造vue项目实现动静分离"></a>改造vue项目实现动静分离</h3><p>如我上述的结构，改造vue项目非常简单，主要分为三步：</p><ol><li><p>在根目录中创建<code>.env.deploy</code>文件，然后写入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=production</span><br><span class="line">DEPLOY=online</span><br></pre></td></tr></table></figure></li><li><p>修改<code>vue.config.js</code>，将一下内容写入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 根据自定义的变量来进行内容设置，将这块放在整个js文件的最上面即可</span><br><span class="line">let BASE_URL = &#x27;/&#x27;</span><br><span class="line">switch(process.env.DEPLOY) &#123;</span><br><span class="line">    case &#x27;online&#x27;:</span><br><span class="line">        BASE_URL = &#x27;https://cdn.songbo.fun/&#x27;</span><br><span class="line">        break</span><br><span class="line">    default:</span><br><span class="line">        BASE_URL = &#x27;/&#x27;</span><br><span class="line">&#125;</span><br><span class="line">然后在module.exports中增加一行，注意&#x27;,&#x27;</span><br><span class="line">publicPath: BASE_URL</span><br></pre></td></tr></table></figure></li><li><p>在<code>package.json</code>中的<strong>scripts</strong>增加一行<code>&quot;deploy&quot;: &quot;vue-cli-service build --mode deploy&quot;</code> 此处注意**,**</p></li></ol><p>完成已上三步后就改造完成了，如果需要打包正常的项目使用<code>npm run build</code> 如果需要动静分离，使用<code>npm run deploy</code> 即可。<br>最终效果如下,在<code>dist/index.html</code>,对应的css地址就换成了如下的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link href=http://cdn.songbo.fun/static/css/app.887c93b2.css rel=preload as=style&gt;</span><br></pre></td></tr></table></figure><p>** 注意 这一步也没有遇到什么坑点，很快就完成了项目的动静分离。</p><h3 id="实现自动化部署"><a href="#实现自动化部署" class="headerlink" title="实现自动化部署"></a>实现自动化部署</h3><p>上一步已经实现了打包的过程，初步具备了前端站点动静分离的条件，最终生成的dist目录结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|-- index.html   // 需要copy到docker镜像中</span><br><span class="line">|-- static // 整个文件夹都需要放到COS上去，使用CDN访问</span><br><span class="line">    |-- js</span><br><span class="line">    |-- img</span><br><span class="line">    |-- css</span><br></pre></td></tr></table></figure><p>自动化部署总体流程比较简单，分为如下几步：</p><ol><li>选择一个devops服务提供商，我目前主要用两个：coding的持续集成以及github的action，配置起来都比较简单。</li><li>选定Docker镜像并且准备好对应的配置，我这里选用的是<code>nginx</code>的docker镜像，准备了<code>config/nginx.conf</code>文件和<code>Dockerfile</code>文件，对应的文件存放位置可以在上文中看到，文件具体内容如下：<br>nginx.conf:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"># nginx.conf</span><br><span class="line">user nginx;</span><br><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line">error_log /var/log/nginx/error.log warn;</span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">  worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">  map $http_x_forwarded_for  $clientRealIp &#123;</span><br><span class="line">      &quot;&quot;      $remote_addr;</span><br><span class="line">      ~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$  $firstAddr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  include /etc/nginx/mime.types;</span><br><span class="line">  default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">  log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">  access_log /var/log/nginx/access.log main;</span><br><span class="line"></span><br><span class="line">  sendfile on;</span><br><span class="line">  tcp_nopush on;</span><br><span class="line"></span><br><span class="line">  gzip on;</span><br><span class="line"></span><br><span class="line">  client_max_body_size 100m;</span><br><span class="line">  client_body_buffer_size 10m;</span><br><span class="line">  proxy_connect_timeout 600s;</span><br><span class="line">  proxy_send_timeout 600s;</span><br><span class="line">  proxy_read_timeout 600s;</span><br><span class="line">  send_timeout 600s;</span><br><span class="line"></span><br><span class="line">  proxy_request_buffering off;</span><br><span class="line">  proxy_buffering off;</span><br><span class="line"></span><br><span class="line">  server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    charset utf-8;</span><br><span class="line"></span><br><span class="line">    root /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">      try_files $uri $uri/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ &#123;</span><br><span class="line">      expires 1y;</span><br><span class="line">      access_log off;</span><br><span class="line">      add_header Cache-Control &quot;public&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~* \.(?:css|js)$ &#123;</span><br><span class="line">      try_files $uri =404;</span><br><span class="line">      expires 1y;</span><br><span class="line">      access_log off;</span><br><span class="line">      add_header Cache-Control &quot;public&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ ^.+\..+$ &#123;</span><br><span class="line">      try_files $uri =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line"></span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">      root /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>Dockerfile:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx:1.17.9-alpine</span><br><span class="line"></span><br><span class="line">ENV TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line">WORKDIR /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">COPY ./config/nginx.conf /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">COPY ./dist /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure></li><li>将对应的文件打包成镜像，然后部署到宿主机上，我使用的是coding的持续集成，对应的jenkinsfile如下：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(&#x27;检出&#x27;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: env.GIT_BUILD_REF]],</span><br><span class="line">        userRemoteConfigs: [[url: env.GIT_REPO_URL, credentialsId: env.CREDENTIALS_ID]]])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&#x27;构建&#x27;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo &#x27;构建中...&#x27;</span><br><span class="line">        sh &#x27;npm install&#x27;</span><br><span class="line">        sh &#x27;npm run deploy&#x27;</span><br><span class="line">        sh &#x27;docker build -t $&#123;registry&#125;/$&#123;projectName&#125;:$&#123;GIT_COMMIT&#125;  .&#x27;</span><br><span class="line">        sh &quot;docker login --username=&#x27;$&#123;username&#125;&#x27;  --password=&#x27;$&#123;password&#125;&#x27;  &#x27;$&#123;registry&#125;&#x27;&quot;</span><br><span class="line">        sh &#x27;docker push $&#123;registry&#125;/$&#123;projectName&#125;:$&#123;GIT_COMMIT&#125;&#x27;</span><br><span class="line">        echo &#x27;构建完成.&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stage(&quot;部署到远端服务&quot;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        script &#123;</span><br><span class="line">          def remoteConfig = [:]</span><br><span class="line">          remoteConfig.name = &quot;my-remote-server&quot;</span><br><span class="line">          remoteConfig.host = &quot;10.0.0.1&quot;</span><br><span class="line">          remoteConfig.port = 22</span><br><span class="line">          remoteConfig.allowAnyHosts = true</span><br><span class="line"></span><br><span class="line">          withCredentials([</span><br><span class="line">            sshUserPrivateKey(</span><br><span class="line">              credentialsId: &quot;$&#123;remote_cred&#125;&quot;,</span><br><span class="line">              keyFileVariable: &#x27;id_rsa&#x27;</span><br><span class="line">            ),</span><br><span class="line">          ]) &#123;</span><br><span class="line">            // SSH 登陆用户名</span><br><span class="line">            remoteConfig.user = &quot;root&quot;</span><br><span class="line">            // SSH 私钥文件地址</span><br><span class="line">            remoteConfig.identityFile = id_rsa</span><br><span class="line"></span><br><span class="line">            // 请确保远端环境中有 Docker 环境</span><br><span class="line">            sshCommand(</span><br><span class="line">              remote: remoteConfig,</span><br><span class="line">              command: &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125; $&#123;registry&#125;&quot;,</span><br><span class="line">              sudo: true,</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            sshCommand(</span><br><span class="line">              remote: remoteConfig,</span><br><span class="line">              command: &quot;docker rm -f  $&#123;containerName&#125; | true&quot;,</span><br><span class="line">              sudo: true,</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            // DOCKER_IMAGE_VERSION 中涉及到 GIT_LOCAL_BRANCH / GIT_TAG / GIT_COMMIT 的环境变量的使用</span><br><span class="line">            // 需要在本地完成拼接后，再传入到远端服务器中使用</span><br><span class="line">            DOCKER_IMAGE_URL = sh(</span><br><span class="line">              script: &quot;echo $&#123;registry&#125;/$&#123;projectName&#125;:$&#123;GIT_COMMIT&#125;&quot;,</span><br><span class="line">              returnStdout: true</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            sshCommand(</span><br><span class="line">              remote: remoteConfig,</span><br><span class="line">              command: &quot;docker run -d -p 2111:80 --name $&#123;containerName&#125; $&#123;DOCKER_IMAGE_URL&#125;&quot;,</span><br><span class="line">              sudo: true,</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            echo &quot;部署成功，请到 https://1410.xxxx.com 预览效果&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(&#x27;上传CDN&#x27;) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo &#x27;构建中...&#x27;</span><br><span class="line">        sh &#x27;node index.js&#x27;</span><br><span class="line">        echo &#x27;上传完成&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  environment &#123;</span><br><span class="line">    registry = &#x27;&#x27;</span><br><span class="line">    username = &#x27;&#x27;</span><br><span class="line">    password = &#x27;&#x27;</span><br><span class="line">    projectName = &#x27;1410&#x27;</span><br><span class="line">    containerName = &#x27;1410&#x27;</span><br><span class="line">    remote_cred = &#x27;&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>为防止docker镜像启动不成功，导致原有的网站不可访问，所以将对应的<code>dist</code>中的文件上传到CDN中作为最后一步，这样可以保证服务启动后，访问的是最新的站点，将dist文件上传到cos上我使用的是我前期写的一个开源项目<a href="https://github.com/dislazy/alidaodao-cos-uploader">alidaodao-cos-uploader</a>,具体的步骤可以访问项目后进行配置。</li></ol><p>到此整个自动化部署的过程也结束了，可以看看对应的运行步骤截图：<br><img src="https://imagecdn.bosong.online/pic/KtliwD.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/pic/KtliwD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="coding持续集成"></p></div><div class="story post-story"><h2 id="遇到的问题以及解决方案"><a href="#遇到的问题以及解决方案" class="headerlink" title="遇到的问题以及解决方案"></a>遇到的问题以及解决方案</h2><h3 id="coding持续集成部署到宿主机时始终报错：invalid-privatekey-B-51d78dde"><a href="#coding持续集成部署到宿主机时始终报错：invalid-privatekey-B-51d78dde" class="headerlink" title="coding持续集成部署到宿主机时始终报错：invalid privatekey: [B@51d78dde"></a>coding持续集成部署到宿主机时始终报错：<strong>invalid privatekey: [B@51d78dde</strong></h3><p>最终查到该问题是由于我使用的连接到宿主机的SSH密钥的版本过新导致的，我使用的密钥如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN OPENSSH PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">PRIVATE KEY</span><br><span class="line"></span><br><span class="line">-----END OPENSSH PRIVATE KEY-----</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是coding使用的Jenkins只支持如下密钥：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">PRIVATE KEY</span><br><span class="line"></span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>问题找到，解决就简单了，将对应的OPENSSH的密钥改成RSA的密钥即可：<code>ssh-keygen -p -m PEM -f 你的密钥地址</code>,然后再转化的密钥存入对应凭据中就解决了。</p></div><div class="story post-story"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对于服务端开发者，自动化早已深入人心，它能帮你节省大量的时间和精力，如何用好自动化技术也是我们的挑战,欢迎与我一起交流。</p><p>参考文献：</p><ul><li><a href="https://help.coding.net/docs/ci/practice/deploy/ssh.html">持续集成 &#x2F; 自动部署 &#x2F; Linux 服务器</a></li></ul></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;前世今生&quot;&gt;&lt;a href=&quot;#前世今生&quot; class=&quot;headerlink&quot; title=&quot;前世今生&quot;&gt;&lt;/a&gt;前世今生&lt;/h2&gt;&lt;p&gt;1410是刚毕业那会做一个毕业照展示网站项目。&lt;/p&gt;
&lt;p&gt;早期使用的是Vue.js作为前端项目，Java作为后端项目。&lt;/p&gt;
&lt;p&gt;中间将Python写的服务端替换了Java后端。&lt;/p&gt;
&lt;p&gt;最后将Golang写的服务端替换了Python后端。&lt;/p&gt;
&lt;p&gt;近期又做了一些前端方面的改造：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用authelia作为Nginx层的SSO网关，设置为登录可访问（不能实现全站CDN的原因是需要NGINX层）&lt;/li&gt;
&lt;li&gt;照片使用腾讯云CDN访问，并且为加快访问速度还使用了腾讯云的万象图片处理&lt;/li&gt;
&lt;li&gt;抛弃后端接口，直接使用json存储照片列表&lt;/li&gt;
&lt;li&gt;实现前端项目动静分离，引入CDN加快访问速度&lt;/li&gt;
&lt;li&gt;使用coding的持续集成实现自动化部署&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以后再也不用操心改完代码还要做一堆的操作让代码上线了，网站访问速度和安全性都得到了提升。&lt;/p&gt;
&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;升级打怪过程&quot;&gt;&lt;a href=&quot;#升级打怪过程&quot; class=&quot;headerlink&quot; title=&quot;升级打怪过程&quot;&gt;&lt;/a&gt;升级打怪过程&lt;/h2&gt;&lt;p&gt;这篇文章就主要介绍一下将vue项目build后实现动静分离和自动化部署过程，以及遇到的一些坑点。&lt;br&gt;以下是1410前端项目的项目结构：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;|-- public //存放不可变静态资源&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		|-- index.html&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		|-- favicon.ico&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		|-- data.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- src&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		|-- plugins  //存放要引入的插件例如iview&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		|-- App.vue  //项目入口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		|-- main.js  //项目配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- config //存放打包成容器后的nginx的配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    |-- nginx.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- .env.deploy 打包时指定的文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- index.js 上传打包后dist文件夹到COS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- Dockerfile 打包成docker镜像的配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- Jenkinsfile 持续集成的配置文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- vue.config.js vue的配置文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- package.json //存放打包命令以及依赖&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;改造vue项目实现动静分离&quot;&gt;&lt;a href=&quot;#改造vue项目实现动静分离&quot; class=&quot;headerlink&quot; title=&quot;改造vue项目实现动静分离&quot;&gt;&lt;/a&gt;改造vue项目实现动静分离&lt;/h3&gt;&lt;p&gt;如我上述的结构，改造vue项目非常简单，主要分为三步：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;在根目录中创建&lt;code&gt;.env.deploy&lt;/code&gt;文件，然后写入&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NODE_ENV=production&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DEPLOY=online&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;修改&lt;code&gt;vue.config.js&lt;/code&gt;，将一下内容写入：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// 根据自定义的变量来进行内容设置，将这块放在整个js文件的最上面即可&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let BASE_URL = &amp;#x27;/&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;switch(process.env.DEPLOY) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    case &amp;#x27;online&amp;#x27;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BASE_URL = &amp;#x27;https://cdn.songbo.fun/&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        break&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    default:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BASE_URL = &amp;#x27;/&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;然后在module.exports中增加一行，注意&amp;#x27;,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;publicPath: BASE_URL&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在&lt;code&gt;package.json&lt;/code&gt;中的&lt;strong&gt;scripts&lt;/strong&gt;增加一行&lt;code&gt;&amp;quot;deploy&amp;quot;: &amp;quot;vue-cli-service build --mode deploy&amp;quot;&lt;/code&gt; 此处注意**,**&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;完成已上三步后就改造完成了，如果需要打包正常的项目使用&lt;code&gt;npm run build&lt;/code&gt; 如果需要动静分离，使用&lt;code&gt;npm run deploy&lt;/code&gt; 即可。&lt;br&gt;最终效果如下,在&lt;code&gt;dist/index.html&lt;/code&gt;,对应的css地址就换成了如下的内容：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;link href=http://cdn.songbo.fun/static/css/app.887c93b2.css rel=preload as=style&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;** 注意 这一步也没有遇到什么坑点，很快就完成了项目的动静分离。&lt;/p&gt;
&lt;h3 id=&quot;实现自动化部署&quot;&gt;&lt;a href=&quot;#实现自动化部署&quot; class=&quot;headerlink&quot; title=&quot;实现自动化部署&quot;&gt;&lt;/a&gt;实现自动化部署&lt;/h3&gt;&lt;p&gt;上一步已经实现了打包的过程，初步具备了前端站点动静分离的条件，最终生成的dist目录结构如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;|-- index.html   // 需要copy到docker镜像中&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|-- static // 整个文件夹都需要放到COS上去，使用CDN访问&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    |-- js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    |-- img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    |-- css&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;自动化部署总体流程比较简单，分为如下几步：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;选择一个devops服务提供商，我目前主要用两个：coding的持续集成以及github的action，配置起来都比较简单。&lt;/li&gt;
&lt;li&gt;选定Docker镜像并且准备好对应的配置，我这里选用的是&lt;code&gt;nginx&lt;/code&gt;的docker镜像，准备了&lt;code&gt;config/nginx.conf&lt;/code&gt;文件和&lt;code&gt;Dockerfile&lt;/code&gt;文件，对应的文件存放位置可以在上文中看到，文件具体内容如下：&lt;br&gt;nginx.conf:&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# nginx.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;user nginx;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;worker_processes 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;error_log /var/log/nginx/error.log warn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pid /var/run/nginx.pid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;events &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  worker_connections 1024;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;http &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  map $http_x_forwarded_for  $clientRealIp &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;&amp;quot;      $remote_addr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ~^(?P&amp;lt;firstAddr&amp;gt;[0-9\.]+),?.*$  $firstAddr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  include /etc/nginx/mime.types;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  default_type application/octet-stream;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  log_format main &amp;#x27;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#x27;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#x27;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  access_log /var/log/nginx/access.log main;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sendfile on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  tcp_nopush on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  gzip on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  client_max_body_size 100m;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  client_body_buffer_size 10m;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  proxy_connect_timeout 600s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  proxy_send_timeout 600s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  proxy_read_timeout 600s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  send_timeout 600s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  proxy_request_buffering off;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  proxy_buffering off;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server_name localhost;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    charset utf-8;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    root /usr/share/nginx/html;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      try_files $uri $uri/ /index.html;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      expires 1y;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      access_log off;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      add_header Cache-Control &amp;quot;public&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location ~* \.(?:css|js)$ &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      try_files $uri =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      expires 1y;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      access_log off;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      add_header Cache-Control &amp;quot;public&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location ~ ^.+\..+$ &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      try_files $uri =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    error_page 500 502 503 504 /50x.html;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location = /50x.html &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      root /usr/share/nginx/html;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
Dockerfile:&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;FROM nginx:1.17.9-alpine&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ENV TZ=Asia/Shanghai&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;WORKDIR /usr/share/nginx/html&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;COPY ./config/nginx.conf /etc/nginx/nginx.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;COPY ./dist /usr/share/nginx/html&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EXPOSE 80&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;将对应的文件打包成镜像，然后部署到宿主机上，我使用的是coding的持续集成，对应的jenkinsfile如下：&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pipeline &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  agent any&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  stages &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stage(&amp;#x27;检出&amp;#x27;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      steps &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        checkout([$class: &amp;#x27;GitSCM&amp;#x27;, branches: [[name: env.GIT_BUILD_REF]],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        userRemoteConfigs: [[url: env.GIT_REPO_URL, credentialsId: env.CREDENTIALS_ID]]])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stage(&amp;#x27;构建&amp;#x27;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      steps &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        echo &amp;#x27;构建中...&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sh &amp;#x27;npm install&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sh &amp;#x27;npm run deploy&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sh &amp;#x27;docker build -t $&amp;#123;registry&amp;#125;/$&amp;#123;projectName&amp;#125;:$&amp;#123;GIT_COMMIT&amp;#125;  .&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sh &amp;quot;docker login --username=&amp;#x27;$&amp;#123;username&amp;#125;&amp;#x27;  --password=&amp;#x27;$&amp;#123;password&amp;#125;&amp;#x27;  &amp;#x27;$&amp;#123;registry&amp;#125;&amp;#x27;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sh &amp;#x27;docker push $&amp;#123;registry&amp;#125;/$&amp;#123;projectName&amp;#125;:$&amp;#123;GIT_COMMIT&amp;#125;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        echo &amp;#x27;构建完成.&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stage(&amp;quot;部署到远端服务&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      steps &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        script &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          def remoteConfig = [:]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          remoteConfig.name = &amp;quot;my-remote-server&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          remoteConfig.host = &amp;quot;10.0.0.1&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          remoteConfig.port = 22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          remoteConfig.allowAnyHosts = true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          withCredentials([&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshUserPrivateKey(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              credentialsId: &amp;quot;$&amp;#123;remote_cred&amp;#125;&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              keyFileVariable: &amp;#x27;id_rsa&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          ]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            // SSH 登陆用户名&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            remoteConfig.user = &amp;quot;root&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            // SSH 私钥文件地址&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            remoteConfig.identityFile = id_rsa&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            // 请确保远端环境中有 Docker 环境&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshCommand(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              remote: remoteConfig,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              command: &amp;quot;docker login -u $&amp;#123;username&amp;#125; -p $&amp;#123;password&amp;#125; $&amp;#123;registry&amp;#125;&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              sudo: true,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshCommand(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              remote: remoteConfig,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              command: &amp;quot;docker rm -f  $&amp;#123;containerName&amp;#125; | true&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              sudo: true,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            // DOCKER_IMAGE_VERSION 中涉及到 GIT_LOCAL_BRANCH / GIT_TAG / GIT_COMMIT 的环境变量的使用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            // 需要在本地完成拼接后，再传入到远端服务器中使用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            DOCKER_IMAGE_URL = sh(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              script: &amp;quot;echo $&amp;#123;registry&amp;#125;/$&amp;#123;projectName&amp;#125;:$&amp;#123;GIT_COMMIT&amp;#125;&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              returnStdout: true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshCommand(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              remote: remoteConfig,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              command: &amp;quot;docker run -d -p 2111:80 --name $&amp;#123;containerName&amp;#125; $&amp;#123;DOCKER_IMAGE_URL&amp;#125;&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              sudo: true,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            echo &amp;quot;部署成功，请到 https://1410.xxxx.com 预览效果&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stage(&amp;#x27;上传CDN&amp;#x27;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      steps &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        echo &amp;#x27;构建中...&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sh &amp;#x27;node index.js&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        echo &amp;#x27;上传完成&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  environment &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    registry = &amp;#x27;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    username = &amp;#x27;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    password = &amp;#x27;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    projectName = &amp;#x27;1410&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    containerName = &amp;#x27;1410&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    remote_cred = &amp;#x27;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;为防止docker镜像启动不成功，导致原有的网站不可访问，所以将对应的&lt;code&gt;dist&lt;/code&gt;中的文件上传到CDN中作为最后一步，这样可以保证服务启动后，访问的是最新的站点，将dist文件上传到cos上我使用的是我前期写的一个开源项目&lt;a href=&quot;https://github.com/dislazy/alidaodao-cos-uploader&quot;&gt;alidaodao-cos-uploader&lt;/a&gt;,具体的步骤可以访问项目后进行配置。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;到此整个自动化部署的过程也结束了，可以看看对应的运行步骤截图：&lt;br&gt;&lt;img src=&quot;https://imagecdn.bosong.online/pic/KtliwD.png&quot; class=&quot;lazyload&quot; data-srcset=&quot;https://imagecdn.bosong.online/pic/KtliwD.png&quot; srcset=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==&quot; alt=&quot;coding持续集成&quot;&gt;&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="技术手册" scheme="https://blog.bosong.online/categories/%E6%8A%80%E6%9C%AF%E6%89%8B%E5%86%8C/"/>
    
    
    <category term="nginx" scheme="https://blog.bosong.online/tags/nginx/"/>
    
    <category term="docker" scheme="https://blog.bosong.online/tags/docker/"/>
    
    <category term="CDN" scheme="https://blog.bosong.online/tags/CDN/"/>
    
    <category term="DEVOPS" scheme="https://blog.bosong.online/tags/DEVOPS/"/>
    
  </entry>
  
  <entry>
    <title>minio改造支持tencent-cos</title>
    <link href="https://blog.bosong.online/minio%E6%94%B9%E9%80%A0%E6%94%AF%E6%8C%81tencent-cos.html"/>
    <id>https://blog.bosong.online/minio%E6%94%B9%E9%80%A0%E6%94%AF%E6%8C%81tencent-cos.html</id>
    <published>2022-01-28T02:55:50.000Z</published>
    <updated>2022-06-02T01:05:59.616Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近在调研一款能管理我的tencent-cos的在线管理端软件，然后调研了很多软件，之前试用过nextcloud发现一般，然后看中了minio，看评测说性能比较好，并且支持S3协议。</p><p>在实际使用过程中是使用的docker部署，具体命令如下,对应文档可以点击<a href="http://docs.minio.org.cn/docs/master/minio-gateway-for-s3">minio-gateway</a>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9000:9000 --name minio-s3 \</span><br><span class="line"> -e &quot;MINIO_ACCESS_KEY=access_key&quot; \</span><br><span class="line"> -e &quot;MINIO_SECRET_KEY=secret_key&quot; \</span><br><span class="line"> minio/minio gateway s3  https://cos.ap-beijing.myqcloud.com</span><br></pre></td></tr></table></figure><p>然而在我将信息填入以后，发现始终无法创建,提示：<code>ERROR Unable to initialize gateway backend: Could not parse the specified URI.</code><br>然而通过中心搜索并不能寻找到结果，然后使用全英文搜索就找到问题所在了，原因是：tencent-cos的bucket命名是以: <strong>bucket名+个人的账号数字</strong>为命名方式的，和minio的默认创建桶的方式不一样，所以始终提示该错误。</p></div><div class="story post-story"><h2 id="改造过程"><a href="#改造过程" class="headerlink" title="改造过程"></a>改造过程</h2><p>既然问题已经找到，剩下的问题就解决问题了，解决问题一般有两种方案，一般是解决创造问题的人，一种是直接解决，然而通过腾讯云的工单并不能解决问题，直接说是第三方的原因导致的，无法进行修改。<br>直接解决问题也很简单：</p><ul><li>先找到minio的github仓库，然后fork到自己的仓库中，</li><li>按文件夹查找<strong>cmd-&gt;gateway-&gt;s3-&gt;gateway-s3.go</strong>文件</li><li>然后找到<strong>randString</strong>这个方法</li><li>修改最后的返回值为：<code>return prefix + string(b[0:30-len(prefix)]) + &quot;-123&quot;</code>。</li><li>此时问题解决。</li></ul></div><div class="story post-story"><h2 id="修改完代码如何投入使用"><a href="#修改完代码如何投入使用" class="headerlink" title="修改完代码如何投入使用"></a>修改完代码如何投入使用</h2><p>其实记录本篇文章的目的不仅仅是解决上面遇到的问题，更是记录一下实际在修改完代码后如何投入使用，最简单的方法有两种：</p><ul><li>如果直接使用宿主机安装的，那么用带有go环境的电脑，直接进入仓库运行<code>make</code> 打包出可执行文件minio然后替换原来的直接执行</li><li>如果使用docker安装的稍微有些麻烦,但是原理是替换容器中的可执行文件，然后再次执行，下面详细讲解一下</li></ul><h3 id="docker容器修改启动minio"><a href="#docker容器修改启动minio" class="headerlink" title="docker容器修改启动minio"></a>docker容器修改启动minio</h3><ul><li>如果没有go环境先安装go环境，如果会github action的可以先用github action来进行打包和封装进镜像</li><li>然后运行<code>make</code> 运行完后会打包出一个minio的可执行文件</li><li>然后将官方镜像文件下载下来，先运行一下，再通过<code>docker cp minio minio:/opt/bin/</code></li><li>将<strong>minio</strong> 这个容器中的可执行文件直接替换成新的，如果你的容器名不叫这个，可以更换成自己的名字或者容器ID</li><li>不知道minio在容器中存放的位置，可以镜像仓库中的<strong>Dockerfile.release</strong>中找到，如：<code>curl -s -q https://dl.min.io/server/minio/release/linux-$&#123;TARGETARCH&#125;/archive/minio.$&#123;RELEASE&#125; -o /opt/bin/minio</code> 此时就找到了<code>/opt/bin/minio</code>的存放位置</li></ul></div><div class="story post-story"><h2 id="改造结果"><a href="#改造结果" class="headerlink" title="改造结果"></a>改造结果</h2><p>注意：改造完成后，容器可以正常运行，此时可以将该容器打造成一个镜像，再上传到你的镜像仓库中，作为cos的专用版使用。</p><p>此时整个过程都比较简单，就是需要安装go环境和利用docker容器的一些常用方法，进行对应的改造。</p><p>就写到这了，有问题可以直接通过邮件联系我一起交流。</p></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;最近在调研一款能管理我的tencent-cos的在线管理端软件，然后调研了很多软件，之前试用过nextcloud发现一般，然后看中了minio，看评测说性能比较好，并且支持S3协议。&lt;/p&gt;
&lt;p&gt;在实际使用过程中是使用的docker部署，具体命令如下,对应文档可以点击&lt;a href=&quot;http://docs.minio.org.cn/docs/master/minio-gateway-for-s3&quot;&gt;minio-gateway&lt;/a&gt;：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker run -p 9000:9000 --name minio-s3 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -e &amp;quot;MINIO_ACCESS_KEY=access_key&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -e &amp;quot;MINIO_SECRET_KEY=secret_key&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; minio/minio gateway s3  https://cos.ap-beijing.myqcloud.com&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然而在我将信息填入以后，发现始终无法创建,提示：&lt;code&gt;ERROR Unable to initialize gateway backend: Could not parse the specified URI.&lt;/code&gt;&lt;br&gt;然而通过中心搜索并不能寻找到结果，然后使用全英文搜索就找到问题所在了，原因是：tencent-cos的bucket命名是以: &lt;strong&gt;bucket名+个人的账号数字&lt;/strong&gt;为命名方式的，和minio的默认创建桶的方式不一样，所以始终提示该错误。&lt;/p&gt;
&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;改造过程&quot;&gt;&lt;a href=&quot;#改造过程&quot; class=&quot;headerlink&quot; title=&quot;改造过程&quot;&gt;&lt;/a&gt;改造过程&lt;/h2&gt;&lt;p&gt;既然问题已经找到，剩下的问题就解决问题了，解决问题一般有两种方案，一般是解决创造问题的人，一种是直接解决，然而通过腾讯云的工单并不能解决问题，直接说是第三方的原因导致的，无法进行修改。&lt;br&gt;直接解决问题也很简单：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先找到minio的github仓库，然后fork到自己的仓库中，&lt;/li&gt;
&lt;li&gt;按文件夹查找&lt;strong&gt;cmd-&amp;gt;gateway-&amp;gt;s3-&amp;gt;gateway-s3.go&lt;/strong&gt;文件&lt;/li&gt;
&lt;li&gt;然后找到&lt;strong&gt;randString&lt;/strong&gt;这个方法&lt;/li&gt;
&lt;li&gt;修改最后的返回值为：&lt;code&gt;return prefix + string(b[0:30-len(prefix)]) + &amp;quot;-123&amp;quot;&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;此时问题解决。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="minio" scheme="https://blog.bosong.online/categories/minio/"/>
    
    
    <category term="Golang" scheme="https://blog.bosong.online/tags/Golang/"/>
    
    <category term="docker" scheme="https://blog.bosong.online/tags/docker/"/>
    
    <category term="minio" scheme="https://blog.bosong.online/tags/minio/"/>
    
  </entry>
  
  <entry>
    <title>程序员抢火车票攻略-用技术创造美好生活</title>
    <link href="https://blog.bosong.online/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%8A%A2%E7%81%AB%E8%BD%A6%E7%A5%A8%E6%94%BB%E7%95%A5-%E7%94%A8%E6%8A%80%E6%9C%AF%E5%88%9B%E9%80%A0%E7%BE%8E%E5%A5%BD%E7%94%9F%E6%B4%BB.html"/>
    <id>https://blog.bosong.online/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%8A%A2%E7%81%AB%E8%BD%A6%E7%A5%A8%E6%94%BB%E7%95%A5-%E7%94%A8%E6%8A%80%E6%9C%AF%E5%88%9B%E9%80%A0%E7%BE%8E%E5%A5%BD%E7%94%9F%E6%B4%BB.html</id>
    <published>2022-01-10T03:55:53.000Z</published>
    <updated>2022-06-02T01:05:59.618Z</updated>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>春运已至，又到了回家团圆的时候了，现在春运抢票越来越难，原因是很多人开始使用技术来抢票，在高配置高带宽的服务器上抢票几率要稍微高一点，希望我这篇文章能帮助正在阅读的你抢到回家的火车票。</p><p>2021年始开始从win转向了macos，再也没有win机器了，然而抢票软件是<a href="https://www.bypass.cn/">12306分流</a>，目前还只能在win服务器上运行，所以就想起了云服务器，我自己也有好几个服务器，但是都是centos服务器，上面有服务器在运行，然后我就想起了阿里云的抢占式实例服务器。</p><p>说干就干，用抢占式实例服务器（2H4G5M费用大概5毛钱一小时）成功抢到了回家的高铁票，所以将教程分享出来。</p><h3 id="上阿里云（腾讯云）注册账号、实名认证"><a href="#上阿里云（腾讯云）注册账号、实名认证" class="headerlink" title="上阿里云（腾讯云）注册账号、实名认证"></a>上阿里云（腾讯云）注册账号、实名认证</h3><p>直接上<a href="https://aliyun.com/">阿里云</a>  官网进行注册和实名认证即可。</p><p>由于按量付费服务器或者抢占式实例服务器是后付费账单，这时候需要提前充值好金额（<strong>建议100及以上</strong>），用完服务器费用支付完成后可以直接将剩余的费用<strong>提现</strong>出来。</p><p><img src="https://imagecdn.bosong.online/blog/12306/001.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/001.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="充值100"></p><h3 id="抢占式实例购买步骤"><a href="#抢占式实例购买步骤" class="headerlink" title="抢占式实例购买步骤"></a>抢占式实例购买步骤</h3><p>阿里云购买服务器大致上分为五个步骤：基础配置-&gt;网络和安全组配置-&gt;系统配置(选填)-&gt;分组配置(选填)-&gt;确认订单，<br>还可以在确认订单步骤将该次的配置保存为模板，以后每次创建服务器都直接从模板创建，减少操作的时间。</p><h4 id="进入菜单，选择购买"><a href="#进入菜单，选择购买" class="headerlink" title="进入菜单，选择购买"></a>进入菜单，选择购买</h4><p>直接选择云服务器ECS进入，可以选择地区，这里我选的北京区域。</p><p><img src="https://imagecdn.bosong.online/blog/12306/002.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/002.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="菜单"><br><img src="https://imagecdn.bosong.online/blog/12306/003.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/003.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="购买ECS"></p><h4 id="选择配置"><a href="#选择配置" class="headerlink" title="选择配置"></a>选择配置</h4><ul><li><p>STEP1：点击<strong>抢占式实例</strong>的标签页</p></li><li><p>STEP2：选择一个合适的价格便宜的配置，这里我选的是2H4G，价格是1毛钱多点</p></li><li><p>STEP3：选择操作系统是<br>Windows Server 2019 数据中心版 64位中文版（安全加固）</p></li><li><p>STEP4：选择网络，我选的是固定带宽5M(因为需要远程连接，这个带宽速度和费用比较合适)</p></li><li><p>STEP5：查看总体配置费用，在页面中显示的价格是你所选的全部配置的费用，可以查看详情</p></li></ul><p><img src="https://imagecdn.bosong.online/blog/12306/004.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/004.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="基础配置"><br><img src="https://imagecdn.bosong.online/blog/12306/005.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/005.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="网络配置"><br><img src="https://imagecdn.bosong.online/blog/12306/006.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/006.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="网络配置2"></p><h4 id="系统配置（选填）"><a href="#系统配置（选填）" class="headerlink" title="系统配置（选填）"></a>系统配置（选填）</h4><p>系统配置中主要是将 登录凭证设置为<strong>创建后设置</strong>，因为抢占式实例，需要创建后设置，在开通服务器5分钟后重置你需要的密码就可以登录上去了。<br><img src="https://imagecdn.bosong.online/blog/12306/007.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/007.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="系统配置"></p><h4 id="分组配置（选填）"><a href="#分组配置（选填）" class="headerlink" title="分组配置（选填）"></a>分组配置（选填）</h4><p>分组配置随意填即可<br><img src="https://imagecdn.bosong.online/blog/12306/008.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/008.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="分组配置"></p><h4 id="确认配置-下单或者保存模板"><a href="#确认配置-下单或者保存模板" class="headerlink" title="确认配置-下单或者保存模板"></a>确认配置-下单或者保存模板</h4><p>仔细检查你需要的详细配置，然后点击保存模板，或者直接创建实例即可。<br><img src="https://imagecdn.bosong.online/blog/12306/009.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/12306/009.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="确认配置"></p><h3 id="抢票环节"><a href="#抢票环节" class="headerlink" title="抢票环节"></a>抢票环节</h3><p>当服务器购买完成以后，如果不用VPC模式直接连接到服务器，而是使用<strong>Microsoft Remote Desktop</strong>客户端连接到服务器时，需要等5分钟将密码设置为你的密码，然后连接到服务上。</p><p>接下来几步直接抢票支付即可：</p><ul><li>去<a href="https://www.bypass.cn/">12306分流</a>下载bypass软件</li><li>解压缩bypass软件</li><li>登录你的12306账号进入软件</li><li>设置你的始发站和目的地、时间，点击抢票即可。</li></ul><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>云服务器不局限于阿里云，这里只是使用阿里云举个栗子，实际上腾讯云也同样支持，其他云服务商我还没怎么使用过，过程比较简单，费用也还算便宜，适合用于手头没有win电脑或者IP被封的用户去买票。</p><p>最后，希望各位新年胜旧年，都能抢到回家的票，阖家团圆。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;p&gt;春运已至，又到了回家团圆的时候了，现在春运抢票越来越难，原因是很多人开始使用技术来抢票，在高配置高带宽的服务器上抢票几率要稍微高一点，希望我这篇文章能帮助正在阅读的你抢到回家的火车票。&lt;/p&gt;</summary>
    
    
    
    <category term="12306" scheme="https://blog.bosong.online/categories/12306/"/>
    
    
    <category term="云服务器" scheme="https://blog.bosong.online/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="12306" scheme="https://blog.bosong.online/tags/12306/"/>
    
    <category term="抢占式实例" scheme="https://blog.bosong.online/tags/%E6%8A%A2%E5%8D%A0%E5%BC%8F%E5%AE%9E%E4%BE%8B/"/>
    
  </entry>
  
  <entry>
    <title>mysql的table复制</title>
    <link href="https://blog.bosong.online/mysql%E7%9A%84table%E5%A4%8D%E5%88%B6.html"/>
    <id>https://blog.bosong.online/mysql%E7%9A%84table%E5%A4%8D%E5%88%B6.html</id>
    <published>2022-01-09T06:58:14.000Z</published>
    <updated>2022-06-02T01:05:59.616Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>前段时间在鼓捣数据表的数据上线，主要流程是将线下的数据同步到线上去，线上的部分需要需要和线下保持一直，并且每一次操作都需要自动化将表进行备份， 这个过程主要是靠自己进行代码同步，因为规则比较自定义，所以没有使用一些现有的数据同步。</p><p>主要流程如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- #备份NX的SCHEMA中的表并查询特定数据进行备用</span><br><span class="line">NX-SCHEMA: 备份NX-TABLE ==&gt; NX-TABLE_COPY ==&gt; SELECT * FROM NX-TABLE_COPY WHERE ID =xx</span><br><span class="line"></span><br><span class="line">- #备份JAPAB的SCHEMA中的表并且将上一步的数据写入到备份表中</span><br><span class="line">JAPAN-SCHEMA: BEFEN JAPAN-TABLE ==&gt; JAPAN-TABLE_COPY ==&gt; INSERT INTO JAPAN-TABLE_COPY VALUE (xxx)</span><br><span class="line"></span><br><span class="line">- #将JAPAN的SCHEMA中的原表和备份表进行重命名，将备份表的表名变成源表名，完成数据上线</span><br><span class="line">JAPAN-SCHEMA: JAPAN-TABLE ==&gt; RENAME JAPAN-TABL XXX ==&gt; RENAME JAPAN-TABLE_COPY TO JAPAN-TABLE</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在这个过程中，我们最主要的一步是在同一个schema下进行将原表进行备份，创建一个对应的不同表，后续所有的操作都改这个表中操作，在这个过程中也是出现了一些问题，后续经过实践后解决了相关问题，特此记录。</p></div><div class="story post-story"><h2 id="经过"><a href="#经过" class="headerlink" title="经过"></a>经过</h2><p>我们在备份源Schema中的table时，直接采取了简单粗暴的SQL语句，如下：<code>create table table_name_copy as select * from table_name</code>,该SQL实现了创建<code>table_name_copy</code>并且将<code>table_name</code>中的数据也插入到对应的新表中，<br>看似满足了我们的需求：朴素的备份源表，不进行任何操作。</p><p>然而，简单的事情总是不会那么简单，在我们进行数据比对时，发现数据没啥问题，但是在校验表的DDL时，发现麻烦稍微有点大，此次备份基本没用，因为此时我们的表的主键、索引等等都丢失了，然后我们再查询相关的文档，发现弊端还挺多。</p><p>然后在此上进行了改进，先根据ddl创建表的结构，然后再讲数据导入进来，这样就避免了锁、和索引等问题。SQL如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">第一步：创建表结构</span><br><span class="line"></span><br><span class="line">方法一： 按照老表的结构创建新表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> new_table <span class="keyword">like</span> old_table;</span><br><span class="line">方法二： 此种方法是先获取ddl，然后再修改表名再次执行DDL，进行表结构创建</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> old_table;</span><br><span class="line"></span><br><span class="line">第二步：同步原表数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> new_table <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> old_table;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>备份表的结构和数据都还是比较简单，但是这个只适用于少量数据的备份，大量数据的备份暂时还没有进行实践，我们大量的数据备份一般使用CSV或者ETL进行同步。</p></div><div class="story post-story"><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>在同步表结构的过程中出现了一些小的插曲，但是还是圆满的解决了问题，在严格检查的前提下发现了问题，在没有发生故障的情况下及时止损，以后的相关内容也是需要多查文档，锁看看原理，严格进行数据和DDL校验，发现问题速度处理，及时止损。</p></div>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h2&gt;&lt;p&gt;前段时间在鼓捣数据表的数据上线，主要流程是将线下的数据同步到线上去，线上的部分需要需要和线下保持一直，并且每一次操作都需要自动化将表进行备份， 这个过程主要是靠自己进行代码同步，因为规则比较自定义，所以没有使用一些现有的数据同步。&lt;/p&gt;
&lt;p&gt;主要流程如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- #备份NX的SCHEMA中的表并查询特定数据进行备用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NX-SCHEMA: 备份NX-TABLE ==&amp;gt; NX-TABLE_COPY ==&amp;gt; SELECT * FROM NX-TABLE_COPY WHERE ID =xx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- #备份JAPAB的SCHEMA中的表并且将上一步的数据写入到备份表中&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JAPAN-SCHEMA: BEFEN JAPAN-TABLE ==&amp;gt; JAPAN-TABLE_COPY ==&amp;gt; INSERT INTO JAPAN-TABLE_COPY VALUE (xxx)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- #将JAPAN的SCHEMA中的原表和备份表进行重命名，将备份表的表名变成源表名，完成数据上线&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JAPAN-SCHEMA: JAPAN-TABLE ==&amp;gt; RENAME JAPAN-TABL XXX ==&amp;gt; RENAME JAPAN-TABLE_COPY TO JAPAN-TABLE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;在这个过程中，我们最主要的一步是在同一个schema下进行将原表进行备份，创建一个对应的不同表，后续所有的操作都改这个表中操作，在这个过程中也是出现了一些问题，后续经过实践后解决了相关问题，特此记录。&lt;/p&gt;
&lt;/div&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;经过&quot;&gt;&lt;a href=&quot;#经过&quot; class=&quot;headerlink&quot; title=&quot;经过&quot;&gt;&lt;/a&gt;经过&lt;/h2&gt;&lt;p&gt;我们在备份源Schema中的table时，直接采取了简单粗暴的SQL语句，如下：&lt;code&gt;create table table_name_copy as select * from table_name&lt;/code&gt;,该SQL实现了创建&lt;code&gt;table_name_copy&lt;/code&gt;并且将&lt;code&gt;table_name&lt;/code&gt;中的数据也插入到对应的新表中，&lt;br&gt;看似满足了我们的需求：朴素的备份源表，不进行任何操作。&lt;/p&gt;
&lt;p&gt;然而，简单的事情总是不会那么简单，在我们进行数据比对时，发现数据没啥问题，但是在校验表的DDL时，发现麻烦稍微有点大，此次备份基本没用，因为此时我们的表的主键、索引等等都丢失了，然后我们再查询相关的文档，发现弊端还挺多。&lt;/p&gt;
&lt;p&gt;然后在此上进行了改进，先根据ddl创建表的结构，然后再讲数据导入进来，这样就避免了锁、和索引等问题。SQL如下：&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;第一步：创建表结构&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;方法一： 按照老表的结构创建新表&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;table&lt;/span&gt; new_table &lt;span class=&quot;keyword&quot;&gt;like&lt;/span&gt; old_table;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;方法二： 此种方法是先获取ddl，然后再修改表名再次执行DDL，进行表结构创建&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; old_table;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;第二步：同步原表数据&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;INTO&lt;/span&gt; new_table &lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; old_table;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;备份表的结构和数据都还是比较简单，但是这个只适用于少量数据的备份，大量数据的备份暂时还没有进行实践，我们大量的数据备份一般使用CSV或者ETL进行同步。&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="mysql" scheme="https://blog.bosong.online/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://blog.bosong.online/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>使用 Pulsar IO 打造流数据管道</title>
    <link href="https://blog.bosong.online/streaming-data-pipelines-with-pulsar-io.html"/>
    <id>https://blog.bosong.online/streaming-data-pipelines-with-pulsar-io.html</id>
    <published>2021-11-19T13:22:26.000Z</published>
    <updated>2022-06-02T01:05:59.616Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本文翻译自 StreamNative 博客。博客原作者：Ioannis Polyzos，StreamNative 解决方案工程师。原文链接：<a href="https://streamnative.io/blog/engineering/2021-11-10-streaming-data-pipelines-with-pulsar-io/">https://streamnative.io/blog/engineering/2021-11-10-streaming-data-pipelines-with-pulsar-io/</a></p></blockquote><h1 id="翻译背景"><a href="#翻译背景" class="headerlink" title="翻译背景"></a>翻译背景</h1><p>今年以来就加入到了Pulsar的开源志愿者中，主要翻译一些英文文档以及做对Pulsar的深入研究。这是我翻译的一篇完整的外文博客，以此作为一个记录，相关文章已发布在StreamNative的公众号中。<a href="https://mp.weixin.qq.com/s/90rEeY8mVKKWM57AoZmN2A">详情点击</a></p><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>构建现代数据基础设施一直是当今企业的难题。当今的企业需要管理全天候生成和交付的大量异构数据。然而，由于企业对数据的数量和速度等等有多种要求，没有“一刀切”的解决方案。相反，企业需在不同系统之间移动数据，以便存储、处理和提供数据。</p><p>粗看搭建基础设施的历史，企业使用了许多不同的工具来尝试移动数据，例如用于流式工作负载的 Apache Kafka 和用于消息工作负载的 RabbitMQ。现在，Apache Pulsar 的诞生为企业简化了这个过程。</p><p>Apache Pulsar 是一个云原生的分布式消息流平台。Pulsar 旨在满足现代数据需求，支持灵活的消息传递语义、分层存储、多租户和异地复制（跨区域数据复制）。自 2018 年毕业成为 Apache 软件基金会顶级项目以来，Pulsar 项目经历了快速的<a href="http://mp.weixin.qq.com/s?__biz=MzUyMjkzMjA1Ng==&mid=2247488107&idx=1&sn=384631ac80ee51a070c559369c5d9ef2&chksm=f9c5085cceb2814aa7182d530643bc6a23bcc931936b8f613d358864f06e1e5a754f756d454e#rd">社区增长</a>、周边生态的发展和全球用户的增长。 将 Pulsar 用作数据基础设施的支柱，公司能够以快速且可扩展的方式移动数据。在这篇博文中，我们将介绍如何使用 Pulsar IO 在 Pulsar 和外部系统之间轻松导入和导出数据。</p><h1 id="1-Pulsar-IO-简介"><a href="#1-Pulsar-IO-简介" class="headerlink" title="1. Pulsar IO 简介"></a>1. Pulsar IO 简介</h1><p>Pulsar IO 是一个完整的工具包，用于创建、部署和管理与外部系统（如键&#x2F;值存储、分布式文件系统、搜索索引、数据库、数据仓库、其他消息传递系统等）集成的 Pulsar 连接器。由于 Pulsar IO 构建在 Pulsar 的无服务器计算层（称为<a href="https://pulsar.apache.org/docs/en/functions-overview/">Pulsar Function</a> ）之上，因此编写 Pulsar IO 连接器就像编写 Pulsar Function 一样简单。</p><p>借助 Pulsar IO，用户可以使用现有的 Pulsar 连接器或编写自己的自定义连接器，轻松地将数据移入和移出 Pulsar。Pulsar IO 拥有以下优势：</p><ul><li>多样的连接器：当前 Pulsar 生态中有许多<a href="https://hub.streamnative.io/">现有的 Pulsar IO 连接器</a>用于外部系统，例如 Apache Kafka、Cassandra 和 Aerospike。使用这些连接器有助于缩短生产时间，因为创建集成所需的所有部件都已就位。开发人员只需要提供配置（如连接 url 和凭据）来运行连接器。</li><li>托管运行时：Pulsar IO 带有托管运行时，负责执行、调度、扩展和容错。开发人员可以专注于配置和业务逻辑。</li><li>多接口：通过 Pulsar IO 提供的接口，用户可以减少用于生成和使用应用程序的样板代码。</li><li>高扩展性：在需要更多实例来处理传入流量的场景下，用户可以通过更改一个简单的配置值轻松横向扩展；如果用户使用 Kubernetes 运行时，可根据流量需求进行弹性扩展。</li><li>充分利用 schema：Pulsar IO 通过在数据模型上指定 schema 类型来帮助用户充分运用 schema，Pulsar IO 支持 JSON、Avro 和 Protobufs 等 schema 类型。</li></ul><h1 id="2-Pulsar-IO-运行时"><a href="#2-Pulsar-IO-运行时" class="headerlink" title="2. Pulsar IO 运行时"></a>2. Pulsar IO 运行时</h1><p>由于 Pulsar IO 建立在 Pulsar Function 之上，因此 Pulsar IO 和 Pulsar Function 具有相同的运行时选项。部署 Pulsar IO 连接器时，用户有以下选择：</p><ul><li><strong>线程</strong>：在与工作线程相同的 JVM 中运行。（通常用于测试的和本地运行，不推荐用于生产部署。）</li><li><strong>进程</strong>：在不同的进程中运行，用户可以使用多个工作线程跨多个节点横向扩展。</li><li><strong>Kubernetes</strong>：在 Kubernetes 集群中作为 Pod 运行，worker 与 Kubernetes 协调。这种运行时方式保证用户可以充分利用 Kubernetes 这样的云原生环境提供的优势，比如轻松横向扩展。</li></ul><h1 id="3-Pulsar-IO-接口"><a href="#3-Pulsar-IO-接口" class="headerlink" title="3. Pulsar IO 接口"></a>3. Pulsar IO 接口</h1><p>如前所述，Pulsar IO 减少了生成和消费应用程序所需的样板代码。它通过提供不同的基本接口来实现这一点，这些接口抽象出样板代码并允许我们专注于业务逻辑。<br>Pulsar IO 支持 Source 和 Sink 的基本接口。Source 连接器（Source connector）允许用户将数据从外部系统带入 Pulsar，而 Sink 连接器（Sink Connector）可用于将数据移出 Pulsar 并移入外部系统，例如数据库。<br>还有一种特殊类型的 Source 连接器，称为 Push Source。Push Source 连接器可以轻松实现某些需要推送数据的集成。举例来说，Push Source 可以是变更数据捕获源系统，它在接收到新变更后，会自动将该变更推送到 Pulsar。</p><h3 id="Source-接口"><a href="#Source-接口" class="headerlink" title="Source 接口"></a>Source 接口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public interface Source&lt;T&gt; extends AutoCloseable &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Open connector with configuration.</span><br><span class="line">     *</span><br><span class="line">     * @param config initialization config</span><br><span class="line">     * @param sourceContext environment where the source connector is running</span><br><span class="line">     * @throws Exception IO type exceptions when opening a connector</span><br><span class="line">     */</span><br><span class="line">    void open(final Map&lt;String, Object&gt; config, SourceContext sourceContext) throws Exception;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Reads the next message from source.</span><br><span class="line">     * If source does not have any new messages, this call should block.</span><br><span class="line">     * @return next message from source.  The return result should never be null</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    Record&lt;T&gt; read() throws Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Push-Source-接口"><a href="#Push-Source-接口" class="headerlink" title="Push Source 接口"></a>Push Source 接口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public interface BatchSource&lt;T&gt; extends AutoCloseable &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Open connector with configuration.</span><br><span class="line">     *</span><br><span class="line">     * @param config config that&#x27;s supplied for source</span><br><span class="line">     * @param context environment where the source connector is running</span><br><span class="line">     * @throws Exception IO type exceptions when opening a connector</span><br><span class="line">     */</span><br><span class="line">    void open(final Map&lt;String, Object&gt; config, SourceContext context) throws Exception;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Discovery phase of a connector.  This phase will only be run on one instance, i.e. instance 0, of the connector.</span><br><span class="line">     * Implementations use the taskEater consumer to output serialized representation of tasks as they are discovered.</span><br><span class="line">     *</span><br><span class="line">     * @param taskEater function to notify the framework about the new task received.</span><br><span class="line">     * @throws Exception during discover</span><br><span class="line">     */</span><br><span class="line">    void discover(Consumer&lt;byte[]&gt; taskEater) throws Exception;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Called when a new task appears for this connector instance.</span><br><span class="line">     *</span><br><span class="line">     * @param task the serialized representation of the task</span><br><span class="line">     */</span><br><span class="line">    void prepare(byte[] task) throws Exception;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Read data and return a record</span><br><span class="line">     * Return null if no more records are present for this task</span><br><span class="line">     * @return a record</span><br><span class="line">     */</span><br><span class="line">    Record&lt;T&gt; readNext() throws Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Sink-接口"><a href="#Sink-接口" class="headerlink" title="Sink 接口"></a>Sink 接口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public interface Sink&lt;T&gt; extends AutoCloseable &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Open connector with configuration.</span><br><span class="line">     *</span><br><span class="line">     * @param config initialization config</span><br><span class="line">     * @param sinkContext environment where the sink connector is running</span><br><span class="line">     * @throws Exception IO type exceptions when opening a connector</span><br><span class="line">     */</span><br><span class="line">    void open(final Map&lt;String, Object&gt; config, SinkContext sinkContext) throws Exception;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Write a message to Sink.</span><br><span class="line">     *</span><br><span class="line">     * @param record record to write to sink</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    void write(Record&lt;T&gt; record) throws Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h1><p>Apache Pulsar 能够作为现代数据基础设施的支柱，它使企业能够以快速且可扩展的方式搬运数据。Pulsar IO 是一个连接器框架，它为开发人员提供了所有必要的工具来创建、部署和管理与不同系统集成的 Pulsar 连接器。Pulsar IO 抽象掉所有样板代码，使开发人员可以专注于应用程序逻辑。</p><h1 id="5-延伸阅读"><a href="#5-延伸阅读" class="headerlink" title="5. 延伸阅读"></a>5. 延伸阅读</h1><p>如果您有兴趣了解更多信息并构建自己的连接器，请查看以下资源：</p><ul><li><a href="https://hub.streamnative.io/">查看 Pulsar 周边生态中所有 Pulsar IO 连接器</a></li><li><a href="https://www.youtube.com/watch?v=w9xQyyoFds4">构建和部署 Source 连接器</a></li><li><a href="https://www.bilibili.com/video/BV1n44y147xr?p=7">为 Pulsar IO 编写自定义 Sink 连接器</a></li><li><a href="https://www.bilibili.com/video/BV1C64y197Db?p=3">监控和故障排除连接器</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本文翻译自 StreamNative 博客。博客原作者：Ioannis Polyzos，StreamNative 解决方案工程师。原文链接：&lt;a href=&quot;https://streamnative.io/blog/engineering/2021-11-10-streaming-data-pipelines-with-pulsar-io/&quot;&gt;https://streamnative.io/blog/engineering/2021-11-10-streaming-data-pipelines-with-pulsar-io/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;翻译背景&quot;&gt;&lt;a href=&quot;#翻译背景&quot; class=&quot;headerlink&quot; title=&quot;翻译背景&quot;&gt;&lt;/a&gt;翻译背景&lt;/h1&gt;</summary>
    
    
    
    <category term="Pulsar" scheme="https://blog.bosong.online/categories/Pulsar/"/>
    
    
    <category term="Pulsar" scheme="https://blog.bosong.online/tags/Pulsar/"/>
    
    <category term="IO" scheme="https://blog.bosong.online/tags/IO/"/>
    
    <category term="Stream" scheme="https://blog.bosong.online/tags/Stream/"/>
    
  </entry>
  
  <entry>
    <title>苹果M1芯片的MBP安装WIN10</title>
    <link href="https://blog.bosong.online/%E8%8B%B9%E6%9E%9CM1%E8%8A%AF%E7%89%87%E7%9A%84MBP%E5%AE%89%E8%A3%85WIN10.html"/>
    <id>https://blog.bosong.online/%E8%8B%B9%E6%9E%9CM1%E8%8A%AF%E7%89%87%E7%9A%84MBP%E5%AE%89%E8%A3%85WIN10.html</id>
    <published>2021-07-22T14:43:00.000Z</published>
    <updated>2022-06-02T01:05:59.618Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>朋友买了一台M1的MBP，但是又需要安装财务软件(财务软件需要安装在windows系统上)，M1目前还不支持原生安装WIN10,所以采用虚拟安装的方法来安装对应的WIN10。</p><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>一开始不知道这里面有坑，直接在<a href="https://next.itellyou.cn/">https://next.itellyou.cn/</a> 网站上下载了普通的WIN10企业版，结果自然不可用。</p><p>然后发现镜像列表中是有ARM的镜像可下，然而经过漫长的文件下载过程后，发现镜像仍不可用。</p><p>这时候就各种查文档，然后查到了网上说去微软官网下载官方ARM的官方预览版，我兴致冲冲的找到了对应的版本，然后不给下，需要注册成为预览版的体验用户，但是并没有告诉我成为预览版体验用户的入口。。。</p><p>但是这时候我并没有放弃，找了一大堆文档，终于找到了下载镜像的方法。</p><p>如果需要在M1芯片的Mac电脑上安装基于ARM64内部预览版的Windows 10虚拟机，需要ARM64安装源 (VHDX)。下面是详细步骤:</p><ol><li><p>点击访问<a href="https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewARM64">微软 Windows内部预览下载网页</a>.</p></li><li><p>如果自己已经是内部体验用户，请使用页面右上角的 “登录” 选项进行登录。<br>  <img src="https://imagecdn.bosong.online/blog/login.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/login.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="登录"></p><p>  如果不是内部体验用户，请点击 <a href="https://insider.windows.com/">链接</a>点击注册选项注册Windows内部体验的用户。</p><p>  <img src="https://imagecdn.bosong.online/blog/register.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/register.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="注册"></p></li><li><p>成功注册Windows 内部体验用户后，再次登录然后回到 <a href="https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewARM64">微软 Windows内部预览下载网页</a>.</p></li><li><p>在页面的下面可以找到WIN10的ARM64位镜像的VHDX的文件下载，如图所示:</p></li></ol><p><img src="https://imagecdn.bosong.online/blog/win10.png" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/win10.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="chdx"></p><ol start="5"><li><p>然后在<a href="https://www.parallels.cn/">https://www.parallels.cn/</a> 网站下载Parallels Desktop 然后先安装好它（激活考虑到版权原因，此处不作说明），静静的等待WIN10下载完成</p></li><li><p>当WIN10 镜像的VHDX文件下载完成后，双击VHDX文件，将自动打开Parallels Desktop</p></li><li><p>然后进入了配置页面，选择用途时候可以选择生产力，或者测试均可</p></li><li><p>点继续，填一下你需要创建的镜像名称和地址，默认可不修改</p></li><li><p>进入了这一步就静静等待WIN10镜像初始化安装完成，可以安装需要的软件了。</p></li></ol><p>温馨提示：</p><ul><li><p>WIN10镜像原版是全英文的，如果需要换成英文在设置中下载中文语言包然后更改语言为中文即可。</p></li><li><p>WIN10关闭后如果下次启动，直接打开Parallels Desktop，然后选择你上次创建的VM名称，右键恢复即可。</p></li></ul><p>以上就是我在M1的MBP安装WIN10的全部步骤。</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>整个过程因为是第一次安装，提前没有做很多的准备，所以一步一坑，花了接近4个小时才解决问题，写这篇文章的目的就是将对应的步骤记录下来，以便参考或者下次自己安装的时候还知道怎么安装。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;朋友买了一台M1的MBP，但是又需要安装财务软件(财务软件需要安装在windows系统上)，M1目前还不支持原生安装WIN10,所以采用虚拟安装的方法来安装对应的WIN10。&lt;/p&gt;</summary>
    
    
    
    <category term="Macos" scheme="https://blog.bosong.online/categories/Macos/"/>
    
    
    <category term="apple" scheme="https://blog.bosong.online/tags/apple/"/>
    
    <category term="win10" scheme="https://blog.bosong.online/tags/win10/"/>
    
  </entry>
  
  <entry>
    <title>clickhouse和mysql的不同用法之陷入误区</title>
    <link href="https://blog.bosong.online/clickhouse%E5%92%8Cmysql%E7%9A%84%E4%B8%8D%E5%90%8C%E7%94%A8%E6%B3%95%E4%B9%8B%E9%99%B7%E5%85%A5%E8%AF%AF%E5%8C%BA.html"/>
    <id>https://blog.bosong.online/clickhouse%E5%92%8Cmysql%E7%9A%84%E4%B8%8D%E5%90%8C%E7%94%A8%E6%B3%95%E4%B9%8B%E9%99%B7%E5%85%A5%E8%AF%AF%E5%8C%BA.html</id>
    <published>2021-07-19T14:25:31.000Z</published>
    <updated>2022-06-02T01:05:59.615Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>我们的数据计算式基于clickhouse的，由于接触clickhouse不久，看官网介绍语法和mysql是类似的，就放心大胆的使用mysql的大量语法，然后遇到了一个很奇怪的问题，也是这个奇怪的问题让我对列式数据库有了更深入的了解。</p><h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>先了解一下clickhouse对列式数据库的图表述：<br><img src="https://imagecdn.bosong.online/blog/column-oriented.gif" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/column-oriented.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="列式数据库"></p><p>再了解一下mysql的行式数据库的图表述：<br><img src="https://imagecdn.bosong.online/blog/row-oriented.gif" class="lazyload" data-srcset="https://imagecdn.bosong.online/blog/row-oriented.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="行式数据库"></p><p>然后下面这样一段sql:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select a,0 as b,0 as c</span><br><span class="line">from tbl_xxx</span><br><span class="line">where del = 1 </span><br><span class="line">and (1&gt;1 or b in (1,2,3) or c in (4,5,6))</span><br><span class="line">group by a,b,c</span><br><span class="line">order by a desc</span><br></pre></td></tr></table></figure><p>这样一段很简单的sql，在clickhouse中却无论如何都查询不出结果，明明在where条件在数据库中满足条件的数据量非常的多，却出现这样奇怪的现象。</p><h3 id="排查问题"><a href="#排查问题" class="headerlink" title="排查问题"></a>排查问题</h3><ul><li>排查到的问题1：以为是<code> 1&gt;1</code>这个语句导致了数据库无法查询出数据，所以将<code>1&gt;1</code> 改成了 <code>2&gt;1</code>，然而能查询出数据了，但是查询出的是全量的数据，所以经过验证后发现该问题无解</li><li>排查到的问题2：突然想到会不会是由于对clikhouse不熟悉导致了相关的问题出现，所以将同样的表在mysql中创建好，并导入一部分数据，这时……，令人惊奇的事情发生了，mysql可以查出对应的数据</li></ul><p>其实通过两个方法就定位到了问题所在，还是比较幸运的，接下来就是解决方案了。</p><h3 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h3><p>在经过现象验证后，发现行式数据库是这样的规则，当你查询的数据被你赋值了，其实where中的语句如果有相同的字段，那么直接就是对你赋值的值的查询了，所以 <code>1，2，3</code>怎么可以匹配上<code>0</code>这个数呢。<br>既然发现了问题，解决问题也很简单，有个最简单的方案：</p><ul><li>将b&#x2F;c的select中的列名和group&#x2F;order by中的列名都进行修改，修改为<code>b_tmp</code>,<code>c_tmp</code>即可解决问题了，因为这条sql使用了好几个<code>union all</code>，所以是无法舍弃对应的字段的，否则会报错。</li></ul><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>遇到不熟悉的组件还是要多多查看文档，工欲善其事必先利其器，多看文档，了解一下不同的话也是不会出现这样很简单但是有时候也能让人摸不着头脑的问题了，吃一堑长一智，也让我对列式数据库有了更深的理解。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;我们的数据计算式基于clickhouse的，由于接触clickhouse不久，看官网介绍语法和mysql是类似的，就放心大胆的使用mysql的大量语法，然后遇到了一个很奇怪的问题，也是这个奇怪的问题让我对列式数据库有了更深入的了解。&lt;/p&gt;</summary>
    
    
    
    <category term="ClickHouse" scheme="https://blog.bosong.online/categories/ClickHouse/"/>
    
    
    <category term="ClickHouse" scheme="https://blog.bosong.online/tags/ClickHouse/"/>
    
    <category term="Mysql" scheme="https://blog.bosong.online/tags/Mysql/"/>
    
  </entry>
  
  <entry>
    <title>go-web容器化中遇到的两个问题</title>
    <link href="https://blog.bosong.online/go-web%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%A4%E4%B8%AA%E9%97%AE%E9%A2%98.html"/>
    <id>https://blog.bosong.online/go-web%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%A4%E4%B8%AA%E9%97%AE%E9%A2%98.html</id>
    <published>2021-07-18T15:53:43.000Z</published>
    <updated>2022-06-02T01:05:59.615Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>今年开始接触并且实践到Golang，近期自己写了一个相册的服务，是基于前后端分离的模式，由Go提供rest给web页面使用。在项目前期是直接使用的打包完成的二进制文件执行，在管理方面存在一些不方便的地方，所以周末抽时间将其容器化，实现自动化的部署方案，主要就是采用coding的devops流程，容器化使用的还是docker容器，使用的是alpine的镜像，在这个过程中遇到一些问题，下面会详细讲出，以此记录。</p><h3 id="docker容器化过程"><a href="#docker容器化过程" class="headerlink" title="docker容器化过程"></a>docker容器化过程</h3><p>将服务自动化发布流程还是比较简单的，分为以下几步：<br>1、github上创建对应的代码仓库，作为源代码的提交<br>2、在coding上新建一个项目，与github的代码库绑定（github同时也提供github action，也是非常好用的，但是我的服务器主机都在国内，所以涉及到一个跨境网络同步延时很高的问题）<br>3、在创建的项目中有个持续集成-构建计划，此时就是自己编写对应的jenkins文件，当代码有更新时，会自动hook到流程中，执行对应的build&#x2F;deploy过程<br>4、完成deploy过程后，检查对应容器的服务状态以及接口状态是否ok，整个自动化发布流程算是结束。</p><h3 id="go-web在使用alpine过程中出现的问题"><a href="#go-web在使用alpine过程中出现的问题" class="headerlink" title="go-web在使用alpine过程中出现的问题"></a>go-web在使用alpine过程中出现的问题</h3><h4 id="Q1-and-A"><a href="#Q1-and-A" class="headerlink" title="Q1 and A"></a>Q1 and A</h4><p>在启动容器时，一直启动不成功，提示<code>standard_init_linux.go:211: exec user process caused &quot;no such file or directory&quot;</code>,这个问题查了一下google，发现是一个非常基本的问题，有很多的blog上都有这样的问题，<br>原因是由于go动态引用了特殊的包，在alpine的包中不存在的问题，详情可以<a href="https://stackoverflow.com/questions/52640304/standard-init-linux-go190-exec-user-process-caused-no-such-file-or-directory">查看</a>,解决方案也很简单，在build时，加个参数即可：<br><code>-tags netgo</code>，打包时就用命令<code>GOARCH=amd64 go build  -tags netgo -o app</code>即可。</p><h4 id="Q2-and-A"><a href="#Q2-and-A" class="headerlink" title="Q2 and A"></a>Q2 and A</h4><p>启动容器后，日志一切正常，但是访问接口无论如何也访问不通，当执行<code>curl localhost:8111</code>时，提示<code>curl: (56) Recv failure: Connection reset by peer</code>,此时查看容器的端口映射情况，也是正常映射的：<code>0.0.0.0:8111-&gt;8111/tcp, :::8111-&gt;8111/tcp</code>,<br>然后查看我的config配置，发现有一行是host的地址，我填的是<code>127.0.0.1</code>,然后将它修改为<code>0.0.0.0</code>后，外部服务正常可以访问，发现在容器内部<code>127.0.0.1</code>的地址可以直接访问通，当在宿主机进行访问时，即使端口映射是对的也是访问不通的，当改成<code>0.0.0.0</code>后，有端口映射的情况是可以访问通的，代表发布到外部访问</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>遇到的都是两个小问题，解决和查文档，思考的过程中也是很快的，在计算机的世界里很多都是相通的，所谓好记性不如烂笔头，所以将其记录。如果有更多想要交流的，欢迎联系我，可以直接给我发邮件：<a href="mailto:&#115;&#111;&#x6e;&#103;&#98;&#x6f;&#x32;&#x30;&#50;&#x31;&#64;&#111;&#x75;&#x74;&#108;&#x6f;&#111;&#x6b;&#x2e;&#99;&#111;&#x6d;">&#115;&#111;&#x6e;&#103;&#98;&#x6f;&#x32;&#x30;&#50;&#x31;&#64;&#111;&#x75;&#x74;&#108;&#x6f;&#111;&#x6b;&#x2e;&#99;&#111;&#x6d;</a>。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;今年开始接触并且实践到Golang，近期自己写了一个相册的服务，是基于前后端分离的模式，由Go提供rest给web页面使用。在项目前期是直接使用的打包完成的二进制文件执行，在管理方面存在一些不方便的地方，所以周末抽时间将其容器化，实现自动化的部署方案，主要就是采用coding的devops流程，容器化使用的还是docker容器，使用的是alpine的镜像，在这个过程中遇到一些问题，下面会详细讲出，以此记录。&lt;/p&gt;</summary>
    
    
    
    <category term="Docker" scheme="https://blog.bosong.online/categories/Docker/"/>
    
    
    <category term="Docker" scheme="https://blog.bosong.online/tags/Docker/"/>
    
    <category term="Golang" scheme="https://blog.bosong.online/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>standard-notes之集成自己的插件库</title>
    <link href="https://blog.bosong.online/standard-notes%E4%B9%8B%E9%9B%86%E6%88%90%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8F%92%E4%BB%B6%E5%BA%93.html"/>
    <id>https://blog.bosong.online/standard-notes%E4%B9%8B%E9%9B%86%E6%88%90%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8F%92%E4%BB%B6%E5%BA%93.html</id>
    <published>2021-07-16T14:58:49.000Z</published>
    <updated>2022-06-02T01:05:59.616Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>上一篇文章写了怎么部署standardnotes的自建笔记本，在使用过程中发现还需要很多的插件来配合更好的使用standardnotes,来做数据备份以及更好的编辑文档。<br>standardnotes的插件是可插拔的，简而言之就是将静态页面加载到页面中，来使用其中的功能，达到增强的目的。</p><h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><p>standardnotes 作为开源软件和服务提供商，它本身的写笔记和同步笔记是不收费的，提供了mac&#x2F;win的客户端和web端应用，所以多端同步是它最大的优势之一，但它对于插件是使用的收费订阅的模式，每个月基本在3美金以内，但是我都自建服务了，<br>为啥还需要去用它本身的服务了，所以参考了一些文档，调查了一些插件的接入步骤，陆续接入了很多插件。</p><h3 id="接入插件步骤"><a href="#接入插件步骤" class="headerlink" title="接入插件步骤"></a>接入插件步骤</h3><h4 id="查看对应的插件接入文档"><a href="#查看对应的插件接入文档" class="headerlink" title="查看对应的插件接入文档"></a>查看对应的插件接入文档</h4><p>作为开发人员，一般了解到一个不太熟悉的内容，或者需要接入某些组件，第一件事就是查看对应的文档，自己了解到一些细节点，文档地址：<a href="https://docs.standardnotes.org/extensions/intro/">https://docs.standardnotes.org/extensions/intro/</a></p><h4 id="查看github上大牛帮你收集好的插件集合"><a href="#查看github上大牛帮你收集好的插件集合" class="headerlink" title="查看github上大牛帮你收集好的插件集合"></a>查看github上大牛帮你收集好的插件集合</h4><p>github上有很多各种领域的大牛，能让你减少很多的收集软件的时间，这个大牛将standardnotes的一些常用的组件都进行了收集，并且还写成了脚本帮助我们将对应的插件一次性生成到某个地方，来供我们直接使用，减去很多繁琐的步骤，大牛对应的github地址：<a href="https://github.com/iganeshk/standardnotes-extensions">https://github.com/iganeshk/standardnotes-extensions</a> 。<br>由于大牛的仓库没有及时更新，所以我根据最新的版本库，fork了一下大牛的仓库并且完成了对应的最新适配：<a href="https://github.com/dislazy/standardnotes-extensions">https://github.com/dislazy/standardnotes-extensions</a> 可以直接使用我fork的仓库，下面的文档基于dislazy的仓库进行构建过程</p><h4 id="拉取github的代码并且生成对应的插件文件夹"><a href="#拉取github的代码并且生成对应的插件文件夹" class="headerlink" title="拉取github的代码并且生成对应的插件文件夹"></a>拉取github的代码并且生成对应的插件文件夹</h4><ul><li>查看 <a href="https://docs.standardnotes.org/extensions/intro/">插件接入文档</a> 了解插入的接入方式</li><li>查看 github上集成对应插件的<a href="https://github.com/dislazy/standardnotes-extensions">文档</a> </li><li>将对应github的代码拉取到本地服务器中，然后以<code>env.simple</code>文件作为模板，创建自己的插件生成配置，包括插件的对应域名和你的github-token，github-token用于拉取githun上的代码时不受速度等的限制</li><li>创建并配置好<code>.env</code>文件后，我是直接运行docker生成对应的public的插件文件夹，运行在插件文件夹中运行<code>docker run -v $PWD/.env:/build/.env -v $PWD/extensions:/build/extensions -v $PWD/public:/build/public mtoohey/standardnotes-extensions</code> </li><li>当public文件夹配置完成了之后，直接将之前配置过sync服务器对应的反向代理配置一下即可，代码块中是nginx的配置文件。</li><li>当配置完成了重新reload一下nginx的配置文件完成配置，直接可以在网页中应用了。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /extensions &#123;</span><br><span class="line">autoindex off;</span><br><span class="line">alias /path/to/standardnotes-extensions/public;  -- 此处修改为你自己的public路径即可</span><br><span class="line"># CORS HEADERS</span><br><span class="line">if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">   #</span><br><span class="line">   # Custom headers and headers various browsers *should* be OK with but aren&#x27;t</span><br><span class="line">   #</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#x27;;</span><br><span class="line">   #</span><br><span class="line">   # Tell client that this pre-flight info is valid for 20 days</span><br><span class="line">   #</span><br><span class="line">   add_header &#x27;Access-Control-Max-Age&#x27; 1728000;</span><br><span class="line">   add_header &#x27;Content-Type&#x27; &#x27;text/plain; charset=utf-8&#x27;;</span><br><span class="line">   add_header &#x27;Content-Length&#x27; 0;</span><br><span class="line">   return 204;</span><br><span class="line">&#125;</span><br><span class="line">if ($request_method = &#x27;POST&#x27;) &#123;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#x27;;</span><br><span class="line">   add_header &#x27;Access-Control-Expose-Headers&#x27; &#x27;Content-Length,Content-Range&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">if ($request_method = &#x27;GET&#x27;) &#123;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">   add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#x27;;</span><br><span class="line">   add_header &#x27;Access-Control-Expose-Headers&#x27; &#x27;Content-Length,Content-Range&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="需要注意的点"><a href="#需要注意的点" class="headerlink" title="需要注意的点"></a>需要注意的点</h4><ul><li>按需在<code>extensions-reposity</code>文件夹中选择合适的插件配置复制到<code>extension</code> 文件夹中，尽量按需选用，否则构建的时间会很长</li><li>在yaml文件中有一项配置<code>github: sn-extensions/xxxx</code> 中的<code>sn-extensions</code>地址已被官方修改为：<code>standardnotes</code>即可，在dislazy仓库中已被修复</li><li>由于大牛的更新不是特别及时，所以很多插件的版本比较过时，或者插件被原作者删除，及时根据对应的github地址去看看release版本，将插件的版本更新最新的版本</li><li>可以在github上的<code>standardnotes</code>组织中找到一些未被收录的其他好用的插件，集成到你的插件库中，根据文档：<a href="https://docs.standardnotes.org/extensions/intro/">https://docs.standardnotes.org/extensions/intro/</a> 进行操作</li></ul><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>我的插件库主要是将markdown的编辑器，以及推送github的插件集成了，为了更好的编辑文档和推送文档更新。尤其对github推送点赞，直接一键推送，真的太棒了。<br>如果有更好用的插件库或者插件，欢迎给我推荐，如果想要联系我，也可以直接给我发邮件：<a href="mailto:&#x73;&#x6f;&#110;&#x67;&#98;&#111;&#x32;&#48;&#x32;&#x31;&#64;&#x6f;&#117;&#116;&#x6c;&#111;&#111;&#107;&#46;&#99;&#111;&#109;">&#x73;&#x6f;&#110;&#x67;&#98;&#111;&#x32;&#48;&#x32;&#x31;&#64;&#x6f;&#117;&#116;&#x6c;&#111;&#111;&#107;&#46;&#99;&#111;&#109;</a>。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;上一篇文章写了怎么部署standardnotes的自建笔记本，在使用过程中发现还需要很多的插件来配合更好的使用standardnotes,来做数据备份以及更好的编辑文档。&lt;br&gt;standardnotes的插件是可插拔的，简而言之就是将静态页面加载到页面中，来使用其中的功能，达到增强的目的。&lt;/p&gt;</summary>
    
    
    
    <category term="Docker" scheme="https://blog.bosong.online/categories/Docker/"/>
    
    
    <category term="Docker" scheme="https://blog.bosong.online/tags/Docker/"/>
    
    <category term="Note" scheme="https://blog.bosong.online/tags/Note/"/>
    
  </entry>
  
  <entry>
    <title>好用的日常笔记本standard notes</title>
    <link href="https://blog.bosong.online/%E5%A5%BD%E7%94%A8%E7%9A%84%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E6%9C%ACStandard-notes.html"/>
    <id>https://blog.bosong.online/%E5%A5%BD%E7%94%A8%E7%9A%84%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E6%9C%ACStandard-notes.html</id>
    <published>2021-07-11T13:22:01.000Z</published>
    <updated>2022-06-02T01:05:59.617Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>很久很久之前就一直在找一些好用的并且开源的note app，尝试过trilium、蚂蚁笔记、notion、语雀 都没有找到我心仪的那一款，要么是数据是存储在境外，一旦国家的墙更厚了，就尬了，另外一些就是数据很分散，备份出来的数据无法很顺利的导入到其他的app中。<br>直到有一天我发现了Standard notes。</p><h3 id="关于Standard-notes"><a href="#关于Standard-notes" class="headerlink" title="关于Standard notes"></a>关于Standard notes</h3><p><a href="https://standardnotes.com/">Standard notes</a>是一款免费、开源且完全加密的笔记应用程序。</p><p>简单介绍一些它的优点：</p><ul><li>开源 代码开源，可以自己创建对应的服务，将数据存储在自己的自建数据库中，这也是我最看重的一点</li><li>免费 知识付费时代，有一些免费的可维护的项目也是很难得，该产品也是通过开源的形式，然后使用官方的服务队插件进行收费</li><li>完全加密 按照文档的说法是完全的端到端加密，数据在浏览器进行接口传输之前就已经进行了加密，避免网络传输过程中被拦截后数据泄露的场景</li></ul><h3 id="部署Standard-notes"><a href="#部署Standard-notes" class="headerlink" title="部署Standard notes"></a>部署Standard notes</h3><p>Standard notes大部分语言是使用node写的，按照微服务的方式进行拆分，分为几大块：</p><h4 id="服务层："><a href="#服务层：" class="headerlink" title="服务层："></a>服务层：</h4><ul><li>同步服务器 业务逻辑的核心，负责对用户数据的所有操作。</li><li>同步服务器 work 同步服务器 JS Worker 负责同步服务器 JS 可能为后台处理卸载的所有异步任务。这包括例如处理电子邮件备份、解决笔记重复问题、将笔记发送到扩展服务器等等。</li><li>身份验证 该服务器负责所有授权和认证机制。身份验证是处理和处理所有与帐户相关的元数据的地方。</li><li>身份验证 work Auth Worker 负责所有与认证和授权领域相关的异步任务例如，处理帐户删除请求和用户的注册后任务。</li><li>API网关 这是整个架构的主要“入口点”。API 网关充当所有无法直接访问的服务的路由器和代理。<h4 id="数据层："><a href="#数据层：" class="headerlink" title="数据层："></a>数据层：</h4></li><li>数据库 MySQL 数据库服务器。这是存储所有数据的地方。</li><li>缓存 Redis 缓存节点，其中保留所有临时数据以进行性能优化和自动过期功能。在自托管模式下，Redis 默认用作服务与其work之间的通信队列。</li></ul><h4 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h4><p>我是使用的docker-compose 加上自己的公有云数据库和缓存进行部署的，官方给出的docker-compose文件可以参见:<a href="https://docs.standardnotes.org/self-hosting/docker/">文档</a></p><ul><li>第一步：将<a href="https://github.com/standardnotes/standalone">https://github.com/standardnotes/standalone</a> git仓库的内容clone或者下载下来放到服务器的对应目录</li><li>第二步：进行对应的文件夹，然后执行：<code>./server.sh init</code></li><li>第三步：编辑 .env文件配置自己的数据库以及对应的token，编辑docker文件内的api-gatewat.env文件和auth.env文件，修改对应的token</li><li>第四步：当配置文件修改完成以后，执行<code>./server.sh start</code> 启动服务</li><li>第五步：执行<code>./server.sh logs</code> 查看服务日志，如果出现问题根据对应的提示进行解决</li><li>第六步：给api-gateway服务配置对应的代理，我是使用的nginx，用域名进行代理即可</li></ul><p>以上的所有步骤都可以在<a href="https://docs.standardnotes.org/self-hosting/docker/">官方文档</a>中看到。</p><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>我的docker-compose根据官方的文件修改而来，使用的是自己的数据层，所以没有启动对应的数据库，如下，具体步骤可以参考以上文档。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.5&#x27;</span><br><span class="line">services:</span><br><span class="line">  syncing-server-js:</span><br><span class="line">    image: standardnotes/syncing-server-js:1.35.1</span><br><span class="line">    entrypoint: [</span><br><span class="line">      &quot;./docker/entrypoint.sh&quot;, &quot;start-web&quot;</span><br><span class="line">    ]</span><br><span class="line">    env_file: .env</span><br><span class="line">    environment:</span><br><span class="line">      PORT: 3000</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      - standardnotes_standalone</span><br><span class="line"></span><br><span class="line">  syncing-server-js-worker:</span><br><span class="line">    image: standardnotes/syncing-server-js:1.35.1</span><br><span class="line">    depends_on:</span><br><span class="line">      - syncing-server-js</span><br><span class="line">    entrypoint: [</span><br><span class="line">      &quot;./wait-for.sh&quot;, &quot;syncing-server-js&quot;, &quot;3000&quot;,</span><br><span class="line">       &quot;./docker/entrypoint.sh&quot;, &quot;start-worker&quot;</span><br><span class="line">    ]</span><br><span class="line">    env_file: .env</span><br><span class="line">    environment:</span><br><span class="line">      PORT: 3000</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      - standardnotes_standalone</span><br><span class="line"></span><br><span class="line">  api-gateway:</span><br><span class="line">    image: standardnotes/api-gateway:1.19.0</span><br><span class="line">    depends_on:</span><br><span class="line">      - auth</span><br><span class="line">      - syncing-server-js</span><br><span class="line">    env_file: docker/api-gateway.env</span><br><span class="line">    ports:</span><br><span class="line">      - $&#123;EXPOSED_PORT&#125;:3000</span><br><span class="line">    environment:</span><br><span class="line">      PORT: 3000</span><br><span class="line">      AUTH_JWT_SECRET: &#x27;$&#123;AUTH_JWT_SECRET&#125;&#x27;</span><br><span class="line">    entrypoint: [</span><br><span class="line">      &quot;./wait-for.sh&quot;, &quot;auth&quot;, &quot;3000&quot;,</span><br><span class="line">      &quot;./wait-for.sh&quot;, &quot;syncing-server-js&quot;, &quot;3000&quot;,</span><br><span class="line">      &quot;./docker/entrypoint.sh&quot;, &quot;start-web&quot;</span><br><span class="line">    ]</span><br><span class="line">    networks:</span><br><span class="line">      - standardnotes_standalone</span><br><span class="line"></span><br><span class="line">  auth:</span><br><span class="line">    image: standardnotes/auth:1.11.0</span><br><span class="line">    depends_on:</span><br><span class="line">      - syncing-server-js</span><br><span class="line">    entrypoint: [</span><br><span class="line">      &quot;./wait-for.sh&quot;, &quot;syncing-server-js&quot;, &quot;3000&quot;,</span><br><span class="line">      &quot;./docker/entrypoint.sh&quot;, &quot;start-web&quot;</span><br><span class="line">    ]</span><br><span class="line">    env_file: docker/auth.env</span><br><span class="line">    environment:</span><br><span class="line">      PORT: 3000</span><br><span class="line">      DB_HOST: &#x27;$&#123;DB_HOST&#125;&#x27;</span><br><span class="line">      DB_REPLICA_HOST: &#x27;$&#123;DB_REPLICA_HOST&#125;&#x27;</span><br><span class="line">      DB_PORT: &#x27;$&#123;DB_PORT&#125;&#x27;</span><br><span class="line">      DB_DATABASE: &#x27;$&#123;DB_DATABASE&#125;&#x27;</span><br><span class="line">      DB_USERNAME: &#x27;$&#123;DB_USERNAME&#125;&#x27;</span><br><span class="line">      DB_PASSWORD: &#x27;$&#123;DB_PASSWORD&#125;&#x27;</span><br><span class="line">      DB_DEBUG_LEVEL: &#x27;$&#123;DB_DEBUG_LEVEL&#125;&#x27;</span><br><span class="line">      DB_MIGRATIONS_PATH: &#x27;$&#123;DB_MIGRATIONS_PATH&#125;&#x27;</span><br><span class="line">      REDIS_URL: &#x27;$&#123;REDIS_URL&#125;&#x27;</span><br><span class="line">      AUTH_JWT_SECRET: &#x27;$&#123;AUTH_JWT_SECRET&#125;&#x27;</span><br><span class="line">    networks:</span><br><span class="line">      - standardnotes_standalone</span><br><span class="line"></span><br><span class="line">  auth-worker:</span><br><span class="line">    image: standardnotes/auth:1.11.0</span><br><span class="line">    depends_on:</span><br><span class="line">      - auth</span><br><span class="line">    entrypoint: [</span><br><span class="line">      &quot;./wait-for.sh&quot;, &quot;auth&quot;, &quot;3000&quot;,</span><br><span class="line">      &quot;./docker/entrypoint.sh&quot;, &quot;start-worker&quot;</span><br><span class="line">    ]</span><br><span class="line">    env_file: docker/auth.env</span><br><span class="line">    environment:</span><br><span class="line">      PORT: 3000</span><br><span class="line">      DB_HOST: &#x27;$&#123;DB_HOST&#125;&#x27;</span><br><span class="line">      DB_REPLICA_HOST: &#x27;$&#123;DB_REPLICA_HOST&#125;&#x27;</span><br><span class="line">      DB_PORT: &#x27;$&#123;DB_PORT&#125;&#x27;</span><br><span class="line">      DB_DATABASE: &#x27;$&#123;DB_DATABASE&#125;&#x27;</span><br><span class="line">      DB_USERNAME: &#x27;$&#123;DB_USERNAME&#125;&#x27;</span><br><span class="line">      DB_PASSWORD: &#x27;$&#123;DB_PASSWORD&#125;&#x27;</span><br><span class="line">      DB_DEBUG_LEVEL: &#x27;$&#123;DB_DEBUG_LEVEL&#125;&#x27;</span><br><span class="line">      DB_MIGRATIONS_PATH: &#x27;$&#123;DB_MIGRATIONS_PATH&#125;&#x27;</span><br><span class="line">      REDIS_URL: &#x27;$&#123;REDIS_URL&#125;&#x27;</span><br><span class="line">      AUTH_JWT_SECRET: &#x27;$&#123;AUTH_JWT_SECRET&#125;&#x27;</span><br><span class="line">    networks:</span><br><span class="line">      - standardnotes_standalone</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  standardnotes_standalone:</span><br><span class="line">    name: standardnotes_standalone</span><br></pre></td></tr></table></figure><h3 id="使用Standard-notes"><a href="#使用Standard-notes" class="headerlink" title="使用Standard notes"></a>使用Standard notes</h3><p>当所有的部署步骤完成，并且配置好反向代理之后，就可以正式启用对应的服务了，使用步骤如下：</p><ul><li>打开 <a href="https://app.standardnotes.org/">https://app.standardnotes.org/</a> 链接</li><li>点击Account，然后点击注册，在高级配置里面配置上自己的服务域名</li><li>填上自己的账号，然后就可以开始使用了</li><li>初始情况下的编辑器是默认的官方编辑器，可以引入markdown编辑器，文档如下：<a href="https://yjk.im.sb/sn-markdown/">https://yjk.im.sb/sn-markdown/</a></li></ul><h3 id="使用感受"><a href="#使用感受" class="headerlink" title="使用感受"></a>使用感受</h3><p>感觉使用起来很清爽，数据备份也很容易，备份出来的数据是我想要的样子，这样以后即使这个软件不可用了我还可以迁移到其他的服务中，也遇到了一些问题：</p><ul><li>断网情况下可能同步的不是特别及时，所以如果断网情况下编辑内容话尽量在客户端中进行，它支持各个终端的客户端，我一般是习惯网页型的</li><li>如果不放心它们的官方网页，也可以进行自建，文档如下：<a href="https://github.com/standardnotes/web">https://github.com/standardnotes/web</a><br>还有更多的可以自己定义的地方可以发掘。。。</li></ul><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>我理想中的笔记本是随时拿来可用，我想记录一个东西的时候立刻能让我创建对应的文档并且进行记录，特别是一些零碎的内容，如果文档打开的过慢，或者操作很复杂，甚至能让我的灵感消失，所以我选用了这么一款部署起来比较折腾，但是使用起来却让我很喜欢的note app，<br>备份也是全量的很简单的text格式，如果有更好用的，欢迎给我推荐，如果想要联系我，也可以直接给我发邮件：<a href="mailto:&#115;&#111;&#x6e;&#103;&#x62;&#x6f;&#50;&#x30;&#50;&#x31;&#64;&#x6f;&#117;&#x74;&#x6c;&#111;&#111;&#x6b;&#x2e;&#99;&#111;&#x6d;">&#115;&#111;&#x6e;&#103;&#x62;&#x6f;&#50;&#x30;&#50;&#x31;&#64;&#x6f;&#117;&#x74;&#x6c;&#111;&#111;&#x6b;&#x2e;&#99;&#111;&#x6d;</a>。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;很久很久之前就一直在找一些好用的并且开源的note app，尝试过trilium、蚂蚁笔记、notion、语雀 都没有找到我心仪的那一款，要么是数据是存储在境外，一旦国家的墙更厚了，就尬了，另外一些就是数据很分散，备份出来的数据无法很顺利的导入到其他的app中。&lt;br&gt;直到有一天我发现了Standard notes。&lt;/p&gt;</summary>
    
    
    
    <category term="Docker" scheme="https://blog.bosong.online/categories/Docker/"/>
    
    
    <category term="Docker" scheme="https://blog.bosong.online/tags/Docker/"/>
    
    <category term="Note" scheme="https://blog.bosong.online/tags/Note/"/>
    
  </entry>
  
  <entry>
    <title>如何为网站申请泛域名证书并自动续约</title>
    <link href="https://blog.bosong.online/%E5%A6%82%E4%BD%95%E4%B8%BA%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AE%E6%B3%9B%E5%9F%9F%E5%90%8DSSL%E8%AF%81%E4%B9%A6.html"/>
    <id>https://blog.bosong.online/%E5%A6%82%E4%BD%95%E4%B8%BA%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AE%E6%B3%9B%E5%9F%9F%E5%90%8DSSL%E8%AF%81%E4%B9%A6.html</id>
    <published>2021-06-02T15:33:34.000Z</published>
    <updated>2022-06-02T01:05:59.617Z</updated>
    
    <content type="html"><![CDATA[<p>自己有很多的网站，每次都需要申请SSL证书，所以最近在鼓捣怎么申请泛域名证书减少工作量。</p><span id="more"></span><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>现在随着chrome大力推广网站HTTPS化，推进互联网的数据安全进程，SSL证书的申请渠道有非常的多，个人用户申请免费的SSL证书很方便。</p><p>阿里云、腾讯云都支持20个以内的单域名SSL证书，有效期是一年，但是因为网站比较多，所以首先考虑方案是申请一个免费的泛域名证书，这样在一级的所有网站可以复用一套SSL证书，更新起来也不用那么繁琐。</p><h3 id="申请SSL免费证书的渠道"><a href="#申请SSL免费证书的渠道" class="headerlink" title="申请SSL免费证书的渠道"></a>申请SSL免费证书的渠道</h3><ul><li>使用<a href="https://certbot.eff.org/">certbot</a>申请SSL证书，可申请普通域名和泛域名证书并配置自动续约，有效期90天</li><li>使用<a href="https://github.com/acmesh-official/acme.sh">acme.sh</a>申请SSL证书，可申请普通域名和泛域名证书并配置自动续约，有效期90天</li><li>使用<a href="https://www.aliyun.com/">阿里云</a>申请SSL证书，仅可申请普通单域名证书，过期需要人工再次申请，有效期365天</li><li>使用<a href="https://cloud.tencent.com/">腾讯云</a>申请SSL证书，仅可申请普通单域名证书，过期需要人工再次申请，有效期365天</li><li>…<h3 id="使用acme-sh申请免费的SSL证书并配置自动续期"><a href="#使用acme-sh申请免费的SSL证书并配置自动续期" class="headerlink" title="使用acme.sh申请免费的SSL证书并配置自动续期"></a>使用acme.sh申请免费的SSL证书并配置自动续期</h3></li></ul><h4 id="为什么选择acme-sh"><a href="#为什么选择acme-sh" class="headerlink" title="为什么选择acme.sh?"></a>为什么选择acme.sh?</h4><ul><li>由于certbot的方式需要安装对应的安装包并且需要支持python环境，配置起来较为麻烦，故不选</li><li>由于阿里云、腾讯云证书都是单域名的，故不选</li><li>acme.sh完全基本shell脚本，不需要安装对应依赖，直接下载脚本shell脚本即可安装对应的证书<h4 id="如何使用acme-sh申请证书-macos"><a href="#如何使用acme-sh申请证书-macos" class="headerlink" title="如何使用acme.sh申请证书(macos)"></a>如何使用acme.sh申请证书(macos)</h4></li></ul><ol><li>打开iterm，然后<code>mkidr  .acme.sh</code></li><li>然后<code>git clone [https://github.com/acmesh-official/acme.sh.git](https://github.com/acmesh-official/acme.sh.git)</code>到对应文件夹下即可</li><li>申请SSL证书需要验证域名的所有权，由于我使用的是阿里云的万网域名，所以可以直接使用阿里云的DNS进行验证并且自动完成添加TXT配置完成域名验证，<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">参见文档</a></li><li>配置好ak之后，即可申请SSL证书<code>acme.sh --issue   --dns dns_ali -d &#39;*.bosong.online&#39;</code>等待命令执行完成，完成SSL证书的申请</li><li>证书是在我的mac电脑上申请的，所以可以scp到对应服务器进行替换即可，替换完成重启nginx<h4 id="如何为SSL证书自动续约"><a href="#如何为SSL证书自动续约" class="headerlink" title="如何为SSL证书自动续约"></a>如何为SSL证书自动续约</h4>使用acme.sh的方式申请的SSL证书有效期只有90天，这代表一年最少得人工操作4次证书申请以及发布到对应服务器重启nginx。<br>所以将对应的命令写成了shell命令，使用<code>crontab -e</code>定期执行脚本，进行证书的检查更新以及自动传送及重启nginx，对应脚本如下(仅供参考，可以根据实际情况进行修改)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">acme.sh  --renew --dns dns_ali -d <span class="string">&#x27;*.bosong.online&#x27;</span></span><br><span class="line">scp <span class="comment">#证书的生成路径 ce-155:/data/nginx/conf/cert/</span></span><br><span class="line">ssh ce-155 &amp;&amp; systemctl reload nginx.service &amp;&amp; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3>使用工具自动申请SSL证书简单并且很方便，能节省自己很多证书，泛域名证书用起来也会很酷，文章有些中如果有错误或者不到位的地方，请多多原谅。</li></ol><h3 id="参阅文档"><a href="#参阅文档" class="headerlink" title="参阅文档"></a>参阅文档</h3><ul><li><a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E">acme.sh中文部署指南</a></li><li><a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">acme.shDNS配置指南</a></li><li><a href="https://github.com/acmesh-official/acme.sh/wiki">acme.sh英文部署指南</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;自己有很多的网站，每次都需要申请SSL证书，所以最近在鼓捣怎么申请泛域名证书减少工作量。&lt;/p&gt;</summary>
    
    
    
    <category term="ssl" scheme="https://blog.bosong.online/categories/ssl/"/>
    
    
    <category term="linux" scheme="https://blog.bosong.online/tags/linux/"/>
    
    <category term="ssl" scheme="https://blog.bosong.online/tags/ssl/"/>
    
    <category term="web" scheme="https://blog.bosong.online/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>基于authelia的最佳实践</title>
    <link href="https://blog.bosong.online/%E5%9F%BA%E4%BA%8Eauthelia%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://blog.bosong.online/%E5%9F%BA%E4%BA%8Eauthelia%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html</id>
    <published>2021-05-11T14:01:20.000Z</published>
    <updated>2022-06-02T01:05:59.617Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>作为一名工程师，在这个繁杂的网络世界中，想有自己的一片净土。自己有很多的网站，方便自己工作生活，但是苦于网络安全问题不敢轻易部署在公网中，所以发掘了这块一款SSO工具：<a href="https://github.com/authelia/authelia">authelia</a>，他能很方便的在nginx层给你的网站加上独属于你的防火墙，账号密码，如果网站很多，并且没有自己独立的账号系统，那这款工具可以说非常适合你了。</p><span id="more"></span><h3 id="关于authelia"><a href="#关于authelia" class="headerlink" title="关于authelia"></a>关于authelia</h3><p><strong>Authelia</strong>是一个开源身份验证和授权服务器，可通过Web门户为您的应用程序提供2要素身份验证和单点登录（SSO）。它充当反向代理（如<a href="https://www.nginx.com/">nginx</a>，<a href="https://traefik.io/">Traefik</a>或<a href="https://www.haproxy.org/">HAProxy）</a>的伴侣，以使他们知道查询是否应该通过。未经身份验证的用户将重定向到Authelia登录门户。<br>目前主要可用<strong>功能</strong></p><ul><li><p>几种第二因素方法：</p><ul><li>带有<a href="https://www.yubico.com/products/yubikey-hardware/yubikey4/">Yubikey的</a><a href="https://www.authelia.com/docs/features/2fa/security-key">安全密钥（U2F）</a>。</li><li>使用<a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en">Google Authenticator</a><a href="https://www.authelia.com/docs/features/2fa/one-time-password">的基于时间的一次性密码</a>。</li><li>带有<a href="https://duo.com/">Duo的</a><a href="https://www.authelia.com/docs/features/2fa/push-notifications">移动推送通知</a>。</li></ul></li><li><p>使用电子邮件确认通过身份验证重置密码。</p></li><li><p>仅单因素身份验证方法可用。</p></li><li><p>尝试过多身份验证后的访问限制。</p></li><li><p>每个子域，用户，资源和网络的细粒度访问控制。</p></li><li><p>支持受单一因素保护的端点的基本身份验证。</p></li><li><p>Beta对<a href="https://www.authelia.com/docs/configuration/identity-providers/oidc.html">OpenID Connect的</a>支持。</p></li><li><p>使用远程数据库具有很高的可用性，Redis可作为高可用性KV存储使用。</p></li><li><p>开箱即用与Kubernetes<a href="https://github.com/kubernetes/ingress-nginx">ingress-nginx</a>控制器兼容。</p><h3 id="最佳实践-部署"><a href="#最佳实践-部署" class="headerlink" title="最佳实践-部署"></a>最佳实践-部署</h3><p>使用容器化部署<strong>Authelia是</strong>比较简单快捷的方法，可以直接拉取对应的镜像，编辑自定义配置文件即可完成部署，超简单的哦。</p><h4 id="1、拉取authelia镜像："><a href="#1、拉取authelia镜像：" class="headerlink" title="1、拉取authelia镜像："></a>1、拉取authelia镜像：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull authelia/authelia</span><br></pre></td></tr></table></figure><p>如果存在国内拉取镜像过慢的方法，可以使用以下的命令拉取,是直接使用github actions拉取到国内来的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry.cn-shanghai.aliyuncs.com/bosong/autheli</span><br></pre></td></tr></table></figure><h4 id="2、编写docker-compose文件"><a href="#2、编写docker-compose文件" class="headerlink" title="2、编写docker compose文件"></a>2、编写docker compose文件</h4><p>docker-compose.yaml文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  authelia:</span><br><span class="line">    image: registry.cn-shanghai.aliyuncs.com/bosong/authelia</span><br><span class="line">    container_name: authelia</span><br><span class="line">    volumes:</span><br><span class="line">      - /data-colum/authelia:/config</span><br><span class="line">    healthcheck:</span><br><span class="line">      <span class="built_in">disable</span>: <span class="literal">false</span></span><br><span class="line">    environment:</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">    ports:</span><br><span class="line">      - 9999:9091</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：</p></li><li><p><code>/data-colum/authelia:/config</code> 此处是直接使用docker部署的配置，需要提前将对应配置放入到对应的文件夹中</p><h4 id="3、配置authelia"><a href="#3、配置authelia" class="headerlink" title="3、配置authelia"></a>3、配置authelia</h4><p>具体的文件排列如下，以 文件夹为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├── /data-colum/authelia/</span><br><span class="line">│   ├── configuration.yml  <span class="comment">#配置文件</span></span><br><span class="line">│   └── users_database.yml <span class="comment">#用户数据文件</span></span><br><span class="line">└── docker-compose.yaml</span><br></pre></td></tr></table></figure><p>configuration.yml模板文件如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"><span class="comment">#                   Authelia configuration                    #</span></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"><span class="comment">#基本配置：配置端口、jwt秘钥、默认的跳转地址、totp对应的域名</span></span><br><span class="line">host: 0.0.0.0</span><br><span class="line">port: 9091</span><br><span class="line">log_level: debug</span><br><span class="line"><span class="comment"># This secret can also be set using the env variables AUTHELIA_JWT_SECRET_FILE</span></span><br><span class="line">jwt_secret: adakusdhhadsk</span><br><span class="line">default_redirection_url: https://www.abcd.com</span><br><span class="line">totp:</span><br><span class="line">  issuer: abcd.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># duo_api:</span></span><br><span class="line"><span class="comment">#  hostname: api-123456789.example.com</span></span><br><span class="line"><span class="comment">#  integration_key: ABCDEF</span></span><br><span class="line"><span class="comment">#  # This secret can also be set using the env variables AUTHELIA_DUO_API_SECRET_KEY_FILE</span></span><br><span class="line"><span class="comment">#  secret_key: 1234567890abcdefghifjkl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用户文件配置：目前Authelia只支持ldap和使用文件形式的用户列表</span></span><br><span class="line">authentication_backend:</span><br><span class="line">  file:</span><br><span class="line">    path: /config/users_database.yml</span><br><span class="line"></span><br><span class="line">access_control:</span><br><span class="line">  default_policy: one_factor</span><br><span class="line">  rules:</span><br><span class="line">    <span class="comment"># Rules applied to everyone</span></span><br><span class="line">    - domain: abcd.abcd.com</span><br><span class="line">      policy: one_factor</span><br><span class="line"></span><br><span class="line"><span class="comment">#seesion 配置</span></span><br><span class="line">session:</span><br><span class="line">  name: authelia</span><br><span class="line">  <span class="comment"># This secret can also be set using the env variables AUTHELIA_SESSION_SECRET_FILE</span></span><br><span class="line">  secret: asdasfjjhas</span><br><span class="line">  expiration: 3600  <span class="comment"># 1 hour</span></span><br><span class="line">  inactivity: 300  <span class="comment"># 5 minutes</span></span><br><span class="line">  domain: abcd.com  <span class="comment"># Should match whatever your root protected domain is</span></span><br><span class="line"></span><br><span class="line">  redis:</span><br><span class="line">    host: redis.xxxx.com</span><br><span class="line">    port: 6379</span><br><span class="line">    password: abcdhasd</span><br><span class="line">    database_index: 5</span><br><span class="line">    maximum_active_connections: 100</span><br><span class="line">    minimum_idle_connections: 0</span><br><span class="line"></span><br><span class="line">regulation:</span><br><span class="line">  max_retries: 3</span><br><span class="line">  find_time: 120</span><br><span class="line">  ban_time: 300</span><br><span class="line"><span class="comment">#存储配置</span></span><br><span class="line">storage:</span><br><span class="line">  mysql:</span><br><span class="line">    host: mysql.abcd.com</span><br><span class="line">    port: 3306</span><br><span class="line">    database: authelia</span><br><span class="line">    username: authelia</span><br><span class="line">    <span class="comment">## Password can also be set using a secret: https://www.authelia.com/docs/configuration/secrets.html</span></span><br><span class="line">    password: 123456</span><br><span class="line"><span class="comment">#邮件发件配置，主要用于修改密码等操作</span></span><br><span class="line">notifier:</span><br><span class="line">  smtp:</span><br><span class="line">    username: noreply@abcd.com</span><br><span class="line">    <span class="comment"># This secret can also be set using the env variables AUTHELIA_NOTIFIER_SMTP_PASSWORD_FILE</span></span><br><span class="line">    password: abcdaklfdj</span><br><span class="line">    host: smtp.exmail.qq.com</span><br><span class="line">    port: 465</span><br><span class="line">    sender: noreply@abcd.com</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>用户文件模板文件如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">users</span>:</span><br><span class="line">  authelia:</span><br><span class="line">    password: $argon2id<span class="variable">$v</span>=19<span class="variable">$m</span>=65536,t=1,p=8$RUFuRGFEY291UGdaU0Jxqwqe<span class="variable">$zqTCjJKc2Ka0MDA3OMQ8rX6HAMyLOppFQl1HPmN8mMI</span></span><br><span class="line">    displayname: Authelia</span><br><span class="line">    email: abcd@abcd.com</span><br><span class="line">    <span class="built_in">groups</span>:</span><br><span class="line">    - admins</span><br><span class="line">    - dev</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：</p></li><li><p><code>default_redirection_url</code> 是直接在<strong>auth.abcd.com登录后默认跳转的地址</strong></p></li><li><p>存储数据库可支持 mysql、sqlite等，结合<a href="https://www.authelia.com/docs/">官方文档</a>来看即可</p></li><li><p>邮件发送配置如果使用即配置，不使用不配置。</p></li><li><p>如果需要修改对应的密码，使用<code>docker exec -it 容器名 sh </code> 后执行 <code>authelia hash-password 123456</code> 即可修改密码再进行填充</p></li><li><p>对应的<code>jwt_secret</code>、<code>session.secret</code> 一定记得更换</p><h4 id="4、部署启动authelia"><a href="#4、部署启动authelia" class="headerlink" title="4、部署启动authelia"></a>4、部署启动authelia</h4><p>在3中已经给出了对应的文件层级，直接根据使用docker-compose执行执行对应命令即可启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-comose -f docker-compose.yaml up -d</span><br></pre></td></tr></table></figure><h4 id="5、按照文档编写对应nginx的配置文件，以nginx为例，需要编写三个文件："><a href="#5、按照文档编写对应nginx的配置文件，以nginx为例，需要编写三个文件：" class="headerlink" title="5、按照文档编写对应nginx的配置文件，以nginx为例，需要编写三个文件："></a>5、按照文档编写对应nginx的配置文件，以nginx为例，需要编写三个文件：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── /authelia/</span><br><span class="line">│   ├── authelia.conf authelia文件</span><br><span class="line">|├── auth.conf auth文件</span><br><span class="line">│   └── proxy.conf 代理文件</span><br><span class="line">└── nginx.conf</span><br></pre></td></tr></table></figure><p><strong>authelia.conf</strong>文件内容如下<strong>：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="variable">$upstream_authelia</span> http://127.0.0.1:9999/api/verify;</span><br><span class="line"><span class="comment"># Virtual endpoint created by nginx to forward auth requests.</span></span><br><span class="line">location /authelia &#123;</span><br><span class="line">    internal;</span><br><span class="line">    proxy_pass_request_body off;</span><br><span class="line">    proxy_pass <span class="variable">$upstream_authelia</span>;</span><br><span class="line">    proxy_set_header Content-Length <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Timeout if the real server is dead</span></span><br><span class="line">    proxy_next_upstream error <span class="built_in">timeout</span> invalid_header http_500 http_502 http_503;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># [REQUIRED] Needed by Authelia to check authorizations of the resource.</span></span><br><span class="line">    <span class="comment"># Provide either X-Original-URL and X-Forwarded-Proto or</span></span><br><span class="line">    <span class="comment"># X-Forwarded-Proto, X-Forwarded-Host and X-Forwarded-Uri or both.</span></span><br><span class="line">    <span class="comment"># Those headers will be used by Authelia to deduce the target url of the user.</span></span><br><span class="line">    <span class="comment"># Basic Proxy Config</span></span><br><span class="line">    client_body_buffer_size 128k;</span><br><span class="line">    proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">    proxy_set_header X-Original-URL <span class="variable">$scheme</span>://$http_host<span class="variable">$request_uri</span>;</span><br><span class="line">    proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Method <span class="variable">$request_method</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Uri <span class="variable">$request_uri</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Ssl on;</span><br><span class="line">    proxy_redirect  http://  <span class="variable">$scheme</span>://;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line">    proxy_cache_bypass <span class="variable">$cookie_session</span>;</span><br><span class="line">    proxy_no_cache <span class="variable">$cookie_session</span>;</span><br><span class="line">    proxy_buffers 4 32k;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Advanced Proxy Config</span></span><br><span class="line">    send_timeout 5m;</span><br><span class="line">    proxy_read_timeout 240;</span><br><span class="line">    proxy_send_timeout 240;</span><br><span class="line">    proxy_connect_timeout 240;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>auth.conf</strong>文件内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Basic Authelia Config</span></span><br><span class="line"><span class="comment"># Send a subsequent request to Authelia to verify if the user is authenticated</span></span><br><span class="line"><span class="comment"># and has the right permissions to access the resource.</span></span><br><span class="line">auth_request /authelia;</span><br><span class="line"><span class="comment"># Set the `target_url` variable based on the request. It will be used to build the portal</span></span><br><span class="line"><span class="comment"># URL with the correct redirection parameter.</span></span><br><span class="line">auth_request_set <span class="variable">$target_url</span> <span class="variable">$scheme</span>://$http_host<span class="variable">$request_uri</span>;</span><br><span class="line"><span class="comment"># Set the X-Forwarded-User and X-Forwarded-Groups with the headers</span></span><br><span class="line"><span class="comment"># returned by Authelia for the backends which can consume them.</span></span><br><span class="line"><span class="comment"># This is not safe, as the backend must make sure that they come from the</span></span><br><span class="line"><span class="comment"># proxy. In the future, it&#x27;s gonna be safe to just use OAuth.</span></span><br><span class="line">auth_request_set <span class="variable">$user</span> <span class="variable">$upstream_http_remote_user</span>;</span><br><span class="line">auth_request_set <span class="variable">$groups</span> <span class="variable">$upstream_http_remote_groups</span>;</span><br><span class="line">auth_request_set <span class="variable">$name</span> <span class="variable">$upstream_http_remote_name</span>;</span><br><span class="line">auth_request_set <span class="variable">$email</span> <span class="variable">$upstream_http_remote_email</span>;</span><br><span class="line">proxy_set_header Remote-User <span class="variable">$user</span>;</span><br><span class="line">proxy_set_header Remote-Groups <span class="variable">$groups</span>;</span><br><span class="line">proxy_set_header Remote-Name <span class="variable">$name</span>;</span><br><span class="line">proxy_set_header Remote-Email <span class="variable">$email</span>;</span><br><span class="line"><span class="comment"># If Authelia returns 401, then nginx redirects the user to the login portal.</span></span><br><span class="line"><span class="comment"># If it returns 200, then the request pass through to the backend.</span></span><br><span class="line"><span class="comment"># For other type of errors, nginx will handle them as usual.</span></span><br><span class="line">error_page 401 =302 https://auth.alidaodao.com/?rd=<span class="variable">$target_url</span>;</span><br></pre></td></tr></table></figure><p>**proxy.conf **文件内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">client_body_buffer_size 128k;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Timeout if the real server is dead</span></span><br><span class="line">proxy_next_upstream error <span class="built_in">timeout</span> invalid_header http_500 http_502 http_503;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Advanced Proxy Config</span></span><br><span class="line">send_timeout 5m;</span><br><span class="line">proxy_read_timeout 360;</span><br><span class="line">proxy_send_timeout 360;</span><br><span class="line">proxy_connect_timeout 360;</span><br><span class="line"><span class="comment"># Basic Proxy Config</span></span><br><span class="line">proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">proxy_set_header X-Forwarded-Uri <span class="variable">$request_uri</span>;</span><br><span class="line">proxy_set_header X-Forwarded-Ssl on;</span><br><span class="line">proxy_redirect  http://  <span class="variable">$scheme</span>://;</span><br><span class="line"><span class="comment">#proxy_http_version 1.1;</span></span><br><span class="line">proxy_set_header Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line">proxy_cache_bypass <span class="variable">$cookie_session</span>;</span><br><span class="line">proxy_no_cache <span class="variable">$cookie_session</span>;</span><br><span class="line">proxy_buffers 64 256k;</span><br><span class="line"></span><br><span class="line"><span class="comment"># If behind reverse proxy, forwards the correct IP</span></span><br><span class="line"><span class="comment">#set_real_ip_from 10.0.0.0/8;</span></span><br><span class="line"><span class="comment">#set_real_ip_from 172.16.0.0/12;</span></span><br><span class="line"><span class="comment">#set_real_ip_from 192.168.0.0/16;</span></span><br><span class="line"><span class="comment">#set_real_ip_from fc00::/7;</span></span><br><span class="line"><span class="comment">#real_ip_header X-Forwarded-For;</span></span><br><span class="line"><span class="comment">#real_ip_recursive on;</span></span><br></pre></td></tr></table></figure><p><strong>注意：</strong></p></li><li><p><strong>auth.conf</strong>、<strong>proxy.conf</strong> 文件不需要进行改动，直接保存放入文件夹中即可</p></li><li><p><strong>authelia.conf</strong> <strong>upstream_authelia</strong> 如果authelia使用的是远程的服务，则修改为对应远程地址即可，其他的不用改动</p><h4 id="6、使用nginx配置auth-abcd-com-域名"><a href="#6、使用nginx配置auth-abcd-com-域名" class="headerlink" title="6、使用nginx配置auth.abcd.com 域名"></a>6、使用nginx配置auth.abcd.com 域名</h4><p>文件配置阶段结束了，可以进行实际的应用，除了配置auth的服务域名之外，另外配置一个demo域名来验证auth的sso服务是否可用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">upstream authelia &#123;</span><br><span class="line">  server localhost:9999;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name auth.abcd.com;</span><br><span class="line">        <span class="built_in">return</span> 301 https://$server_name<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 443 ssl;</span><br><span class="line">        server_name auth.abcd.com;</span><br><span class="line">        charset utf-8;</span><br><span class="line">        ssl_certificate   cert/authelia.pem;</span><br><span class="line">        ssl_certificate_key  cert/authelia.key;</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        access_log  logs/authelia_access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://authelia;</span><br><span class="line">        include /data/nginx/authelia/proxy.conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用以上配置来使auth域名对应的服务生效，可以访问<strong>auth.abcd.com</strong>来验证服务是否正常对外提供服务。</p><h4 id="7、配置demo-abcd-com域名"><a href="#7、配置demo-abcd-com域名" class="headerlink" title="7、配置demo.abcd.com域名"></a>7、配置demo.abcd.com域名</h4><p>给<strong>demo.abcd.com</strong>域名配置上SSO服务，在访问<strong>demo.abcd.com</strong>时，如果未进行登录则会跳转到<strong>auth.abcd.com</strong>进行登录，登录成功后会重定向回<strong>demo.abcd.com</strong>，配置文件如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">upstream demo &#123;</span><br><span class="line">  server localhost:8880;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name demo.abcd.com;</span><br><span class="line">        <span class="built_in">return</span> 301 https://$server_name<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 443 ssl;</span><br><span class="line">        server_name demo.abcd.com;</span><br><span class="line">        charset utf-8;</span><br><span class="line">        <span class="comment">#ssl on;</span></span><br><span class="line">        ssl_certificate   cert/demo.pem;</span><br><span class="line">        ssl_certificate_key  cert/demo.key;</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        access_log  logs/demo_access.log  main;</span><br><span class="line">        <span class="comment">#将authelia.conf配置在此处</span></span><br><span class="line">        include /data/nginx/authelia/authelia.conf;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://demo;</span><br><span class="line">        <span class="comment">#配置auth和代理</span></span><br><span class="line">        include /data/nginx/authelia/auth.conf;</span><br><span class="line">        include /data/nginx/authelia/proxy.conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用以上配置即可成功让<strong>demo.abcd.com</strong>网站接入sso服务，来保障<strong>demo.abcd.com</strong>对应的服务不被匿名访问到</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>没有十全十美的工具，只看怎么使用，在使用<a href="https://github.com/authelia/authelia">authelia</a>的过程中也发现了很多的不足：</p></li><li><p>非ldap模式下配置用户比较麻烦，修改完文件后还需要进行重启</p></li><li><p>如果出现如下警告: <strong>nginx: [warn] could not build optimal proxy_headers_hash, you should increase either proxy_headers_hash_max_size: 512 or proxy_headers_hash_bucket_size: 64; ignoring proxy_headers_hash_bucket_size 在nginx.conf 配置文件中加上 以下配置即可。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy_headers_hash_max_size 51200;</span><br><span class="line">proxy_headers_hash_bucket_size 6400;</span><br></pre></td></tr></table></figure></li><li><p>这篇文章是自己根据实际经验编写的，如果有错漏之处可以参考<a href="https://www.authelia.com/docs/">官方文档</a></p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;作为一名工程师，在这个繁杂的网络世界中，想有自己的一片净土。自己有很多的网站，方便自己工作生活，但是苦于网络安全问题不敢轻易部署在公网中，所以发掘了这块一款SSO工具：&lt;a href=&quot;https://github.com/authelia/authelia&quot;&gt;authelia&lt;/a&gt;，他能很方便的在nginx层给你的网站加上独属于你的防火墙，账号密码，如果网站很多，并且没有自己独立的账号系统，那这款工具可以说非常适合你了。&lt;/p&gt;</summary>
    
    
    
    <category term="SSO" scheme="https://blog.bosong.online/categories/SSO/"/>
    
    
    <category term="LINUX" scheme="https://blog.bosong.online/tags/LINUX/"/>
    
    <category term="SSO" scheme="https://blog.bosong.online/tags/SSO/"/>
    
  </entry>
  
</feed>
