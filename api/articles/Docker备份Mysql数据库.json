{"title":"Docker备份Mysql数据库","slug":"Docker备份Mysql数据库","date":"2018-10-14T10:00:12.000Z","updated":"2022-06-02T01:05:59.612Z","comments":true,"path":"api/articles/Docker备份Mysql数据库.json","excerpt":"1.备份数据库脚本vi dump.sh","covers":null,"content":"<h3 id=\"1-备份数据库脚本\"><a href=\"#1-备份数据库脚本\" class=\"headerlink\" title=\"1.备份数据库脚本\"></a>1.备份数据库脚本</h3><p><code>vi dump.sh</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql=`docker ps|grep mysql | awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class=\"line\"></span><br><span class=\"line\">backDate=`date +%F_%H-%M-%S`</span><br><span class=\"line\">if [ ! -e &quot;/data/backup/$backDate&quot; ]; then</span><br><span class=\"line\">                mkdir -p /data/backup/$backDate</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo $mysql</span><br><span class=\"line\">dataBases=&quot;teaching&quot;;  //备份数据库名称</span><br><span class=\"line\">for dataname in $&#123;dataBases&#125;</span><br><span class=\"line\">do</span><br><span class=\"line\">    docker exec -i $mysql mysqldump -h localhost  --opt -u root --password=mypassword --default-character-set=utf8 --hex-blob $dataname &gt; /data/backup/$backDate/$dataname-$backDate.sql</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-linux设置定时任务\"><a href=\"#2-linux设置定时任务\" class=\"headerlink\" title=\"2.linux设置定时任务\"></a>2.linux设置定时任务</h3><p><code>crontab -e</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 2 * * * sh -x /root/mysql/dump.sh &gt; /data/backup/back_mysql.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<p><code>30 2</code> 代表凌晨2点30分执行脚本</p>\n<p><code>* * * sh -x /root/mysql/dump.sh &gt;</code>   执行路径下dump.sh脚本</p>\n<p><code>/data/backup/back_mysql.log 2&gt;&amp;1</code> 记录备份日志</p>\n<hr>\n<p>备份mysql数据库完成</p>\n\n","more":"\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql=`docker ps|grep mysql | awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class=\"line\"></span><br><span class=\"line\">backDate=`date +%F_%H-%M-%S`</span><br><span class=\"line\">if [ ! -e &quot;/data/backup/$backDate&quot; ]; then</span><br><span class=\"line\">                mkdir -p /data/backup/$backDate</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo $mysql</span><br><span class=\"line\">dataBases=&quot;teaching&quot;;  //备份数据库名称</span><br><span class=\"line\">for dataname in $&#123;dataBases&#125;</span><br><span class=\"line\">do</span><br><span class=\"line\">    docker exec -i $mysql mysqldump -h localhost  --opt -u root --password=mypassword --default-character-set=utf8 --hex-blob $dataname &gt; /data/backup/$backDate/$dataname-$backDate.sql</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-linux设置定时任务\"><a href=\"#2-linux设置定时任务\" class=\"headerlink\" title=\"2.linux设置定时任务\"></a>2.linux设置定时任务</h3><p><code>crontab -e</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 2 * * * sh -x /root/mysql/dump.sh &gt; /data/backup/back_mysql.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<p><code>30 2</code> 代表凌晨2点30分执行脚本</p>\n<p><code>* * * sh -x /root/mysql/dump.sh &gt;</code>   执行路径下dump.sh脚本</p>\n<p><code>/data/backup/back_mysql.log 2&gt;&amp;1</code> 记录备份日志</p>\n<hr>\n<p>备份mysql数据库完成</p>\n\n","categories":[{"name":"Docker","path":"api/categories/Docker.json"}],"tags":[{"name":"Docker","path":"api/tags/Docker.json"}]}