{"title":"mysql中间件-Mycat","slug":"Mysql中间件-Mycat","date":"2018-10-14T09:04:21.000Z","updated":"2022-06-02T01:05:59.614Z","comments":true,"path":"api/articles/Mysql中间件-Mycat.json","excerpt":"前言因业务需要，给mysql做了主备，然后准备使用数据库中间件来进行读写分离和分片。","covers":null,"content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>因业务需要，给mysql做了主备，然后准备使用数据库中间件来进行读写分离和分片。</p>\n<h3 id=\"学习过程\"><a href=\"#学习过程\" class=\"headerlink\" title=\"学习过程\"></a>学习过程</h3><p>学习过程中使用了三台服务器，一主两备，此处只用一主一备参与中间件的试用。</p>\n<p>集群组成如下：</p>\n<p>角色             主机名                      主机IP</p>\n<p>master         liunian1          192.168.1.1</p>\n<p>slave           liunian2           192.168.1.2</p>\n<p>slave           liunian3           192.168.1.3</p>\n<p>先配置mycat配置文件schema.xml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class=\"line\">&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</span><br><span class=\"line\">        &lt;!-- 逻辑库 --&gt;</span><br><span class=\"line\">\t&lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot; dataNode=&quot;dn1&quot;/&gt;</span><br><span class=\"line\">\t&lt;!-- 物理节点--&gt;</span><br><span class=\"line\">\t&lt;dataNode name=&quot;dn1&quot; dataHost=&quot;dh1&quot; database=&quot;tale&quot; /&gt;</span><br><span class=\"line\">\t&lt;!-- 物理读写分离--&gt;</span><br><span class=\"line\">\t&lt;dataHost name=&quot;dh1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;2&quot;</span><br><span class=\"line\">\t\t\t  writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</span><br><span class=\"line\">\t\t&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class=\"line\">\t\t&lt;!-- 设置 --&gt;</span><br><span class=\"line\">\t\t&lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.1.1:3306&quot; user=&quot;root&quot; password=&quot;password&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.1.2:3306&quot; user=&quot;root&quot; password=&quot;password&quot; /&gt;\t\t</span><br><span class=\"line\">\t\t&lt;/writeHost&gt;</span><br><span class=\"line\">\t&lt;/dataHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/mycat:schema&gt;</span><br></pre></td></tr></table></figure>\n<p>以下是一些重要参数</p>\n<p>balance指的负载均衡类型，目前的取值有4种：</p>\n<ol>\n<li><p>balance&#x3D;”0”, 不开启读写分离机制，所有读操作都发送到当前可用的writeHost上。</p>\n</li>\n<li><p>balance&#x3D;”1”，全部的readHost与stand by writeHost参与select语句的负载均衡，简单的说，当双主双从模式(M1-&gt;S1，M2-&gt;S2，并且M1与 M2互为主备)，正常情况下，M2,S1,S2都参与select语句的负载均衡。</p>\n</li>\n<li><p>balance&#x3D;”2”，所有读操作都随机的在writeHost、readhost上分发。</p>\n</li>\n<li><p>balance&#x3D;”3”，所有读请求随机的分发到wiriterHost对应的readhost执行，writerHost不负担读压力</p>\n</li>\n</ol>\n<p>switchType指的是切换的模式，目前的取值也有4种：</p>\n<ol>\n<li><p>switchType&#x3D;’-1’ 表示不自动切换</p>\n</li>\n<li><p>switchType&#x3D;’1’ 默认值，表示自动切换</p>\n</li>\n<li><p>switchType&#x3D;’2’ 基于MySQL主从同步的状态决定是否切换,心跳语句为 show slave status</p>\n</li>\n<li><p>switchType&#x3D;’3’基于MySQL galary cluster的切换机制（适合集群）（1.4.1），心跳语句为 show status like ‘wsrep%’。</p>\n</li>\n</ol>\n<p>writeType表示写模式</p>\n<ol>\n<li><p>writeType&#x3D;”0”，所有的操作发送到配置的第一个writehost</p>\n</li>\n<li><p>writeType&#x3D;”1”，随机发送到配置的所有writehost</p>\n</li>\n<li><p>writeType&#x3D;”2”，不执行写操作</p>\n</li>\n</ol>\n<p>rule规则需要读者自己去详细发掘，server.xml主要配置用户逻辑库以及用户账户，端口等系统配置，可酌情进行配置。</p>\n<p>mycat的使用过程比较坎坷，Navicat连接上之后无法直接读库，需要进行sql语句查询，此问题目前未解决。</p>\n\n","more":"\n<h3 id=\"学习过程\"><a href=\"#学习过程\" class=\"headerlink\" title=\"学习过程\"></a>学习过程</h3><p>学习过程中使用了三台服务器，一主两备，此处只用一主一备参与中间件的试用。</p>\n<p>集群组成如下：</p>\n<p>角色             主机名                      主机IP</p>\n<p>master         liunian1          192.168.1.1</p>\n<p>slave           liunian2           192.168.1.2</p>\n<p>slave           liunian3           192.168.1.3</p>\n<p>先配置mycat配置文件schema.xml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class=\"line\">&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</span><br><span class=\"line\">        &lt;!-- 逻辑库 --&gt;</span><br><span class=\"line\">\t&lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot; dataNode=&quot;dn1&quot;/&gt;</span><br><span class=\"line\">\t&lt;!-- 物理节点--&gt;</span><br><span class=\"line\">\t&lt;dataNode name=&quot;dn1&quot; dataHost=&quot;dh1&quot; database=&quot;tale&quot; /&gt;</span><br><span class=\"line\">\t&lt;!-- 物理读写分离--&gt;</span><br><span class=\"line\">\t&lt;dataHost name=&quot;dh1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;2&quot;</span><br><span class=\"line\">\t\t\t  writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</span><br><span class=\"line\">\t\t&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class=\"line\">\t\t&lt;!-- 设置 --&gt;</span><br><span class=\"line\">\t\t&lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.1.1:3306&quot; user=&quot;root&quot; password=&quot;password&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.1.2:3306&quot; user=&quot;root&quot; password=&quot;password&quot; /&gt;\t\t</span><br><span class=\"line\">\t\t&lt;/writeHost&gt;</span><br><span class=\"line\">\t&lt;/dataHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/mycat:schema&gt;</span><br></pre></td></tr></table></figure>\n<p>以下是一些重要参数</p>\n<p>balance指的负载均衡类型，目前的取值有4种：</p>\n<ol>\n<li><p>balance&#x3D;”0”, 不开启读写分离机制，所有读操作都发送到当前可用的writeHost上。</p>\n</li>\n<li><p>balance&#x3D;”1”，全部的readHost与stand by writeHost参与select语句的负载均衡，简单的说，当双主双从模式(M1-&gt;S1，M2-&gt;S2，并且M1与 M2互为主备)，正常情况下，M2,S1,S2都参与select语句的负载均衡。</p>\n</li>\n<li><p>balance&#x3D;”2”，所有读操作都随机的在writeHost、readhost上分发。</p>\n</li>\n<li><p>balance&#x3D;”3”，所有读请求随机的分发到wiriterHost对应的readhost执行，writerHost不负担读压力</p>\n</li>\n</ol>\n<p>switchType指的是切换的模式，目前的取值也有4种：</p>\n<ol>\n<li><p>switchType&#x3D;’-1’ 表示不自动切换</p>\n</li>\n<li><p>switchType&#x3D;’1’ 默认值，表示自动切换</p>\n</li>\n<li><p>switchType&#x3D;’2’ 基于MySQL主从同步的状态决定是否切换,心跳语句为 show slave status</p>\n</li>\n<li><p>switchType&#x3D;’3’基于MySQL galary cluster的切换机制（适合集群）（1.4.1），心跳语句为 show status like ‘wsrep%’。</p>\n</li>\n</ol>\n<p>writeType表示写模式</p>\n<ol>\n<li><p>writeType&#x3D;”0”，所有的操作发送到配置的第一个writehost</p>\n</li>\n<li><p>writeType&#x3D;”1”，随机发送到配置的所有writehost</p>\n</li>\n<li><p>writeType&#x3D;”2”，不执行写操作</p>\n</li>\n</ol>\n<p>rule规则需要读者自己去详细发掘，server.xml主要配置用户逻辑库以及用户账户，端口等系统配置，可酌情进行配置。</p>\n<p>mycat的使用过程比较坎坷，Navicat连接上之后无法直接读库，需要进行sql语句查询，此问题目前未解决。</p>\n\n","categories":[{"name":"中间件","path":"api/categories/中间件.json"}],"tags":[{"name":"数据库中间件","path":"api/tags/数据库中间件.json"}]}