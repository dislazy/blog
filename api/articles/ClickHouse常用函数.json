{"title":"ClickHouse常用函数","slug":"ClickHouse常用函数","date":"2021-03-18T12:47:45.000Z","updated":"2022-06-02T01:05:59.611Z","comments":true,"path":"api/articles/ClickHouse常用函数.json","excerpt":"前言近期项目引入了Clickhouse进行数据计算与展示，今天突然我们的PM同学来问我一个问题，怎么快速获取这十个品牌中GMV各自排名前三的SPU数据。当时想了想，一般情况下这种需求都是使用代码实现的，简直So easy，但是一旦写代码的话就没法快速获取并且以后类似的需求也没法快速响应了。然后想到了咱们使用的是Clickhouse数据库，它自带很多函数，在经过一段时间的查询以后，发现有一个函数还是比较好用的，正好解决这种典型的分组取TOP的问题，这个函数就是groupArray(x)，可以查看以下sql，看它是怎么使用的：1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>select * from  <br>(select b.bid,b.brand as brand, c[1] as top1,c[2] as top2,c[3] as top3,groupArray(3)(b.spu_name) as c,groupArray(10)(b.gmv) as d,d[1]+d[2]+d[3]+d[4]+d[5]+d[6]+d[7]+d[8]+d[9]+d[10] as gmvsum  <br>from (  <br>      select spu_id,spu_name,gmv,us,brand,bid  <br>  from spu  <br>      where platform_id = 2  <br>  and c2_id = 3305  <br>  and bid in (1234, 5678, 1903, 41313, 3145, 555, 111, 444, 222, 444)  <br>        and multiSearchAny(spu_name, [&#x27;精酿啤酒&#x27;,&#x27;啤酒精酿&#x27;])  <br>        and not multiSearchAny(spu_name, [&#x27;饮料&#x27;])  <br>        and effective_date between &#x27;2020-09-30&#x27; and &#x27;2021-02-28&#x27;  <br>  order by gmv desc)  <br>    b group by b.bid,b.brand order by bid) c order by c.gmvsum desc;<br>Clickhouse的简单介绍ClickHouse是一个用于联机分析(OLAP)的列式数据库管理系统(DBMS)；Mysql等数据库是将数据以行的形式来进行存储，它是标准的行式数据库，但是在列式数据库中数据以列的形式来进行存储;<br>以列的形式来存储数据，它还是有不少优点的，主要是：绝大多数是读请求数据以相当大的批次(&gt; 1000行)更新，而不是单行更新;或者根本没有更新。已添加到数据库的数据不能修改。对于读取，从数据库中提取相当多的行，但只提取列的一小部分。宽表，即每个表包含着大量的列查询相对较少(通常每台服务器每秒查询数百次或更少)对于简单查询，允许延迟大约50毫秒列中的数据相对较小：数字和短字符串(例如，每个URL 60个字节)处理单个查询时需要高吞吐量(每台服务器每秒可达数十亿行)事务不是必须的对数据一致性要求低每个查询有一个大表。除了他以外，其他的都很小。查询结果明显小于源数据。换句话说，数据经过过滤或聚合，因此结果适合于单个服务器的RAM中可以根据官方文档来看一下OLAP的列式数据库查询为什么比行式数据库查询效率要高：<br>行式数据库 [Figure] 当然还有一些其他方面的优势，可以参考官方的文档。","covers":["https://imagecdn.bosong.online/blog/row-oriented.gif","https://imagecdn.bosong.online/blog/column-oriented.gif"],"content":"<div class=\"story post-story\"><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>近期项目引入了Clickhouse进行数据计算与展示，今天突然我们的PM同学来问我一个问题，怎么快速获取这十个品牌中GMV各自排名前三的SPU数据。当时想了想，一般情况下这种需求都是使用代码实现的，简直So easy，但是一旦写代码的话就没法快速获取并且以后类似的需求也没法快速响应了。</p>\n<p>然后想到了咱们使用的是Clickhouse数据库，它自带很多函数，在经过一段时间的查询以后，发现有一个函数还是比较好用的，正好解决这种典型的<em>分组取TOP</em>的问题，这个函数就是<code>groupArray(x)</code>，可以查看以下sql，看它是怎么使用的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from  </span><br><span class=\"line\">(select b.bid,b.brand as brand, c[1] as top1,c[2] as top2,c[3] as top3,groupArray(3)(b.spu_name) as c,groupArray(10)(b.gmv) as d,d[1]+d[2]+d[3]+d[4]+d[5]+d[6]+d[7]+d[8]+d[9]+d[10] as gmvsum  </span><br><span class=\"line\">from (  </span><br><span class=\"line\">      select spu_id,spu_name,gmv,us,brand,bid  </span><br><span class=\"line\">  from spu  </span><br><span class=\"line\">      where platform_id = 2  </span><br><span class=\"line\">  and c2_id = 3305  </span><br><span class=\"line\">  and bid in (1234, 5678, 1903, 41313, 3145, 555, 111, 444, 222, 444)  </span><br><span class=\"line\">        and multiSearchAny(spu_name, [&#x27;精酿啤酒&#x27;,&#x27;啤酒精酿&#x27;])  </span><br><span class=\"line\">        and not multiSearchAny(spu_name, [&#x27;饮料&#x27;])  </span><br><span class=\"line\">        and effective_date between &#x27;2020-09-30&#x27; and &#x27;2021-02-28&#x27;  </span><br><span class=\"line\">  order by gmv desc)  </span><br><span class=\"line\">    b group by b.bid,b.brand order by bid) c order by c.gmvsum desc;</span><br></pre></td></tr></table></figure>\n\n</div><div class=\"story post-story\"><h2 id=\"Clickhouse的简单介绍\"><a href=\"#Clickhouse的简单介绍\" class=\"headerlink\" title=\"Clickhouse的简单介绍\"></a>Clickhouse的简单介绍</h2><p>ClickHouse是一个用于<em>联机分析(OLAP)<em>的</em>列式</em>数据库管理系统(DBMS)；</p>\n<p>Mysql等数据库是将数据以<em>行的形式</em>来进行存储，它是标准的行式数据库，但是在列式数据库中数据以<em>列的形式</em>来进行存储;<br>以列的形式来存储数据，它还是有不少优点的，主要是：</p>\n<ul>\n<li>绝大多数是读请求</li>\n<li>数据以相当大的批次(&gt; 1000行)更新，而不是单行更新;或者根本没有更新。</li>\n<li>已添加到数据库的数据不能修改。</li>\n<li>对于读取，从数据库中提取相当多的行，但只提取列的一小部分。</li>\n<li>宽表，即每个表包含着大量的列</li>\n<li>查询相对较少(通常每台服务器每秒查询数百次或更少)</li>\n<li>对于简单查询，允许延迟大约50毫秒</li>\n<li>列中的数据相对较小：数字和短字符串(例如，每个URL 60个字节)</li>\n<li>处理单个查询时需要高吞吐量(每台服务器每秒可达数十亿行)</li>\n<li>事务不是必须的</li>\n<li>对数据一致性要求低</li>\n<li>每个查询有一个大表。除了他以外，其他的都很小。</li>\n<li>查询结果明显小于源数据。换句话说，数据经过过滤或聚合，因此结果适合于单个服务器的RAM中</li>\n</ul>\n<p>可以根据官方文档来看一下OLAP的列式数据库查询为什么比行式数据库查询效率要高：<br>行式数据库</p>\n<p><img src=\"https://imagecdn.bosong.online/blog/row-oriented.gif\" class=\"lazyload\" data-srcset=\"https://imagecdn.bosong.online/blog/row-oriented.gif\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"行式数据库\"></p>\n<p>列式数据库</p>\n<p><img src=\"https://imagecdn.bosong.online/blog/column-oriented.gif\" class=\"lazyload\" data-srcset=\"https://imagecdn.bosong.online/blog/column-oriented.gif\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"列式数据库\"></p>\n<p>一般情况下，在数据计算时只需要抽取其中一部分列，所以使用列式数据库相比较来说会快速的查找到需要的列，相比行式数据库来说减少了大量的IO。<br>当然还有一些其他方面的优势，可以参考<a href=\"https://clickhouse.tech/docs/zh/\">官方的文档</a>。</p>\n</div><div class=\"story post-story\"><h2 id=\"Clickhouse函数指南\"><a href=\"#Clickhouse函数指南\" class=\"headerlink\" title=\"Clickhouse函数指南\"></a>Clickhouse函数指南</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br><span class=\"line\">852</span><br><span class=\"line\">853</span><br><span class=\"line\">854</span><br><span class=\"line\">855</span><br><span class=\"line\">856</span><br><span class=\"line\">857</span><br><span class=\"line\">858</span><br><span class=\"line\">859</span><br><span class=\"line\">860</span><br><span class=\"line\">861</span><br><span class=\"line\">862</span><br><span class=\"line\">863</span><br><span class=\"line\">864</span><br><span class=\"line\">865</span><br><span class=\"line\">866</span><br><span class=\"line\">867</span><br><span class=\"line\">868</span><br><span class=\"line\">869</span><br><span class=\"line\">870</span><br><span class=\"line\">871</span><br><span class=\"line\">872</span><br><span class=\"line\">873</span><br><span class=\"line\">874</span><br><span class=\"line\">875</span><br><span class=\"line\">876</span><br><span class=\"line\">877</span><br><span class=\"line\">878</span><br><span class=\"line\">879</span><br><span class=\"line\">880</span><br><span class=\"line\">881</span><br><span class=\"line\">882</span><br><span class=\"line\">883</span><br><span class=\"line\">884</span><br><span class=\"line\">885</span><br><span class=\"line\">886</span><br><span class=\"line\">887</span><br><span class=\"line\">888</span><br><span class=\"line\">889</span><br><span class=\"line\">890</span><br><span class=\"line\">891</span><br><span class=\"line\">892</span><br><span class=\"line\">893</span><br><span class=\"line\">894</span><br><span class=\"line\">895</span><br><span class=\"line\">896</span><br><span class=\"line\">897</span><br><span class=\"line\">898</span><br><span class=\"line\">899</span><br><span class=\"line\">900</span><br><span class=\"line\">901</span><br><span class=\"line\">902</span><br><span class=\"line\">903</span><br><span class=\"line\">904</span><br><span class=\"line\">905</span><br><span class=\"line\">906</span><br><span class=\"line\">907</span><br><span class=\"line\">908</span><br><span class=\"line\">909</span><br><span class=\"line\">910</span><br><span class=\"line\">911</span><br><span class=\"line\">912</span><br><span class=\"line\">913</span><br><span class=\"line\">914</span><br><span class=\"line\">915</span><br><span class=\"line\">916</span><br><span class=\"line\">917</span><br><span class=\"line\">918</span><br><span class=\"line\">919</span><br><span class=\"line\">920</span><br><span class=\"line\">921</span><br><span class=\"line\">922</span><br><span class=\"line\">923</span><br><span class=\"line\">924</span><br><span class=\"line\">925</span><br><span class=\"line\">926</span><br><span class=\"line\">927</span><br><span class=\"line\">928</span><br><span class=\"line\">929</span><br><span class=\"line\">930</span><br><span class=\"line\">931</span><br><span class=\"line\">932</span><br><span class=\"line\">933</span><br><span class=\"line\">934</span><br><span class=\"line\">935</span><br><span class=\"line\">936</span><br><span class=\"line\">937</span><br><span class=\"line\">938</span><br><span class=\"line\">939</span><br><span class=\"line\">940</span><br><span class=\"line\">941</span><br><span class=\"line\">942</span><br><span class=\"line\">943</span><br><span class=\"line\">944</span><br><span class=\"line\">945</span><br><span class=\"line\">946</span><br><span class=\"line\">947</span><br><span class=\"line\">948</span><br><span class=\"line\">949</span><br><span class=\"line\">950</span><br><span class=\"line\">951</span><br><span class=\"line\">952</span><br><span class=\"line\">953</span><br><span class=\"line\">954</span><br><span class=\"line\">955</span><br><span class=\"line\">956</span><br><span class=\"line\">957</span><br><span class=\"line\">958</span><br><span class=\"line\">959</span><br><span class=\"line\">960</span><br><span class=\"line\">961</span><br><span class=\"line\">962</span><br><span class=\"line\">963</span><br><span class=\"line\">964</span><br><span class=\"line\">965</span><br><span class=\"line\">966</span><br><span class=\"line\">967</span><br><span class=\"line\">968</span><br><span class=\"line\">969</span><br><span class=\"line\">970</span><br><span class=\"line\">971</span><br><span class=\"line\">972</span><br><span class=\"line\">973</span><br><span class=\"line\">974</span><br><span class=\"line\">975</span><br><span class=\"line\">976</span><br><span class=\"line\">977</span><br><span class=\"line\">978</span><br><span class=\"line\">979</span><br><span class=\"line\">980</span><br><span class=\"line\">981</span><br><span class=\"line\">982</span><br><span class=\"line\">983</span><br><span class=\"line\">984</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-- 零、检测函数类型（clickhouse中数据的类型）</span><br><span class=\"line\">SELECT toTypeName(0);-- UInt8(三位数为8)</span><br><span class=\"line\">SELECT toTypeName(-0);-- Int8</span><br><span class=\"line\">SELECT toTypeName(-343);-- Int16</span><br><span class=\"line\">SELECT toTypeName(12.43); -- Float64(默认浮点型的数据为64)，所以一般在处理浮点型的数据的时候尽量转成toFloat32(12.43)</span><br><span class=\"line\">SELECT toTypeName(12.34343); -- Float64</span><br><span class=\"line\">SELECT toTypeName(toDateTime(1502396027)); -- DateTime</span><br><span class=\"line\">-- 一、算数函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 算数函数(数学上的计算)</span><br><span class=\"line\">--求和</span><br><span class=\"line\">SELECT plus(12, 21), plus(10, -10), plus(-10, -10);</span><br><span class=\"line\">--差值</span><br><span class=\"line\">SELECT minus(10, 5), minus(10, -10),minus(-10, -10);</span><br><span class=\"line\">--积</span><br><span class=\"line\">SELECT multiply(12, 2), multiply(12, -2), multiply(-12, -2);</span><br><span class=\"line\">--平均值</span><br><span class=\"line\">SELECT divide(12, 4), divide(10, 3), divide(2, 4), divide(-4, -2), divide(-4, 2), divide(-4.5, 3);</span><br><span class=\"line\">SELECT intDiv(10, 3), divide(10, 3); -- 3, 3.333(保留四位有效数字)</span><br><span class=\"line\">SELECT divide(10, 0), divide(-10, 0); -- 出现无穷大字符“ ∞ ”或“ -∞ ”</span><br><span class=\"line\">SELECT divide(0, 0); -- 特殊字符（类似乱码）</span><br><span class=\"line\">SELECT intDivOrZero(10, 0); -- 0</span><br><span class=\"line\">--求余数</span><br><span class=\"line\">SELECT modulo(10, 3); --1</span><br><span class=\"line\">SELECT modulo(10.5, 3); --1</span><br><span class=\"line\">--取反</span><br><span class=\"line\">SELECT negate(10), negate(-10); -- -10\t10</span><br><span class=\"line\">--绝对值</span><br><span class=\"line\">SELECT abs(-10), abs(10);</span><br><span class=\"line\">--最大公约数</span><br><span class=\"line\">SELECT gcd(12, 24), gcd(-12, -24), gcd(-12, 24);</span><br><span class=\"line\">--最小公倍数</span><br><span class=\"line\">SELECT lcm(12, 24), lcm(-12, -24), lcm(-3, 4);</span><br><span class=\"line\">-- 二、比较函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 比较函数(始终返回0表示false 或   1表示true)</span><br><span class=\"line\">SELECT 12 == 12, 12 != 10, 12 == 132, 12 != 12, 12 &lt;&gt; 12;</span><br><span class=\"line\">SELECT equals(12, 12), notEquals(12, 10), equals(12, 10), notEquals(12,123);</span><br><span class=\"line\">SELECT greater(12, 10), greater(10, 12), greater(12, 12);-- 前者是否大于后者</span><br><span class=\"line\">SELECT greaterOrEquals(12,10), greaterOrEquals(12,12);-- 前者是否大于或等于后者</span><br><span class=\"line\">SELECT less(12, 21), less(12, 10), less(120, 120);-- 前者是否小于后者</span><br><span class=\"line\">SELECT lessOrEquals(12, 120), lessOrEquals(12, 12);-- 前世是否小于或等于或者</span><br><span class=\"line\">-- 三、逻辑函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 逻辑操作符（返回0表示false 或 1表示true）</span><br><span class=\"line\">SELECT 12==12 or 12!=10;</span><br><span class=\"line\">SELECT 12==12 and 12!=10;</span><br><span class=\"line\">SELECT not 12, not 0;</span><br><span class=\"line\">SELECT or(equals(12, 12), notEquals(12, 10)); --函数表示法：或</span><br><span class=\"line\">SELECT and(equals(12, 12), notEquals(12, 10));--函数表示法：且</span><br><span class=\"line\">SELECT not(12), not(0);</span><br><span class=\"line\">-- 四、类型转换函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 类型转换函数部分示例：</span><br><span class=\"line\">SELECT toInt8(12.3334343), toFloat32(10.001), toFloat64(1.000040);</span><br><span class=\"line\">SELECT toString(now());</span><br><span class=\"line\">SELECT now() AS now_local, toString(now(), &#x27;Asia/Yekaterinburg&#x27;) AS now_yekat;</span><br><span class=\"line\">SELECT now() AS now_local, toDate(now()), toDateTime(now()), toUnixTimestamp(now());</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">&#x27;2016-06-15 23:00:00&#x27; AS timestamp,</span><br><span class=\"line\">CAST(timestamp AS DateTime) AS datetime,</span><br><span class=\"line\">CAST(timestamp AS Date) AS date,</span><br><span class=\"line\">CAST(timestamp, &#x27;String&#x27;) AS string,</span><br><span class=\"line\">CAST(timestamp, &#x27;FixedString(22)&#x27;) AS fixed_string;</span><br><span class=\"line\">WITH</span><br><span class=\"line\">   toDate(&#x27;2019-01-01&#x27;) AS date,</span><br><span class=\"line\">   INTERVAL 1 WEEK AS interval_week,</span><br><span class=\"line\">   toIntervalWeek(1) AS interval_to_week,</span><br><span class=\"line\">   toIntervalMonth(1) AS interval_to_month</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">   date + interval_week,</span><br><span class=\"line\">   date + interval_to_week,</span><br><span class=\"line\">   date + interval_to_month;</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-01-01 12:10:10&#x27;) as datetime,</span><br><span class=\"line\">\tINTERVAL 1 HOUR AS interval_hour,</span><br><span class=\"line\">\ttoIntervalHour(1) as invterval_to_hour</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tplus(datetime, interval_hour),</span><br><span class=\"line\">\tplus(datetime, invterval_to_hour);</span><br><span class=\"line\">-- 五、时间日期函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 时间日期函数</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-30 10:10:10&#x27;) AS time,</span><br><span class=\"line\">\t-- 将DateTime转换成Unix时间戳</span><br><span class=\"line\">\ttoUnixTimestamp(time) as unixTimestamp,</span><br><span class=\"line\">\t-- 保留  时-分-秒</span><br><span class=\"line\">\ttoDate(time) as date_local,</span><br><span class=\"line\">\ttoTime(time) as date_time,-- 将DateTime中的日期转换为一个固定的日期，同时保留时间部分。</span><br><span class=\"line\">\t-- 获取年份，月份，季度，小时，分钟，秒钟</span><br><span class=\"line\">\ttoYear(time) as get_year,</span><br><span class=\"line\">\ttoMonth(time) as get_month,</span><br><span class=\"line\">\t-- 一年分为四个季度。1（一季度:1-3）,2（二季度:4-6）,3（三季度:7-9）,4（四季度:10-12）</span><br><span class=\"line\">\ttoQuarter(time) as get_quarter,</span><br><span class=\"line\">\ttoHour(time) as get_hour,</span><br><span class=\"line\">\ttoMinute(time) as get_minute,</span><br><span class=\"line\">\ttoSecond(time) as get_second,</span><br><span class=\"line\">\t-- 获取 DateTime中的当前日期是当前年份的第几天，当前月份的第几日，当前星期的周几</span><br><span class=\"line\">\ttoDayOfYear(time) as &quot;当前年份中的第几天&quot;,</span><br><span class=\"line\">\ttoDayOfMonth(time) as &quot;当前月份的第几天&quot;,</span><br><span class=\"line\">\ttoDayOfWeek(time) as &quot;星期&quot;,</span><br><span class=\"line\">\ttoDate(time, &#x27;Asia/Shanghai&#x27;) AS date_shanghai,</span><br><span class=\"line\">\ttoDateTime(time, &#x27;Asia/Shanghai&#x27;) AS time_shanghai,</span><br><span class=\"line\">\t-- 得到当前年份的第一天,当前月份的第一天，当前季度的第一天，当前日期的开始时刻</span><br><span class=\"line\">\ttoStartOfYear(time),</span><br><span class=\"line\">\ttoStartOfMonth(time),</span><br><span class=\"line\">\ttoStartOfQuarter(time),</span><br><span class=\"line\">\ttoStartOfDay(time) AS cur_start_daytime,</span><br><span class=\"line\">\ttoStartOfHour(time) as cur_start_hour,</span><br><span class=\"line\">\ttoStartOfMinute(time) AS cur_start_minute,</span><br><span class=\"line\">\t-- 从过去的某个固定的时间开始，以此得到当前指定的日期的编号</span><br><span class=\"line\">\ttoRelativeYearNum(time),</span><br><span class=\"line\">\ttoRelativeQuarterNum(time);</span><br><span class=\"line\">\t</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-30 14:27:30&#x27;) as time,</span><br><span class=\"line\">\ttoISOYear(time) AS iso_year,</span><br><span class=\"line\">\ttoISOWeek(time) AS iso_week,</span><br><span class=\"line\">\tnow() AS cur_dateTime1, -- 返回当前时间yyyy-MM-dd HH:mm:ss</span><br><span class=\"line\">\ttoday() AS cur_dateTime2, -- 其功能与&#x27;toDate(now())&#x27;相同</span><br><span class=\"line\">\tyesterday() AS yesterday, -- 当前日期的上一天</span><br><span class=\"line\">\t-- timeSlot(1) AS timeSlot_1, -- 出现异常！！将时间向前取整半小时</span><br><span class=\"line\">\ttoDate(time) as getY_M_d;</span><br><span class=\"line\">-- 目前只有这三种格式，没有什么toYYYY(),toYYYddmm()之类的函数，不要想当然。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tnow() as nowTime,</span><br><span class=\"line\">\t-- 将Date或DateTime转换为包含年份和月份编号的UInt32类型的数字（YYYY * 100 + MM）</span><br><span class=\"line\">\ttoYYYYMMDDhhmmss(nowTime),</span><br><span class=\"line\">\ttoYYYYMMDD(nowTime),</span><br><span class=\"line\">\ttoYYYYMM(nowTime);</span><br><span class=\"line\">-- formatDateTime(Time, Format[,Timezone])函数引用</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tnow() as now_time,</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-31 18:20:30&#x27;) AS def_datetime,</span><br><span class=\"line\">\tformatDateTime(now_time, &#x27;%D&#x27;) AS now_time_day_month_year,-- 07/30/19</span><br><span class=\"line\">--\ttoDateTime(&#x27;2019-07-31 18:20:30&#x27;, &#x27;Asia/Shanghai&#x27;) AS def_datetime1, -- 指定时区</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%Y&#x27;) AS def_datetime_year, -- 2019（指定日期为2019年）</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%y&#x27;) AS def_datetime_year_litter, -- 19（指定日期为19年,Year, last two digits (00-99),本世纪的第19年）</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%H&#x27;) AS hour24, -- 18 下午六点</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%I&#x27;) AS hour12, -- 06下午六点</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%p&#x27;) AS PMorAM, -- 指定时间是上午还是下午</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%w&#x27;) AS def_datetime_get_curWeek,-- 3(指定日期为星期三)</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%F&#x27;) AS def_datetime_get_date,-- 2019-07-31 </span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%T&#x27;) AS def_datetime_get_time,-- 18:20:30</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%M&#x27;) AS def_datetime_get_minute,-- 20(得到指定事件的“分”，minute (00-59))</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%S&#x27;) AS def_datetime_get_second;-- 30(得到指定事件的“秒”，second (00-59))</span><br><span class=\"line\">\t</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 1.跳转到之后的日期函数</span><br><span class=\"line\">-- 第一种，日期格式（指定日期，需注意时区的问题）</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDate(&#x27;2019-09-09&#x27;) AS date,</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-09-09 00:00:00&#x27;) AS date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\taddYears(date, 1) AS add_years_with_date,</span><br><span class=\"line\">\taddYears(date_time, 0) AS add_years_with_date_time;</span><br><span class=\"line\">-- 第二种，日期格式（当前，本地时间）</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDate(now()) as date,</span><br><span class=\"line\">\ttoDateTime(now()) as date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tnow() as now_time,-- 当前时间</span><br><span class=\"line\">\taddYears(date, 1) AS add_years_with_date,-- 之后1年</span><br><span class=\"line\">\taddYears(date_time, 1) AS add_years_with_date_time,</span><br><span class=\"line\">\taddMonths(date, 1) AS add_months_with_date,-- 之后1月</span><br><span class=\"line\">\taddMonths(date_time, 1) AS add_months_with_date_time,</span><br><span class=\"line\">\taddWeeks(date, 1) AS add_weeks_with_date,--之后1周</span><br><span class=\"line\">\taddWeeks(date_time, 1) AS add_weeks_with_date_time,</span><br><span class=\"line\">\taddDays(date, 1) AS add_days_with_date,-- 之后1天</span><br><span class=\"line\">\taddDays(date_time, 1) AS add_days_with_date_time,</span><br><span class=\"line\">\taddHours(date_time, 1) AS add_hours_with_date_time,--之后1小时</span><br><span class=\"line\">\taddMinutes(date_time, 1) AS add_minutes_with_date_time,--之后1分中</span><br><span class=\"line\">\taddSeconds(date_time, 10) AS add_seconds_with_date_time,-- 之后10秒钟</span><br><span class=\"line\">\taddQuarters(date, 1) AS add_quarters_with_date, -- 之后1个季度</span><br><span class=\"line\">\taddQuarters(date_time, 1) AS add_quarters_with_date_time;</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 2.跳转到当前日期之前的函数(函数将Date/DateTime减去一段时间间隔，然后返回Date/DateTime)</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDate(now()) as date,</span><br><span class=\"line\">\ttoDateTime(now()) as date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tsubtractYears(date, 1) AS subtract_years_with_date,</span><br><span class=\"line\">    subtractYears(date_time, 1) AS subtract_years_with_date_time,</span><br><span class=\"line\">\tsubtractQuarters(date, 1) AS subtract_Quarters_with_date,</span><br><span class=\"line\">    subtractQuarters(date_time, 1) AS subtract_Quarters_with_date_time,</span><br><span class=\"line\">\tsubtractMonths(date, 1) AS subtract_Months_with_date,</span><br><span class=\"line\">    subtractMonths(date_time, 1) AS subtract_Months_with_date_time,</span><br><span class=\"line\">\tsubtractWeeks(date, 1) AS subtract_Weeks_with_date,</span><br><span class=\"line\">    subtractWeeks(date_time, 1) AS subtract_Weeks_with_date_time,</span><br><span class=\"line\">\tsubtractDays(date, 1) AS subtract_Days_with_date,</span><br><span class=\"line\">    subtractDays(date_time, 1) AS subtract_Days_with_date_time,</span><br><span class=\"line\">    subtractHours(date_time, 1) AS subtract_Hours_with_date_time,</span><br><span class=\"line\">    subtractMinutes(date_time, 1) AS subtract_Minutes_with_date_time,</span><br><span class=\"line\">    subtractSeconds(date_time, 1) AS subtract_Seconds_with_date_time;</span><br><span class=\"line\">SELECT toDate(&#x27;2019-07-31&#x27;, &#x27;Asia/GuangZhou&#x27;) as date_guangzhou;</span><br><span class=\"line\">SELECT toDate(&#x27;2019-07-31&#x27;), toDate(&#x27;2019-07-31&#x27;, &#x27;Asia/Beijing&#x27;) as date_beijing;</span><br><span class=\"line\">-- 亚洲只能加载上海的timezone？？？</span><br><span class=\"line\">SELECT toDateTime(&#x27;2019-07-31 10:10:10&#x27;, &#x27;Asia/Shanghai&#x27;) as date_shanghai;</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 计算连个时刻在不同时间单位下的差值</span><br><span class=\"line\">-- 第一种：指定时间计算差值示例</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-30 10:10:10&#x27;, &#x27;Asia/Shanghai&#x27;) as date_shanghai_one,</span><br><span class=\"line\">\ttoDateTime(&#x27;2020-10-31 11:20:30&#x27;, &#x27;Asia/Shanghai&#x27;) as date_shanghai_two</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tdateDiff(&#x27;year&#x27;, date_shanghai_one, date_shanghai_two) as diff_years,</span><br><span class=\"line\">\tdateDiff(&#x27;month&#x27;, date_shanghai_one, date_shanghai_two) as diff_months,</span><br><span class=\"line\">\tdateDiff(&#x27;week&#x27;, date_shanghai_one, date_shanghai_two) as diff_week,</span><br><span class=\"line\">\tdateDiff(&#x27;day&#x27;, date_shanghai_one, date_shanghai_two) as diff_days,</span><br><span class=\"line\">\tdateDiff(&#x27;hour&#x27;, date_shanghai_one, date_shanghai_two) as diff_hours,</span><br><span class=\"line\">\tdateDiff(&#x27;minute&#x27;, date_shanghai_one, date_shanghai_two) as diff_minutes,</span><br><span class=\"line\">\tdateDiff(&#x27;second&#x27;, date_shanghai_one, date_shanghai_two) as diff_seconds;</span><br><span class=\"line\">-- 第二种：本地当前时间示例</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\tnow() as date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tdateDiff(&#x27;year&#x27;, date_time, addYears(date_time, 1)) as diff_years,</span><br><span class=\"line\">\tdateDiff(&#x27;month&#x27;, date_time, addMonths(date_time, 2)) as diff_months,</span><br><span class=\"line\">\tdateDiff(&#x27;week&#x27;, date_time, addWeeks(date_time, 3)) as diff_week,</span><br><span class=\"line\">\tdateDiff(&#x27;day&#x27;, date_time, addDays(date_time, 3)) as diff_days,</span><br><span class=\"line\">\tdateDiff(&#x27;hour&#x27;, date_time, addHours(date_time, 3)) as diff_hours,</span><br><span class=\"line\">\tdateDiff(&#x27;minute&#x27;, date_time, addMinutes(date_time, 30)) as diff_minutes,</span><br><span class=\"line\">\tdateDiff(&#x27;second&#x27;, date_time, addSeconds(date_time, 35)) as diff_seconds;</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- timeSlot(StartTime, Duration, [,Size])</span><br><span class=\"line\">-- 它返回一个时间数组，其中包括从从“StartTime”开始到“StartTime + Duration 秒”内的所有符合“size”（以秒为单位）步长的时间点</span><br><span class=\"line\">-- 作用:搜索在相应会话中综合浏览量是非常有用的。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\ttimeSlots(toDateTime(&#x27;2012-01-01 12:20:00&#x27;), toUInt32(600)) as dateTimeArray,</span><br><span class=\"line\">\tdateTimeArray[0] as arr_index_0, -- no result.</span><br><span class=\"line\">\tdateTimeArray[1] as arr_index_1, -- 2012-01-01 20:00:00</span><br><span class=\"line\">\tdateTimeArray[2] as arr_index_2, -- 2012-01-01 20:30:00</span><br><span class=\"line\">\tdateTimeArray[3] as arr_index_3, -- no result.</span><br><span class=\"line\">\tdateTimeArray[4] as arr_index_4; -- no result.</span><br><span class=\"line\">-- toUInt32(600) 表示之后间距20秒的时刻</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\ttimeSlots(now(), toUInt32(600), 20) as dateTimeArray, -- 类似于：引用地址</span><br><span class=\"line\">\tdateTimeArray[0] as arr_index_0, -- no result.为什么？</span><br><span class=\"line\">\tdateTimeArray[1] as arr_index_1,</span><br><span class=\"line\">\tdateTimeArray[2] as arr_index_2,</span><br><span class=\"line\">\tdateTimeArray[3] as arr_index_3,</span><br><span class=\"line\">\tdateTimeArray[4] as arr_index_4,</span><br><span class=\"line\">\tdateTimeArray[5] as arr_index_5;</span><br><span class=\"line\">-- 指定时间为基准，之后每个元素增加20秒</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttimeSlots(toDateTime(&#x27;2012-01-01 12:20:00&#x27;), toUInt32(600), 20) as cur_dateTimeArray, -- 类似于：引用地址</span><br><span class=\"line\">\tcur_dateTimeArray[0] as arr_index_0, -- no result.为什么？</span><br><span class=\"line\">\tcur_dateTimeArray[1] as arr_index_1, -- 2012-01-01 20:20:00</span><br><span class=\"line\">\tcur_dateTimeArray[2] as arr_index_2, -- 2012-01-01 20:20:20</span><br><span class=\"line\">\tcur_dateTimeArray[3] as arr_index_3, -- 2012-01-01 20:20:40</span><br><span class=\"line\">\tcur_dateTimeArray[4] as arr_index_4, -- 2012-01-01 20:21:00</span><br><span class=\"line\">\tcur_dateTimeArray[5] as arr_index_5; -- 2012-01-01 20:21:20</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 六、字符串函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串函数：</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tlength(&#x27;hello world&#x27;) as str_length, -- 按照Unicode编码计算长度“你好”的长度为6</span><br><span class=\"line\">\tempty(&#x27;hello world&#x27;),-- 判断字符串是否为空，空为1，非空为0</span><br><span class=\"line\">\tnotEmpty(&#x27;hello world&#x27;),</span><br><span class=\"line\">\tlengthUTF8(&#x27;hello world&#x27;), -- 按照实际字符计算长度“你好”为2</span><br><span class=\"line\">\tchar_length(&#x27;hello world&#x27;), -- 同 lengthUTF8()</span><br><span class=\"line\">\tcharacter_length(&#x27;hello world&#x27;), -- 同 lengthUTF8(),</span><br><span class=\"line\">\tlower(&#x27;abcd123--&#x27;),--字母全部小写（将字符串中的ASCII转换为小写。）</span><br><span class=\"line\">\tupper(&#x27;abcd123--&#x27;),--字母全部大写（将字符串中的ASCII转换为大写。）</span><br><span class=\"line\">\tlowerUTF8(&#x27;abcd123-/*\\8asd-\\\\&#x27;), -- abcd123-/*8asd-\\</span><br><span class=\"line\">\tupperUTF8(&#x27;abcd123--&#x27;), -- ABCD123--</span><br><span class=\"line\">\tisValidUTF8(&#x27;abcd123--/*\\*&#x27;); --检查字符串是否为有效的UTF-8编码，是则返回1，否则返回0。</span><br><span class=\"line\">SELECT notEmpty(&#x27;&#x27;), notEmpty(NULL), notEmpty(&#x27;he&#x27;); -- 0,空,1</span><br><span class=\"line\">SELECT toValidUTF8(&#x27;\\x61\\xF0\\x80\\x80\\x80b&#x27;);</span><br><span class=\"line\">-- reverseUTF8():以Unicode字符为单位反转UTF-8编码的字符串。如果字符串不是UTF-8编码，则可能获取到一个非预期的结果（不会抛出异常）</span><br><span class=\"line\">SELECT reverse(&#x27;abcdefg&#x27;), reverseUTF8(&#x27;abcdefg&#x27;);</span><br><span class=\"line\">-- 2.字符串维度自定义安排</span><br><span class=\"line\">SELECT format(&#x27;&#123;1&#125; &#123;0&#125; &#123;1&#125;&#x27;, &#x27;World&#x27;, &#x27;Hello&#x27;); -- 输出：Hello World Hello</span><br><span class=\"line\">SELECT format(&#x27;&#123;0&#125; &#123;0&#125; &#123;1&#125; &#123;1&#125;&#x27;, &#x27;one&#x27;, &#x27;two&#x27;); -- 输出：one one two two</span><br><span class=\"line\">SELECT format(&#x27;&#123;&#125; &#123;&#125;&#x27;, &#x27;Hello&#x27;, &#x27;World&#x27;); -- 输出：Hello World</span><br><span class=\"line\">-- 3.字符串拼接 concat(s1,s2,s3,...)</span><br><span class=\"line\">SELECT concat(&#x27;Hello&#x27;,&#x27; &#x27;,&#x27;World&#x27;, &#x27;!&#x27;);-- Hello World!</span><br><span class=\"line\">-- 与concat相同，区别在于，你需要保证concat(s1, s2, s3) -&gt; s4是单射的，它将用于GROUP BY的优化。</span><br><span class=\"line\">SELECT concatAssumeInjective(&#x27;Hello&#x27;,&#x27; &#x27;,&#x27;World&#x27;, &#x27;!&#x27;);-- Hello World!</span><br><span class=\"line\">-- 4.字符串截取：substring(s, offset, length), mid(s, offset, length), substr(s, offset, length)</span><br><span class=\"line\">-- 以字节为单位截取指定位置字符串，返回以‘offset’位置为开头，长度为‘length’的子串。‘offset’从1开始（与标准SQL相同）。‘offset’和‘length’参数必须是常量。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tsubstring(&#x27;abcdefg&#x27;, 1, 3),-- abc</span><br><span class=\"line\">\tsubstring(&#x27;你好，世界&#x27;, 1, 3),-- 你</span><br><span class=\"line\">\tsubstringUTF8(&#x27;你好，世界&#x27;, 1, 3); -- 你好，</span><br><span class=\"line\">-- 5.字符串拼接：appendTrailingCharIfAbsent(s, c)</span><br><span class=\"line\">-- 如果‘s’字符串非空并且末尾不包含‘c’字符，则将‘c’字符附加到末尾。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tappendTrailingCharIfAbsent(&#x27;good&#x27;,&#x27;c&#x27;), -- goodc</span><br><span class=\"line\">\tappendTrailingCharIfAbsent(&#x27;goodccc&#x27;,&#x27;c&#x27;); -- goodccc</span><br><span class=\"line\">-- 6.字符串编码转换：convertCharset(s, from, to) 返回从‘from’中的编码转换为‘to’中的编码的字符串‘s’。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;UTF8&#x27;,&#x27;Unicode&#x27;),-- ��h</span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;Unicode&#x27;, &#x27;UTF8&#x27;),-- 桥汬�</span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;Unicode&#x27;, &#x27;ASCII&#x27;),-- </span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;ascii&#x27;, &#x27;ascii&#x27;),--hello</span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;UTF8&#x27;,&#x27;UTF8&#x27;);-- hello</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tbase64Encode(&#x27;username+password&#x27;),-- dXNlcm5hbWUrcGFzc3dvcmQ=</span><br><span class=\"line\">\tbase64Decode(&#x27;dXNlcm5hbWUrcGFzc3dvcmQ=&#x27;), -- username+password</span><br><span class=\"line\">\t-- 使用base64将字符串解码成原始字符串。但如果出现错误，将返回空字符串。</span><br><span class=\"line\">\ttryBase64Decode(&#x27;dXNlcm5hbWUrcGFzc3dvcmQ=&#x27;);</span><br><span class=\"line\">-- 7.判断字符串是否已什么结尾或结束，返回1：true，0：flase</span><br><span class=\"line\">-- endsWith(s, suffix)  返回是否以指定的后缀结尾。如果字符串以指定的后缀结束，则返回1，否则返回0</span><br><span class=\"line\">-- startWith(s, prefix) 返回是否以指定的前缀开头。如果字符串以指定的前缀开头，则返回1，否则返回0。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tendsWith(&#x27;string&#x27;,&#x27;g&#x27;),</span><br><span class=\"line\">\tstartsWith(&#x27;string&#x27;, &#x27;str&#x27;); -- 1  true</span><br><span class=\"line\">-- 8.删除左侧空白字符</span><br><span class=\"line\">-- trimLeft(s)  返回一个字符串，用于删除左侧的空白字符</span><br><span class=\"line\">-- trimRight(s) 返回一个字符串，用于删除右侧的空白字符</span><br><span class=\"line\">-- trimBoth(s)  返回一个字符串，用于删除左侧和右侧的空白字符</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttrimLeft(&#x27;  sdfdgs&#x27;), -- sdfdgs</span><br><span class=\"line\">\ttrimRight(&#x27;abcd   &#x27;), -- abcd</span><br><span class=\"line\">\ttrimBoth(&#x27;  abcd  &#x27;); -- abcd</span><br><span class=\"line\">-- 七、字符串搜索函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串搜索函数</span><br><span class=\"line\">-- pasition(haystack, needle), 显示needle在haystack的第一个出现的位置。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tPOSITION(&#x27;2121stringstrstrstrstr&#x27;,&#x27;str&#x27;) AS positionSearch, -- 5</span><br><span class=\"line\">\tPOSITION(&#x27;你好，hello,12323-你好，你，好sdfd*dg&#x27;, &#x27;你，好&#x27;),-- 31</span><br><span class=\"line\">\tpositionUTF8(&#x27;n12你好&#x27;,&#x27;你好&#x27;) AS positionUTF8,-- 4</span><br><span class=\"line\">\tpositionCaseInsensitive(&#x27;ABCDCDEFABCD&#x27;,&#x27;bc&#x27;) AS positionCaseInsensitive, --2</span><br><span class=\"line\">\tlocate(&#x27;hellohellohellohello&#x27;,&#x27;ello&#x27;); -- 2</span><br><span class=\"line\">-- multiSearchAllPositions(haystack, [needle1, needle2, ..., needlen])</span><br><span class=\"line\">-- 注意：在所有multiSearch*函数中，由于实现规范，needles的数量应小于2^8。</span><br><span class=\"line\">-- 函数返回一个数组，其中包含所有匹配needlei的位置</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tmultiSearchAllPositions(&#x27;goodnamegoodnamegoodhellohihihi&#x27;, [&#x27;dn&#x27;, &#x27;good&#x27;]) as multiSearch,-- [4,1]</span><br><span class=\"line\">\tmultiSearchAllPositionsCaseInsensitive(&#x27;nameSsdfagpSSDFDFetgfderef&#x27;, [&#x27;SS&#x27;,&#x27;fa&#x27;]) as multiCaseInsensitive,</span><br><span class=\"line\">\tmultiSearchAllPositionsUTF8(&#x27;nameSsdfazz轴功率gpSSDFDFetgfderef&#x27;, [&#x27;Ss&#x27;,&#x27;fa&#x27;, &#x27;zz轴&#x27;]) AS multiSearchUTF8,</span><br><span class=\"line\">\tmultiSearchAllPositionsCaseInsensitiveUTF8(&#x27;nameSsdfazz轴功率gpSSDFDFetgfderef&#x27;, [&#x27;Ss&#x27;,&#x27;fa&#x27;, &#x27;zz轴&#x27;]) AS multiCaseInsensitiveUTF8;</span><br><span class=\"line\">-- 检查字符串是否与pattern正则表达式匹配。pattern可以是一个任意的re2正则表达式。 re2正则表达式的语法比Perl正则表达式的语法存在更多限制。</span><br><span class=\"line\">-- match(haystack, pattern) 匹配到了则返回1，否则返回0</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tmatch(&#x27;1232434sadgaDDFSrefds&#x27;, &#x27;[0-9a-zA-Z]&#x27;), -- 存在匹配的字符，返回1</span><br><span class=\"line\">\tmatch(&#x27;1232321&#x27;, &#x27;[a-z]&#x27;); -- 不存在匹配的字符，返回0</span><br><span class=\"line\">-- 与match相同，但如果所有正则表达式都不匹配，则返回0；如果任何模式匹配，则返回1。它使用hyperscan库。对于在字符串中搜索子字符串的模式，最好使用“multisearchany”，因为它更高效。</span><br><span class=\"line\">-- multiMatchAny(haystack, [pattern1, pattern2, ..., patternn]) </span><br><span class=\"line\">-- 注意：任何haystack字符串的长度必须小于232字节，否则抛出异常。这种限制是因为hyperscan API而产生的。</span><br><span class=\"line\">-- 多个正则表达式对原始字符进行匹配，如若只有一个正则表达式匹配上了则返回1，否则返回0</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tmultiMatchAny(&#x27;abcABC&#x27;,[&#x27;[0-9]&#x27;,&#x27;[a-zA-Z]&#x27;]) AS multiMatchAnyOne, -- 1</span><br><span class=\"line\">\tmultiMatchAny(&#x27;123abcABC&#x27;,[&#x27;[0-9]&#x27;,&#x27;[a-zA-Z]&#x27;]) AS multiMatchAnyTwo, --1</span><br><span class=\"line\">\t-- 与multiMatchAny相同，但返回与haystack匹配的任何内容的索引位置。</span><br><span class=\"line\">\tmultiMatchAnyIndex(&#x27;123abcABC&#x27;, [&#x27;[0-9]&#x27;,&#x27;[a-zA-Z]&#x27;]) as multiMatchAnyIndex; --2</span><br><span class=\"line\">-- 模糊匹配：like()函数，注意大写敏感。</span><br><span class=\"line\">-- % 表示任何字节数（包括零字符）</span><br><span class=\"line\">-- _ 表示任何一个字节</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\t&#x27;hello&#x27; LIKE &#x27;%h%&#x27; as LIKE_UP, -- 1</span><br><span class=\"line\">\t&#x27;hello&#x27; like &#x27;he&#x27; AS like_low, -- 0</span><br><span class=\"line\">\t&#x27;hello&#x27; not like &#x27;he&#x27; AS not_like, -- 1</span><br><span class=\"line\">\t&#x27;hello&#x27; like &#x27;%he%&#x27; AS like_litter, -- 1</span><br><span class=\"line\">\tlike(&#x27;adgadgadfa1232&#x27;, &#x27;_12_&#x27;) AS like_func,</span><br><span class=\"line\">\tlike(&#x27;sdfasdfasd&#x27;, &#x27;[a-z]&#x27;) AS like_func2, -- 0</span><br><span class=\"line\">\tnotLike(&#x27;1232423&#x27;, &#x27;[a-zA-Z]&#x27;) AS not_like_func; -- 1</span><br><span class=\"line\">-- 使用字符串截取字符串：extract(haystack, pattern)</span><br><span class=\"line\">-- 使用正则表达式截取字符串。如果‘haystack’与‘pattern’不匹配，则返回空字符串。如果正则表达式中不包含子模式，它将获取与整个正则表达式匹配的子串。否则，它将获取与第一个子模式匹配的子串。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\textractAll(&#x27;hellogoodaimantIdeaIDEAfasd123232&#x27;, &#x27;[0-9]&#x27;), -- [&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;2&#x27;]</span><br><span class=\"line\">\textractAll(&#x27;12323dSDFRE&#x27;, &#x27;[A-Z]&#x27;),-- [&#x27;S&#x27;,&#x27;D&#x27;,&#x27;F&#x27;,&#x27;R&#x27;,&#x27;E&#x27;]</span><br><span class=\"line\">\textract(&#x27;helloclickhouse&#x27;, &#x27;[a-z]&#x27;);-- h</span><br><span class=\"line\">-- ngramSearch(haystack, needle)</span><br><span class=\"line\">-- 基于4-gram计算haystack和needle之间的距离：计算两个4-gram集合之间的对称差异，并用它们的基数和对其进行归一化。</span><br><span class=\"line\">-- 返回0到1之间的任何浮点数 -- 越接近0则表示越多的字符串彼此相似。</span><br><span class=\"line\">-- 如果常量的needle或haystack超过32KB，函数将抛出异常。如果非常量的haystack或needle字符串超过32Kb，则距离始终为1。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tngramDistance(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistance, </span><br><span class=\"line\">\tngramDistanceCaseInsensitive(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistanceCaseInsensitive,</span><br><span class=\"line\">\tngramDistanceUTF8(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistanceUTF8,</span><br><span class=\"line\">\tngramDistanceCaseInsensitiveUTF8(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistanceCaseInsensitiveUTF8;</span><br><span class=\"line\">-- 注意：对于UTF-8，我们使用3-gram。所有这些都不是完全公平的n-gram距离。</span><br><span class=\"line\">-- 我们使用2字节哈希来散列n-gram，然后计算这些哈希表之间的（非）对称差异 - 可能会发生冲突。</span><br><span class=\"line\">-- 对于UTF-8不区分大小写的格式，我们不使用公平的tolower函数 </span><br><span class=\"line\">-- 我们将每个Unicode字符字节的第5位（从零开始）和字节的第一位归零 </span><br><span class=\"line\">-- 这适用于拉丁语，主要用于所有西里尔字母。</span><br><span class=\"line\">--八、字符串替换函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串替换函数</span><br><span class=\"line\">-- 替换匹配到的字符串</span><br><span class=\"line\">-- replaceOne(haystack, pattern, replacement)</span><br><span class=\"line\">-- 用‘replacement’子串替换‘haystack’中与‘pattern’子串第一个匹配的匹配项（如果存在）。 ‘pattern’和‘replacement’必须是常量。</span><br><span class=\"line\">-- replaceAll(haystack, pattern, replacement), replace(haystack, pattern, replacement)</span><br><span class=\"line\">-- 用‘replacement’子串替换‘haystack’中出现的所有‘pattern’子串。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\treplaceOne(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replaceOne,-- hed123*544</span><br><span class=\"line\">\treplaceRegexpOne(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replaceRegexpOne,-- hed123*544</span><br><span class=\"line\">\treplace(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replace, -- hed123*5**</span><br><span class=\"line\">\treplaceAll(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replaceAll;-- hed123*5**</span><br><span class=\"line\">-- 实例：2019-07-31 改变成  07/31/2019</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttoDate(now()) AS now_date,</span><br><span class=\"line\">\treplaceRegexpOne(toString(now_date), &#x27;(\\\\d&#123;4&#125;)-(\\\\d&#123;2&#125;)-(\\\\d&#123;2&#125;)&#x27;, &#x27;\\\\2/\\\\3/\\\\1&#x27;) AS format_date;</span><br><span class=\"line\">-- 示例：赋值字符串10次</span><br><span class=\"line\">SELECT replaceRegexpOne(&#x27;Hello, World!&#x27;, &#x27;.*&#x27;, &#x27;\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0&#x27;) AS res;</span><br><span class=\"line\">-- replaceRegexpAll(haystack, pattern, replacement)</span><br><span class=\"line\">-- 与replaceRegexpOne相同，但会替换所有出现的匹配项。例如：</span><br><span class=\"line\">SELECT replaceRegexpAll(&#x27;hello,world!&#x27;, &#x27;.&#x27;, &#x27;\\\\0\\\\0&#x27;) as res; -- hheelllloo,,wwoorrlldd!!</span><br><span class=\"line\">SELECT replaceRegexpAll(&#x27;hello o o, world.&#x27;, &#x27; &#x27;, &#x27;*&#x27;) as res; -- hello*o*o,*world.</span><br><span class=\"line\">-- 函数：regexpQuoteMeta(s)   该函数用于在字符串中的某些预定义字符之前添加反斜杠。</span><br><span class=\"line\">-- 预定义字符：&#x27;0&#x27;，&#x27;\\&#x27;，&#x27;|&#x27;，&#x27;(&#x27;，&#x27;)&#x27;，&#x27;^&#x27;，&#x27;$&#x27;，&#x27;。&#x27;，&#x27;[&#x27;，&#x27;]&#x27;，&#x27;？&#x27;，&#x27;* &#x27;，&#x27;+&#x27;，&#x27;&#123;&#x27;，&#x27;：&#x27;，&#x27; - &#x27;。 </span><br><span class=\"line\">-- 这个实现与re2 :: RE2 :: QuoteMeta略有不同。它以\\0而不是\\x00转义零字节，它只转义所需的字符</span><br><span class=\"line\">---- 简言之，就是不处理转义字符，一般如果没有用的这个函数，都会有转义的情况出现。</span><br><span class=\"line\">SELECT regexpQuoteMeta(&#x27;\\\\\\\\|[]&#123;&#125;+_-=@!~`&amp;^*%$#&#x27;); -- \\\\\\\\\\|\\[\\]\\&#123;&#125;\\+_\\-=@!~`&amp;\\^\\*%\\$#</span><br><span class=\"line\">SELECT toString(&#x27;\\\\\\\\&#x27;); -- \\\\</span><br><span class=\"line\"> </span><br><span class=\"line\">--九、条件函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 条件函数</span><br><span class=\"line\">-- 1. if(cond, then, else)函数：类似于三元操作符。</span><br><span class=\"line\">-- 中文字符使用双引号，英文字符可不使用引号也可使用当引号或双引号，根据具体情况而定。</span><br><span class=\"line\">-- 如果cond ！= 0则返回then，如果cond = 0则返回else。 cond必须是UInt8类型，then和else必须存在最低的共同类型。</span><br><span class=\"line\">-- 注意：then和else可以是NULL</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">&gt; 10 ? &#x27;desc&#x27; : &#x27;asc&#x27; AS &quot;三元操作符&quot;,</span><br><span class=\"line\">\tif(12 &gt; 10, &#x27;desc&#x27; , &#x27;asc&#x27;) AS &quot;if()函数&quot;,</span><br><span class=\"line\">\tif(12 &gt; 10, NULL, NULL);</span><br><span class=\"line\">-- 2. multiIf(cond_1, then_1, cond_2, then_2...else)</span><br><span class=\"line\">-- 允许您在查询中更紧凑地编写CASE运算符。类似于java中的switch语法（可以接受2n+1个参数）</span><br><span class=\"line\">SELECT multiIf(1,&#x27;one&#x27;,2,&#x27;two&#x27;,3,&#x27;three&#x27;,&#x27;not this index&#x27;);-- 关联case条件表达式</span><br><span class=\"line\">--十、数学函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 数学函数</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">* e() AS E,</span><br><span class=\"line\">* pi() AS PI,</span><br><span class=\"line\">\tsqrt(25) AS sqrt_25, --接受一个数值类型的参数并返回它的平方根。</span><br><span class=\"line\">\tcbrt(27) AS cbrt_27, --接受一个数值类型的参数并返回它的立方根。</span><br><span class=\"line\">\texp(10), --接受一个数值类型的参数并返回它的指数</span><br><span class=\"line\">\texp10(10), --接受一个数值类型的参数并返回它的10的x次幂。</span><br><span class=\"line\">\tlog(10) AS LOG,</span><br><span class=\"line\">\tlog2(10) AS LOG2, --接受一个数值类型的参数并返回它的底2对数。</span><br><span class=\"line\">\tln(e()) AS LOG10; --接受一个数值类型的参数并返回它的自然对数</span><br><span class=\"line\">-- 示例：三西格玛准则</span><br><span class=\"line\">SELECT erf(3 / sqrt(2)); -- 0.997</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tsin(90), -- 返回x的三角正弦值。</span><br><span class=\"line\">\tcos(90), -- 返回x的三角余弦值。</span><br><span class=\"line\">\ttan(90), -- 返回x的三角正切值</span><br><span class=\"line\">\tacos(0), -- 返回x的反三角余弦值。</span><br><span class=\"line\">\tasin(1), -- 返回x的反三角正弦值。</span><br><span class=\"line\">\tatan(45); -- 返回x的反三角正切值。</span><br><span class=\"line\">-- pow(x, y), power(x, y) 接受x和y两个参数。返回x的y次方。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tpow(2, 3), -- 2的三次方</span><br><span class=\"line\">\tpow(3, 2); -- 3的平方</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tintExp2(4), --2^4 \t接受一个数值类型的参数并返回它的2的x次幂（UInt64）。</span><br><span class=\"line\">\tintExp10(2);--10^2\t接受一个数值类型的参数并返回它的10的x次幂（UInt64）。</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 十一、取整函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 取整函数</span><br><span class=\"line\">-- 1.向下取整：floor(x[,N])</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tfloor(toFloat32(12.08098), 2), -- 12.08</span><br><span class=\"line\">\tfloor(toFloat32(12.2323), 2), -- 12.23</span><br><span class=\"line\">\tfloor(toFloat32(12.89788), -1), -- 10</span><br><span class=\"line\">\tfloor(toFloat32(12.09590), 3), -- 12.095 (注意：如果按照正常的四舍五入，则应该是12.096，为什么呢？)</span><br><span class=\"line\">\tfloor(toFloat32(12.0987), 3),-- 12.098</span><br><span class=\"line\">\tfloor(10, 2); -- 10</span><br><span class=\"line\">-- 2.四舍五入：round(expression [, decimal_places])</span><br><span class=\"line\">--\t如果decimal_places=0,则取整数；</span><br><span class=\"line\">--\t如果&gt;0,则将值舍入小数点右侧；</span><br><span class=\"line\">--\t如果&lt;0,则将小数点左侧的值四舍五入。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tround(toFloat32(12.1234), 3),</span><br><span class=\"line\">\tround(toFloat32(12.0025), 3), -- 12.002(注意：为什么不是12.003呢？)</span><br><span class=\"line\">\t-- round函数只会最多保留三位有效数字</span><br><span class=\"line\">\tround(toFloat32(12.0025), 4), -- 12.002</span><br><span class=\"line\">\tround(toFloat32(12.0025002323), 100); -- 12.003</span><br><span class=\"line\">-- 示例：</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tround(toFloat32(10 / 3)), -- 3  </span><br><span class=\"line\">\tround(toFloat32(10 / 3), 2), -- 3.33</span><br><span class=\"line\">\tround(toFloat32(10.000/3), 3), -- 3.333</span><br><span class=\"line\">\tround(toFloat32(10.000/3), 6); -- 3.333</span><br><span class=\"line\">-- roundToExp2() 接受一个数字。如果数字小于1，则返回0。否则，它将数字向下舍入到最接近的（整个非负）2的x次幂。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\troundToExp2(12.0129), -- 8 = 2^3</span><br><span class=\"line\">\troundToExp2(toFloat32(0.01)); -- 0.008</span><br><span class=\"line\">-- 3.向上取整：ceil(x[, N]) 或者 ceiling(x[, N])</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tceil(12.34343, 3), -- 12.344</span><br><span class=\"line\">\tceil(toFloat64(12.34343), 3), -- 12.344</span><br><span class=\"line\">\tceil(toFloat32(12.34343), 3), -- 12.344</span><br><span class=\"line\">\tceil(12.0011, 3); -- 12.002</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">---十二、数组函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 数组函数</span><br><span class=\"line\">-- 1.数组非空判断相关函数（真为1，假为0）</span><br><span class=\"line\">SELECT empty([]), empty([1,2,3]), notEmpty([1,2,3]), notEmpty([]);</span><br><span class=\"line\">-- 2.数组长度 length()  返回数组中的元素个数。 结果类型是UInt64。 该函数也适用于字符串。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">--\tlength(), -- 出现异常</span><br><span class=\"line\">--\tlength([true, false]), -- 异常</span><br><span class=\"line\">--\tlength([1,2,,4]), --出现异常！</span><br><span class=\"line\">\tlength([]), -- 0</span><br><span class=\"line\">\tlength([&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]), -- 3</span><br><span class=\"line\">\tlength([1,2,3]); -- 3</span><br><span class=\"line\">-- 3.扩展判断非空的部分函数如下：不接受任何参数并返回适当类型的空数组</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\temptyArrayUInt8(), -- UInt8的空数组</span><br><span class=\"line\">\temptyArrayUInt16(),</span><br><span class=\"line\">\temptyArrayUInt32(),</span><br><span class=\"line\">\temptyArrayUInt64(),</span><br><span class=\"line\">\temptyArrayDate(),</span><br><span class=\"line\">\temptyArrayDateTime(),</span><br><span class=\"line\">\temptyArrayInt8(),</span><br><span class=\"line\">\temptyArrayInt16(),</span><br><span class=\"line\">\temptyArrayInt32(),</span><br><span class=\"line\">\temptyArrayInt64();</span><br><span class=\"line\">--\t接受一个空数组并返回一个仅包含一个默认值元素的数组。(以下是部分示例)</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayInt32()), -- 0</span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayUInt32()), -- 0</span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayDate()), -- 0002-11-30</span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayDateTime()); --0002-11-30 08:00:00</span><br><span class=\"line\">-- 4.生成一个含有N个元素的数组,元素从0开始增长，步长尾1.</span><br><span class=\"line\">-- range(N)  返回从0到N-1的数字数组。 以防万一，如果在数据块中创建总长度超过100,000,000个元素的数组，则抛出异常</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\trange(10), -- [0,1,2,3,4,5,6,7,8,9]</span><br><span class=\"line\">\trange(2), -- [0,1]</span><br><span class=\"line\">--\trange(5.5), -- 出现异常，N为Int8的数据类型，正整数</span><br><span class=\"line\">--\trange(-10), -- 出现异常，DB::Exception: Illegal type Int8 of argument of function range</span><br><span class=\"line\">\trange(1); -- 0</span><br><span class=\"line\">-- 5.新建一个数组的函数：array(x1,……) 类似于 直接[x1,……]</span><br><span class=\"line\">-- 注意：新建数组的每个元素的数据类型需保持一致性。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarray(1,2,2,3,4) AS &quot;array()函数&quot;,</span><br><span class=\"line\">--\t[1,&#x27;hello&#x27;,3], -- 出现异常，DB::Exception: There is no supertype for types UInt8, String, UInt8 because some of them are String/FixedString and some of them are not (version 19.10.1.5 (official build))</span><br><span class=\"line\">\t[1,2,3,4] AS &quot;[ ]&quot;;</span><br><span class=\"line\">-- 6.合并N个数组  arrayConcat(arrays) 合并参数中传递的所有数组。跟java的数组差不多的合并，不会自动去重，不会自动排序</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayConcat(array(1,2),array(2,3),array(4,5)), -- [1,2,2,3,4,5]（第一种情况）</span><br><span class=\"line\">\tarrayConcat(array(1,1),array(2,2),array(3,3)), -- [1,1,2,2,3,3]</span><br><span class=\"line\">--\tarrayConcat(array(1,2),[&#x27;a&#x27;,&#x27;c&#x27;],array(3,3)), -- 出现异常，不能将不同类型的数组进行合并</span><br><span class=\"line\">\tarrayConcat(array(1,1),[2,3],array(4,5)); -- [1,1,2,3,4,5]</span><br><span class=\"line\">-- 7.从数组arr中获取索引为“n”的元素。</span><br><span class=\"line\">--  n必须是任何整数类型。 数组中的索引从一开始。 支持负索引。在这种情况下，它选择从末尾开始编号的相应元素。例如，arr [-1]是数组中的最后一项。</span><br><span class=\"line\">--  如果索引超出数组的边界，则返回默认值（数字为0，字符串为空字符串等）.</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayElement(array(10,20,3), 1), -- 10</span><br><span class=\"line\">\tarrayElement(array(1,20,3), 2), -- 20</span><br><span class=\"line\">\tarrayElement(array(1,2,30), 3), -- 30</span><br><span class=\"line\">\tarrayElement(array(10,20,3), 0), -- 0</span><br><span class=\"line\">\tarrayElement(array(10,20,3), -3), -- 10</span><br><span class=\"line\">\tarrayElement(array(10,20,3), -2), -- 20</span><br><span class=\"line\">\tarrayElement(array(10,20,3), -1);-- 3</span><br><span class=\"line\">-- 8.检查在数组中是否含有此元素。has(arr, elem)  包含此元素则返回1，否则返回0</span><br><span class=\"line\">-- has()  检查&#x27;arr&#x27;数组是否具有&#x27;elem&#x27;元素。 如果元素不在数组中，则返回0;如果在，则返回1。</span><br><span class=\"line\">-- hasAny(arr1, arr2) 返回1表示arr1和arr2存在交集。否则返回0. </span><br><span class=\"line\">--注意：特殊的定义：</span><br><span class=\"line\">--\t\t① “NULL”作为数组中的元素值进行处理。</span><br><span class=\"line\">--\t\t② 忽略两个数组中的元素值的顺序</span><br><span class=\"line\">-- hasAll(set, subset)  检查一个数组是否是另一个数组的子集。返回1，表示set包含subset中所有的元素</span><br><span class=\"line\">--    set – 具有一组元素的任何类型的数组。</span><br><span class=\"line\">--    subset – 任何类型的数组，其元素应该被测试为set的子集。</span><br><span class=\"line\">-- 注意：特殊的定义：</span><br><span class=\"line\">--\t\t① 空数组是任何数组的子集。</span><br><span class=\"line\">--\t\t② “NULL”作为数组中的元素值进行处理。</span><br><span class=\"line\">--\t\t③ 忽略两个数组中的元素值的顺序。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\thas([1,2,3], 2), -- 1</span><br><span class=\"line\">\thas(array(1,2,3),2), -- 1</span><br><span class=\"line\">\thas([1,2,NULL], NULL), -- 1 (注意：null值的处理)</span><br><span class=\"line\">--\thas([], 2), -- 出现异常，DB::Exception: Types of array and 2nd argument of function has must be identical up to nullability or numeric types or Enum and numeric type. Passed: Array(Nothing) and UInt8</span><br><span class=\"line\">\thas([1,2], 3); -- 0</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\thasAll([], []), -- 1</span><br><span class=\"line\">\thasAll([1,NULL,NULL], [NULL]), -- 1</span><br><span class=\"line\">\thasAll([1,2,3], [1,2]), -- 1</span><br><span class=\"line\">\thasAll([1,2,2,3], [2]), -- 1</span><br><span class=\"line\">\thasAll(array(1,2,2,3), [2]), -- 1</span><br><span class=\"line\">\thasAll([1,2,3], [4,5]); -- 0</span><br><span class=\"line\">-- 多重数组（如下的二维数组）。</span><br><span class=\"line\">SELECT hasAll([[1, 2], [3, 4]], [[1, 2], [3, 5]]); -- 0</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\thasAny(array(1,2,3), array(1)), -- 1</span><br><span class=\"line\">\thasAny(array(1,2,3), array(1,4,56,80)), -- 1</span><br><span class=\"line\">\t-- []与array()是一样的含义，本质上是一直的。只不过[]更加简便而已。</span><br><span class=\"line\">\thasAny(array(), array()), -- 0</span><br><span class=\"line\">\thasAny([],[]), -- 0</span><br><span class=\"line\">\thasAny([1],[]), -- 0</span><br><span class=\"line\">\t-- 空数组跟null不是一样的对象</span><br><span class=\"line\">\thasAny([1,NULL],[]), -- 0</span><br><span class=\"line\">\thasAny([1,NULL],[NULL,2]); -- 1</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 9.返回数组指定元素的索引</span><br><span class=\"line\">-- indexOf(arr, x) 返回数组中第一个‘x’元素的索引（从1开始），如果‘x’元素不存在在数组中，则返回0。</span><br><span class=\"line\">SELECT indexOf([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], &#x27;one&#x27;); -- 1</span><br><span class=\"line\">SELECT indexOf([1, 2, 4], 4); -- 3</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tindexOf([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], &#x27;one&#x27;), -- 1</span><br><span class=\"line\">\tindexOf([&#x27;one&#x27;,NULL,NULL], NULL),-- 1返回第一个找到的元素的索引位置</span><br><span class=\"line\">\tindexOf([1, 2, 4], 4); -- 3</span><br><span class=\"line\">-- 数组元素的以第一个和最后一个元素。</span><br><span class=\"line\">SELECT length([12,3,4,4,4]);</span><br><span class=\"line\">SELECT array(12,22,31)[1];</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\t[23,43,565,2,32,34] AS arr</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarr[1], -- 去除数组中的第一个元素</span><br><span class=\"line\">\tarr[length(arr)]; -- 提取元素中的最后一个元素</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 10.计算数组中包含指定元素的个数</span><br><span class=\"line\">-- countEqual(arr, x) 返回数组中等于x的元素的个数。相当于arrayCount（elem - &gt; elem = x，arr）。</span><br><span class=\"line\">-- 注意：null值将作为单独的元素值处理。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tcountEqual([1, 2, 2, 2, 3, 4], 2), -- 3</span><br><span class=\"line\">\tcountEqual([1, 2, NULL, NULL], NULL); -- 2</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 11.arrayEnumerate(arr)  返回 Array [1, 2, 3, ..., length (arr) ] 此功能通常与ARRAY JOIN一起使用。它允许在应用ARRAY JOIN后为每个数组计算一次。</span><br><span class=\"line\">SELECT arrayEnumerate([1,20,20,3]); -- [1,2,3,4]</span><br><span class=\"line\">SELECT arrayEnumerate(array(11,20,13)); -- [1,2,3]</span><br><span class=\"line\">SELECT arrayEnumerate(array(11,20,13,NULL)); -- [1,2,3,4] 注意：null也算是一个元素。</span><br><span class=\"line\">--arrayEnumerateUniq(arr)  返回与源数组大小相同的数组，其中每个元素表示与其下标对应的源数组元素在源数组中出现的次数</span><br><span class=\"line\">SELECT arrayEnumerateUniq([1,1,2,2]); -- [1,2]</span><br><span class=\"line\">-- 12.删除数组的元素</span><br><span class=\"line\">-- arrayPopBack(array) 删除数组array的最后一项</span><br><span class=\"line\">SELECT arrayPopBack(array(1,2,3,0)) AS res; -- [1,2,3]</span><br><span class=\"line\">-- arrayPopFront(array) 从数组中删除第一项</span><br><span class=\"line\">SELECT arrayPopFront(array(0,1,2,3)) AS res; -- [1,2,3]</span><br><span class=\"line\">-- 13.添加数组的元素 arrayPushFront(array, single_value) single_value是单个值</span><br><span class=\"line\">SELECT arrayPushBack([1,2,3], 0) AS res; --  [1,2,3,0]</span><br><span class=\"line\">SELECT arrayPushFront([1,2,3], 0) AS res; --  [0,1,2,3]</span><br><span class=\"line\">-- 14.更改数组的长度  arrayResize(arr, size[, extender])</span><br><span class=\"line\">-- 如果arr的长度 &gt; size,则会对arr截取size的长度；</span><br><span class=\"line\">-- 如果arr的长度 &lt; size，则其余位置用对应数据类型的默认值填充。</span><br><span class=\"line\">-- 注意：extender含义是扩展元素的值。如果没有指定extender，则默认按照对应的数据类型的默认值进行赋值。否则按照extender进行填充。</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 5); -- [1,2,3,0,0]</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 2); -- [1,2]</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 3); -- [1,2,3]</span><br><span class=\"line\">--↓↓↓ RuntimeException: Parse exception: ByteFragment&#123;[[[1,2],[3,4],[5,6],[],[]]], start=0, len=25&#125;</span><br><span class=\"line\">SELECT arrayResize([array(1,2),array(3,4),array(5,6)], 5);</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 5, 12); -- [1,2,3,12,12]</span><br><span class=\"line\">SELECT arrayResize([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], 5); -- [&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;,&#x27;&#x27;,&#x27;&#x27;]</span><br><span class=\"line\">SELECT arrayResize([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], 5, &#x27;default&#x27;); -- [&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;,&#x27;default&#x27;,&#x27;default&#x27;]</span><br><span class=\"line\">-- 15.截取数组的部分元素，得到一个新的子数组</span><br><span class=\"line\">-- arraySlice(array, offset[, length])</span><br><span class=\"line\">--\t解释：</span><br><span class=\"line\">--\tarray: 数组，</span><br><span class=\"line\">--\toffset – 数组的偏移。正值表示左侧的偏移量，负值表示右侧的缩进值。数组下标从1开始。</span><br><span class=\"line\">--\tlength - 子数组的长度。如果指定负值，则该函数返回[offset，array_length - length。如果省略该值，则该函数返回[offset，the_end_of_array]。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarraySlice([1,2,3,4,5,6], 0, 3), -- 无返回值</span><br><span class=\"line\">\tarraySlice([1,2,NULL,5,6], 1, 3), -- [1,2,0]</span><br><span class=\"line\">\tarraySlice([&#x27;one&#x27;,&#x27;two&#x27;,NULL], 1, 3), -- [&#x27;one&#x27;,&#x27;two&#x27;,&#x27;&#x27;]</span><br><span class=\"line\"> \tarraySlice([1,2,3,4,5,6], 1, 3); -- [1,2,3]</span><br><span class=\"line\"> \t \t</span><br><span class=\"line\">-- 16.数组排序：arraySort([func,] arr, ……)</span><br><span class=\"line\">-- 注意：如果在字符串数组中，&#x27;&#x27;和NULL是需要特别对待的，&#x27;&#x27;需要放在最前面，而NULL则是按顺序存放到最后的。</span><br><span class=\"line\">-- arraySort是高阶函数。您可以将lambda函数作为第一个参数传递给它。在这种情况下，排序顺序由lambda函数的调用结果决定。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarraySort([&#x27;a&#x27;,&#x27;&#x27;,NULL,&#x27;c&#x27;,&#x27;b&#x27;]) AS hasNullempty1, --[&#x27;&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;&#x27;]  (第一个是&#x27;&#x27;,最后一个&#x27;&#x27;起始是NULL)</span><br><span class=\"line\">\tarraySort(array(&#x27;ac&#x27;,&#x27;ab&#x27;,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNull, -- [&#x27;ab&#x27;,&#x27;ac&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;]</span><br><span class=\"line\">\tarraySort(array(&#x27;ac&#x27;,&#x27;&#x27;,&#x27;ab&#x27;,NULL,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNullempty2, -- [&#x27;&#x27;,&#x27;ab&#x27;,&#x27;ac&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;,&#x27;&#x27;]</span><br><span class=\"line\">\tarraySort([5,4,3,2,1]) AS numSorted,-- [1,2,3,4,5] (数字排序)</span><br><span class=\"line\">\tarraySort([&#x27;ca&#x27;,&#x27;bb&#x27;,&#x27;ac&#x27;]) AS strSorted;-- [&#x27;ac&#x27;,&#x27;bb&#x27;,&#x27;ca&#x27;] (字符串排序)</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarraySort([NULL, 1, 3, NULL, 2]) AS sortedArr, -- [1,2,3,0,0]</span><br><span class=\"line\">\tarrayReverse(sortedArr) AS reverseSortdArr;-- [0,0,3,2,1]</span><br><span class=\"line\">-- 下面这种排序的实质，正数转成负数，再在数学上比较升序排序。</span><br><span class=\"line\">SELECT arraySort(x -&gt; -x, [1,2,3]) as res; -- [3,2,1] 降序：（高阶函数用法）</span><br><span class=\"line\">SELECT arraySort((x) -&gt; -x, [1,2,3]) as res; -- [3,2,1] 降序：（高阶函数用法）</span><br><span class=\"line\">SELECT arraySort(x -&gt; x, [5,4,3,1,2,3]) as res; -- [1,2,3,3,4,5] 升序：（高阶函数用法）</span><br><span class=\"line\">SELECT arraySort((x) -&gt; x, [5,4,3,1,2,3]) as res; -- [1,2,3,3,4,5] 升序：（高阶函数用法）</span><br><span class=\"line\">-- arraySort(lambda, arr1, arr2) </span><br><span class=\"line\">SELECT arraySort((x, y) -&gt; y, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res; -- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">SELECT arraySort((x, y) -&gt; -y, [0, 1, 2], [1, 2, 3]) as res; -- [2,1,0]</span><br><span class=\"line\">-- 再次提醒：NULL, NaN, Inf的排序顺序：</span><br><span class=\"line\">--\t含义：</span><br><span class=\"line\">--\t    -Inf 是数组中的第一个。</span><br><span class=\"line\">--\t    NULL 是数组中的最后一个。</span><br><span class=\"line\">--\t    NaN  在NULL的前面。</span><br><span class=\"line\">--\t    Inf  在NaN的前面。</span><br><span class=\"line\">-- 出现异常：RuntimeException: Parse exception: </span><br><span class=\"line\">-- \tByteFragment&#123;[[-inf,-4,1,2,3,inf,nan,nan,NULL,NULL]], start=0, len=37&#125;</span><br><span class=\"line\">SELECT arraySort([1, nan, 2, NULL, 3, nan, -4, NULL, inf, -inf]);</span><br><span class=\"line\">-- 17.数组翻转：arrayReverse([func,] arr, ……)</span><br><span class=\"line\">-- 如果是NULL的话在排序的过程中，根据数组的数据类型进行默认值填充。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayReverse(array(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,NULL)) AS hasOneNull, -- [&#x27;&#x27;,&#x27;c&#x27;,&#x27;b&#x27;,&#x27;a&#x27;]</span><br><span class=\"line\">\tarrayReverse(array(&#x27;ac&#x27;,&#x27;ab&#x27;,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNull, -- [&#x27;&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;ab&#x27;,&#x27;ac&#x27;]</span><br><span class=\"line\">\t--网格视图： [&#x27;[NULL]&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;,&#x27;ab&#x27;,&#x27;[NULL]&#x27;,&#x27;&#x27;,&#x27;ac&#x27;]；文本视图 ：[&#x27;&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;,&#x27;ab&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;ac&#x27;]</span><br><span class=\"line\">\tarrayReverse(array(&#x27;ac&#x27;,&#x27;&#x27;,NULL,&#x27;ab&#x27;,&#x27;&#x27;,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNullEmpty, </span><br><span class=\"line\">\tarrayReverse(array(NULL, 3, NULL, 2, 1)),-- [1,2,0,3,0]</span><br><span class=\"line\">\tarrayReverse([1,2,3,4]);-- [4,3,2,1]</span><br><span class=\"line\">-- 18.数组排序并翻转：arraySort([func,] arr, ...)</span><br><span class=\"line\">SELECT arrayReverseSort([1, 3, 3, 0]); -- [3,3,1,0]</span><br><span class=\"line\">SELECT arrayReverseSort([&#x27;hello&#x27;, &#x27;world&#x27;, &#x27;!&#x27;]); -- [&#x27;world&#x27;,&#x27;hello&#x27;,&#x27;!&#x27;]</span><br><span class=\"line\">--RuntimeException: Parse exception: ByteFragment&#123;[[inf,3,2,1,-4,-inf,nan,nan,NULL,NULL]], start=0, len=37&#125;</span><br><span class=\"line\">SELECT arrayReverseSort([1, nan, 2, NULL, 3, nan, -4, NULL, inf, -inf]) as res;-- [inf,3,2,1,-4,-inf,nan,nan,NULL,NULL]</span><br><span class=\"line\">-- 下面的执行顺序为：</span><br><span class=\"line\">--    1.首先，根据lambda函数的调用结果对源数组（[1, 2, 3]）进行排序。 结果是[3, 2, 1]。</span><br><span class=\"line\">--    2.反转上一步获得的数组。 所以，最终的结果是[1, 2, 3]。</span><br><span class=\"line\">SELECT arrayReverseSort((x) -&gt; -x, [1, 2, 3]) as res; -- [1,2,3]</span><br><span class=\"line\">SELECT arrayReverseSort((x) -&gt; x, [1, 2, 3]) as res; -- [1,2,3]</span><br><span class=\"line\">-- 下面的执行顺序为：</span><br><span class=\"line\">--    1.首先，根据lambda函数的调用结果对源数组（[&#x27;hello&#x27;，&#x27;world&#x27;]）进行排序。 其中，在第二个数组（[2,1]）中定义了源数组中相应元素的排序键。 所以，排序结果[&#x27;world&#x27;，&#x27;hello&#x27;]。</span><br><span class=\"line\">--    2.反转上一步骤中获得的排序数组。 所以，最终的结果是[&#x27;hello&#x27;，&#x27;world&#x27;]。</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; y, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;-- [&#x27;hello&#x27;,&#x27;world&#x27;]</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; -y, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;-- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; x, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;-- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">--出现异常：Illegal type String of argument </span><br><span class=\"line\">--SELECT arrayReverseSort((x, y) -&gt; -x, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; x, [&#x27;hello&#x27;, &#x27;world&#x27;], [1, 2]) as res;-- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">-- 19.统计数组中不重复元素的个数。arrayUniq(arr,……)</span><br><span class=\"line\">-- ① 如果传递一个参数，则计算数组中不同元素的数量。</span><br><span class=\"line\">-- ② 如果传递了多个参数，则它计算多个数组中相应位置的不同元素元组的数量</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayUniq([1,2,3]), -- 3</span><br><span class=\"line\">\tarrayUniq([1,2,2,2,3]); -- 3</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayUniq([1,2,3],[2,3,4]),</span><br><span class=\"line\">\tarrayUniq([1,2,2],[1,3,3]);</span><br><span class=\"line\">-- 20.数组的特殊功能：arrayJoin(arr)  这是一个非常有用的函数。</span><br><span class=\"line\">-- 解释：此函数将数组作为参数，并将该行在结果集中复制数组元素个数</span><br><span class=\"line\">SELECT arrayJoin([1, 2, 3] AS src) AS dst, &#x27;Hello&#x27;, src;</span><br><span class=\"line\"> -- 每个元素扩大两倍；</span><br><span class=\"line\">SELECT arrayJoin([1,2,3]) * 2;</span><br><span class=\"line\">SELECT arrayJoin([-1,-2,0,1,2]) * 2;</span><br><span class=\"line\">--出现异常： Illegal types Array(UInt8) and Array(UInt8) of arguments of function multiply</span><br><span class=\"line\">--SELECT multiply(array(1,2,3), 2); </span><br><span class=\"line\">SELECT multiply(arrayJoin([-1,-2,0,1,2]), 2);</span><br><span class=\"line\"> -- 每个元素缩小两倍</span><br><span class=\"line\">SELECT arrayJoin([-4,-2,0,2,4]) / 2;</span><br><span class=\"line\">SELECT divide(arrayJoin([-4,-2,0,2,4]) , 2);</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 21.arrayDifference(arr)</span><br><span class=\"line\">-- 返回一个数组，其中包含所有相邻元素对之间的差值</span><br><span class=\"line\">SELECT arrayDifference([1,2,3,4]);-- [0,1,1,1]</span><br><span class=\"line\">SELECT arrayDifference([1,3,10,50]);-- [0,2,7,40]</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 22. arrayDistinct(arr)返回一个包含所有数组中不同元素的数组.</span><br><span class=\"line\">-- 类似于java的Set集合，对list集合进行去重。</span><br><span class=\"line\">SELECT arrayDistinct(array(1,2,3,4,4,4)); -- [1,2,3,4]</span><br><span class=\"line\">SELECT arrayDistinct([1,2,2,3,4,2,2,5,4,5]); -- [1,2,3,4,5]</span><br><span class=\"line\">SELECT arrayDistinct(array(0,1,NULL,3,4,4,4)); -- [0,1,3,4]</span><br><span class=\"line\">-- 数组去重统计元素个数</span><br><span class=\"line\">SELECT uniq(arrayJoin([1,2,3,6,3])); -- 4 表示数组去重后元素的个数</span><br><span class=\"line\">SELECT uniqArray([1,2,3,4,1,2,3,4]); -- 4 表示数组去重后元素的个数</span><br><span class=\"line\">-- 数组元素累计</span><br><span class=\"line\">SELECT sumArray([1,2,3,4,5]);-- 15</span><br><span class=\"line\">SELECT sum(arraySum([1,2,3,4,5])); -- 15</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 23. arrayEnumerateDense(arr) 返回与源数组大小相同的数组，指示每个元素首次出现在源数组中的位置</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarrayEnumerateDense([10,20,20,10,30]) AS numArrEnumDense,-- [1,2,2,1,3]</span><br><span class=\"line\">\t-- [1,1,2,3,4,1,3,5,5]</span><br><span class=\"line\">\tarrayEnumerateDense([10,10,2,12,3,10,12,NULL,NULL]) as arrEnumDenseHasNull,</span><br><span class=\"line\">\t-- [1,2,1,1,2,3]</span><br><span class=\"line\">\tarrayEnumerateDense([10,20,10,10,20,30]) AS arrEnumDese2;</span><br><span class=\"line\">-- 24. arrayIntersect(arr,……) 返回所有数组元素的交集。</span><br><span class=\"line\">-- 如果arr的数目只有一个，则返回它本身；如果有多个数组,则返回所有数组中元素的交集。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\t-- 注意：最后得到的数组元素的顺序。（有什么影响吗？）</span><br><span class=\"line\">\tarrayIntersect([&#x27;one&#x27;,&#x27;two&#x27;],[&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;]) as uniStrArr1, -- [&#x27;two&#x27;,&#x27;one&#x27;]</span><br><span class=\"line\">\tarrayIntersect([&#x27;aaa&#x27;,&#x27;bbb&#x27;],[&#x27;bbb&#x27;,&#x27;aaa&#x27;,&#x27;three&#x27;]) as uniStrArr2, -- [&#x27;bbb&#x27;,&#x27;aaa&#x27;]</span><br><span class=\"line\">\tarrayIntersect([1,2],[1,2,3]) as uniArr1, -- [1,2]</span><br><span class=\"line\">\tarrayIntersect([1,2],[1,2,3],[2,3,4],[2,3,4]) as uniArr2; -- 2</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarrayIntersect([1,2], [3,4]), -- []</span><br><span class=\"line\">\tarrayIntersect([1,2]);-- [1,2]</span><br><span class=\"line\">-- 25.arrayReduce(agg_func, arr1, ...)</span><br><span class=\"line\">-- agg_func 为聚合函数，传入到数组当中。</span><br><span class=\"line\">-- 将聚合函数应用于数组并返回其结果.如果聚合函数具有多个参数，则此函数可应用于相同大小的多个数组。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayReduce(&#x27;max&#x27;, [1,2,3]) AS minNum,--最大值 3</span><br><span class=\"line\">\tarrayReduce(&#x27;min&#x27;, [1,2,3]) AS maxNum,--最小值 1</span><br><span class=\"line\">\tarrayReduce(&#x27;sum&#x27;, [1,2,3]) AS sumNum;--求和 6</span><br><span class=\"line\">-- 十三、 字符串查分合并函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串拆分合并函数</span><br><span class=\"line\">-- 1.splitByChar(separator, s) 将字符串以‘separator’拆分成多个子串。</span><br><span class=\"line\">-- ‘separator’必须为仅包含一个字符的字符串常量。 返回拆分后的子串的数组。</span><br><span class=\"line\">--  如果分隔符出现在字符串的开头或结尾，或者如果有多个连续的分隔符，则将在对应位置填充空的子串。</span><br><span class=\"line\">SELECT splitByChar(&#x27;,&#x27;, &#x27;hello,world!&#x27;); -- [&#x27;hello&#x27;,&#x27;world!&#x27;]</span><br><span class=\"line\">--下面异常：Illegal separator for function splitByChar. Must be exactly one byte.</span><br><span class=\"line\">--SELECT splitByChar(&#x27;or&#x27;, &#x27;hello,world!&#x27;);</span><br><span class=\"line\">-- 2.splitByString(separator, s)</span><br><span class=\"line\">-- 与上面相同，但它使用多个字符的字符串作为分隔符。 该字符串必须为非空</span><br><span class=\"line\">SELECT splitByString(&#x27;or&#x27;,&#x27;goodorniceorgreat&#x27;); -- [&#x27;good&#x27;,&#x27;nice&#x27;,&#x27;great&#x27;]</span><br><span class=\"line\">-- 3.alphaTokens(s)  从范围a-z和A-Z中选择连续字节的子字符串。返回子字符串数组</span><br><span class=\"line\">SELECT alphaTokens(&#x27;abca1abc&#x27;); -- [&#x27;abca&#x27;,&#x27;abc&#x27;]</span><br><span class=\"line\">SELECT alphaTokens(&#x27;abc1232abc2wer3rtty&#x27;); -- [&#x27;abc&#x27;,&#x27;abc&#x27;,&#x27;wer&#x27;,&#x27;rtty&#x27;]</span><br><span class=\"line\">-- 4.数组元素合并函数：arrayStringConcat(arr[, sparator])</span><br><span class=\"line\">-- 使用separator将数组中列出的字符串拼接起来。</span><br><span class=\"line\">-- ‘separator’是一个可选参数：一个常量字符串，默认情况下设置为空字符串。 返回拼接后的字符串</span><br><span class=\"line\">SELECT arrayStringConcat([1,2,3], &#x27;-&#x27;); -- 出现异常，要求数组必须是字符串string类型的元素</span><br><span class=\"line\">SELECT arrayStringConcat([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;]); -- onetwothree</span><br><span class=\"line\">SELECT arrayStringConcat([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], &#x27;-&#x27;); -- one-two-three</span><br><span class=\"line\">SELECT arrayStringConcat([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;,&#x27;&#x27;], &#x27;-&#x27;);--  one-two-three- 注意：NULL不能存在arr中</span><br><span class=\"line\"> </span><br><span class=\"line\">--十四、位操作符</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 位操作符</span><br><span class=\"line\">--位操作函数适用于UInt8，UInt16，UInt32，UInt64，Int8，Int16，Int32，Int64，Float32或Float64中的任何类型。</span><br><span class=\"line\">--结果类型是一个整数，其位数等于其参数的最大位。</span><br><span class=\"line\">--如果至少有一个参数为有符数字，则结果为有符数字。如果参数是浮点数，则将其强制转换为Int64。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tbitAnd(1,0), -- 0</span><br><span class=\"line\">\tbitAnd(1,1), -- 1</span><br><span class=\"line\">\tbitAnd(1,2), -- 0</span><br><span class=\"line\">\tbitAnd(-1,0), -- 0</span><br><span class=\"line\">\tbitAnd(-1,-2), -- -2</span><br><span class=\"line\">\tbitAnd(-10,-1), -- -10</span><br><span class=\"line\">\tbitOr(1,2), -- 3</span><br><span class=\"line\">\tbitOr(1,0), -- 1</span><br><span class=\"line\">\tbitOr(2,0), -- 2</span><br><span class=\"line\">\tbitOr(0,2); -- 2</span><br><span class=\"line\">SELECT bitXor(1, 2), bitXor(20, 15), bitNot(2);-- 3 27 253</span><br><span class=\"line\"> </span><br><span class=\"line\">--十五、Hash函数：可以用于将元素不可逆的伪随机打乱。</span><br><span class=\"line\">-- 注意：伪随机！</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\t-- 计算字符串的MD5值。（ 如果您不需要一定使用MD5，请使用‘sipHash64’函数。）</span><br><span class=\"line\">\thalfMD5(&#x27;HELLO WORLD!&#x27;),</span><br><span class=\"line\">\thalfMD5(12);</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tMD5(&#x27;drew-zero,78967&#x27;);</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\t-- 为任何类型的整数计算32位的哈希。 这是相对高效的非加密Hash函数</span><br><span class=\"line\">\tintHash32(1221232132132) AS intHash32,</span><br><span class=\"line\">\t-- 推荐：从任何类型的整数计算64位哈希码。 它的工作速度比intHash32函数快。</span><br><span class=\"line\">\tintHash64(1221232132132) AS intHash64,</span><br><span class=\"line\">\t-- 计算任意数量字符串的CityHash64或使用特定实现的Hash函数计算任意数量其他类型的Hash。</span><br><span class=\"line\">\tcityHash64(&#x27;username&#x27;) AS cityHash64,</span><br><span class=\"line\">\t-- 1.使用sha1或者sha224加密的话，只能用于字符串</span><br><span class=\"line\">\t-- 2.字符串 需使用单引号。</span><br><span class=\"line\">\tSHA1(&#x27;1232131&#x27;) AS sha1,</span><br><span class=\"line\">\tSHA224(&#x27;1232131&#x27;) AS sha224,</span><br><span class=\"line\">\tSHA256(&#x27;DREW-ZERO&#x27;) AS sha256;</span><br><span class=\"line\">-- URLHash(url[, N]) 一种快速的非加密哈希函数，用于规范化的从URL获得的字符串</span><br><span class=\"line\">--  从一个字符串计算一个哈希，如果结尾存在尾随符号/，？或#则忽略。 URLHash（s，N） </span><br><span class=\"line\">-- 计算URL层次结构中字符串到N级别的哈希值，如果末尾存在尾随符号/，？或#则忽略。 URL的层级与URLHierarchy中的层级相同</span><br><span class=\"line\">-- 用处：此函数被用于Yandex.Metrica。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tURLHash(&#x27;www.baidu.com&#x27;), \t -- 11390370829909720855</span><br><span class=\"line\">\tURLHash(&#x27;www.baidu.com&#x27;, 0), -- 11390370829909720855</span><br><span class=\"line\">\t-- </span><br><span class=\"line\">\tURLHash(&#x27;www.baidu.com&#x27;, 1); -- 11160318154034397263</span><br><span class=\"line\">-- farmHash64(s)  计算字符串的FarmHash64。 接受一个String类型的参数。返回UInt64。</span><br><span class=\"line\">SELECT farmHash64(&#x27;www.runoob.com&#x27;); -- 6668483584160323388</span><br><span class=\"line\">-- javaHash(s) 计算字符串的JavaHash。 接受一个String类型的参数。返回Int32。</span><br><span class=\"line\">SELECT javaHash(&#x27;www.baidu.com&#x27;); -- 270263191</span><br><span class=\"line\">-- hiveHash(s) 计算字符串的HiveHash。 接受一个String类型的参数。返回Int32。 与JavaHash相同，但不会返回负数</span><br><span class=\"line\">SELECT hiveHash(&#x27;www.baidu.com&#x27;); -- 270263191</span><br><span class=\"line\"> </span><br><span class=\"line\">--十六、随机函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 随机函数</span><br><span class=\"line\">-- 解释：随机函数使用非加密方式生成【伪随机】数字。</span><br><span class=\"line\">-- ① 所有随机函数都只接受一个参数或不接受任何参数。</span><br><span class=\"line\">-- ② 您可以向它传递任何类型的参数，但传递的参数将不会使用在任何随机数生成过程中。</span><br><span class=\"line\">-- ③  此参数的唯一目的是防止公共子表达式消除，以便在相同的查询中使用相同的随机函数生成不同的随机数</span><br><span class=\"line\">-- rand() 函数：返回一个UInt32类型的随机数字，所有UInt32类型的数字被生成的概率均相等。</span><br><span class=\"line\">-- rand64() 函数：返回一个UInt64类型的随机数字，所有UInt64类型的数字被生成的概率均相等。</span><br><span class=\"line\">-- randConstant() 函数：返回一个UInt32类型的随机数字，该函数不同之处在于仅为每个数据块参数一个随机数。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\trand(), -- 1751687411</span><br><span class=\"line\">\trand(10), -- 1124981728</span><br><span class=\"line\">\trand64(),</span><br><span class=\"line\">\trand64(10),</span><br><span class=\"line\">\trandConstant(),</span><br><span class=\"line\">\trandConstant();</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 十七、编码函数：</span><br><span class=\"line\">-- hex(), unhex(), UUIDStringToNum(str), UUIDNumToString(str),bitmaskToList(num) ...</span><br><span class=\"line\">-- 1.hex函数编码</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\t-- 68656C6C6F20776F726C64212C68656C6C6F20636C69636B686F757365</span><br><span class=\"line\">\thex(&#x27;hello world!,hello clickhouse&#x27;) AS hexStr,</span><br><span class=\"line\">\thex(now()) AS hexDatetime, -- 5D414BA2</span><br><span class=\"line\">\thex(toDate(now())) AS hexDate; --46BC</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 2.接受包含36个字符的字符串，格式为“123e4567-e89b-12d3-a456-426655440000”，并将其转化为FixedString（16）返回</span><br><span class=\"line\">SELECT UUIDStringToNum(&#x27;123e4567-e89b-12d3-a456-426655440000&#x27;);</span><br><span class=\"line\">-- 3. 接受一个整数。返回一个UInt64类型数组，其中包含一组2的幂列表，其列表中的所有值相加等于这个整数。数组中的数字按升序排列。</span><br><span class=\"line\">-- bitmaskToArray(num)</span><br><span class=\"line\">SELECT bitmaskToArray(10); -- [2,8]</span><br><span class=\"line\">SELECT bitmaskToArray(100); -- [4,32,64]</span><br><span class=\"line\">-- 4.接受一个整数。返回一个字符串，其中包含一组2的幂列表，其列表中的所有值相加等于这个整数。列表使用逗号分割，按升序排列。</span><br><span class=\"line\">-- bitmaskToList(num) </span><br><span class=\"line\">SELECT bitmaskToList(10); -- 2,8</span><br><span class=\"line\">SELECT bitmaskToList(100); -- 4,32,64</span><br><span class=\"line\">SELECT bitmaskToList(0); -- &#x27;&#x27; 空字符串</span><br><span class=\"line\"> </span><br><span class=\"line\">--十八、UUID函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; UUID函数</span><br><span class=\"line\">-- 1.generateUUIDv4()  返回 UUID类型的值。</span><br><span class=\"line\">SELECT generateUUIDv4() as randomUUID; -- 随机生成一个UUIDv4的字符串（b6940dfe-0dc9-4788-bac7-319d13235a2e）</span><br><span class=\"line\">SELECT replaceAll(toString(generateUUIDv4()), &#x27;-&#x27;, &#x27;&#x27;) AS replaceUUID; -- 9d1947ea4fcf450da5391feb6142cab6</span><br><span class=\"line\">-- 2.toUUID(s) 将string类型的值 转换成UUID类型的值</span><br><span class=\"line\">SELECT toUUID(&#x27;61f0c404-5cb3-11e7-907b-a6006ad3dba0&#x27;) AS uuid;</span><br><span class=\"line\">-- 3.接受一个String类型的值，其中包含36个字符且格式为xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx，</span><br><span class=\"line\">--   将其转换为UUID的数值并以FixedString(16)将其返回。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">    &#x27;612f3c40-5d3b-217e-707b-6a546a3d7b29&#x27; AS uuid, -- 612f3c40-5d3b-217e-707b-6a546a3d7b29</span><br><span class=\"line\">    UUIDStringToNum(uuid) AS bytes; --a/&lt;@];!~p&#123;jTj=&#123;)</span><br><span class=\"line\">    </span><br><span class=\"line\">-- 4. UUIDNumToString() 接受一个FixedString(16)类型的值，返回其对应的String表现形式。</span><br><span class=\"line\">SELECT &#x27;a/&lt;@];!~p&#123;jTj=&#123;)&#x27; AS bytes,</span><br><span class=\"line\">    UUIDNumToString(toFixedString(bytes, 16)) AS uuid;</span><br><span class=\"line\">--- 二十、 URL函数：所有这些功能都不遵循RFC。它们被最大程度简化以提高性能。</span><br><span class=\"line\">--- 什么事RFC？</span><br><span class=\"line\">----  Request For Comments（RFC），是一系列以编号排定的文件。文件收集了有关互联网相关信息，以及UNIX和互联网社区的软件文件。</span><br><span class=\"line\">-- 1. 截取函数：如果URL中没有要截取的内容则返回空字符串。</span><br><span class=\"line\">SELECT protocol(&#x27;http://www.baidu.com&#x27;);-- http</span><br><span class=\"line\">SELECT protocol(&#x27;https://www.baidu.com&#x27;);-- https</span><br><span class=\"line\">SELECT protocol(&#x27;www.baidu.com&#x27;);-- &#x27;&#x27;</span><br><span class=\"line\">-- 获取域名。</span><br><span class=\"line\">SELECT domain(&#x27;http://www.baidu.com&#x27;); -- www.baidu.com</span><br><span class=\"line\">SELECT domain(&#x27;https://www.google.com.cn&#x27;); -- www.google.com.cn</span><br><span class=\"line\">-- 返回域名并删除第一个‘www.’</span><br><span class=\"line\">SELECT domainWithoutWWW(&#x27;http://www.baidu.com&#x27;);-- baidu.com</span><br><span class=\"line\">SELECT domainWithoutWWW(&#x27;www.baidu.com&#x27;);-- &#x27;&#x27;</span><br><span class=\"line\">-- 返回顶级域名。例如：.ru</span><br><span class=\"line\">SELECT topLevelDomain(&#x27;http://www.runoob.com.cn&#x27;); -- cn</span><br><span class=\"line\">SELECT topLevelDomain(&#x27;https://www.huse.edn&#x27;); -- edu</span><br><span class=\"line\">-- 返回“第一个有效子域名”</span><br><span class=\"line\">--\t如果顶级域名为‘com’，‘net’，‘org’或者‘co’则第一个有效子域名为二级域名。否则则返回三级域名</span><br><span class=\"line\">SELECT firstSignificantSubdomain(&#x27;https://news.yandex.com.tr/&#x27;); -- yandex</span><br><span class=\"line\">-- 返回包含顶级域名与第一个有效子域名之间的内容(参阅上面内容)</span><br><span class=\"line\">SELECT cutToFirstSignificantSubdomain(&#x27;https://news.yandex.com.tr/&#x27;); -- yandex.com.tr</span><br><span class=\"line\">-- 返回URL路径</span><br><span class=\"line\">SELECT path(&#x27;https://blog.csdn.net/u012111465/article/details/85250030&#x27;);-- /u012111465/article/details/85250030</span><br><span class=\"line\">-- 与上面相同，但包括请求参数和fragment。</span><br><span class=\"line\">SELECT pathFull(&#x27;https://clickhouse.yandex/#quick-start&#x27;); -- /#quick-start</span><br><span class=\"line\">-- 返回请求参数。例如：page=1&amp;lr=213。请求参数不包含问号已经# 以及# 之后所有的内容。</span><br><span class=\"line\">SELECT queryString(&#x27;http://www.baidu.com/?page=1&amp;lr=234&#x27;); -- page=1&amp;lr=234 (根据？确定)</span><br><span class=\"line\">SELECT queryString(&#x27;http://www.baidu.com/page=1&amp;lr=234&#x27;); -- &#x27;&#x27;</span><br><span class=\"line\">-- 返回URL的fragment标识。fragment不包含#。</span><br><span class=\"line\">SELECT fragment(&#x27;https://clickhouse.yandex/#quick-start&#x27;); -- quick-start</span><br><span class=\"line\">-- 返回请求参数和fragment标识。例如：page=1#29390。</span><br><span class=\"line\">SELECT queryStringAndFragment(&#x27;https://www.baidu.com/s?ie=utf-8&amp;rsv_sug7=100#ei-ai&#x27;); -- ie=utf-8&amp;rsv_sug7=100#ei-ai</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 2. 删除URL中的部分内容 (如果URL中不包含指定的部分，则URL不变。)</span><br><span class=\"line\">SELECT cutWWW(&#x27;www.baidu.com&#x27;);-- www.baidu.com</span><br><span class=\"line\">SELECT cutWWW(&#x27;https://www.baidu.com&#x27;);-- www.baidu.com</span><br><span class=\"line\">SELECT cutWWW(&#x27;https://www.baidu.com&#x27;);-- www.baidu.com</span><br><span class=\"line\">-- 删除请求参数</span><br><span class=\"line\">SELECT cutQueryString(&#x27;http://www.baidu.com/1?page=1&#x27;); -- http://www.baidu.com/1</span><br><span class=\"line\">-- 删除fragment标识。#同样也会被删除。</span><br><span class=\"line\">SELECT cutFragment(&#x27;http://www.baidu.com/#quick-demo&#x27;); -- http://www.baidu.com/</span><br><span class=\"line\">-- 删除请求参数以及fragment标识。问号以及#也会被删除。</span><br><span class=\"line\">SELECT cutQueryStringAndFragment(&#x27;http://www.baidu.com/1?page=23#we&#x27;); -- http://www.baidu.com/1</span><br><span class=\"line\">-- cutURLParameter(URL, name) 删除URL中名称为‘name’的参数。下面例子中的参数是：&amp;之后，resv,name</span><br><span class=\"line\">SELECT cutURLParameter(&#x27;http://www.baidu.com/1?page=1#erre&amp;resv=23&amp;name=user&#x27;,&#x27;resv&#x27;);</span><br><span class=\"line\"> </span><br><span class=\"line\">--二十一、IP函数</span><br><span class=\"line\"> </span><br><span class=\"line\">--二十二、条件函数</span><br><span class=\"line\">SELECT IF(12 &gt; 10 , 12, 20);</span><br><span class=\"line\">SELECT 12 &gt; 10 ? 12 : 10;</span><br><span class=\"line\">SELECT if(greater(12, 10), 12, 10);</span><br><span class=\"line\"> </span><br><span class=\"line\">--二十三、操作符函数替换</span><br><span class=\"line\">-- clickhouse自带的计算操作符函数（对接mybatis的时候不用将“&lt;”之类的符号转换成 “age1 &lt;![CDATA[ &lt; ]] 2&gt;”）</span><br><span class=\"line\">-- 1.等于(注意函数名称的大小，严格区分大小写)</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tequals(&#x27;hello&#x27;,&#x27;hello&#x27;), -- 1</span><br><span class=\"line\">\tequals(&#x27;ab&#x27;,&#x27;ba&#x27;); -- 0</span><br><span class=\"line\">-- 2.不等于</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tnotEquals(&#x27;a&#x27;,&#x27;b&#x27;), -- 1</span><br><span class=\"line\">\tnotEquals(&#x27;a&#x27;,&#x27;a&#x27;), -- 0</span><br><span class=\"line\">\tnotEquals(12, 12), -- 1</span><br><span class=\"line\">\tnotEquals(12, 1010); -- 0</span><br><span class=\"line\">-- 3.大于( 如果前者大于后者，则返回1；否则返回0)</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tgreater(12, 10), -- 1 </span><br><span class=\"line\">\tgreater(10, 12), -- 0</span><br><span class=\"line\">\tgreater(12, 12), -- 0</span><br><span class=\"line\">\tgreater(&#x27;b&#x27;,&#x27;a&#x27;), -- 1</span><br><span class=\"line\">\tgreater(&#x27;a&#x27;,&#x27;b&#x27;); -- 0</span><br><span class=\"line\">-- 3.1 扩展：提取两者中最大的值</span><br><span class=\"line\">SELECT greatest(12,11); -- 12</span><br><span class=\"line\">-- 4.小于（如果前者小于后者，则返回1；否则返回0）</span><br><span class=\"line\">SELECT less(12,23); -- 1</span><br><span class=\"line\">SELECT less(120,23); -- 0</span><br><span class=\"line\">-- 5.大于或等于</span><br><span class=\"line\">SELECT greaterOrEquals(12,12); -- 1</span><br><span class=\"line\">SELECT greaterOrEquals(120,12); -- 1</span><br><span class=\"line\">-- 6.小于或等于</span><br><span class=\"line\">SELECT lessOrEquals(12,12); -- 1</span><br><span class=\"line\">SELECT lessOrEquals(12,129); -- 1</span><br><span class=\"line\">-- ===== String操作</span><br><span class=\"line\">-- *. a LIKE s</span><br><span class=\"line\">SELECT like(&#x27;a&#x27;, &#x27;abcd&#x27;); -- 0</span><br><span class=\"line\">SELECT like(&#x27;a&#x27;, &#x27;a&#x27;); -- 1</span><br></pre></td></tr></table></figure>\n</div>","more":"<div class=\"story post-story\"><h2 id=\"Clickhouse函数指南\"><a href=\"#Clickhouse函数指南\" class=\"headerlink\" title=\"Clickhouse函数指南\"></a>Clickhouse函数指南</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br><span class=\"line\">852</span><br><span class=\"line\">853</span><br><span class=\"line\">854</span><br><span class=\"line\">855</span><br><span class=\"line\">856</span><br><span class=\"line\">857</span><br><span class=\"line\">858</span><br><span class=\"line\">859</span><br><span class=\"line\">860</span><br><span class=\"line\">861</span><br><span class=\"line\">862</span><br><span class=\"line\">863</span><br><span class=\"line\">864</span><br><span class=\"line\">865</span><br><span class=\"line\">866</span><br><span class=\"line\">867</span><br><span class=\"line\">868</span><br><span class=\"line\">869</span><br><span class=\"line\">870</span><br><span class=\"line\">871</span><br><span class=\"line\">872</span><br><span class=\"line\">873</span><br><span class=\"line\">874</span><br><span class=\"line\">875</span><br><span class=\"line\">876</span><br><span class=\"line\">877</span><br><span class=\"line\">878</span><br><span class=\"line\">879</span><br><span class=\"line\">880</span><br><span class=\"line\">881</span><br><span class=\"line\">882</span><br><span class=\"line\">883</span><br><span class=\"line\">884</span><br><span class=\"line\">885</span><br><span class=\"line\">886</span><br><span class=\"line\">887</span><br><span class=\"line\">888</span><br><span class=\"line\">889</span><br><span class=\"line\">890</span><br><span class=\"line\">891</span><br><span class=\"line\">892</span><br><span class=\"line\">893</span><br><span class=\"line\">894</span><br><span class=\"line\">895</span><br><span class=\"line\">896</span><br><span class=\"line\">897</span><br><span class=\"line\">898</span><br><span class=\"line\">899</span><br><span class=\"line\">900</span><br><span class=\"line\">901</span><br><span class=\"line\">902</span><br><span class=\"line\">903</span><br><span class=\"line\">904</span><br><span class=\"line\">905</span><br><span class=\"line\">906</span><br><span class=\"line\">907</span><br><span class=\"line\">908</span><br><span class=\"line\">909</span><br><span class=\"line\">910</span><br><span class=\"line\">911</span><br><span class=\"line\">912</span><br><span class=\"line\">913</span><br><span class=\"line\">914</span><br><span class=\"line\">915</span><br><span class=\"line\">916</span><br><span class=\"line\">917</span><br><span class=\"line\">918</span><br><span class=\"line\">919</span><br><span class=\"line\">920</span><br><span class=\"line\">921</span><br><span class=\"line\">922</span><br><span class=\"line\">923</span><br><span class=\"line\">924</span><br><span class=\"line\">925</span><br><span class=\"line\">926</span><br><span class=\"line\">927</span><br><span class=\"line\">928</span><br><span class=\"line\">929</span><br><span class=\"line\">930</span><br><span class=\"line\">931</span><br><span class=\"line\">932</span><br><span class=\"line\">933</span><br><span class=\"line\">934</span><br><span class=\"line\">935</span><br><span class=\"line\">936</span><br><span class=\"line\">937</span><br><span class=\"line\">938</span><br><span class=\"line\">939</span><br><span class=\"line\">940</span><br><span class=\"line\">941</span><br><span class=\"line\">942</span><br><span class=\"line\">943</span><br><span class=\"line\">944</span><br><span class=\"line\">945</span><br><span class=\"line\">946</span><br><span class=\"line\">947</span><br><span class=\"line\">948</span><br><span class=\"line\">949</span><br><span class=\"line\">950</span><br><span class=\"line\">951</span><br><span class=\"line\">952</span><br><span class=\"line\">953</span><br><span class=\"line\">954</span><br><span class=\"line\">955</span><br><span class=\"line\">956</span><br><span class=\"line\">957</span><br><span class=\"line\">958</span><br><span class=\"line\">959</span><br><span class=\"line\">960</span><br><span class=\"line\">961</span><br><span class=\"line\">962</span><br><span class=\"line\">963</span><br><span class=\"line\">964</span><br><span class=\"line\">965</span><br><span class=\"line\">966</span><br><span class=\"line\">967</span><br><span class=\"line\">968</span><br><span class=\"line\">969</span><br><span class=\"line\">970</span><br><span class=\"line\">971</span><br><span class=\"line\">972</span><br><span class=\"line\">973</span><br><span class=\"line\">974</span><br><span class=\"line\">975</span><br><span class=\"line\">976</span><br><span class=\"line\">977</span><br><span class=\"line\">978</span><br><span class=\"line\">979</span><br><span class=\"line\">980</span><br><span class=\"line\">981</span><br><span class=\"line\">982</span><br><span class=\"line\">983</span><br><span class=\"line\">984</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-- 零、检测函数类型（clickhouse中数据的类型）</span><br><span class=\"line\">SELECT toTypeName(0);-- UInt8(三位数为8)</span><br><span class=\"line\">SELECT toTypeName(-0);-- Int8</span><br><span class=\"line\">SELECT toTypeName(-343);-- Int16</span><br><span class=\"line\">SELECT toTypeName(12.43); -- Float64(默认浮点型的数据为64)，所以一般在处理浮点型的数据的时候尽量转成toFloat32(12.43)</span><br><span class=\"line\">SELECT toTypeName(12.34343); -- Float64</span><br><span class=\"line\">SELECT toTypeName(toDateTime(1502396027)); -- DateTime</span><br><span class=\"line\">-- 一、算数函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 算数函数(数学上的计算)</span><br><span class=\"line\">--求和</span><br><span class=\"line\">SELECT plus(12, 21), plus(10, -10), plus(-10, -10);</span><br><span class=\"line\">--差值</span><br><span class=\"line\">SELECT minus(10, 5), minus(10, -10),minus(-10, -10);</span><br><span class=\"line\">--积</span><br><span class=\"line\">SELECT multiply(12, 2), multiply(12, -2), multiply(-12, -2);</span><br><span class=\"line\">--平均值</span><br><span class=\"line\">SELECT divide(12, 4), divide(10, 3), divide(2, 4), divide(-4, -2), divide(-4, 2), divide(-4.5, 3);</span><br><span class=\"line\">SELECT intDiv(10, 3), divide(10, 3); -- 3, 3.333(保留四位有效数字)</span><br><span class=\"line\">SELECT divide(10, 0), divide(-10, 0); -- 出现无穷大字符“ ∞ ”或“ -∞ ”</span><br><span class=\"line\">SELECT divide(0, 0); -- 特殊字符（类似乱码）</span><br><span class=\"line\">SELECT intDivOrZero(10, 0); -- 0</span><br><span class=\"line\">--求余数</span><br><span class=\"line\">SELECT modulo(10, 3); --1</span><br><span class=\"line\">SELECT modulo(10.5, 3); --1</span><br><span class=\"line\">--取反</span><br><span class=\"line\">SELECT negate(10), negate(-10); -- -10\t10</span><br><span class=\"line\">--绝对值</span><br><span class=\"line\">SELECT abs(-10), abs(10);</span><br><span class=\"line\">--最大公约数</span><br><span class=\"line\">SELECT gcd(12, 24), gcd(-12, -24), gcd(-12, 24);</span><br><span class=\"line\">--最小公倍数</span><br><span class=\"line\">SELECT lcm(12, 24), lcm(-12, -24), lcm(-3, 4);</span><br><span class=\"line\">-- 二、比较函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 比较函数(始终返回0表示false 或   1表示true)</span><br><span class=\"line\">SELECT 12 == 12, 12 != 10, 12 == 132, 12 != 12, 12 &lt;&gt; 12;</span><br><span class=\"line\">SELECT equals(12, 12), notEquals(12, 10), equals(12, 10), notEquals(12,123);</span><br><span class=\"line\">SELECT greater(12, 10), greater(10, 12), greater(12, 12);-- 前者是否大于后者</span><br><span class=\"line\">SELECT greaterOrEquals(12,10), greaterOrEquals(12,12);-- 前者是否大于或等于后者</span><br><span class=\"line\">SELECT less(12, 21), less(12, 10), less(120, 120);-- 前者是否小于后者</span><br><span class=\"line\">SELECT lessOrEquals(12, 120), lessOrEquals(12, 12);-- 前世是否小于或等于或者</span><br><span class=\"line\">-- 三、逻辑函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 逻辑操作符（返回0表示false 或 1表示true）</span><br><span class=\"line\">SELECT 12==12 or 12!=10;</span><br><span class=\"line\">SELECT 12==12 and 12!=10;</span><br><span class=\"line\">SELECT not 12, not 0;</span><br><span class=\"line\">SELECT or(equals(12, 12), notEquals(12, 10)); --函数表示法：或</span><br><span class=\"line\">SELECT and(equals(12, 12), notEquals(12, 10));--函数表示法：且</span><br><span class=\"line\">SELECT not(12), not(0);</span><br><span class=\"line\">-- 四、类型转换函数</span><br><span class=\"line\">--&gt;&gt;&gt;&gt;&gt;&gt; 类型转换函数部分示例：</span><br><span class=\"line\">SELECT toInt8(12.3334343), toFloat32(10.001), toFloat64(1.000040);</span><br><span class=\"line\">SELECT toString(now());</span><br><span class=\"line\">SELECT now() AS now_local, toString(now(), &#x27;Asia/Yekaterinburg&#x27;) AS now_yekat;</span><br><span class=\"line\">SELECT now() AS now_local, toDate(now()), toDateTime(now()), toUnixTimestamp(now());</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">&#x27;2016-06-15 23:00:00&#x27; AS timestamp,</span><br><span class=\"line\">CAST(timestamp AS DateTime) AS datetime,</span><br><span class=\"line\">CAST(timestamp AS Date) AS date,</span><br><span class=\"line\">CAST(timestamp, &#x27;String&#x27;) AS string,</span><br><span class=\"line\">CAST(timestamp, &#x27;FixedString(22)&#x27;) AS fixed_string;</span><br><span class=\"line\">WITH</span><br><span class=\"line\">   toDate(&#x27;2019-01-01&#x27;) AS date,</span><br><span class=\"line\">   INTERVAL 1 WEEK AS interval_week,</span><br><span class=\"line\">   toIntervalWeek(1) AS interval_to_week,</span><br><span class=\"line\">   toIntervalMonth(1) AS interval_to_month</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">   date + interval_week,</span><br><span class=\"line\">   date + interval_to_week,</span><br><span class=\"line\">   date + interval_to_month;</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-01-01 12:10:10&#x27;) as datetime,</span><br><span class=\"line\">\tINTERVAL 1 HOUR AS interval_hour,</span><br><span class=\"line\">\ttoIntervalHour(1) as invterval_to_hour</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tplus(datetime, interval_hour),</span><br><span class=\"line\">\tplus(datetime, invterval_to_hour);</span><br><span class=\"line\">-- 五、时间日期函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 时间日期函数</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-30 10:10:10&#x27;) AS time,</span><br><span class=\"line\">\t-- 将DateTime转换成Unix时间戳</span><br><span class=\"line\">\ttoUnixTimestamp(time) as unixTimestamp,</span><br><span class=\"line\">\t-- 保留  时-分-秒</span><br><span class=\"line\">\ttoDate(time) as date_local,</span><br><span class=\"line\">\ttoTime(time) as date_time,-- 将DateTime中的日期转换为一个固定的日期，同时保留时间部分。</span><br><span class=\"line\">\t-- 获取年份，月份，季度，小时，分钟，秒钟</span><br><span class=\"line\">\ttoYear(time) as get_year,</span><br><span class=\"line\">\ttoMonth(time) as get_month,</span><br><span class=\"line\">\t-- 一年分为四个季度。1（一季度:1-3）,2（二季度:4-6）,3（三季度:7-9）,4（四季度:10-12）</span><br><span class=\"line\">\ttoQuarter(time) as get_quarter,</span><br><span class=\"line\">\ttoHour(time) as get_hour,</span><br><span class=\"line\">\ttoMinute(time) as get_minute,</span><br><span class=\"line\">\ttoSecond(time) as get_second,</span><br><span class=\"line\">\t-- 获取 DateTime中的当前日期是当前年份的第几天，当前月份的第几日，当前星期的周几</span><br><span class=\"line\">\ttoDayOfYear(time) as &quot;当前年份中的第几天&quot;,</span><br><span class=\"line\">\ttoDayOfMonth(time) as &quot;当前月份的第几天&quot;,</span><br><span class=\"line\">\ttoDayOfWeek(time) as &quot;星期&quot;,</span><br><span class=\"line\">\ttoDate(time, &#x27;Asia/Shanghai&#x27;) AS date_shanghai,</span><br><span class=\"line\">\ttoDateTime(time, &#x27;Asia/Shanghai&#x27;) AS time_shanghai,</span><br><span class=\"line\">\t-- 得到当前年份的第一天,当前月份的第一天，当前季度的第一天，当前日期的开始时刻</span><br><span class=\"line\">\ttoStartOfYear(time),</span><br><span class=\"line\">\ttoStartOfMonth(time),</span><br><span class=\"line\">\ttoStartOfQuarter(time),</span><br><span class=\"line\">\ttoStartOfDay(time) AS cur_start_daytime,</span><br><span class=\"line\">\ttoStartOfHour(time) as cur_start_hour,</span><br><span class=\"line\">\ttoStartOfMinute(time) AS cur_start_minute,</span><br><span class=\"line\">\t-- 从过去的某个固定的时间开始，以此得到当前指定的日期的编号</span><br><span class=\"line\">\ttoRelativeYearNum(time),</span><br><span class=\"line\">\ttoRelativeQuarterNum(time);</span><br><span class=\"line\">\t</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-30 14:27:30&#x27;) as time,</span><br><span class=\"line\">\ttoISOYear(time) AS iso_year,</span><br><span class=\"line\">\ttoISOWeek(time) AS iso_week,</span><br><span class=\"line\">\tnow() AS cur_dateTime1, -- 返回当前时间yyyy-MM-dd HH:mm:ss</span><br><span class=\"line\">\ttoday() AS cur_dateTime2, -- 其功能与&#x27;toDate(now())&#x27;相同</span><br><span class=\"line\">\tyesterday() AS yesterday, -- 当前日期的上一天</span><br><span class=\"line\">\t-- timeSlot(1) AS timeSlot_1, -- 出现异常！！将时间向前取整半小时</span><br><span class=\"line\">\ttoDate(time) as getY_M_d;</span><br><span class=\"line\">-- 目前只有这三种格式，没有什么toYYYY(),toYYYddmm()之类的函数，不要想当然。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tnow() as nowTime,</span><br><span class=\"line\">\t-- 将Date或DateTime转换为包含年份和月份编号的UInt32类型的数字（YYYY * 100 + MM）</span><br><span class=\"line\">\ttoYYYYMMDDhhmmss(nowTime),</span><br><span class=\"line\">\ttoYYYYMMDD(nowTime),</span><br><span class=\"line\">\ttoYYYYMM(nowTime);</span><br><span class=\"line\">-- formatDateTime(Time, Format[,Timezone])函数引用</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tnow() as now_time,</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-31 18:20:30&#x27;) AS def_datetime,</span><br><span class=\"line\">\tformatDateTime(now_time, &#x27;%D&#x27;) AS now_time_day_month_year,-- 07/30/19</span><br><span class=\"line\">--\ttoDateTime(&#x27;2019-07-31 18:20:30&#x27;, &#x27;Asia/Shanghai&#x27;) AS def_datetime1, -- 指定时区</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%Y&#x27;) AS def_datetime_year, -- 2019（指定日期为2019年）</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%y&#x27;) AS def_datetime_year_litter, -- 19（指定日期为19年,Year, last two digits (00-99),本世纪的第19年）</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%H&#x27;) AS hour24, -- 18 下午六点</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%I&#x27;) AS hour12, -- 06下午六点</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%p&#x27;) AS PMorAM, -- 指定时间是上午还是下午</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%w&#x27;) AS def_datetime_get_curWeek,-- 3(指定日期为星期三)</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%F&#x27;) AS def_datetime_get_date,-- 2019-07-31 </span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%T&#x27;) AS def_datetime_get_time,-- 18:20:30</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%M&#x27;) AS def_datetime_get_minute,-- 20(得到指定事件的“分”，minute (00-59))</span><br><span class=\"line\">\tformatDateTime(def_datetime, &#x27;%S&#x27;) AS def_datetime_get_second;-- 30(得到指定事件的“秒”，second (00-59))</span><br><span class=\"line\">\t</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 1.跳转到之后的日期函数</span><br><span class=\"line\">-- 第一种，日期格式（指定日期，需注意时区的问题）</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDate(&#x27;2019-09-09&#x27;) AS date,</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-09-09 00:00:00&#x27;) AS date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\taddYears(date, 1) AS add_years_with_date,</span><br><span class=\"line\">\taddYears(date_time, 0) AS add_years_with_date_time;</span><br><span class=\"line\">-- 第二种，日期格式（当前，本地时间）</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDate(now()) as date,</span><br><span class=\"line\">\ttoDateTime(now()) as date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tnow() as now_time,-- 当前时间</span><br><span class=\"line\">\taddYears(date, 1) AS add_years_with_date,-- 之后1年</span><br><span class=\"line\">\taddYears(date_time, 1) AS add_years_with_date_time,</span><br><span class=\"line\">\taddMonths(date, 1) AS add_months_with_date,-- 之后1月</span><br><span class=\"line\">\taddMonths(date_time, 1) AS add_months_with_date_time,</span><br><span class=\"line\">\taddWeeks(date, 1) AS add_weeks_with_date,--之后1周</span><br><span class=\"line\">\taddWeeks(date_time, 1) AS add_weeks_with_date_time,</span><br><span class=\"line\">\taddDays(date, 1) AS add_days_with_date,-- 之后1天</span><br><span class=\"line\">\taddDays(date_time, 1) AS add_days_with_date_time,</span><br><span class=\"line\">\taddHours(date_time, 1) AS add_hours_with_date_time,--之后1小时</span><br><span class=\"line\">\taddMinutes(date_time, 1) AS add_minutes_with_date_time,--之后1分中</span><br><span class=\"line\">\taddSeconds(date_time, 10) AS add_seconds_with_date_time,-- 之后10秒钟</span><br><span class=\"line\">\taddQuarters(date, 1) AS add_quarters_with_date, -- 之后1个季度</span><br><span class=\"line\">\taddQuarters(date_time, 1) AS add_quarters_with_date_time;</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 2.跳转到当前日期之前的函数(函数将Date/DateTime减去一段时间间隔，然后返回Date/DateTime)</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDate(now()) as date,</span><br><span class=\"line\">\ttoDateTime(now()) as date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tsubtractYears(date, 1) AS subtract_years_with_date,</span><br><span class=\"line\">    subtractYears(date_time, 1) AS subtract_years_with_date_time,</span><br><span class=\"line\">\tsubtractQuarters(date, 1) AS subtract_Quarters_with_date,</span><br><span class=\"line\">    subtractQuarters(date_time, 1) AS subtract_Quarters_with_date_time,</span><br><span class=\"line\">\tsubtractMonths(date, 1) AS subtract_Months_with_date,</span><br><span class=\"line\">    subtractMonths(date_time, 1) AS subtract_Months_with_date_time,</span><br><span class=\"line\">\tsubtractWeeks(date, 1) AS subtract_Weeks_with_date,</span><br><span class=\"line\">    subtractWeeks(date_time, 1) AS subtract_Weeks_with_date_time,</span><br><span class=\"line\">\tsubtractDays(date, 1) AS subtract_Days_with_date,</span><br><span class=\"line\">    subtractDays(date_time, 1) AS subtract_Days_with_date_time,</span><br><span class=\"line\">    subtractHours(date_time, 1) AS subtract_Hours_with_date_time,</span><br><span class=\"line\">    subtractMinutes(date_time, 1) AS subtract_Minutes_with_date_time,</span><br><span class=\"line\">    subtractSeconds(date_time, 1) AS subtract_Seconds_with_date_time;</span><br><span class=\"line\">SELECT toDate(&#x27;2019-07-31&#x27;, &#x27;Asia/GuangZhou&#x27;) as date_guangzhou;</span><br><span class=\"line\">SELECT toDate(&#x27;2019-07-31&#x27;), toDate(&#x27;2019-07-31&#x27;, &#x27;Asia/Beijing&#x27;) as date_beijing;</span><br><span class=\"line\">-- 亚洲只能加载上海的timezone？？？</span><br><span class=\"line\">SELECT toDateTime(&#x27;2019-07-31 10:10:10&#x27;, &#x27;Asia/Shanghai&#x27;) as date_shanghai;</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 计算连个时刻在不同时间单位下的差值</span><br><span class=\"line\">-- 第一种：指定时间计算差值示例</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\ttoDateTime(&#x27;2019-07-30 10:10:10&#x27;, &#x27;Asia/Shanghai&#x27;) as date_shanghai_one,</span><br><span class=\"line\">\ttoDateTime(&#x27;2020-10-31 11:20:30&#x27;, &#x27;Asia/Shanghai&#x27;) as date_shanghai_two</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tdateDiff(&#x27;year&#x27;, date_shanghai_one, date_shanghai_two) as diff_years,</span><br><span class=\"line\">\tdateDiff(&#x27;month&#x27;, date_shanghai_one, date_shanghai_two) as diff_months,</span><br><span class=\"line\">\tdateDiff(&#x27;week&#x27;, date_shanghai_one, date_shanghai_two) as diff_week,</span><br><span class=\"line\">\tdateDiff(&#x27;day&#x27;, date_shanghai_one, date_shanghai_two) as diff_days,</span><br><span class=\"line\">\tdateDiff(&#x27;hour&#x27;, date_shanghai_one, date_shanghai_two) as diff_hours,</span><br><span class=\"line\">\tdateDiff(&#x27;minute&#x27;, date_shanghai_one, date_shanghai_two) as diff_minutes,</span><br><span class=\"line\">\tdateDiff(&#x27;second&#x27;, date_shanghai_one, date_shanghai_two) as diff_seconds;</span><br><span class=\"line\">-- 第二种：本地当前时间示例</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\tnow() as date_time</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tdateDiff(&#x27;year&#x27;, date_time, addYears(date_time, 1)) as diff_years,</span><br><span class=\"line\">\tdateDiff(&#x27;month&#x27;, date_time, addMonths(date_time, 2)) as diff_months,</span><br><span class=\"line\">\tdateDiff(&#x27;week&#x27;, date_time, addWeeks(date_time, 3)) as diff_week,</span><br><span class=\"line\">\tdateDiff(&#x27;day&#x27;, date_time, addDays(date_time, 3)) as diff_days,</span><br><span class=\"line\">\tdateDiff(&#x27;hour&#x27;, date_time, addHours(date_time, 3)) as diff_hours,</span><br><span class=\"line\">\tdateDiff(&#x27;minute&#x27;, date_time, addMinutes(date_time, 30)) as diff_minutes,</span><br><span class=\"line\">\tdateDiff(&#x27;second&#x27;, date_time, addSeconds(date_time, 35)) as diff_seconds;</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- timeSlot(StartTime, Duration, [,Size])</span><br><span class=\"line\">-- 它返回一个时间数组，其中包括从从“StartTime”开始到“StartTime + Duration 秒”内的所有符合“size”（以秒为单位）步长的时间点</span><br><span class=\"line\">-- 作用:搜索在相应会话中综合浏览量是非常有用的。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\ttimeSlots(toDateTime(&#x27;2012-01-01 12:20:00&#x27;), toUInt32(600)) as dateTimeArray,</span><br><span class=\"line\">\tdateTimeArray[0] as arr_index_0, -- no result.</span><br><span class=\"line\">\tdateTimeArray[1] as arr_index_1, -- 2012-01-01 20:00:00</span><br><span class=\"line\">\tdateTimeArray[2] as arr_index_2, -- 2012-01-01 20:30:00</span><br><span class=\"line\">\tdateTimeArray[3] as arr_index_3, -- no result.</span><br><span class=\"line\">\tdateTimeArray[4] as arr_index_4; -- no result.</span><br><span class=\"line\">-- toUInt32(600) 表示之后间距20秒的时刻</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\ttimeSlots(now(), toUInt32(600), 20) as dateTimeArray, -- 类似于：引用地址</span><br><span class=\"line\">\tdateTimeArray[0] as arr_index_0, -- no result.为什么？</span><br><span class=\"line\">\tdateTimeArray[1] as arr_index_1,</span><br><span class=\"line\">\tdateTimeArray[2] as arr_index_2,</span><br><span class=\"line\">\tdateTimeArray[3] as arr_index_3,</span><br><span class=\"line\">\tdateTimeArray[4] as arr_index_4,</span><br><span class=\"line\">\tdateTimeArray[5] as arr_index_5;</span><br><span class=\"line\">-- 指定时间为基准，之后每个元素增加20秒</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttimeSlots(toDateTime(&#x27;2012-01-01 12:20:00&#x27;), toUInt32(600), 20) as cur_dateTimeArray, -- 类似于：引用地址</span><br><span class=\"line\">\tcur_dateTimeArray[0] as arr_index_0, -- no result.为什么？</span><br><span class=\"line\">\tcur_dateTimeArray[1] as arr_index_1, -- 2012-01-01 20:20:00</span><br><span class=\"line\">\tcur_dateTimeArray[2] as arr_index_2, -- 2012-01-01 20:20:20</span><br><span class=\"line\">\tcur_dateTimeArray[3] as arr_index_3, -- 2012-01-01 20:20:40</span><br><span class=\"line\">\tcur_dateTimeArray[4] as arr_index_4, -- 2012-01-01 20:21:00</span><br><span class=\"line\">\tcur_dateTimeArray[5] as arr_index_5; -- 2012-01-01 20:21:20</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 六、字符串函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串函数：</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tlength(&#x27;hello world&#x27;) as str_length, -- 按照Unicode编码计算长度“你好”的长度为6</span><br><span class=\"line\">\tempty(&#x27;hello world&#x27;),-- 判断字符串是否为空，空为1，非空为0</span><br><span class=\"line\">\tnotEmpty(&#x27;hello world&#x27;),</span><br><span class=\"line\">\tlengthUTF8(&#x27;hello world&#x27;), -- 按照实际字符计算长度“你好”为2</span><br><span class=\"line\">\tchar_length(&#x27;hello world&#x27;), -- 同 lengthUTF8()</span><br><span class=\"line\">\tcharacter_length(&#x27;hello world&#x27;), -- 同 lengthUTF8(),</span><br><span class=\"line\">\tlower(&#x27;abcd123--&#x27;),--字母全部小写（将字符串中的ASCII转换为小写。）</span><br><span class=\"line\">\tupper(&#x27;abcd123--&#x27;),--字母全部大写（将字符串中的ASCII转换为大写。）</span><br><span class=\"line\">\tlowerUTF8(&#x27;abcd123-/*\\8asd-\\\\&#x27;), -- abcd123-/*8asd-\\</span><br><span class=\"line\">\tupperUTF8(&#x27;abcd123--&#x27;), -- ABCD123--</span><br><span class=\"line\">\tisValidUTF8(&#x27;abcd123--/*\\*&#x27;); --检查字符串是否为有效的UTF-8编码，是则返回1，否则返回0。</span><br><span class=\"line\">SELECT notEmpty(&#x27;&#x27;), notEmpty(NULL), notEmpty(&#x27;he&#x27;); -- 0,空,1</span><br><span class=\"line\">SELECT toValidUTF8(&#x27;\\x61\\xF0\\x80\\x80\\x80b&#x27;);</span><br><span class=\"line\">-- reverseUTF8():以Unicode字符为单位反转UTF-8编码的字符串。如果字符串不是UTF-8编码，则可能获取到一个非预期的结果（不会抛出异常）</span><br><span class=\"line\">SELECT reverse(&#x27;abcdefg&#x27;), reverseUTF8(&#x27;abcdefg&#x27;);</span><br><span class=\"line\">-- 2.字符串维度自定义安排</span><br><span class=\"line\">SELECT format(&#x27;&#123;1&#125; &#123;0&#125; &#123;1&#125;&#x27;, &#x27;World&#x27;, &#x27;Hello&#x27;); -- 输出：Hello World Hello</span><br><span class=\"line\">SELECT format(&#x27;&#123;0&#125; &#123;0&#125; &#123;1&#125; &#123;1&#125;&#x27;, &#x27;one&#x27;, &#x27;two&#x27;); -- 输出：one one two two</span><br><span class=\"line\">SELECT format(&#x27;&#123;&#125; &#123;&#125;&#x27;, &#x27;Hello&#x27;, &#x27;World&#x27;); -- 输出：Hello World</span><br><span class=\"line\">-- 3.字符串拼接 concat(s1,s2,s3,...)</span><br><span class=\"line\">SELECT concat(&#x27;Hello&#x27;,&#x27; &#x27;,&#x27;World&#x27;, &#x27;!&#x27;);-- Hello World!</span><br><span class=\"line\">-- 与concat相同，区别在于，你需要保证concat(s1, s2, s3) -&gt; s4是单射的，它将用于GROUP BY的优化。</span><br><span class=\"line\">SELECT concatAssumeInjective(&#x27;Hello&#x27;,&#x27; &#x27;,&#x27;World&#x27;, &#x27;!&#x27;);-- Hello World!</span><br><span class=\"line\">-- 4.字符串截取：substring(s, offset, length), mid(s, offset, length), substr(s, offset, length)</span><br><span class=\"line\">-- 以字节为单位截取指定位置字符串，返回以‘offset’位置为开头，长度为‘length’的子串。‘offset’从1开始（与标准SQL相同）。‘offset’和‘length’参数必须是常量。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tsubstring(&#x27;abcdefg&#x27;, 1, 3),-- abc</span><br><span class=\"line\">\tsubstring(&#x27;你好，世界&#x27;, 1, 3),-- 你</span><br><span class=\"line\">\tsubstringUTF8(&#x27;你好，世界&#x27;, 1, 3); -- 你好，</span><br><span class=\"line\">-- 5.字符串拼接：appendTrailingCharIfAbsent(s, c)</span><br><span class=\"line\">-- 如果‘s’字符串非空并且末尾不包含‘c’字符，则将‘c’字符附加到末尾。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tappendTrailingCharIfAbsent(&#x27;good&#x27;,&#x27;c&#x27;), -- goodc</span><br><span class=\"line\">\tappendTrailingCharIfAbsent(&#x27;goodccc&#x27;,&#x27;c&#x27;); -- goodccc</span><br><span class=\"line\">-- 6.字符串编码转换：convertCharset(s, from, to) 返回从‘from’中的编码转换为‘to’中的编码的字符串‘s’。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;UTF8&#x27;,&#x27;Unicode&#x27;),-- ��h</span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;Unicode&#x27;, &#x27;UTF8&#x27;),-- 桥汬�</span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;Unicode&#x27;, &#x27;ASCII&#x27;),-- </span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;ascii&#x27;, &#x27;ascii&#x27;),--hello</span><br><span class=\"line\">\tconvertCharset(&#x27;hello&#x27;, &#x27;UTF8&#x27;,&#x27;UTF8&#x27;);-- hello</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tbase64Encode(&#x27;username+password&#x27;),-- dXNlcm5hbWUrcGFzc3dvcmQ=</span><br><span class=\"line\">\tbase64Decode(&#x27;dXNlcm5hbWUrcGFzc3dvcmQ=&#x27;), -- username+password</span><br><span class=\"line\">\t-- 使用base64将字符串解码成原始字符串。但如果出现错误，将返回空字符串。</span><br><span class=\"line\">\ttryBase64Decode(&#x27;dXNlcm5hbWUrcGFzc3dvcmQ=&#x27;);</span><br><span class=\"line\">-- 7.判断字符串是否已什么结尾或结束，返回1：true，0：flase</span><br><span class=\"line\">-- endsWith(s, suffix)  返回是否以指定的后缀结尾。如果字符串以指定的后缀结束，则返回1，否则返回0</span><br><span class=\"line\">-- startWith(s, prefix) 返回是否以指定的前缀开头。如果字符串以指定的前缀开头，则返回1，否则返回0。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tendsWith(&#x27;string&#x27;,&#x27;g&#x27;),</span><br><span class=\"line\">\tstartsWith(&#x27;string&#x27;, &#x27;str&#x27;); -- 1  true</span><br><span class=\"line\">-- 8.删除左侧空白字符</span><br><span class=\"line\">-- trimLeft(s)  返回一个字符串，用于删除左侧的空白字符</span><br><span class=\"line\">-- trimRight(s) 返回一个字符串，用于删除右侧的空白字符</span><br><span class=\"line\">-- trimBoth(s)  返回一个字符串，用于删除左侧和右侧的空白字符</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttrimLeft(&#x27;  sdfdgs&#x27;), -- sdfdgs</span><br><span class=\"line\">\ttrimRight(&#x27;abcd   &#x27;), -- abcd</span><br><span class=\"line\">\ttrimBoth(&#x27;  abcd  &#x27;); -- abcd</span><br><span class=\"line\">-- 七、字符串搜索函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串搜索函数</span><br><span class=\"line\">-- pasition(haystack, needle), 显示needle在haystack的第一个出现的位置。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tPOSITION(&#x27;2121stringstrstrstrstr&#x27;,&#x27;str&#x27;) AS positionSearch, -- 5</span><br><span class=\"line\">\tPOSITION(&#x27;你好，hello,12323-你好，你，好sdfd*dg&#x27;, &#x27;你，好&#x27;),-- 31</span><br><span class=\"line\">\tpositionUTF8(&#x27;n12你好&#x27;,&#x27;你好&#x27;) AS positionUTF8,-- 4</span><br><span class=\"line\">\tpositionCaseInsensitive(&#x27;ABCDCDEFABCD&#x27;,&#x27;bc&#x27;) AS positionCaseInsensitive, --2</span><br><span class=\"line\">\tlocate(&#x27;hellohellohellohello&#x27;,&#x27;ello&#x27;); -- 2</span><br><span class=\"line\">-- multiSearchAllPositions(haystack, [needle1, needle2, ..., needlen])</span><br><span class=\"line\">-- 注意：在所有multiSearch*函数中，由于实现规范，needles的数量应小于2^8。</span><br><span class=\"line\">-- 函数返回一个数组，其中包含所有匹配needlei的位置</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tmultiSearchAllPositions(&#x27;goodnamegoodnamegoodhellohihihi&#x27;, [&#x27;dn&#x27;, &#x27;good&#x27;]) as multiSearch,-- [4,1]</span><br><span class=\"line\">\tmultiSearchAllPositionsCaseInsensitive(&#x27;nameSsdfagpSSDFDFetgfderef&#x27;, [&#x27;SS&#x27;,&#x27;fa&#x27;]) as multiCaseInsensitive,</span><br><span class=\"line\">\tmultiSearchAllPositionsUTF8(&#x27;nameSsdfazz轴功率gpSSDFDFetgfderef&#x27;, [&#x27;Ss&#x27;,&#x27;fa&#x27;, &#x27;zz轴&#x27;]) AS multiSearchUTF8,</span><br><span class=\"line\">\tmultiSearchAllPositionsCaseInsensitiveUTF8(&#x27;nameSsdfazz轴功率gpSSDFDFetgfderef&#x27;, [&#x27;Ss&#x27;,&#x27;fa&#x27;, &#x27;zz轴&#x27;]) AS multiCaseInsensitiveUTF8;</span><br><span class=\"line\">-- 检查字符串是否与pattern正则表达式匹配。pattern可以是一个任意的re2正则表达式。 re2正则表达式的语法比Perl正则表达式的语法存在更多限制。</span><br><span class=\"line\">-- match(haystack, pattern) 匹配到了则返回1，否则返回0</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tmatch(&#x27;1232434sadgaDDFSrefds&#x27;, &#x27;[0-9a-zA-Z]&#x27;), -- 存在匹配的字符，返回1</span><br><span class=\"line\">\tmatch(&#x27;1232321&#x27;, &#x27;[a-z]&#x27;); -- 不存在匹配的字符，返回0</span><br><span class=\"line\">-- 与match相同，但如果所有正则表达式都不匹配，则返回0；如果任何模式匹配，则返回1。它使用hyperscan库。对于在字符串中搜索子字符串的模式，最好使用“multisearchany”，因为它更高效。</span><br><span class=\"line\">-- multiMatchAny(haystack, [pattern1, pattern2, ..., patternn]) </span><br><span class=\"line\">-- 注意：任何haystack字符串的长度必须小于232字节，否则抛出异常。这种限制是因为hyperscan API而产生的。</span><br><span class=\"line\">-- 多个正则表达式对原始字符进行匹配，如若只有一个正则表达式匹配上了则返回1，否则返回0</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tmultiMatchAny(&#x27;abcABC&#x27;,[&#x27;[0-9]&#x27;,&#x27;[a-zA-Z]&#x27;]) AS multiMatchAnyOne, -- 1</span><br><span class=\"line\">\tmultiMatchAny(&#x27;123abcABC&#x27;,[&#x27;[0-9]&#x27;,&#x27;[a-zA-Z]&#x27;]) AS multiMatchAnyTwo, --1</span><br><span class=\"line\">\t-- 与multiMatchAny相同，但返回与haystack匹配的任何内容的索引位置。</span><br><span class=\"line\">\tmultiMatchAnyIndex(&#x27;123abcABC&#x27;, [&#x27;[0-9]&#x27;,&#x27;[a-zA-Z]&#x27;]) as multiMatchAnyIndex; --2</span><br><span class=\"line\">-- 模糊匹配：like()函数，注意大写敏感。</span><br><span class=\"line\">-- % 表示任何字节数（包括零字符）</span><br><span class=\"line\">-- _ 表示任何一个字节</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\t&#x27;hello&#x27; LIKE &#x27;%h%&#x27; as LIKE_UP, -- 1</span><br><span class=\"line\">\t&#x27;hello&#x27; like &#x27;he&#x27; AS like_low, -- 0</span><br><span class=\"line\">\t&#x27;hello&#x27; not like &#x27;he&#x27; AS not_like, -- 1</span><br><span class=\"line\">\t&#x27;hello&#x27; like &#x27;%he%&#x27; AS like_litter, -- 1</span><br><span class=\"line\">\tlike(&#x27;adgadgadfa1232&#x27;, &#x27;_12_&#x27;) AS like_func,</span><br><span class=\"line\">\tlike(&#x27;sdfasdfasd&#x27;, &#x27;[a-z]&#x27;) AS like_func2, -- 0</span><br><span class=\"line\">\tnotLike(&#x27;1232423&#x27;, &#x27;[a-zA-Z]&#x27;) AS not_like_func; -- 1</span><br><span class=\"line\">-- 使用字符串截取字符串：extract(haystack, pattern)</span><br><span class=\"line\">-- 使用正则表达式截取字符串。如果‘haystack’与‘pattern’不匹配，则返回空字符串。如果正则表达式中不包含子模式，它将获取与整个正则表达式匹配的子串。否则，它将获取与第一个子模式匹配的子串。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\textractAll(&#x27;hellogoodaimantIdeaIDEAfasd123232&#x27;, &#x27;[0-9]&#x27;), -- [&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;2&#x27;]</span><br><span class=\"line\">\textractAll(&#x27;12323dSDFRE&#x27;, &#x27;[A-Z]&#x27;),-- [&#x27;S&#x27;,&#x27;D&#x27;,&#x27;F&#x27;,&#x27;R&#x27;,&#x27;E&#x27;]</span><br><span class=\"line\">\textract(&#x27;helloclickhouse&#x27;, &#x27;[a-z]&#x27;);-- h</span><br><span class=\"line\">-- ngramSearch(haystack, needle)</span><br><span class=\"line\">-- 基于4-gram计算haystack和needle之间的距离：计算两个4-gram集合之间的对称差异，并用它们的基数和对其进行归一化。</span><br><span class=\"line\">-- 返回0到1之间的任何浮点数 -- 越接近0则表示越多的字符串彼此相似。</span><br><span class=\"line\">-- 如果常量的needle或haystack超过32KB，函数将抛出异常。如果非常量的haystack或needle字符串超过32Kb，则距离始终为1。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tngramDistance(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistance, </span><br><span class=\"line\">\tngramDistanceCaseInsensitive(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistanceCaseInsensitive,</span><br><span class=\"line\">\tngramDistanceUTF8(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistanceUTF8,</span><br><span class=\"line\">\tngramDistanceCaseInsensitiveUTF8(&#x27;hello123456789&#x27;,&#x27;123&#x27;) AS ngramDistanceCaseInsensitiveUTF8;</span><br><span class=\"line\">-- 注意：对于UTF-8，我们使用3-gram。所有这些都不是完全公平的n-gram距离。</span><br><span class=\"line\">-- 我们使用2字节哈希来散列n-gram，然后计算这些哈希表之间的（非）对称差异 - 可能会发生冲突。</span><br><span class=\"line\">-- 对于UTF-8不区分大小写的格式，我们不使用公平的tolower函数 </span><br><span class=\"line\">-- 我们将每个Unicode字符字节的第5位（从零开始）和字节的第一位归零 </span><br><span class=\"line\">-- 这适用于拉丁语，主要用于所有西里尔字母。</span><br><span class=\"line\">--八、字符串替换函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串替换函数</span><br><span class=\"line\">-- 替换匹配到的字符串</span><br><span class=\"line\">-- replaceOne(haystack, pattern, replacement)</span><br><span class=\"line\">-- 用‘replacement’子串替换‘haystack’中与‘pattern’子串第一个匹配的匹配项（如果存在）。 ‘pattern’和‘replacement’必须是常量。</span><br><span class=\"line\">-- replaceAll(haystack, pattern, replacement), replace(haystack, pattern, replacement)</span><br><span class=\"line\">-- 用‘replacement’子串替换‘haystack’中出现的所有‘pattern’子串。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\treplaceOne(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replaceOne,-- hed123*544</span><br><span class=\"line\">\treplaceRegexpOne(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replaceRegexpOne,-- hed123*544</span><br><span class=\"line\">\treplace(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replace, -- hed123*5**</span><br><span class=\"line\">\treplaceAll(&#x27;hed1234544&#x27;, &#x27;4&#x27;, &#x27;*&#x27;) AS replaceAll;-- hed123*5**</span><br><span class=\"line\">-- 实例：2019-07-31 改变成  07/31/2019</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\ttoDate(now()) AS now_date,</span><br><span class=\"line\">\treplaceRegexpOne(toString(now_date), &#x27;(\\\\d&#123;4&#125;)-(\\\\d&#123;2&#125;)-(\\\\d&#123;2&#125;)&#x27;, &#x27;\\\\2/\\\\3/\\\\1&#x27;) AS format_date;</span><br><span class=\"line\">-- 示例：赋值字符串10次</span><br><span class=\"line\">SELECT replaceRegexpOne(&#x27;Hello, World!&#x27;, &#x27;.*&#x27;, &#x27;\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0&#x27;) AS res;</span><br><span class=\"line\">-- replaceRegexpAll(haystack, pattern, replacement)</span><br><span class=\"line\">-- 与replaceRegexpOne相同，但会替换所有出现的匹配项。例如：</span><br><span class=\"line\">SELECT replaceRegexpAll(&#x27;hello,world!&#x27;, &#x27;.&#x27;, &#x27;\\\\0\\\\0&#x27;) as res; -- hheelllloo,,wwoorrlldd!!</span><br><span class=\"line\">SELECT replaceRegexpAll(&#x27;hello o o, world.&#x27;, &#x27; &#x27;, &#x27;*&#x27;) as res; -- hello*o*o,*world.</span><br><span class=\"line\">-- 函数：regexpQuoteMeta(s)   该函数用于在字符串中的某些预定义字符之前添加反斜杠。</span><br><span class=\"line\">-- 预定义字符：&#x27;0&#x27;，&#x27;\\&#x27;，&#x27;|&#x27;，&#x27;(&#x27;，&#x27;)&#x27;，&#x27;^&#x27;，&#x27;$&#x27;，&#x27;。&#x27;，&#x27;[&#x27;，&#x27;]&#x27;，&#x27;？&#x27;，&#x27;* &#x27;，&#x27;+&#x27;，&#x27;&#123;&#x27;，&#x27;：&#x27;，&#x27; - &#x27;。 </span><br><span class=\"line\">-- 这个实现与re2 :: RE2 :: QuoteMeta略有不同。它以\\0而不是\\x00转义零字节，它只转义所需的字符</span><br><span class=\"line\">---- 简言之，就是不处理转义字符，一般如果没有用的这个函数，都会有转义的情况出现。</span><br><span class=\"line\">SELECT regexpQuoteMeta(&#x27;\\\\\\\\|[]&#123;&#125;+_-=@!~`&amp;^*%$#&#x27;); -- \\\\\\\\\\|\\[\\]\\&#123;&#125;\\+_\\-=@!~`&amp;\\^\\*%\\$#</span><br><span class=\"line\">SELECT toString(&#x27;\\\\\\\\&#x27;); -- \\\\</span><br><span class=\"line\"> </span><br><span class=\"line\">--九、条件函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 条件函数</span><br><span class=\"line\">-- 1. if(cond, then, else)函数：类似于三元操作符。</span><br><span class=\"line\">-- 中文字符使用双引号，英文字符可不使用引号也可使用当引号或双引号，根据具体情况而定。</span><br><span class=\"line\">-- 如果cond ！= 0则返回then，如果cond = 0则返回else。 cond必须是UInt8类型，then和else必须存在最低的共同类型。</span><br><span class=\"line\">-- 注意：then和else可以是NULL</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">&gt; 10 ? &#x27;desc&#x27; : &#x27;asc&#x27; AS &quot;三元操作符&quot;,</span><br><span class=\"line\">\tif(12 &gt; 10, &#x27;desc&#x27; , &#x27;asc&#x27;) AS &quot;if()函数&quot;,</span><br><span class=\"line\">\tif(12 &gt; 10, NULL, NULL);</span><br><span class=\"line\">-- 2. multiIf(cond_1, then_1, cond_2, then_2...else)</span><br><span class=\"line\">-- 允许您在查询中更紧凑地编写CASE运算符。类似于java中的switch语法（可以接受2n+1个参数）</span><br><span class=\"line\">SELECT multiIf(1,&#x27;one&#x27;,2,&#x27;two&#x27;,3,&#x27;three&#x27;,&#x27;not this index&#x27;);-- 关联case条件表达式</span><br><span class=\"line\">--十、数学函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 数学函数</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">* e() AS E,</span><br><span class=\"line\">* pi() AS PI,</span><br><span class=\"line\">\tsqrt(25) AS sqrt_25, --接受一个数值类型的参数并返回它的平方根。</span><br><span class=\"line\">\tcbrt(27) AS cbrt_27, --接受一个数值类型的参数并返回它的立方根。</span><br><span class=\"line\">\texp(10), --接受一个数值类型的参数并返回它的指数</span><br><span class=\"line\">\texp10(10), --接受一个数值类型的参数并返回它的10的x次幂。</span><br><span class=\"line\">\tlog(10) AS LOG,</span><br><span class=\"line\">\tlog2(10) AS LOG2, --接受一个数值类型的参数并返回它的底2对数。</span><br><span class=\"line\">\tln(e()) AS LOG10; --接受一个数值类型的参数并返回它的自然对数</span><br><span class=\"line\">-- 示例：三西格玛准则</span><br><span class=\"line\">SELECT erf(3 / sqrt(2)); -- 0.997</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tsin(90), -- 返回x的三角正弦值。</span><br><span class=\"line\">\tcos(90), -- 返回x的三角余弦值。</span><br><span class=\"line\">\ttan(90), -- 返回x的三角正切值</span><br><span class=\"line\">\tacos(0), -- 返回x的反三角余弦值。</span><br><span class=\"line\">\tasin(1), -- 返回x的反三角正弦值。</span><br><span class=\"line\">\tatan(45); -- 返回x的反三角正切值。</span><br><span class=\"line\">-- pow(x, y), power(x, y) 接受x和y两个参数。返回x的y次方。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tpow(2, 3), -- 2的三次方</span><br><span class=\"line\">\tpow(3, 2); -- 3的平方</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tintExp2(4), --2^4 \t接受一个数值类型的参数并返回它的2的x次幂（UInt64）。</span><br><span class=\"line\">\tintExp10(2);--10^2\t接受一个数值类型的参数并返回它的10的x次幂（UInt64）。</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 十一、取整函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 取整函数</span><br><span class=\"line\">-- 1.向下取整：floor(x[,N])</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tfloor(toFloat32(12.08098), 2), -- 12.08</span><br><span class=\"line\">\tfloor(toFloat32(12.2323), 2), -- 12.23</span><br><span class=\"line\">\tfloor(toFloat32(12.89788), -1), -- 10</span><br><span class=\"line\">\tfloor(toFloat32(12.09590), 3), -- 12.095 (注意：如果按照正常的四舍五入，则应该是12.096，为什么呢？)</span><br><span class=\"line\">\tfloor(toFloat32(12.0987), 3),-- 12.098</span><br><span class=\"line\">\tfloor(10, 2); -- 10</span><br><span class=\"line\">-- 2.四舍五入：round(expression [, decimal_places])</span><br><span class=\"line\">--\t如果decimal_places=0,则取整数；</span><br><span class=\"line\">--\t如果&gt;0,则将值舍入小数点右侧；</span><br><span class=\"line\">--\t如果&lt;0,则将小数点左侧的值四舍五入。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tround(toFloat32(12.1234), 3),</span><br><span class=\"line\">\tround(toFloat32(12.0025), 3), -- 12.002(注意：为什么不是12.003呢？)</span><br><span class=\"line\">\t-- round函数只会最多保留三位有效数字</span><br><span class=\"line\">\tround(toFloat32(12.0025), 4), -- 12.002</span><br><span class=\"line\">\tround(toFloat32(12.0025002323), 100); -- 12.003</span><br><span class=\"line\">-- 示例：</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tround(toFloat32(10 / 3)), -- 3  </span><br><span class=\"line\">\tround(toFloat32(10 / 3), 2), -- 3.33</span><br><span class=\"line\">\tround(toFloat32(10.000/3), 3), -- 3.333</span><br><span class=\"line\">\tround(toFloat32(10.000/3), 6); -- 3.333</span><br><span class=\"line\">-- roundToExp2() 接受一个数字。如果数字小于1，则返回0。否则，它将数字向下舍入到最接近的（整个非负）2的x次幂。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\troundToExp2(12.0129), -- 8 = 2^3</span><br><span class=\"line\">\troundToExp2(toFloat32(0.01)); -- 0.008</span><br><span class=\"line\">-- 3.向上取整：ceil(x[, N]) 或者 ceiling(x[, N])</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tceil(12.34343, 3), -- 12.344</span><br><span class=\"line\">\tceil(toFloat64(12.34343), 3), -- 12.344</span><br><span class=\"line\">\tceil(toFloat32(12.34343), 3), -- 12.344</span><br><span class=\"line\">\tceil(12.0011, 3); -- 12.002</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">---十二、数组函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 数组函数</span><br><span class=\"line\">-- 1.数组非空判断相关函数（真为1，假为0）</span><br><span class=\"line\">SELECT empty([]), empty([1,2,3]), notEmpty([1,2,3]), notEmpty([]);</span><br><span class=\"line\">-- 2.数组长度 length()  返回数组中的元素个数。 结果类型是UInt64。 该函数也适用于字符串。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">--\tlength(), -- 出现异常</span><br><span class=\"line\">--\tlength([true, false]), -- 异常</span><br><span class=\"line\">--\tlength([1,2,,4]), --出现异常！</span><br><span class=\"line\">\tlength([]), -- 0</span><br><span class=\"line\">\tlength([&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]), -- 3</span><br><span class=\"line\">\tlength([1,2,3]); -- 3</span><br><span class=\"line\">-- 3.扩展判断非空的部分函数如下：不接受任何参数并返回适当类型的空数组</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\temptyArrayUInt8(), -- UInt8的空数组</span><br><span class=\"line\">\temptyArrayUInt16(),</span><br><span class=\"line\">\temptyArrayUInt32(),</span><br><span class=\"line\">\temptyArrayUInt64(),</span><br><span class=\"line\">\temptyArrayDate(),</span><br><span class=\"line\">\temptyArrayDateTime(),</span><br><span class=\"line\">\temptyArrayInt8(),</span><br><span class=\"line\">\temptyArrayInt16(),</span><br><span class=\"line\">\temptyArrayInt32(),</span><br><span class=\"line\">\temptyArrayInt64();</span><br><span class=\"line\">--\t接受一个空数组并返回一个仅包含一个默认值元素的数组。(以下是部分示例)</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayInt32()), -- 0</span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayUInt32()), -- 0</span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayDate()), -- 0002-11-30</span><br><span class=\"line\">\temptyArrayToSingle(emptyArrayDateTime()); --0002-11-30 08:00:00</span><br><span class=\"line\">-- 4.生成一个含有N个元素的数组,元素从0开始增长，步长尾1.</span><br><span class=\"line\">-- range(N)  返回从0到N-1的数字数组。 以防万一，如果在数据块中创建总长度超过100,000,000个元素的数组，则抛出异常</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\trange(10), -- [0,1,2,3,4,5,6,7,8,9]</span><br><span class=\"line\">\trange(2), -- [0,1]</span><br><span class=\"line\">--\trange(5.5), -- 出现异常，N为Int8的数据类型，正整数</span><br><span class=\"line\">--\trange(-10), -- 出现异常，DB::Exception: Illegal type Int8 of argument of function range</span><br><span class=\"line\">\trange(1); -- 0</span><br><span class=\"line\">-- 5.新建一个数组的函数：array(x1,……) 类似于 直接[x1,……]</span><br><span class=\"line\">-- 注意：新建数组的每个元素的数据类型需保持一致性。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarray(1,2,2,3,4) AS &quot;array()函数&quot;,</span><br><span class=\"line\">--\t[1,&#x27;hello&#x27;,3], -- 出现异常，DB::Exception: There is no supertype for types UInt8, String, UInt8 because some of them are String/FixedString and some of them are not (version 19.10.1.5 (official build))</span><br><span class=\"line\">\t[1,2,3,4] AS &quot;[ ]&quot;;</span><br><span class=\"line\">-- 6.合并N个数组  arrayConcat(arrays) 合并参数中传递的所有数组。跟java的数组差不多的合并，不会自动去重，不会自动排序</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayConcat(array(1,2),array(2,3),array(4,5)), -- [1,2,2,3,4,5]（第一种情况）</span><br><span class=\"line\">\tarrayConcat(array(1,1),array(2,2),array(3,3)), -- [1,1,2,2,3,3]</span><br><span class=\"line\">--\tarrayConcat(array(1,2),[&#x27;a&#x27;,&#x27;c&#x27;],array(3,3)), -- 出现异常，不能将不同类型的数组进行合并</span><br><span class=\"line\">\tarrayConcat(array(1,1),[2,3],array(4,5)); -- [1,1,2,3,4,5]</span><br><span class=\"line\">-- 7.从数组arr中获取索引为“n”的元素。</span><br><span class=\"line\">--  n必须是任何整数类型。 数组中的索引从一开始。 支持负索引。在这种情况下，它选择从末尾开始编号的相应元素。例如，arr [-1]是数组中的最后一项。</span><br><span class=\"line\">--  如果索引超出数组的边界，则返回默认值（数字为0，字符串为空字符串等）.</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayElement(array(10,20,3), 1), -- 10</span><br><span class=\"line\">\tarrayElement(array(1,20,3), 2), -- 20</span><br><span class=\"line\">\tarrayElement(array(1,2,30), 3), -- 30</span><br><span class=\"line\">\tarrayElement(array(10,20,3), 0), -- 0</span><br><span class=\"line\">\tarrayElement(array(10,20,3), -3), -- 10</span><br><span class=\"line\">\tarrayElement(array(10,20,3), -2), -- 20</span><br><span class=\"line\">\tarrayElement(array(10,20,3), -1);-- 3</span><br><span class=\"line\">-- 8.检查在数组中是否含有此元素。has(arr, elem)  包含此元素则返回1，否则返回0</span><br><span class=\"line\">-- has()  检查&#x27;arr&#x27;数组是否具有&#x27;elem&#x27;元素。 如果元素不在数组中，则返回0;如果在，则返回1。</span><br><span class=\"line\">-- hasAny(arr1, arr2) 返回1表示arr1和arr2存在交集。否则返回0. </span><br><span class=\"line\">--注意：特殊的定义：</span><br><span class=\"line\">--\t\t① “NULL”作为数组中的元素值进行处理。</span><br><span class=\"line\">--\t\t② 忽略两个数组中的元素值的顺序</span><br><span class=\"line\">-- hasAll(set, subset)  检查一个数组是否是另一个数组的子集。返回1，表示set包含subset中所有的元素</span><br><span class=\"line\">--    set – 具有一组元素的任何类型的数组。</span><br><span class=\"line\">--    subset – 任何类型的数组，其元素应该被测试为set的子集。</span><br><span class=\"line\">-- 注意：特殊的定义：</span><br><span class=\"line\">--\t\t① 空数组是任何数组的子集。</span><br><span class=\"line\">--\t\t② “NULL”作为数组中的元素值进行处理。</span><br><span class=\"line\">--\t\t③ 忽略两个数组中的元素值的顺序。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\thas([1,2,3], 2), -- 1</span><br><span class=\"line\">\thas(array(1,2,3),2), -- 1</span><br><span class=\"line\">\thas([1,2,NULL], NULL), -- 1 (注意：null值的处理)</span><br><span class=\"line\">--\thas([], 2), -- 出现异常，DB::Exception: Types of array and 2nd argument of function has must be identical up to nullability or numeric types or Enum and numeric type. Passed: Array(Nothing) and UInt8</span><br><span class=\"line\">\thas([1,2], 3); -- 0</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\thasAll([], []), -- 1</span><br><span class=\"line\">\thasAll([1,NULL,NULL], [NULL]), -- 1</span><br><span class=\"line\">\thasAll([1,2,3], [1,2]), -- 1</span><br><span class=\"line\">\thasAll([1,2,2,3], [2]), -- 1</span><br><span class=\"line\">\thasAll(array(1,2,2,3), [2]), -- 1</span><br><span class=\"line\">\thasAll([1,2,3], [4,5]); -- 0</span><br><span class=\"line\">-- 多重数组（如下的二维数组）。</span><br><span class=\"line\">SELECT hasAll([[1, 2], [3, 4]], [[1, 2], [3, 5]]); -- 0</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\thasAny(array(1,2,3), array(1)), -- 1</span><br><span class=\"line\">\thasAny(array(1,2,3), array(1,4,56,80)), -- 1</span><br><span class=\"line\">\t-- []与array()是一样的含义，本质上是一直的。只不过[]更加简便而已。</span><br><span class=\"line\">\thasAny(array(), array()), -- 0</span><br><span class=\"line\">\thasAny([],[]), -- 0</span><br><span class=\"line\">\thasAny([1],[]), -- 0</span><br><span class=\"line\">\t-- 空数组跟null不是一样的对象</span><br><span class=\"line\">\thasAny([1,NULL],[]), -- 0</span><br><span class=\"line\">\thasAny([1,NULL],[NULL,2]); -- 1</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 9.返回数组指定元素的索引</span><br><span class=\"line\">-- indexOf(arr, x) 返回数组中第一个‘x’元素的索引（从1开始），如果‘x’元素不存在在数组中，则返回0。</span><br><span class=\"line\">SELECT indexOf([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], &#x27;one&#x27;); -- 1</span><br><span class=\"line\">SELECT indexOf([1, 2, 4], 4); -- 3</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tindexOf([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], &#x27;one&#x27;), -- 1</span><br><span class=\"line\">\tindexOf([&#x27;one&#x27;,NULL,NULL], NULL),-- 1返回第一个找到的元素的索引位置</span><br><span class=\"line\">\tindexOf([1, 2, 4], 4); -- 3</span><br><span class=\"line\">-- 数组元素的以第一个和最后一个元素。</span><br><span class=\"line\">SELECT length([12,3,4,4,4]);</span><br><span class=\"line\">SELECT array(12,22,31)[1];</span><br><span class=\"line\">WITH</span><br><span class=\"line\">\t[23,43,565,2,32,34] AS arr</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarr[1], -- 去除数组中的第一个元素</span><br><span class=\"line\">\tarr[length(arr)]; -- 提取元素中的最后一个元素</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 10.计算数组中包含指定元素的个数</span><br><span class=\"line\">-- countEqual(arr, x) 返回数组中等于x的元素的个数。相当于arrayCount（elem - &gt; elem = x，arr）。</span><br><span class=\"line\">-- 注意：null值将作为单独的元素值处理。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tcountEqual([1, 2, 2, 2, 3, 4], 2), -- 3</span><br><span class=\"line\">\tcountEqual([1, 2, NULL, NULL], NULL); -- 2</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 11.arrayEnumerate(arr)  返回 Array [1, 2, 3, ..., length (arr) ] 此功能通常与ARRAY JOIN一起使用。它允许在应用ARRAY JOIN后为每个数组计算一次。</span><br><span class=\"line\">SELECT arrayEnumerate([1,20,20,3]); -- [1,2,3,4]</span><br><span class=\"line\">SELECT arrayEnumerate(array(11,20,13)); -- [1,2,3]</span><br><span class=\"line\">SELECT arrayEnumerate(array(11,20,13,NULL)); -- [1,2,3,4] 注意：null也算是一个元素。</span><br><span class=\"line\">--arrayEnumerateUniq(arr)  返回与源数组大小相同的数组，其中每个元素表示与其下标对应的源数组元素在源数组中出现的次数</span><br><span class=\"line\">SELECT arrayEnumerateUniq([1,1,2,2]); -- [1,2]</span><br><span class=\"line\">-- 12.删除数组的元素</span><br><span class=\"line\">-- arrayPopBack(array) 删除数组array的最后一项</span><br><span class=\"line\">SELECT arrayPopBack(array(1,2,3,0)) AS res; -- [1,2,3]</span><br><span class=\"line\">-- arrayPopFront(array) 从数组中删除第一项</span><br><span class=\"line\">SELECT arrayPopFront(array(0,1,2,3)) AS res; -- [1,2,3]</span><br><span class=\"line\">-- 13.添加数组的元素 arrayPushFront(array, single_value) single_value是单个值</span><br><span class=\"line\">SELECT arrayPushBack([1,2,3], 0) AS res; --  [1,2,3,0]</span><br><span class=\"line\">SELECT arrayPushFront([1,2,3], 0) AS res; --  [0,1,2,3]</span><br><span class=\"line\">-- 14.更改数组的长度  arrayResize(arr, size[, extender])</span><br><span class=\"line\">-- 如果arr的长度 &gt; size,则会对arr截取size的长度；</span><br><span class=\"line\">-- 如果arr的长度 &lt; size，则其余位置用对应数据类型的默认值填充。</span><br><span class=\"line\">-- 注意：extender含义是扩展元素的值。如果没有指定extender，则默认按照对应的数据类型的默认值进行赋值。否则按照extender进行填充。</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 5); -- [1,2,3,0,0]</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 2); -- [1,2]</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 3); -- [1,2,3]</span><br><span class=\"line\">--↓↓↓ RuntimeException: Parse exception: ByteFragment&#123;[[[1,2],[3,4],[5,6],[],[]]], start=0, len=25&#125;</span><br><span class=\"line\">SELECT arrayResize([array(1,2),array(3,4),array(5,6)], 5);</span><br><span class=\"line\">SELECT arrayResize([1,2,3], 5, 12); -- [1,2,3,12,12]</span><br><span class=\"line\">SELECT arrayResize([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], 5); -- [&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;,&#x27;&#x27;,&#x27;&#x27;]</span><br><span class=\"line\">SELECT arrayResize([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], 5, &#x27;default&#x27;); -- [&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;,&#x27;default&#x27;,&#x27;default&#x27;]</span><br><span class=\"line\">-- 15.截取数组的部分元素，得到一个新的子数组</span><br><span class=\"line\">-- arraySlice(array, offset[, length])</span><br><span class=\"line\">--\t解释：</span><br><span class=\"line\">--\tarray: 数组，</span><br><span class=\"line\">--\toffset – 数组的偏移。正值表示左侧的偏移量，负值表示右侧的缩进值。数组下标从1开始。</span><br><span class=\"line\">--\tlength - 子数组的长度。如果指定负值，则该函数返回[offset，array_length - length。如果省略该值，则该函数返回[offset，the_end_of_array]。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarraySlice([1,2,3,4,5,6], 0, 3), -- 无返回值</span><br><span class=\"line\">\tarraySlice([1,2,NULL,5,6], 1, 3), -- [1,2,0]</span><br><span class=\"line\">\tarraySlice([&#x27;one&#x27;,&#x27;two&#x27;,NULL], 1, 3), -- [&#x27;one&#x27;,&#x27;two&#x27;,&#x27;&#x27;]</span><br><span class=\"line\"> \tarraySlice([1,2,3,4,5,6], 1, 3); -- [1,2,3]</span><br><span class=\"line\"> \t \t</span><br><span class=\"line\">-- 16.数组排序：arraySort([func,] arr, ……)</span><br><span class=\"line\">-- 注意：如果在字符串数组中，&#x27;&#x27;和NULL是需要特别对待的，&#x27;&#x27;需要放在最前面，而NULL则是按顺序存放到最后的。</span><br><span class=\"line\">-- arraySort是高阶函数。您可以将lambda函数作为第一个参数传递给它。在这种情况下，排序顺序由lambda函数的调用结果决定。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarraySort([&#x27;a&#x27;,&#x27;&#x27;,NULL,&#x27;c&#x27;,&#x27;b&#x27;]) AS hasNullempty1, --[&#x27;&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;&#x27;]  (第一个是&#x27;&#x27;,最后一个&#x27;&#x27;起始是NULL)</span><br><span class=\"line\">\tarraySort(array(&#x27;ac&#x27;,&#x27;ab&#x27;,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNull, -- [&#x27;ab&#x27;,&#x27;ac&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;]</span><br><span class=\"line\">\tarraySort(array(&#x27;ac&#x27;,&#x27;&#x27;,&#x27;ab&#x27;,NULL,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNullempty2, -- [&#x27;&#x27;,&#x27;ab&#x27;,&#x27;ac&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;,&#x27;&#x27;]</span><br><span class=\"line\">\tarraySort([5,4,3,2,1]) AS numSorted,-- [1,2,3,4,5] (数字排序)</span><br><span class=\"line\">\tarraySort([&#x27;ca&#x27;,&#x27;bb&#x27;,&#x27;ac&#x27;]) AS strSorted;-- [&#x27;ac&#x27;,&#x27;bb&#x27;,&#x27;ca&#x27;] (字符串排序)</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarraySort([NULL, 1, 3, NULL, 2]) AS sortedArr, -- [1,2,3,0,0]</span><br><span class=\"line\">\tarrayReverse(sortedArr) AS reverseSortdArr;-- [0,0,3,2,1]</span><br><span class=\"line\">-- 下面这种排序的实质，正数转成负数，再在数学上比较升序排序。</span><br><span class=\"line\">SELECT arraySort(x -&gt; -x, [1,2,3]) as res; -- [3,2,1] 降序：（高阶函数用法）</span><br><span class=\"line\">SELECT arraySort((x) -&gt; -x, [1,2,3]) as res; -- [3,2,1] 降序：（高阶函数用法）</span><br><span class=\"line\">SELECT arraySort(x -&gt; x, [5,4,3,1,2,3]) as res; -- [1,2,3,3,4,5] 升序：（高阶函数用法）</span><br><span class=\"line\">SELECT arraySort((x) -&gt; x, [5,4,3,1,2,3]) as res; -- [1,2,3,3,4,5] 升序：（高阶函数用法）</span><br><span class=\"line\">-- arraySort(lambda, arr1, arr2) </span><br><span class=\"line\">SELECT arraySort((x, y) -&gt; y, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res; -- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">SELECT arraySort((x, y) -&gt; -y, [0, 1, 2], [1, 2, 3]) as res; -- [2,1,0]</span><br><span class=\"line\">-- 再次提醒：NULL, NaN, Inf的排序顺序：</span><br><span class=\"line\">--\t含义：</span><br><span class=\"line\">--\t    -Inf 是数组中的第一个。</span><br><span class=\"line\">--\t    NULL 是数组中的最后一个。</span><br><span class=\"line\">--\t    NaN  在NULL的前面。</span><br><span class=\"line\">--\t    Inf  在NaN的前面。</span><br><span class=\"line\">-- 出现异常：RuntimeException: Parse exception: </span><br><span class=\"line\">-- \tByteFragment&#123;[[-inf,-4,1,2,3,inf,nan,nan,NULL,NULL]], start=0, len=37&#125;</span><br><span class=\"line\">SELECT arraySort([1, nan, 2, NULL, 3, nan, -4, NULL, inf, -inf]);</span><br><span class=\"line\">-- 17.数组翻转：arrayReverse([func,] arr, ……)</span><br><span class=\"line\">-- 如果是NULL的话在排序的过程中，根据数组的数据类型进行默认值填充。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayReverse(array(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,NULL)) AS hasOneNull, -- [&#x27;&#x27;,&#x27;c&#x27;,&#x27;b&#x27;,&#x27;a&#x27;]</span><br><span class=\"line\">\tarrayReverse(array(&#x27;ac&#x27;,&#x27;ab&#x27;,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNull, -- [&#x27;&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;ab&#x27;,&#x27;ac&#x27;]</span><br><span class=\"line\">\t--网格视图： [&#x27;[NULL]&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;,&#x27;ab&#x27;,&#x27;[NULL]&#x27;,&#x27;&#x27;,&#x27;ac&#x27;]；文本视图 ：[&#x27;&#x27;,&#x27;ad&#x27;,&#x27;bc&#x27;,&#x27;&#x27;,&#x27;ab&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;ac&#x27;]</span><br><span class=\"line\">\tarrayReverse(array(&#x27;ac&#x27;,&#x27;&#x27;,NULL,&#x27;ab&#x27;,&#x27;&#x27;,&#x27;bc&#x27;,&#x27;ad&#x27;,NULL)) AS hasNullEmpty, </span><br><span class=\"line\">\tarrayReverse(array(NULL, 3, NULL, 2, 1)),-- [1,2,0,3,0]</span><br><span class=\"line\">\tarrayReverse([1,2,3,4]);-- [4,3,2,1]</span><br><span class=\"line\">-- 18.数组排序并翻转：arraySort([func,] arr, ...)</span><br><span class=\"line\">SELECT arrayReverseSort([1, 3, 3, 0]); -- [3,3,1,0]</span><br><span class=\"line\">SELECT arrayReverseSort([&#x27;hello&#x27;, &#x27;world&#x27;, &#x27;!&#x27;]); -- [&#x27;world&#x27;,&#x27;hello&#x27;,&#x27;!&#x27;]</span><br><span class=\"line\">--RuntimeException: Parse exception: ByteFragment&#123;[[inf,3,2,1,-4,-inf,nan,nan,NULL,NULL]], start=0, len=37&#125;</span><br><span class=\"line\">SELECT arrayReverseSort([1, nan, 2, NULL, 3, nan, -4, NULL, inf, -inf]) as res;-- [inf,3,2,1,-4,-inf,nan,nan,NULL,NULL]</span><br><span class=\"line\">-- 下面的执行顺序为：</span><br><span class=\"line\">--    1.首先，根据lambda函数的调用结果对源数组（[1, 2, 3]）进行排序。 结果是[3, 2, 1]。</span><br><span class=\"line\">--    2.反转上一步获得的数组。 所以，最终的结果是[1, 2, 3]。</span><br><span class=\"line\">SELECT arrayReverseSort((x) -&gt; -x, [1, 2, 3]) as res; -- [1,2,3]</span><br><span class=\"line\">SELECT arrayReverseSort((x) -&gt; x, [1, 2, 3]) as res; -- [1,2,3]</span><br><span class=\"line\">-- 下面的执行顺序为：</span><br><span class=\"line\">--    1.首先，根据lambda函数的调用结果对源数组（[&#x27;hello&#x27;，&#x27;world&#x27;]）进行排序。 其中，在第二个数组（[2,1]）中定义了源数组中相应元素的排序键。 所以，排序结果[&#x27;world&#x27;，&#x27;hello&#x27;]。</span><br><span class=\"line\">--    2.反转上一步骤中获得的排序数组。 所以，最终的结果是[&#x27;hello&#x27;，&#x27;world&#x27;]。</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; y, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;-- [&#x27;hello&#x27;,&#x27;world&#x27;]</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; -y, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;-- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; x, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;-- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">--出现异常：Illegal type String of argument </span><br><span class=\"line\">--SELECT arrayReverseSort((x, y) -&gt; -x, [&#x27;hello&#x27;, &#x27;world&#x27;], [2, 1]) as res;</span><br><span class=\"line\">SELECT arrayReverseSort((x, y) -&gt; x, [&#x27;hello&#x27;, &#x27;world&#x27;], [1, 2]) as res;-- [&#x27;world&#x27;,&#x27;hello&#x27;]</span><br><span class=\"line\">-- 19.统计数组中不重复元素的个数。arrayUniq(arr,……)</span><br><span class=\"line\">-- ① 如果传递一个参数，则计算数组中不同元素的数量。</span><br><span class=\"line\">-- ② 如果传递了多个参数，则它计算多个数组中相应位置的不同元素元组的数量</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayUniq([1,2,3]), -- 3</span><br><span class=\"line\">\tarrayUniq([1,2,2,2,3]); -- 3</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayUniq([1,2,3],[2,3,4]),</span><br><span class=\"line\">\tarrayUniq([1,2,2],[1,3,3]);</span><br><span class=\"line\">-- 20.数组的特殊功能：arrayJoin(arr)  这是一个非常有用的函数。</span><br><span class=\"line\">-- 解释：此函数将数组作为参数，并将该行在结果集中复制数组元素个数</span><br><span class=\"line\">SELECT arrayJoin([1, 2, 3] AS src) AS dst, &#x27;Hello&#x27;, src;</span><br><span class=\"line\"> -- 每个元素扩大两倍；</span><br><span class=\"line\">SELECT arrayJoin([1,2,3]) * 2;</span><br><span class=\"line\">SELECT arrayJoin([-1,-2,0,1,2]) * 2;</span><br><span class=\"line\">--出现异常： Illegal types Array(UInt8) and Array(UInt8) of arguments of function multiply</span><br><span class=\"line\">--SELECT multiply(array(1,2,3), 2); </span><br><span class=\"line\">SELECT multiply(arrayJoin([-1,-2,0,1,2]), 2);</span><br><span class=\"line\"> -- 每个元素缩小两倍</span><br><span class=\"line\">SELECT arrayJoin([-4,-2,0,2,4]) / 2;</span><br><span class=\"line\">SELECT divide(arrayJoin([-4,-2,0,2,4]) , 2);</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 21.arrayDifference(arr)</span><br><span class=\"line\">-- 返回一个数组，其中包含所有相邻元素对之间的差值</span><br><span class=\"line\">SELECT arrayDifference([1,2,3,4]);-- [0,1,1,1]</span><br><span class=\"line\">SELECT arrayDifference([1,3,10,50]);-- [0,2,7,40]</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 22. arrayDistinct(arr)返回一个包含所有数组中不同元素的数组.</span><br><span class=\"line\">-- 类似于java的Set集合，对list集合进行去重。</span><br><span class=\"line\">SELECT arrayDistinct(array(1,2,3,4,4,4)); -- [1,2,3,4]</span><br><span class=\"line\">SELECT arrayDistinct([1,2,2,3,4,2,2,5,4,5]); -- [1,2,3,4,5]</span><br><span class=\"line\">SELECT arrayDistinct(array(0,1,NULL,3,4,4,4)); -- [0,1,3,4]</span><br><span class=\"line\">-- 数组去重统计元素个数</span><br><span class=\"line\">SELECT uniq(arrayJoin([1,2,3,6,3])); -- 4 表示数组去重后元素的个数</span><br><span class=\"line\">SELECT uniqArray([1,2,3,4,1,2,3,4]); -- 4 表示数组去重后元素的个数</span><br><span class=\"line\">-- 数组元素累计</span><br><span class=\"line\">SELECT sumArray([1,2,3,4,5]);-- 15</span><br><span class=\"line\">SELECT sum(arraySum([1,2,3,4,5])); -- 15</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 23. arrayEnumerateDense(arr) 返回与源数组大小相同的数组，指示每个元素首次出现在源数组中的位置</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarrayEnumerateDense([10,20,20,10,30]) AS numArrEnumDense,-- [1,2,2,1,3]</span><br><span class=\"line\">\t-- [1,1,2,3,4,1,3,5,5]</span><br><span class=\"line\">\tarrayEnumerateDense([10,10,2,12,3,10,12,NULL,NULL]) as arrEnumDenseHasNull,</span><br><span class=\"line\">\t-- [1,2,1,1,2,3]</span><br><span class=\"line\">\tarrayEnumerateDense([10,20,10,10,20,30]) AS arrEnumDese2;</span><br><span class=\"line\">-- 24. arrayIntersect(arr,……) 返回所有数组元素的交集。</span><br><span class=\"line\">-- 如果arr的数目只有一个，则返回它本身；如果有多个数组,则返回所有数组中元素的交集。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\t-- 注意：最后得到的数组元素的顺序。（有什么影响吗？）</span><br><span class=\"line\">\tarrayIntersect([&#x27;one&#x27;,&#x27;two&#x27;],[&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;]) as uniStrArr1, -- [&#x27;two&#x27;,&#x27;one&#x27;]</span><br><span class=\"line\">\tarrayIntersect([&#x27;aaa&#x27;,&#x27;bbb&#x27;],[&#x27;bbb&#x27;,&#x27;aaa&#x27;,&#x27;three&#x27;]) as uniStrArr2, -- [&#x27;bbb&#x27;,&#x27;aaa&#x27;]</span><br><span class=\"line\">\tarrayIntersect([1,2],[1,2,3]) as uniArr1, -- [1,2]</span><br><span class=\"line\">\tarrayIntersect([1,2],[1,2,3],[2,3,4],[2,3,4]) as uniArr2; -- 2</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tarrayIntersect([1,2], [3,4]), -- []</span><br><span class=\"line\">\tarrayIntersect([1,2]);-- [1,2]</span><br><span class=\"line\">-- 25.arrayReduce(agg_func, arr1, ...)</span><br><span class=\"line\">-- agg_func 为聚合函数，传入到数组当中。</span><br><span class=\"line\">-- 将聚合函数应用于数组并返回其结果.如果聚合函数具有多个参数，则此函数可应用于相同大小的多个数组。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tarrayReduce(&#x27;max&#x27;, [1,2,3]) AS minNum,--最大值 3</span><br><span class=\"line\">\tarrayReduce(&#x27;min&#x27;, [1,2,3]) AS maxNum,--最小值 1</span><br><span class=\"line\">\tarrayReduce(&#x27;sum&#x27;, [1,2,3]) AS sumNum;--求和 6</span><br><span class=\"line\">-- 十三、 字符串查分合并函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 字符串拆分合并函数</span><br><span class=\"line\">-- 1.splitByChar(separator, s) 将字符串以‘separator’拆分成多个子串。</span><br><span class=\"line\">-- ‘separator’必须为仅包含一个字符的字符串常量。 返回拆分后的子串的数组。</span><br><span class=\"line\">--  如果分隔符出现在字符串的开头或结尾，或者如果有多个连续的分隔符，则将在对应位置填充空的子串。</span><br><span class=\"line\">SELECT splitByChar(&#x27;,&#x27;, &#x27;hello,world!&#x27;); -- [&#x27;hello&#x27;,&#x27;world!&#x27;]</span><br><span class=\"line\">--下面异常：Illegal separator for function splitByChar. Must be exactly one byte.</span><br><span class=\"line\">--SELECT splitByChar(&#x27;or&#x27;, &#x27;hello,world!&#x27;);</span><br><span class=\"line\">-- 2.splitByString(separator, s)</span><br><span class=\"line\">-- 与上面相同，但它使用多个字符的字符串作为分隔符。 该字符串必须为非空</span><br><span class=\"line\">SELECT splitByString(&#x27;or&#x27;,&#x27;goodorniceorgreat&#x27;); -- [&#x27;good&#x27;,&#x27;nice&#x27;,&#x27;great&#x27;]</span><br><span class=\"line\">-- 3.alphaTokens(s)  从范围a-z和A-Z中选择连续字节的子字符串。返回子字符串数组</span><br><span class=\"line\">SELECT alphaTokens(&#x27;abca1abc&#x27;); -- [&#x27;abca&#x27;,&#x27;abc&#x27;]</span><br><span class=\"line\">SELECT alphaTokens(&#x27;abc1232abc2wer3rtty&#x27;); -- [&#x27;abc&#x27;,&#x27;abc&#x27;,&#x27;wer&#x27;,&#x27;rtty&#x27;]</span><br><span class=\"line\">-- 4.数组元素合并函数：arrayStringConcat(arr[, sparator])</span><br><span class=\"line\">-- 使用separator将数组中列出的字符串拼接起来。</span><br><span class=\"line\">-- ‘separator’是一个可选参数：一个常量字符串，默认情况下设置为空字符串。 返回拼接后的字符串</span><br><span class=\"line\">SELECT arrayStringConcat([1,2,3], &#x27;-&#x27;); -- 出现异常，要求数组必须是字符串string类型的元素</span><br><span class=\"line\">SELECT arrayStringConcat([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;]); -- onetwothree</span><br><span class=\"line\">SELECT arrayStringConcat([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;], &#x27;-&#x27;); -- one-two-three</span><br><span class=\"line\">SELECT arrayStringConcat([&#x27;one&#x27;,&#x27;two&#x27;,&#x27;three&#x27;,&#x27;&#x27;], &#x27;-&#x27;);--  one-two-three- 注意：NULL不能存在arr中</span><br><span class=\"line\"> </span><br><span class=\"line\">--十四、位操作符</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 位操作符</span><br><span class=\"line\">--位操作函数适用于UInt8，UInt16，UInt32，UInt64，Int8，Int16，Int32，Int64，Float32或Float64中的任何类型。</span><br><span class=\"line\">--结果类型是一个整数，其位数等于其参数的最大位。</span><br><span class=\"line\">--如果至少有一个参数为有符数字，则结果为有符数字。如果参数是浮点数，则将其强制转换为Int64。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tbitAnd(1,0), -- 0</span><br><span class=\"line\">\tbitAnd(1,1), -- 1</span><br><span class=\"line\">\tbitAnd(1,2), -- 0</span><br><span class=\"line\">\tbitAnd(-1,0), -- 0</span><br><span class=\"line\">\tbitAnd(-1,-2), -- -2</span><br><span class=\"line\">\tbitAnd(-10,-1), -- -10</span><br><span class=\"line\">\tbitOr(1,2), -- 3</span><br><span class=\"line\">\tbitOr(1,0), -- 1</span><br><span class=\"line\">\tbitOr(2,0), -- 2</span><br><span class=\"line\">\tbitOr(0,2); -- 2</span><br><span class=\"line\">SELECT bitXor(1, 2), bitXor(20, 15), bitNot(2);-- 3 27 253</span><br><span class=\"line\"> </span><br><span class=\"line\">--十五、Hash函数：可以用于将元素不可逆的伪随机打乱。</span><br><span class=\"line\">-- 注意：伪随机！</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\t-- 计算字符串的MD5值。（ 如果您不需要一定使用MD5，请使用‘sipHash64’函数。）</span><br><span class=\"line\">\thalfMD5(&#x27;HELLO WORLD!&#x27;),</span><br><span class=\"line\">\thalfMD5(12);</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tMD5(&#x27;drew-zero,78967&#x27;);</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\t-- 为任何类型的整数计算32位的哈希。 这是相对高效的非加密Hash函数</span><br><span class=\"line\">\tintHash32(1221232132132) AS intHash32,</span><br><span class=\"line\">\t-- 推荐：从任何类型的整数计算64位哈希码。 它的工作速度比intHash32函数快。</span><br><span class=\"line\">\tintHash64(1221232132132) AS intHash64,</span><br><span class=\"line\">\t-- 计算任意数量字符串的CityHash64或使用特定实现的Hash函数计算任意数量其他类型的Hash。</span><br><span class=\"line\">\tcityHash64(&#x27;username&#x27;) AS cityHash64,</span><br><span class=\"line\">\t-- 1.使用sha1或者sha224加密的话，只能用于字符串</span><br><span class=\"line\">\t-- 2.字符串 需使用单引号。</span><br><span class=\"line\">\tSHA1(&#x27;1232131&#x27;) AS sha1,</span><br><span class=\"line\">\tSHA224(&#x27;1232131&#x27;) AS sha224,</span><br><span class=\"line\">\tSHA256(&#x27;DREW-ZERO&#x27;) AS sha256;</span><br><span class=\"line\">-- URLHash(url[, N]) 一种快速的非加密哈希函数，用于规范化的从URL获得的字符串</span><br><span class=\"line\">--  从一个字符串计算一个哈希，如果结尾存在尾随符号/，？或#则忽略。 URLHash（s，N） </span><br><span class=\"line\">-- 计算URL层次结构中字符串到N级别的哈希值，如果末尾存在尾随符号/，？或#则忽略。 URL的层级与URLHierarchy中的层级相同</span><br><span class=\"line\">-- 用处：此函数被用于Yandex.Metrica。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tURLHash(&#x27;www.baidu.com&#x27;), \t -- 11390370829909720855</span><br><span class=\"line\">\tURLHash(&#x27;www.baidu.com&#x27;, 0), -- 11390370829909720855</span><br><span class=\"line\">\t-- </span><br><span class=\"line\">\tURLHash(&#x27;www.baidu.com&#x27;, 1); -- 11160318154034397263</span><br><span class=\"line\">-- farmHash64(s)  计算字符串的FarmHash64。 接受一个String类型的参数。返回UInt64。</span><br><span class=\"line\">SELECT farmHash64(&#x27;www.runoob.com&#x27;); -- 6668483584160323388</span><br><span class=\"line\">-- javaHash(s) 计算字符串的JavaHash。 接受一个String类型的参数。返回Int32。</span><br><span class=\"line\">SELECT javaHash(&#x27;www.baidu.com&#x27;); -- 270263191</span><br><span class=\"line\">-- hiveHash(s) 计算字符串的HiveHash。 接受一个String类型的参数。返回Int32。 与JavaHash相同，但不会返回负数</span><br><span class=\"line\">SELECT hiveHash(&#x27;www.baidu.com&#x27;); -- 270263191</span><br><span class=\"line\"> </span><br><span class=\"line\">--十六、随机函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; 随机函数</span><br><span class=\"line\">-- 解释：随机函数使用非加密方式生成【伪随机】数字。</span><br><span class=\"line\">-- ① 所有随机函数都只接受一个参数或不接受任何参数。</span><br><span class=\"line\">-- ② 您可以向它传递任何类型的参数，但传递的参数将不会使用在任何随机数生成过程中。</span><br><span class=\"line\">-- ③  此参数的唯一目的是防止公共子表达式消除，以便在相同的查询中使用相同的随机函数生成不同的随机数</span><br><span class=\"line\">-- rand() 函数：返回一个UInt32类型的随机数字，所有UInt32类型的数字被生成的概率均相等。</span><br><span class=\"line\">-- rand64() 函数：返回一个UInt64类型的随机数字，所有UInt64类型的数字被生成的概率均相等。</span><br><span class=\"line\">-- randConstant() 函数：返回一个UInt32类型的随机数字，该函数不同之处在于仅为每个数据块参数一个随机数。</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\trand(), -- 1751687411</span><br><span class=\"line\">\trand(10), -- 1124981728</span><br><span class=\"line\">\trand64(),</span><br><span class=\"line\">\trand64(10),</span><br><span class=\"line\">\trandConstant(),</span><br><span class=\"line\">\trandConstant();</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 十七、编码函数：</span><br><span class=\"line\">-- hex(), unhex(), UUIDStringToNum(str), UUIDNumToString(str),bitmaskToList(num) ...</span><br><span class=\"line\">-- 1.hex函数编码</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\t-- 68656C6C6F20776F726C64212C68656C6C6F20636C69636B686F757365</span><br><span class=\"line\">\thex(&#x27;hello world!,hello clickhouse&#x27;) AS hexStr,</span><br><span class=\"line\">\thex(now()) AS hexDatetime, -- 5D414BA2</span><br><span class=\"line\">\thex(toDate(now())) AS hexDate; --46BC</span><br><span class=\"line\">\t</span><br><span class=\"line\">-- 2.接受包含36个字符的字符串，格式为“123e4567-e89b-12d3-a456-426655440000”，并将其转化为FixedString（16）返回</span><br><span class=\"line\">SELECT UUIDStringToNum(&#x27;123e4567-e89b-12d3-a456-426655440000&#x27;);</span><br><span class=\"line\">-- 3. 接受一个整数。返回一个UInt64类型数组，其中包含一组2的幂列表，其列表中的所有值相加等于这个整数。数组中的数字按升序排列。</span><br><span class=\"line\">-- bitmaskToArray(num)</span><br><span class=\"line\">SELECT bitmaskToArray(10); -- [2,8]</span><br><span class=\"line\">SELECT bitmaskToArray(100); -- [4,32,64]</span><br><span class=\"line\">-- 4.接受一个整数。返回一个字符串，其中包含一组2的幂列表，其列表中的所有值相加等于这个整数。列表使用逗号分割，按升序排列。</span><br><span class=\"line\">-- bitmaskToList(num) </span><br><span class=\"line\">SELECT bitmaskToList(10); -- 2,8</span><br><span class=\"line\">SELECT bitmaskToList(100); -- 4,32,64</span><br><span class=\"line\">SELECT bitmaskToList(0); -- &#x27;&#x27; 空字符串</span><br><span class=\"line\"> </span><br><span class=\"line\">--十八、UUID函数</span><br><span class=\"line\">---&gt;&gt;&gt;&gt;&gt;&gt; UUID函数</span><br><span class=\"line\">-- 1.generateUUIDv4()  返回 UUID类型的值。</span><br><span class=\"line\">SELECT generateUUIDv4() as randomUUID; -- 随机生成一个UUIDv4的字符串（b6940dfe-0dc9-4788-bac7-319d13235a2e）</span><br><span class=\"line\">SELECT replaceAll(toString(generateUUIDv4()), &#x27;-&#x27;, &#x27;&#x27;) AS replaceUUID; -- 9d1947ea4fcf450da5391feb6142cab6</span><br><span class=\"line\">-- 2.toUUID(s) 将string类型的值 转换成UUID类型的值</span><br><span class=\"line\">SELECT toUUID(&#x27;61f0c404-5cb3-11e7-907b-a6006ad3dba0&#x27;) AS uuid;</span><br><span class=\"line\">-- 3.接受一个String类型的值，其中包含36个字符且格式为xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx，</span><br><span class=\"line\">--   将其转换为UUID的数值并以FixedString(16)将其返回。</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">    &#x27;612f3c40-5d3b-217e-707b-6a546a3d7b29&#x27; AS uuid, -- 612f3c40-5d3b-217e-707b-6a546a3d7b29</span><br><span class=\"line\">    UUIDStringToNum(uuid) AS bytes; --a/&lt;@];!~p&#123;jTj=&#123;)</span><br><span class=\"line\">    </span><br><span class=\"line\">-- 4. UUIDNumToString() 接受一个FixedString(16)类型的值，返回其对应的String表现形式。</span><br><span class=\"line\">SELECT &#x27;a/&lt;@];!~p&#123;jTj=&#123;)&#x27; AS bytes,</span><br><span class=\"line\">    UUIDNumToString(toFixedString(bytes, 16)) AS uuid;</span><br><span class=\"line\">--- 二十、 URL函数：所有这些功能都不遵循RFC。它们被最大程度简化以提高性能。</span><br><span class=\"line\">--- 什么事RFC？</span><br><span class=\"line\">----  Request For Comments（RFC），是一系列以编号排定的文件。文件收集了有关互联网相关信息，以及UNIX和互联网社区的软件文件。</span><br><span class=\"line\">-- 1. 截取函数：如果URL中没有要截取的内容则返回空字符串。</span><br><span class=\"line\">SELECT protocol(&#x27;http://www.baidu.com&#x27;);-- http</span><br><span class=\"line\">SELECT protocol(&#x27;https://www.baidu.com&#x27;);-- https</span><br><span class=\"line\">SELECT protocol(&#x27;www.baidu.com&#x27;);-- &#x27;&#x27;</span><br><span class=\"line\">-- 获取域名。</span><br><span class=\"line\">SELECT domain(&#x27;http://www.baidu.com&#x27;); -- www.baidu.com</span><br><span class=\"line\">SELECT domain(&#x27;https://www.google.com.cn&#x27;); -- www.google.com.cn</span><br><span class=\"line\">-- 返回域名并删除第一个‘www.’</span><br><span class=\"line\">SELECT domainWithoutWWW(&#x27;http://www.baidu.com&#x27;);-- baidu.com</span><br><span class=\"line\">SELECT domainWithoutWWW(&#x27;www.baidu.com&#x27;);-- &#x27;&#x27;</span><br><span class=\"line\">-- 返回顶级域名。例如：.ru</span><br><span class=\"line\">SELECT topLevelDomain(&#x27;http://www.runoob.com.cn&#x27;); -- cn</span><br><span class=\"line\">SELECT topLevelDomain(&#x27;https://www.huse.edn&#x27;); -- edu</span><br><span class=\"line\">-- 返回“第一个有效子域名”</span><br><span class=\"line\">--\t如果顶级域名为‘com’，‘net’，‘org’或者‘co’则第一个有效子域名为二级域名。否则则返回三级域名</span><br><span class=\"line\">SELECT firstSignificantSubdomain(&#x27;https://news.yandex.com.tr/&#x27;); -- yandex</span><br><span class=\"line\">-- 返回包含顶级域名与第一个有效子域名之间的内容(参阅上面内容)</span><br><span class=\"line\">SELECT cutToFirstSignificantSubdomain(&#x27;https://news.yandex.com.tr/&#x27;); -- yandex.com.tr</span><br><span class=\"line\">-- 返回URL路径</span><br><span class=\"line\">SELECT path(&#x27;https://blog.csdn.net/u012111465/article/details/85250030&#x27;);-- /u012111465/article/details/85250030</span><br><span class=\"line\">-- 与上面相同，但包括请求参数和fragment。</span><br><span class=\"line\">SELECT pathFull(&#x27;https://clickhouse.yandex/#quick-start&#x27;); -- /#quick-start</span><br><span class=\"line\">-- 返回请求参数。例如：page=1&amp;lr=213。请求参数不包含问号已经# 以及# 之后所有的内容。</span><br><span class=\"line\">SELECT queryString(&#x27;http://www.baidu.com/?page=1&amp;lr=234&#x27;); -- page=1&amp;lr=234 (根据？确定)</span><br><span class=\"line\">SELECT queryString(&#x27;http://www.baidu.com/page=1&amp;lr=234&#x27;); -- &#x27;&#x27;</span><br><span class=\"line\">-- 返回URL的fragment标识。fragment不包含#。</span><br><span class=\"line\">SELECT fragment(&#x27;https://clickhouse.yandex/#quick-start&#x27;); -- quick-start</span><br><span class=\"line\">-- 返回请求参数和fragment标识。例如：page=1#29390。</span><br><span class=\"line\">SELECT queryStringAndFragment(&#x27;https://www.baidu.com/s?ie=utf-8&amp;rsv_sug7=100#ei-ai&#x27;); -- ie=utf-8&amp;rsv_sug7=100#ei-ai</span><br><span class=\"line\"> </span><br><span class=\"line\">-- 2. 删除URL中的部分内容 (如果URL中不包含指定的部分，则URL不变。)</span><br><span class=\"line\">SELECT cutWWW(&#x27;www.baidu.com&#x27;);-- www.baidu.com</span><br><span class=\"line\">SELECT cutWWW(&#x27;https://www.baidu.com&#x27;);-- www.baidu.com</span><br><span class=\"line\">SELECT cutWWW(&#x27;https://www.baidu.com&#x27;);-- www.baidu.com</span><br><span class=\"line\">-- 删除请求参数</span><br><span class=\"line\">SELECT cutQueryString(&#x27;http://www.baidu.com/1?page=1&#x27;); -- http://www.baidu.com/1</span><br><span class=\"line\">-- 删除fragment标识。#同样也会被删除。</span><br><span class=\"line\">SELECT cutFragment(&#x27;http://www.baidu.com/#quick-demo&#x27;); -- http://www.baidu.com/</span><br><span class=\"line\">-- 删除请求参数以及fragment标识。问号以及#也会被删除。</span><br><span class=\"line\">SELECT cutQueryStringAndFragment(&#x27;http://www.baidu.com/1?page=23#we&#x27;); -- http://www.baidu.com/1</span><br><span class=\"line\">-- cutURLParameter(URL, name) 删除URL中名称为‘name’的参数。下面例子中的参数是：&amp;之后，resv,name</span><br><span class=\"line\">SELECT cutURLParameter(&#x27;http://www.baidu.com/1?page=1#erre&amp;resv=23&amp;name=user&#x27;,&#x27;resv&#x27;);</span><br><span class=\"line\"> </span><br><span class=\"line\">--二十一、IP函数</span><br><span class=\"line\"> </span><br><span class=\"line\">--二十二、条件函数</span><br><span class=\"line\">SELECT IF(12 &gt; 10 , 12, 20);</span><br><span class=\"line\">SELECT 12 &gt; 10 ? 12 : 10;</span><br><span class=\"line\">SELECT if(greater(12, 10), 12, 10);</span><br><span class=\"line\"> </span><br><span class=\"line\">--二十三、操作符函数替换</span><br><span class=\"line\">-- clickhouse自带的计算操作符函数（对接mybatis的时候不用将“&lt;”之类的符号转换成 “age1 &lt;![CDATA[ &lt; ]] 2&gt;”）</span><br><span class=\"line\">-- 1.等于(注意函数名称的大小，严格区分大小写)</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tequals(&#x27;hello&#x27;,&#x27;hello&#x27;), -- 1</span><br><span class=\"line\">\tequals(&#x27;ab&#x27;,&#x27;ba&#x27;); -- 0</span><br><span class=\"line\">-- 2.不等于</span><br><span class=\"line\">SELECT </span><br><span class=\"line\">\tnotEquals(&#x27;a&#x27;,&#x27;b&#x27;), -- 1</span><br><span class=\"line\">\tnotEquals(&#x27;a&#x27;,&#x27;a&#x27;), -- 0</span><br><span class=\"line\">\tnotEquals(12, 12), -- 1</span><br><span class=\"line\">\tnotEquals(12, 1010); -- 0</span><br><span class=\"line\">-- 3.大于( 如果前者大于后者，则返回1；否则返回0)</span><br><span class=\"line\">SELECT</span><br><span class=\"line\">\tgreater(12, 10), -- 1 </span><br><span class=\"line\">\tgreater(10, 12), -- 0</span><br><span class=\"line\">\tgreater(12, 12), -- 0</span><br><span class=\"line\">\tgreater(&#x27;b&#x27;,&#x27;a&#x27;), -- 1</span><br><span class=\"line\">\tgreater(&#x27;a&#x27;,&#x27;b&#x27;); -- 0</span><br><span class=\"line\">-- 3.1 扩展：提取两者中最大的值</span><br><span class=\"line\">SELECT greatest(12,11); -- 12</span><br><span class=\"line\">-- 4.小于（如果前者小于后者，则返回1；否则返回0）</span><br><span class=\"line\">SELECT less(12,23); -- 1</span><br><span class=\"line\">SELECT less(120,23); -- 0</span><br><span class=\"line\">-- 5.大于或等于</span><br><span class=\"line\">SELECT greaterOrEquals(12,12); -- 1</span><br><span class=\"line\">SELECT greaterOrEquals(120,12); -- 1</span><br><span class=\"line\">-- 6.小于或等于</span><br><span class=\"line\">SELECT lessOrEquals(12,12); -- 1</span><br><span class=\"line\">SELECT lessOrEquals(12,129); -- 1</span><br><span class=\"line\">-- ===== String操作</span><br><span class=\"line\">-- *. a LIKE s</span><br><span class=\"line\">SELECT like(&#x27;a&#x27;, &#x27;abcd&#x27;); -- 0</span><br><span class=\"line\">SELECT like(&#x27;a&#x27;, &#x27;a&#x27;); -- 1</span><br></pre></td></tr></table></figure>\n</div>","categories":[{"name":"ClickHouse","path":"api/categories/ClickHouse.json"}],"tags":[{"name":"ClickHouse","path":"api/tags/ClickHouse.json"}]}