{"title":"mysql-slave踩坑日记","slug":"Mysql-slave踩坑日记","date":"2018-10-12T01:59:34.000Z","updated":"2022-06-02T01:05:59.614Z","comments":true,"path":"api/articles/Mysql-slave踩坑日记.json","excerpt":"晚上闲来无事，想找点事做于是手动删除了一些无用的数据库，手贱的是在从库里面删除了","covers":null,"content":"<h3 id=\"晚上闲来无事，想找点事做\"><a href=\"#晚上闲来无事，想找点事做\" class=\"headerlink\" title=\"晚上闲来无事，想找点事做\"></a>晚上闲来无事，想找点事做</h3><p>于是手动删除了一些无用的数据库，手贱的是在从库里面删除了</p>\n<p>然后，在主库里面也进行该数据库删除，发现未手动删除的从库正常执行了binlog日志中的sql语句</p>\n<h3 id=\"一段时间后，问题出现了\"><a href=\"#一段时间后，问题出现了\" class=\"headerlink\" title=\"一段时间后，问题出现了\"></a>一段时间后，问题出现了</h3><p>自己手动在主库里插入一条语句，发现两个备库只有一个备库更新了最新的数据，手动删除数据库的那个从库并未更新语句</p>\n<p>接下来，查询从库mysql日志</p>\n<p>发现</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2018-08-19T19:27:04.704407+08:00 6 [ERROR] Slave SQL for channel &#x27;&#x27;: Error &#x27;Can&#x27;t drop database &#x27;jeewx-h5&#x27;; database doesn&#x27;t exist&#x27; on query. Default database: &#x27;jeewx-h5&#x27;. Query: &#x27;DROP DATABASE `jeewx-h5`&#x27;, Error_code: 1008</span><br><span class=\"line\">2018-08-19T19:27:04.704429+08:00 6 [Warning] Slave: Can&#x27;t drop database &#x27;jeewx-h5&#x27;; database doesn&#x27;t exist Error_code: 1008</span><br></pre></td></tr></table></figure>\n<p>主从复制报错，出现故障，导致后面的日志内容无法进行</p>\n<p>接下来，解决方法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p </span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; slave stop; </span><br><span class=\"line\">Query OK, 0 rows affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; set GLOBAL SQL_SLAVE_SKIP_COUNTER=1;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; slave start;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; show slave status\\G;</span><br><span class=\"line\"></span><br><span class=\"line\">Slave_IO_Running: Yes</span><br><span class=\"line\">Slave_SQL_Running: Yes</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Last_IO_Errno: 0</span><br><span class=\"line\">Last_IO_Error: </span><br><span class=\"line\">Last_SQL_Errno: 0</span><br></pre></td></tr></table></figure>\n<p>将指针移动下一位，问题得到解决。并且后面的操作正常执行。</p>\n<p>仅此记录，另外 少操作，甚至不操作从库！！！！</p>\n\n","more":"\n<p>然后，在主库里面也进行该数据库删除，发现未手动删除的从库正常执行了binlog日志中的sql语句</p>\n<h3 id=\"一段时间后，问题出现了\"><a href=\"#一段时间后，问题出现了\" class=\"headerlink\" title=\"一段时间后，问题出现了\"></a>一段时间后，问题出现了</h3><p>自己手动在主库里插入一条语句，发现两个备库只有一个备库更新了最新的数据，手动删除数据库的那个从库并未更新语句</p>\n<p>接下来，查询从库mysql日志</p>\n<p>发现</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2018-08-19T19:27:04.704407+08:00 6 [ERROR] Slave SQL for channel &#x27;&#x27;: Error &#x27;Can&#x27;t drop database &#x27;jeewx-h5&#x27;; database doesn&#x27;t exist&#x27; on query. Default database: &#x27;jeewx-h5&#x27;. Query: &#x27;DROP DATABASE `jeewx-h5`&#x27;, Error_code: 1008</span><br><span class=\"line\">2018-08-19T19:27:04.704429+08:00 6 [Warning] Slave: Can&#x27;t drop database &#x27;jeewx-h5&#x27;; database doesn&#x27;t exist Error_code: 1008</span><br></pre></td></tr></table></figure>\n<p>主从复制报错，出现故障，导致后面的日志内容无法进行</p>\n<p>接下来，解决方法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p </span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; slave stop; </span><br><span class=\"line\">Query OK, 0 rows affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; set GLOBAL SQL_SLAVE_SKIP_COUNTER=1;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; slave start;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; show slave status\\G;</span><br><span class=\"line\"></span><br><span class=\"line\">Slave_IO_Running: Yes</span><br><span class=\"line\">Slave_SQL_Running: Yes</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Last_IO_Errno: 0</span><br><span class=\"line\">Last_IO_Error: </span><br><span class=\"line\">Last_SQL_Errno: 0</span><br></pre></td></tr></table></figure>\n<p>将指针移动下一位，问题得到解决。并且后面的操作正常执行。</p>\n<p>仅此记录，另外 少操作，甚至不操作从库！！！！</p>\n\n","categories":[{"name":"数据库","path":"api/categories/数据库.json"}],"tags":[{"name":"mysql","path":"api/tags/mysql.json"}]}