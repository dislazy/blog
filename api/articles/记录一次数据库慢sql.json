{"title":"记录一次数据库慢sql","slug":"记录一次数据库慢sql","date":"2018-10-10T10:28:34.000Z","updated":"2022-06-02T01:05:59.618Z","comments":true,"path":"api/articles/记录一次数据库慢sql.json","excerpt":"起因由于数据库系统的查询一直在使用es监控，某一天收到一条报警记录","covers":["https://imagecdn.bosong.online/image/sn43arsfqujg1ra6cmp10lg2hf.png"],"content":"<h3 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h3><p>由于数据库系统的查询一直在使用es监控，某一天收到一条报警记录</p>\n<p><img src=\"https://imagecdn.bosong.online/image/sn43arsfqujg1ra6cmp10lg2hf.png\" class=\"lazyload\" data-srcset=\"https://imagecdn.bosong.online/image/sn43arsfqujg1ra6cmp10lg2hf.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"慢SQL\"></p>\n<p>在遇到这个告警的时候，还存在一些疑问，这么简单的sql居然会报慢查询。</p>\n<h3 id=\"经过\"><a href=\"#经过\" class=\"headerlink\" title=\"经过\"></a>经过</h3><p>经过查看数据库数据，发现由于topic_type只有1和0两个状态，就未给它设置索引</p>\n<h3 id=\"结果\"><a href=\"#结果\" class=\"headerlink\" title=\"结果\"></a>结果</h3><p>经过查看该表有数据40+W，在sql中topic_type&#x3D;1的数据比formid的数据多的多，导致了查询时导致了慢sql</p>\n<h3 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h3><p>修改了sql的查询顺序，发现再也没有慢日志产生，由此得出结论：</p>\n<ol>\n<li>数据库语句查询条件并非并行，而是有先后关系，所以一定要注意查询语句的先后关系，范围小的先放前面</li>\n<li>该加索引就必须加索引，数据库性能达到瓶颈能导致整个系统崩溃</li>\n<li>微服务环境下，不仅要分库分表，还需要将不同服务的数据库分别部署，增强容灾性，一旦某个库达到瓶颈，后果会形成链式反应</li>\n</ol>\n\n","more":"\n<p><img src=\"https://imagecdn.bosong.online/image/sn43arsfqujg1ra6cmp10lg2hf.png\" class=\"lazyload\" data-srcset=\"https://imagecdn.bosong.online/image/sn43arsfqujg1ra6cmp10lg2hf.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"慢SQL\"></p>\n<p>在遇到这个告警的时候，还存在一些疑问，这么简单的sql居然会报慢查询。</p>\n<h3 id=\"经过\"><a href=\"#经过\" class=\"headerlink\" title=\"经过\"></a>经过</h3><p>经过查看数据库数据，发现由于topic_type只有1和0两个状态，就未给它设置索引</p>\n<h3 id=\"结果\"><a href=\"#结果\" class=\"headerlink\" title=\"结果\"></a>结果</h3><p>经过查看该表有数据40+W，在sql中topic_type&#x3D;1的数据比formid的数据多的多，导致了查询时导致了慢sql</p>\n<h3 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h3><p>修改了sql的查询顺序，发现再也没有慢日志产生，由此得出结论：</p>\n<ol>\n<li>数据库语句查询条件并非并行，而是有先后关系，所以一定要注意查询语句的先后关系，范围小的先放前面</li>\n<li>该加索引就必须加索引，数据库性能达到瓶颈能导致整个系统崩溃</li>\n<li>微服务环境下，不仅要分库分表，还需要将不同服务的数据库分别部署，增强容灾性，一旦某个库达到瓶颈，后果会形成链式反应</li>\n</ol>\n\n","categories":[{"name":"Java","path":"api/categories/Java.json"}],"tags":[{"name":"mysql","path":"api/tags/mysql.json"}]}