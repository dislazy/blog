{"title":"centos7.4安装MYSQL及主从同步设置","slug":"Centos7-4安装MYSQL及主从同步设置","date":"2018-10-12T02:06:46.000Z","updated":"2022-06-02T01:05:59.611Z","comments":true,"path":"api/articles/Centos7-4安装MYSQL及主从同步设置.json","excerpt":"1. 下载mysql wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz","covers":null,"content":"<h3 id=\"1-下载mysql\"><a href=\"#1-下载mysql\" class=\"headerlink\" title=\"1. 下载mysql\"></a>1. 下载mysql</h3><p><code> wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz</code></p>\n<h3 id=\"2-解压mysql\"><a href=\"#2-解压mysql\" class=\"headerlink\" title=\"2. 解压mysql\"></a>2. 解压mysql</h3><p><code>tar -zxvf mysql mysql-5.7.23-linux-glibc2.12-i686.tar.gz</code></p>\n<h3 id=\"3-将mysql安装文件移动到系统目录文件夹\"><a href=\"#3-将mysql安装文件移动到系统目录文件夹\" class=\"headerlink\" title=\"3. 将mysql安装文件移动到系统目录文件夹\"></a>3. 将mysql安装文件移动到系统目录文件夹</h3><p><code>cp -r mysql/* /usr/local/mysql</code></p>\n<h3 id=\"4-安装mysql\"><a href=\"#4-安装mysql\" class=\"headerlink\" title=\"4. 安装mysql\"></a>4. 安装mysql</h3><p>&#96;bin&#x2F;mysqld –initialize –user&#x3D;mysql –basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql –datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data –lc_messages_dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;share –lc_messages&#x3D;en_US&#96;&#96;</p>\n<h4 id=\"遇到问题\"><a href=\"#遇到问题\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>bin/mysqld: error while loading shared libraries: libnuma.so.1: cannot open shared object file: No such file or directory</code></p>\n<h4 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>yum -y install numactl</code></p>\n<h4 id=\"遇到问题-1\"><a href=\"#遇到问题-1\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code> [ERROR] Could not open file &#39;/var/log/mysqld.log&#39; for error logging: Permission denied</code></p>\n<h4 id=\"解决方案-1\"><a href=\"#解决方案-1\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>touch /var/log/mysqld.log</code></p>\n<p><code>chown mysql:mysql /var/log/mysqld.log</code></p>\n<h4 id=\"设置mysql快捷启动\"><a href=\"#设置mysql快捷启动\" class=\"headerlink\" title=\"- 设置mysql快捷启动\"></a>- 设置mysql快捷启动</h4><p><code> ln -s /usr/local/mysql/bin/mysql /usr/bin</code></p>\n<h4 id=\"启动mysql\"><a href=\"#启动mysql\" class=\"headerlink\" title=\"- 启动mysql\"></a>- 启动mysql</h4><p><code>service start mysql</code></p>\n<h4 id=\"遇到问题-2\"><a href=\"#遇到问题-2\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>/usr/local/mysql/bin/mysqld: Can&#39;t create/write to file &#39;/var/run/mysqld/mysqld.pid&#39; (Errcode: 13 - Permission denied)</code></p>\n<h4 id=\"解决方案-2\"><a href=\"#解决方案-2\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>chown -R mysql /var/run/mysqld</code><br><code>chgrp -R mysql /var/run/mysqld</code></p>\n<p><code>service start mysql</code></p>\n<h4 id=\"关闭mysql\"><a href=\"#关闭mysql\" class=\"headerlink\" title=\"- 关闭mysql\"></a>- 关闭mysql</h4><p><code>systemctl stop mysql</code></p>\n<h4 id=\"遇到问题-3\"><a href=\"#遇到问题-3\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>Failed to restart mysql.service: Unit not found.</code></p>\n<h4 id=\"解决方案-3\"><a href=\"#解决方案-3\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>systemctl enable mysql.service </code> </p>\n<p><code>进入/var/log/mysqld.log 最后一行为密码</code></p>\n<h4 id=\"进入mysql\"><a href=\"#进入mysql\" class=\"headerlink\" title=\"- 进入mysql\"></a>- 进入mysql</h4><p><code>mysql -uroot -p</code></p>\n<h4 id=\"修改初始密码\"><a href=\"#修改初始密码\" class=\"headerlink\" title=\"- 修改初始密码\"></a>- 修改初始密码</h4><p><code>set password=password(&quot;new password&quot;);</code></p>\n<h4 id=\"设置外部访问\"><a href=\"#设置外部访问\" class=\"headerlink\" title=\"- 设置外部访问\"></a>- 设置外部访问</h4><p><code>use mysql; </code></p>\n<p><code>update user set host=&#39;%&#39; where user=&#39;root&#39; and host=&#39;localhost&#39;;</code></p>\n<p><code>flush privileges; </code></p>\n<h4 id=\"记录File和Position对应的信息-主库\"><a href=\"#记录File和Position对应的信息-主库\" class=\"headerlink\" title=\"- 记录File和Position对应的信息(主库)\"></a>- 记录File和Position对应的信息(主库)</h4><p><code>show master status; </code></p>\n<h3 id=\"配置同步（从库）\"><a href=\"#配置同步（从库）\" class=\"headerlink\" title=\"- 配置同步（从库）\"></a>- 配置同步（从库）</h3><p><code>stop slave;</code></p>\n<p><code>change master to master_host=&#39;35.203.167.155:31521&#39;, master_user=&#39;root&#39;,master_password=&#39;qwe13579QWE&#39;,master_file_log=&#39;log.000007&#39;,master_log_pos=&#39;1357&#39;;</code> </p>\n<h4 id=\"遇到问题-4\"><a href=\"#遇到问题-4\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;master_file_log=log.000007,master_log_pos=1357&#39; at line 1</code></p>\n<h4 id=\"解决方案（MASTER-LOG-FILE-MASTER-LOG-POS为主库的信息）\"><a href=\"#解决方案（MASTER-LOG-FILE-MASTER-LOG-POS为主库的信息）\" class=\"headerlink\" title=\"- 解决方案（MASTER_LOG_FILE,MASTER_LOG_POS为主库的信息）\"></a>- 解决方案（MASTER_LOG_FILE,MASTER_LOG_POS为主库的信息）</h4><p><code>CHANGE MASTER TO MASTER_HOST=&#39;192.168,1.1&#39;, MASTER_PORT=3306,MASTER_USER=&#39;root&#39;, MASTER_PASSWORD=&#39;mypassword&#39;, MASTER_LOG_FILE=&#39;log.000004&#39;, MASTER_LOG_POS=1665;</code></p>\n<h4 id=\"启动同步\"><a href=\"#启动同步\" class=\"headerlink\" title=\"- 启动同步\"></a>- 启动同步</h4><p><code>start slave;</code></p>\n<h4 id=\"查看同步状态\"><a href=\"#查看同步状态\" class=\"headerlink\" title=\"查看同步状态\"></a>查看同步状态</h4><p><code>show slave status \\G;</code></p>\n<h4 id=\"验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。\"><a href=\"#验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。\" class=\"headerlink\" title=\"验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。\"></a>验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。</h4>\n","more":"\n<h3 id=\"2-解压mysql\"><a href=\"#2-解压mysql\" class=\"headerlink\" title=\"2. 解压mysql\"></a>2. 解压mysql</h3><p><code>tar -zxvf mysql mysql-5.7.23-linux-glibc2.12-i686.tar.gz</code></p>\n<h3 id=\"3-将mysql安装文件移动到系统目录文件夹\"><a href=\"#3-将mysql安装文件移动到系统目录文件夹\" class=\"headerlink\" title=\"3. 将mysql安装文件移动到系统目录文件夹\"></a>3. 将mysql安装文件移动到系统目录文件夹</h3><p><code>cp -r mysql/* /usr/local/mysql</code></p>\n<h3 id=\"4-安装mysql\"><a href=\"#4-安装mysql\" class=\"headerlink\" title=\"4. 安装mysql\"></a>4. 安装mysql</h3><p>&#96;bin&#x2F;mysqld –initialize –user&#x3D;mysql –basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql –datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data –lc_messages_dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;share –lc_messages&#x3D;en_US&#96;&#96;</p>\n<h4 id=\"遇到问题\"><a href=\"#遇到问题\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>bin/mysqld: error while loading shared libraries: libnuma.so.1: cannot open shared object file: No such file or directory</code></p>\n<h4 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>yum -y install numactl</code></p>\n<h4 id=\"遇到问题-1\"><a href=\"#遇到问题-1\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code> [ERROR] Could not open file &#39;/var/log/mysqld.log&#39; for error logging: Permission denied</code></p>\n<h4 id=\"解决方案-1\"><a href=\"#解决方案-1\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>touch /var/log/mysqld.log</code></p>\n<p><code>chown mysql:mysql /var/log/mysqld.log</code></p>\n<h4 id=\"设置mysql快捷启动\"><a href=\"#设置mysql快捷启动\" class=\"headerlink\" title=\"- 设置mysql快捷启动\"></a>- 设置mysql快捷启动</h4><p><code> ln -s /usr/local/mysql/bin/mysql /usr/bin</code></p>\n<h4 id=\"启动mysql\"><a href=\"#启动mysql\" class=\"headerlink\" title=\"- 启动mysql\"></a>- 启动mysql</h4><p><code>service start mysql</code></p>\n<h4 id=\"遇到问题-2\"><a href=\"#遇到问题-2\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>/usr/local/mysql/bin/mysqld: Can&#39;t create/write to file &#39;/var/run/mysqld/mysqld.pid&#39; (Errcode: 13 - Permission denied)</code></p>\n<h4 id=\"解决方案-2\"><a href=\"#解决方案-2\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>chown -R mysql /var/run/mysqld</code><br><code>chgrp -R mysql /var/run/mysqld</code></p>\n<p><code>service start mysql</code></p>\n<h4 id=\"关闭mysql\"><a href=\"#关闭mysql\" class=\"headerlink\" title=\"- 关闭mysql\"></a>- 关闭mysql</h4><p><code>systemctl stop mysql</code></p>\n<h4 id=\"遇到问题-3\"><a href=\"#遇到问题-3\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>Failed to restart mysql.service: Unit not found.</code></p>\n<h4 id=\"解决方案-3\"><a href=\"#解决方案-3\" class=\"headerlink\" title=\"- 解决方案\"></a>- 解决方案</h4><p><code>systemctl enable mysql.service </code> </p>\n<p><code>进入/var/log/mysqld.log 最后一行为密码</code></p>\n<h4 id=\"进入mysql\"><a href=\"#进入mysql\" class=\"headerlink\" title=\"- 进入mysql\"></a>- 进入mysql</h4><p><code>mysql -uroot -p</code></p>\n<h4 id=\"修改初始密码\"><a href=\"#修改初始密码\" class=\"headerlink\" title=\"- 修改初始密码\"></a>- 修改初始密码</h4><p><code>set password=password(&quot;new password&quot;);</code></p>\n<h4 id=\"设置外部访问\"><a href=\"#设置外部访问\" class=\"headerlink\" title=\"- 设置外部访问\"></a>- 设置外部访问</h4><p><code>use mysql; </code></p>\n<p><code>update user set host=&#39;%&#39; where user=&#39;root&#39; and host=&#39;localhost&#39;;</code></p>\n<p><code>flush privileges; </code></p>\n<h4 id=\"记录File和Position对应的信息-主库\"><a href=\"#记录File和Position对应的信息-主库\" class=\"headerlink\" title=\"- 记录File和Position对应的信息(主库)\"></a>- 记录File和Position对应的信息(主库)</h4><p><code>show master status; </code></p>\n<h3 id=\"配置同步（从库）\"><a href=\"#配置同步（从库）\" class=\"headerlink\" title=\"- 配置同步（从库）\"></a>- 配置同步（从库）</h3><p><code>stop slave;</code></p>\n<p><code>change master to master_host=&#39;35.203.167.155:31521&#39;, master_user=&#39;root&#39;,master_password=&#39;qwe13579QWE&#39;,master_file_log=&#39;log.000007&#39;,master_log_pos=&#39;1357&#39;;</code> </p>\n<h4 id=\"遇到问题-4\"><a href=\"#遇到问题-4\" class=\"headerlink\" title=\"- 遇到问题\"></a>- 遇到问题</h4><p><code>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;master_file_log=log.000007,master_log_pos=1357&#39; at line 1</code></p>\n<h4 id=\"解决方案（MASTER-LOG-FILE-MASTER-LOG-POS为主库的信息）\"><a href=\"#解决方案（MASTER-LOG-FILE-MASTER-LOG-POS为主库的信息）\" class=\"headerlink\" title=\"- 解决方案（MASTER_LOG_FILE,MASTER_LOG_POS为主库的信息）\"></a>- 解决方案（MASTER_LOG_FILE,MASTER_LOG_POS为主库的信息）</h4><p><code>CHANGE MASTER TO MASTER_HOST=&#39;192.168,1.1&#39;, MASTER_PORT=3306,MASTER_USER=&#39;root&#39;, MASTER_PASSWORD=&#39;mypassword&#39;, MASTER_LOG_FILE=&#39;log.000004&#39;, MASTER_LOG_POS=1665;</code></p>\n<h4 id=\"启动同步\"><a href=\"#启动同步\" class=\"headerlink\" title=\"- 启动同步\"></a>- 启动同步</h4><p><code>start slave;</code></p>\n<h4 id=\"查看同步状态\"><a href=\"#查看同步状态\" class=\"headerlink\" title=\"查看同步状态\"></a>查看同步状态</h4><p><code>show slave status \\G;</code></p>\n<h4 id=\"验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。\"><a href=\"#验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。\" class=\"headerlink\" title=\"验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。\"></a>验证，可在主库创建数据库后查看从库，然后从从库再写数据，验证主动同步。</h4>\n","categories":[{"name":"Linux","path":"api/categories/Linux.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"}]}