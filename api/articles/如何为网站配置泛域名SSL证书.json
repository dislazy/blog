{"title":"如何为网站申请泛域名证书并自动续约","slug":"如何为网站配置泛域名SSL证书","date":"2021-06-02T15:33:34.000Z","updated":"2022-06-02T01:05:59.617Z","comments":true,"path":"api/articles/如何为网站配置泛域名SSL证书.json","excerpt":"自己有很多的网站，每次都需要申请SSL证书，所以最近在鼓捣怎么申请泛域名证书减少工作量。","covers":null,"content":"<p>自己有很多的网站，每次都需要申请SSL证书，所以最近在鼓捣怎么申请泛域名证书减少工作量。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>现在随着chrome大力推广网站HTTPS化，推进互联网的数据安全进程，SSL证书的申请渠道有非常的多，个人用户申请免费的SSL证书很方便。</p>\n<p>阿里云、腾讯云都支持20个以内的单域名SSL证书，有效期是一年，但是因为网站比较多，所以首先考虑方案是申请一个免费的泛域名证书，这样在一级的所有网站可以复用一套SSL证书，更新起来也不用那么繁琐。</p>\n<h3 id=\"申请SSL免费证书的渠道\"><a href=\"#申请SSL免费证书的渠道\" class=\"headerlink\" title=\"申请SSL免费证书的渠道\"></a>申请SSL免费证书的渠道</h3><ul>\n<li>使用<a href=\"https://certbot.eff.org/\">certbot</a>申请SSL证书，可申请普通域名和泛域名证书并配置自动续约，有效期90天</li>\n<li>使用<a href=\"https://github.com/acmesh-official/acme.sh\">acme.sh</a>申请SSL证书，可申请普通域名和泛域名证书并配置自动续约，有效期90天</li>\n<li>使用<a href=\"https://www.aliyun.com/\">阿里云</a>申请SSL证书，仅可申请普通单域名证书，过期需要人工再次申请，有效期365天</li>\n<li>使用<a href=\"https://cloud.tencent.com/\">腾讯云</a>申请SSL证书，仅可申请普通单域名证书，过期需要人工再次申请，有效期365天</li>\n<li>…<h3 id=\"使用acme-sh申请免费的SSL证书并配置自动续期\"><a href=\"#使用acme-sh申请免费的SSL证书并配置自动续期\" class=\"headerlink\" title=\"使用acme.sh申请免费的SSL证书并配置自动续期\"></a>使用acme.sh申请免费的SSL证书并配置自动续期</h3></li>\n</ul>\n<h4 id=\"为什么选择acme-sh\"><a href=\"#为什么选择acme-sh\" class=\"headerlink\" title=\"为什么选择acme.sh?\"></a>为什么选择acme.sh?</h4><ul>\n<li>由于certbot的方式需要安装对应的安装包并且需要支持python环境，配置起来较为麻烦，故不选</li>\n<li>由于阿里云、腾讯云证书都是单域名的，故不选</li>\n<li>acme.sh完全基本shell脚本，不需要安装对应依赖，直接下载脚本shell脚本即可安装对应的证书<h4 id=\"如何使用acme-sh申请证书-macos\"><a href=\"#如何使用acme-sh申请证书-macos\" class=\"headerlink\" title=\"如何使用acme.sh申请证书(macos)\"></a>如何使用acme.sh申请证书(macos)</h4></li>\n</ul>\n<ol>\n<li>打开iterm，然后<code>mkidr  .acme.sh</code></li>\n<li>然后<code>git clone [https://github.com/acmesh-official/acme.sh.git](https://github.com/acmesh-official/acme.sh.git)</code>到对应文件夹下即可</li>\n<li>申请SSL证书需要验证域名的所有权，由于我使用的是阿里云的万网域名，所以可以直接使用阿里云的DNS进行验证并且自动完成添加TXT配置完成域名验证，<a href=\"https://github.com/acmesh-official/acme.sh/wiki/dnsapi\">参见文档</a></li>\n<li>配置好ak之后，即可申请SSL证书<code>acme.sh --issue   --dns dns_ali -d &#39;*.bosong.online&#39;</code>等待命令执行完成，完成SSL证书的申请</li>\n<li>证书是在我的mac电脑上申请的，所以可以scp到对应服务器进行替换即可，替换完成重启nginx<h4 id=\"如何为SSL证书自动续约\"><a href=\"#如何为SSL证书自动续约\" class=\"headerlink\" title=\"如何为SSL证书自动续约\"></a>如何为SSL证书自动续约</h4>使用acme.sh的方式申请的SSL证书有效期只有90天，这代表一年最少得人工操作4次证书申请以及发布到对应服务器重启nginx。<br>所以将对应的命令写成了shell命令，使用<code>crontab -e</code>定期执行脚本，进行证书的检查更新以及自动传送及重启nginx，对应脚本如下(仅供参考，可以根据实际情况进行修改)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">acme.sh  --renew --dns dns_ali -d <span class=\"string\">&#x27;*.bosong.online&#x27;</span></span><br><span class=\"line\">scp <span class=\"comment\">#证书的生成路径 ce-155:/data/nginx/conf/cert/</span></span><br><span class=\"line\">ssh ce-155 &amp;&amp; systemctl reload nginx.service &amp;&amp; <span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h3>使用工具自动申请SSL证书简单并且很方便，能节省自己很多证书，泛域名证书用起来也会很酷，文章有些中如果有错误或者不到位的地方，请多多原谅。</li>\n</ol>\n<h3 id=\"参阅文档\"><a href=\"#参阅文档\" class=\"headerlink\" title=\"参阅文档\"></a>参阅文档</h3><ul>\n<li><a href=\"https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E\">acme.sh中文部署指南</a></li>\n<li><a href=\"https://github.com/acmesh-official/acme.sh/wiki/dnsapi\">acme.shDNS配置指南</a></li>\n<li><a href=\"https://github.com/acmesh-official/acme.sh/wiki\">acme.sh英文部署指南</a></li>\n</ul>\n\n","more":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>现在随着chrome大力推广网站HTTPS化，推进互联网的数据安全进程，SSL证书的申请渠道有非常的多，个人用户申请免费的SSL证书很方便。</p>\n<p>阿里云、腾讯云都支持20个以内的单域名SSL证书，有效期是一年，但是因为网站比较多，所以首先考虑方案是申请一个免费的泛域名证书，这样在一级的所有网站可以复用一套SSL证书，更新起来也不用那么繁琐。</p>\n<h3 id=\"申请SSL免费证书的渠道\"><a href=\"#申请SSL免费证书的渠道\" class=\"headerlink\" title=\"申请SSL免费证书的渠道\"></a>申请SSL免费证书的渠道</h3><ul>\n<li>使用<a href=\"https://certbot.eff.org/\">certbot</a>申请SSL证书，可申请普通域名和泛域名证书并配置自动续约，有效期90天</li>\n<li>使用<a href=\"https://github.com/acmesh-official/acme.sh\">acme.sh</a>申请SSL证书，可申请普通域名和泛域名证书并配置自动续约，有效期90天</li>\n<li>使用<a href=\"https://www.aliyun.com/\">阿里云</a>申请SSL证书，仅可申请普通单域名证书，过期需要人工再次申请，有效期365天</li>\n<li>使用<a href=\"https://cloud.tencent.com/\">腾讯云</a>申请SSL证书，仅可申请普通单域名证书，过期需要人工再次申请，有效期365天</li>\n<li>…<h3 id=\"使用acme-sh申请免费的SSL证书并配置自动续期\"><a href=\"#使用acme-sh申请免费的SSL证书并配置自动续期\" class=\"headerlink\" title=\"使用acme.sh申请免费的SSL证书并配置自动续期\"></a>使用acme.sh申请免费的SSL证书并配置自动续期</h3></li>\n</ul>\n<h4 id=\"为什么选择acme-sh\"><a href=\"#为什么选择acme-sh\" class=\"headerlink\" title=\"为什么选择acme.sh?\"></a>为什么选择acme.sh?</h4><ul>\n<li>由于certbot的方式需要安装对应的安装包并且需要支持python环境，配置起来较为麻烦，故不选</li>\n<li>由于阿里云、腾讯云证书都是单域名的，故不选</li>\n<li>acme.sh完全基本shell脚本，不需要安装对应依赖，直接下载脚本shell脚本即可安装对应的证书<h4 id=\"如何使用acme-sh申请证书-macos\"><a href=\"#如何使用acme-sh申请证书-macos\" class=\"headerlink\" title=\"如何使用acme.sh申请证书(macos)\"></a>如何使用acme.sh申请证书(macos)</h4></li>\n</ul>\n<ol>\n<li>打开iterm，然后<code>mkidr  .acme.sh</code></li>\n<li>然后<code>git clone [https://github.com/acmesh-official/acme.sh.git](https://github.com/acmesh-official/acme.sh.git)</code>到对应文件夹下即可</li>\n<li>申请SSL证书需要验证域名的所有权，由于我使用的是阿里云的万网域名，所以可以直接使用阿里云的DNS进行验证并且自动完成添加TXT配置完成域名验证，<a href=\"https://github.com/acmesh-official/acme.sh/wiki/dnsapi\">参见文档</a></li>\n<li>配置好ak之后，即可申请SSL证书<code>acme.sh --issue   --dns dns_ali -d &#39;*.bosong.online&#39;</code>等待命令执行完成，完成SSL证书的申请</li>\n<li>证书是在我的mac电脑上申请的，所以可以scp到对应服务器进行替换即可，替换完成重启nginx<h4 id=\"如何为SSL证书自动续约\"><a href=\"#如何为SSL证书自动续约\" class=\"headerlink\" title=\"如何为SSL证书自动续约\"></a>如何为SSL证书自动续约</h4>使用acme.sh的方式申请的SSL证书有效期只有90天，这代表一年最少得人工操作4次证书申请以及发布到对应服务器重启nginx。<br>所以将对应的命令写成了shell命令，使用<code>crontab -e</code>定期执行脚本，进行证书的检查更新以及自动传送及重启nginx，对应脚本如下(仅供参考，可以根据实际情况进行修改)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">acme.sh  --renew --dns dns_ali -d <span class=\"string\">&#x27;*.bosong.online&#x27;</span></span><br><span class=\"line\">scp <span class=\"comment\">#证书的生成路径 ce-155:/data/nginx/conf/cert/</span></span><br><span class=\"line\">ssh ce-155 &amp;&amp; systemctl reload nginx.service &amp;&amp; <span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h3>使用工具自动申请SSL证书简单并且很方便，能节省自己很多证书，泛域名证书用起来也会很酷，文章有些中如果有错误或者不到位的地方，请多多原谅。</li>\n</ol>\n<h3 id=\"参阅文档\"><a href=\"#参阅文档\" class=\"headerlink\" title=\"参阅文档\"></a>参阅文档</h3><ul>\n<li><a href=\"https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E\">acme.sh中文部署指南</a></li>\n<li><a href=\"https://github.com/acmesh-official/acme.sh/wiki/dnsapi\">acme.shDNS配置指南</a></li>\n<li><a href=\"https://github.com/acmesh-official/acme.sh/wiki\">acme.sh英文部署指南</a></li>\n</ul>","categories":[{"name":"ssl","path":"api/categories/ssl.json"}],"tags":[{"name":"linux","path":"api/tags/linux.json"},{"name":"ssl","path":"api/tags/ssl.json"},{"name":"web","path":"api/tags/web.json"}]}