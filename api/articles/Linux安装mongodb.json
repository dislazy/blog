{"title":"Linux安装mongodb","slug":"Linux安装mongodb","date":"2021-04-28T07:40:17.000Z","updated":"2022-06-02T01:05:59.613Z","comments":true,"path":"api/articles/Linux安装mongodb.json","excerpt":null,"covers":null,"content":"<div class=\"story post-story\"><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>因为需要部署蚂蚁笔记，就想着将数据库放在云上，后来发现基本上所有的云厂商对Mongodb收费都比较高昂，所以就选择了便宜的方案，在公有云服务器上自建mongodb服务。<br>mongodb服务构建主要是使用的docker，数据挂载在磁盘固定的位置，并且定时进行同步</p>\n</div><div class=\"story post-story\"><h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><ul>\n<li><p>使用docker最新版的mongodb镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull mongo </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>给mongodb创建对应的本地数据存储空间以及数据备份空间</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/mongo-data</span><br><span class=\"line\">mkdir -p /data/mongo-backup</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>写docker容器创建命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#创建mongo容器并且指定对外Port为20011 挂载数据内容以及备份内容，`--auth` 开启mongo认证，不建议在公网环境暴露</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 20011:27017 --name mongo -v /data/mongo-data:/data/db -v /data/mongo-backup:/data/backup mongo --auth</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>启动mongo后创建对应账号</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it mongo /bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">mongo</span><br><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(&#123;user:&quot;root&quot;,pwd:&quot;password&quot;,roles:[&#123;role:&#x27;root&#x27;,db:&#x27;admin&#x27;&#125;]&#125;)</span><br><span class=\"line\">exit</span><br></pre></td></tr></table></figure></li>\n<li><p>定时进行数据备份</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#备份脚本</span><br><span class=\"line\">docker exec mongo sh -c &#x27;exec var=`date +%Y%m%d%H%M` &amp;&amp; mongodump -h localhost --port 27017 -u root -p password -d dbname -o /data/backup/$var_db.dat&#x27;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h3><p>使用docker部署mongo比较简单，需要注意的就是需要在启动时添加<code>--auth</code>开启认证，否则mongo就是在公网环境中暴露，很容易被攻击，备份恢复需要关注对应的mongodb版本是否兼容</p>\n</li>\n</ul>\n\n</div>","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>因为需要部署蚂蚁笔记，就想着将数据库放在云上，后来发现基本上所有的云厂商对Mongodb收费都比较高昂，所以就选择了便宜的方案，在公有云服务器上自建mongodb服务。<br>mongodb服务构建主要是使用的docker，数据挂载在磁盘固定的位置，并且定时进行同步</p>\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><ul>\n<li><p>使用docker最新版的mongodb镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull mongo </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>给mongodb创建对应的本地数据存储空间以及数据备份空间</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/mongo-data</span><br><span class=\"line\">mkdir -p /data/mongo-backup</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>写docker容器创建命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#创建mongo容器并且指定对外Port为20011 挂载数据内容以及备份内容，`--auth` 开启mongo认证，不建议在公网环境暴露</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 20011:27017 --name mongo -v /data/mongo-data:/data/db -v /data/mongo-backup:/data/backup mongo --auth</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>启动mongo后创建对应账号</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it mongo /bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">mongo</span><br><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(&#123;user:&quot;root&quot;,pwd:&quot;password&quot;,roles:[&#123;role:&#x27;root&#x27;,db:&#x27;admin&#x27;&#125;]&#125;)</span><br><span class=\"line\">exit</span><br></pre></td></tr></table></figure></li>\n<li><p>定时进行数据备份</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#备份脚本</span><br><span class=\"line\">docker exec mongo sh -c &#x27;exec var=`date +%Y%m%d%H%M` &amp;&amp; mongodump -h localhost --port 27017 -u root -p password -d dbname -o /data/backup/$var_db.dat&#x27;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h3><p>使用docker部署mongo比较简单，需要注意的就是需要在启动时添加<code>--auth</code>开启认证，否则mongo就是在公网环境中暴露，很容易被攻击，备份恢复需要关注对应的mongodb版本是否兼容</p>\n</li>\n</ul>\n","categories":[{"name":"Linux","path":"api/categories/Linux.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"Docker","path":"api/tags/Docker.json"},{"name":"mongodb","path":"api/tags/mongodb.json"}]}